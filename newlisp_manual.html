<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="generator" content="AsciiDoc 8.6.8">
<title>newLISP&#174;</title>
<style type="text/css">
/* Shared CSS for AsciiDoc xhtml11 and html5 backends */

/* Default font. */
body {
  font-family: Georgia,serif;
}

/* Title font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Arial,Helvetica,sans-serif;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}
h5 {
  font-size: 1.0em;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

pre {
  padding: 0;
  margin: 0;
}

#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
#email {
}
#revnumber, #revdate, #revremark {
}

#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #777777;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}

div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  #footer-badges { display: none; }
}

#toc {
  margin-bottom: 2.5em;
}

#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }

span.underline { text-decoration: underline; }
span.overline { text-decoration: overline; }
span.line-through { text-decoration: line-through; }


/*
 * xhtml11 specific
 *
 * */

tt {
  font-family: monospace;
  font-size: inherit;
  color: navy;
}

div.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


/*
 * html5 specific
 *
 * */

.monospaced {
  font-family: monospace;
  font-size: inherit;
  color: navy;
}

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #527bbd;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #527bbd;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #527bbd;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}


/*
 * manpage specific
 *
 * */

body.manpage h1 {
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  border-top: 2px solid silver;
  border-bottom: 2px solid silver;
}
body.manpage h2 {
  border-style: none;
}
body.manpage div.sectionbody {
  margin-left: 3em;
}

@media print {
  body.manpage div#toc { display: none; }
}


/*
 * Theme specific overrides of the preceding (asciidoc.css) CSS.
 *
 */
body {
  font-family: Garamond, Georgia, serif;
  font-size: 17px;
  color: #3E4349;
  line-height: 1.3em;
}
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Garmond, Georgia, serif;
  font-weight: normal;
  border-bottom-width: 0;
  color: #3E4349;
}
div.title, caption.title { color: #596673; font-weight: bold; }
h1 { font-size: 240%; }
h2 { font-size: 180%; }
h3 { font-size: 150%; }
h4 { font-size: 130%; }
h5 { font-size: 115%; }
h6 { font-size: 100%; }
#header h1 { margin-top: 0; }
#toc {
  color: #444444;
  line-height: 1.5;
  padding-top: 1.5em;
}
#toctitle {
  font-size: 20px;
}
#toc a {
    border-bottom: 1px dotted #999999;
    color: #444444 !important;
    text-decoration: none !important;
}
#toc a:hover {
    border-bottom: 1px solid #6D4100;
    color: #6D4100 !important;
    text-decoration: none !important;
}
div.toclevel1 { margin-top: 0.2em; font-size: 16px; }
div.toclevel2 { margin-top: 0.15em; font-size: 14px; }
em, dt, td.hdlist1 { color: black; }
strong { color: #3E4349; }
a { color: #004B6B; text-decoration: none; border-bottom: 1px dotted #004B6B; }
a:visited { color: #615FA0; border-bottom: 1px dotted #615FA0; }
a:hover { color: #6D4100; border-bottom: 1px solid #6D4100; }
div.tableblock > table, table.tableblock { border: 3px solid #E8E8E8; }
th.tableblock, td.tableblock { border: 1px solid #E8E8E8; }
ul > li > * { color: #3E4349; }
pre, tt, .monospaced { font-family: Consolas,Menlo,'Deja Vu Sans Mono','Bitstream Vera Sans Mono',monospace; }
tt, .monospaced { font-size: 0.9em; color: black;
}
div.exampleblock > div.content, div.sidebarblock > div.content, div.listingblock > div.content { border-width: 0 0 0 3px; border-color: #E8E8E8; }
div.verseblock { border-left-width: 0; margin-left: 3em; }
div.quoteblock { border-left-width: 3px; margin-left: 0; margin-right: 0;}
div.admonitionblock td.content { border-left: 3px solid #E8E8E8; }

/*
  pygmentize filter
*/
.highlight .hll { background-color: #ffffcc }
.highlight  { background: #f4f4f4; }
.highlight .c { color: #008800; font-style: italic } /* Comment */
.highlight .err { border: 1px solid #FF0000 } /* Error */
.highlight .k { color: #AA22FF; font-weight: bold } /* Keyword */
.highlight .o { color: #666666 } /* Operator */
.highlight .cm { color: #008800; font-style: italic } /* Comment.Multiline */
.highlight .cp { color: #008800 } /* Comment.Preproc */
.highlight .c1 { color: #008800; font-style: italic } /* Comment.Single */
.highlight .cs { color: #008800; font-weight: bold } /* Comment.Special */
.highlight .gd { color: #A00000 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #FF0000 } /* Generic.Error */
.highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight .gi { color: #00A000 } /* Generic.Inserted */
.highlight .go { color: #808080 } /* Generic.Output */
.highlight .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight .gt { color: #0040D0 } /* Generic.Traceback */
.highlight .kc { color: #AA22FF; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #AA22FF; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #AA22FF; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #AA22FF } /* Keyword.Pseudo */
.highlight .kr { color: #AA22FF; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #00BB00; font-weight: bold } /* Keyword.Type */
.highlight .m { color: #666666 } /* Literal.Number */
.highlight .s { color: #BB4444 } /* Literal.String */
.highlight .na { color: #BB4444 } /* Name.Attribute */
.highlight .nb { color: #AA22FF } /* Name.Builtin */
.highlight .nc { color: #0000FF } /* Name.Class */
.highlight .no { color: #880000 } /* Name.Constant */
.highlight .nd { color: #AA22FF } /* Name.Decorator */
.highlight .ni { color: #999999; font-weight: bold } /* Name.Entity */
.highlight .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #00A000 } /* Name.Function */
.highlight .nl { color: #A0A000 } /* Name.Label */
.highlight .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.highlight .nt { color: #008000; font-weight: bold } /* Name.Tag */
.highlight .nv { color: #B8860B } /* Name.Variable */
.highlight .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mf { color: #666666 } /* Literal.Number.Float */
.highlight .mh { color: #666666 } /* Literal.Number.Hex */
.highlight .mi { color: #666666 } /* Literal.Number.Integer */
.highlight .mo { color: #666666 } /* Literal.Number.Oct */
.highlight .sb { color: #BB4444 } /* Literal.String.Backtick */
.highlight .sc { color: #BB4444 } /* Literal.String.Char */
.highlight .sd { color: #BB4444; font-style: italic } /* Literal.String.Doc */
.highlight .s2 { color: #BB4444 } /* Literal.String.Double */
.highlight .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.highlight .sh { color: #BB4444 } /* Literal.String.Heredoc */
.highlight .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.highlight .sx { color: #008000 } /* Literal.String.Other */
.highlight .sr { color: #BB6688 } /* Literal.String.Regex */
.highlight .s1 { color: #BB4444 } /* Literal.String.Single */
.highlight .ss { color: #B8860B } /* Literal.String.Symbol */
.highlight .bp { color: #AA22FF } /* Name.Builtin.Pseudo */
.highlight .vc { color: #B8860B } /* Name.Variable.Class */
.highlight .vg { color: #B8860B } /* Name.Variable.Global */
.highlight .vi { color: #B8860B } /* Name.Variable.Instance */
.highlight .il { color: #666666 } /* Literal.Number.Integer.Long */


@media screen {
  body {
    max-width: 50em; /* approximately 80 characters wide */
    margin-left: 16em;
  }

  #toc {
    position: fixed;
    top: 0;
    left: 0;
    bottom: 0;
    width: 13em;
    padding: 0.5em;
    padding-bottom: 1.5em;
    margin: 0;
    overflow: auto;
    border-right: 3px solid #f8f8f8;
    background-color: white;
  }

  #toc .toclevel1 {
    margin-top: 0.5em;
  }

  #toc .toclevel2 {
    margin-top: 0.25em;
    display: list-item;
    color: #aaaaaa;
  }

  #toctitle {
    margin-top: 0.5em;
  }
}
</style>
<script type="text/javascript">
/*<![CDATA[*/
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([1-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  if (!toc) {
    return;
  }

  // Delete existing TOC entries in case we're reloading the TOC.
  var tocEntriesToRemove = [];
  var i;
  for (i = 0; i < toc.childNodes.length; i++) {
    var entry = toc.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div'
     && entry.getAttribute("class")
     && entry.getAttribute("class").match(/^toclevel/))
      tocEntriesToRemove.push(entry);
  }
  for (i = 0; i < tocEntriesToRemove.length; i++) {
    toc.removeChild(tocEntriesToRemove[i]);
  }

  // Rebuild TOC entries.
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  // Delete existing footnote entries in case we're reloading the footnodes.
  var i;
  var noteholder = document.getElementById("footnotes");
  if (!noteholder) {
    return;
  }
  var entriesToRemove = [];
  for (i = 0; i < noteholder.childNodes.length; i++) {
    var entry = noteholder.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div' && entry.getAttribute("class") == "footnote")
      entriesToRemove.push(entry);
  }
  for (i = 0; i < entriesToRemove.length; i++) {
    noteholder.removeChild(entriesToRemove[i]);
  }

  // Rebuild footnote entries.
  var cont = document.getElementById("content");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      var note = spans[i].getAttribute("data-note");
      if (!note) {
        // Use [\s\S] in place of . so multi-line matches work.
        // Because JavaScript has no s (dotall) regex flag.
        note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
        spans[i].innerHTML =
          "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
        spans[i].setAttribute("data-note", note);
      }
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
},

install: function(toclevels) {
  var timerId;

  function reinstall() {
    asciidoc.footnotes();
    if (toclevels) {
      asciidoc.toc(toclevels);
    }
  }

  function reinstallAndRemoveTimer() {
    clearInterval(timerId);
    reinstall();
  }

  timerId = setInterval(reinstall, 500);
  if (document.addEventListener)
    document.addEventListener("DOMContentLoaded", reinstallAndRemoveTimer, false);
  else
    window.onload = reinstallAndRemoveTimer;
}

}
asciidoc.install(3);
/*]]>*/
</script>
</head>
<body class="article">
<div id="header">
<h1>newLISP&#174;</h1>
<span id="author">Lutz Mueller</span><br>
<span id="revnumber">version 10.4.5,</span>
<span id="revdate">2013-01-20</span>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="sidebarblock">
<div class="content">
<div class="paragraph"><p><em>For Mac OS X, GNU Linux, Unix and Win32</em></p></div>
<div class="paragraph"><p><strong>User Manual and Reference v.10.4.5</strong></p></div>
<div class="paragraph"><p>Copyright &#169; 2012 Lutz Mueller <a href="http://www.nuevatec.com">www.nuevatec.com</a>.<br>
All rights reserved.<br>
Permission is granted to copy, distribute and/or modify this document<br>
under the terms of the GNU Free Documentation License,<br>
Version 1.2 or any later version published by the Free Software<br>
Foundation; with no Invariant Sections, no Front-Cover Texts,<br>
and no Back-Cover Texts. A copy of the license is included in the<br>
section entitled <a href="#GNUFDL">GNU Free Documentation License</a>.<br>
The accompanying software is protected by the <a href="#GNUGPL">GNU General<br>
Public License</a> V.3, June 2007.<br>
newLISP is a registered trademark of Lutz Mueller.<br></p></div>
</div></div>
<div id="toc">
  <div id="toctitle">Contents</div>
  <noscript><p><b>JavaScript must be enabled in your browser to display the table of contents.</b></p></noscript>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_newlisp_user_manual">newLISP User Manual</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_1_introduction">1. Introduction</h3>
<div class="paragraph"><p>newLISP focuses on the core components of Lisp: <em>lists</em>, <em>symbols</em>, and
<em>lambda expressions</em>. To these, newLISP adds <em>arrays</em>, <em>implicit
indexing</em> on lists and arrays, and <em>dynamic</em> and <em>lexical scoping</em>.
Lexical scoping is implemented using separate namespaces called
<em>contexts</em>.</p></div>
<div class="paragraph"><p>The result is an easier-to-learn Lisp that is even smaller than most
Scheme implementations, but which still has about 350 built-in
functions. Not much over 200k in size, newLISP is built for high
portability using only the most common Unix system C-libraries. It loads
quickly and has a small memory footprint. newLISP is as fast or faster
than other popular scripting languages and uses very few resources.</p></div>
<div class="paragraph"><p>Both built-in and user-defined functions, along with variables, share
the same global symbol tree and are manipulated by the same functions.
Lambda expressions and user-defined functions can be handled like any
other list expression.</p></div>
<div class="paragraph"><p>newLISP is dynamically scoped inside lexically separated contexts
(namespaces). Contexts in newLISP are used for multiple purposes. They
allow (1) partitioning of programs into modules, (2) the definition of
<em>Classes</em> in FOOP (Functional Object Oriented Programming), (3) the
definition of functions with state and (4) the creation of Hash trees
for associative key → value storage.</p></div>
<div class="paragraph"><p>newLISP&#8217;s efficient <em>red-black</em> tree implementation can handle millions
of symbols in namespaces or hashes without degrading performance.</p></div>
<div class="paragraph"><p>newLISP allocates and reclaims memory automatically, without using
traditional asynchronous garbage collection. All objects&#8201;&#8212;&#8201;except for
contexts, built-in primitives, and symbols&#8201;&#8212;&#8201;are passed by value and are
referenced only once. Upon creation objects are scheduled for delayed
deletion and Lisp cells are recycled for newly created objects. This
results in predictable processing times without the pauses found in
traditional garbage collection. newLISP&#8217;s unique automatic memory
management makes it the fastest interactive Lisp available. More than
any other Lisp, it implements the <em>data equals program</em> paradigm and
full self reflection.</p></div>
<div class="paragraph"><p>Many of newLISP&#8217;s built-in functions are polymorphic and accept a
variety of data types and optional parameters. This greatly reduces the
number of functions and syntactic forms necessary to learn and
implement. High-level functions are available for string and list
processing, financial math, statistics, and Artifial Intelligence
applications.</p></div>
<div class="paragraph"><p>newLISP has functions to modify, insert, or delete elements inside
complex <em>nested</em> lists or <em>multi-dimensional</em> array structures.</p></div>
<div class="paragraph"><p>Because strings can contain null characters in newLISP, they can be used
to process binary data with most string manipulating functions.</p></div>
<div class="paragraph"><p>newLISP can also be extended with a shared library interface to import
functions that access data in foreign binary data structures. The
distribution contains modules for importing popular C-library APIs.</p></div>
<div class="paragraph"><p>newLISP&#8217;s HTTP, TCP/IP, and UDP socket interfaces make it easy to write
distributed networked applications. Its built-in XML interface, along
with its text-processing features&#8201;&#8212;&#8201;Perl Compatible Regular Expressions
(PCRE) and text-parsing functions&#8201;&#8212;&#8201;make newLISP a useful tool for CGI
processing. The source distribution includes examples of HTML forms
processing. newLISP can be run a as a CGI capable web server using its
built-in http mode option.</p></div>
<div class="paragraph"><p>newLISP has built-in support for distributed processing on networks and
parallel, concurrent processing on the same CPU with one or more
processing cores.</p></div>
<div class="paragraph"><p>The source distribution can be compiled for Linux, Mac OS X/Darwin, BSDs
Solaris, and Win32. newLISP can be compiled as a 64-bit LP64 application
for full 64-bit memory addressing.</p></div>
<div class="sect3">
<h4 id="_newlisp_gs">newLISP-GS</h4>
<div class="paragraph"><p>newLISP-GS comprises a graphical user interface (GUI) and library
server. The GUI front-end is written in newLISP, whereas the library
server is Java based and uses the standard Java runtime environment
installed on all Windows and Mac OS X platforms. Applications built with
newLISP-GS can have the host operating system&#8217;s native look and feel.
Interfaces to GTK, Tcl/Tk and OpenGL graphics libraries are also
available.</p></div>
<div class="paragraph"><p>newLISP and Java are available for most operating systems. This makes
newLISP-GS a platform-independent solution for writing GUI applications.</p></div>
<div class="paragraph"><p>For more information on newLISP-GS, see
<a href="http://newlisp.org/guiserver">newLISP-GS</a>.</p></div>
</div>
<div class="sect3">
<h4 id="_licensing">Licensing</h4>
<div class="paragraph"><p>newLISP and newLISP-GS are licensed under version 3 of the
<a href="#GNUGPL">GPL (General Public License)</a>. The newLISP documentation as
well as other documentation packaged with newLISP are licensed under the
<a href="#GNUFDL">GNU Free Documentation License</a>.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_2_deprecated_functions_and_future_changes">2. Deprecated functions and future changes</h3>
<div class="paragraph"><p>Since version 10.3.0 newLISP can switch between IPv4 and IPv6 modes
during run-time using the new <a href="#net-ipv">net-ipv</a> function. The <span class="monospaced">-6</span>
commandline option can be used to start newLISP in IPv6 mode. After
transition to IPv6 the <span class="monospaced">-6</span> commandline switch will be changed to <span class="monospaced">-4</span>
for starting up in IPv4 mode.</p></div>
<div class="paragraph"><p>The old writing <span class="monospaced">parse-date</span> of <a href="#date-parse">date-parse</a> is still
recognized but deprecated since version 10.3.0. The old writing will be
removed in a future version.</p></div>
<div class="paragraph"><p>The functions <span class="monospaced">if-not</span> and <span class="monospaced">local</span> are deprecated and have been taken
out of the documentation. Both functions will keep on working for an
indefinite time.</p></div>
</div>
<div class="sect2">
<h3 id="_3_interactive_lisp_mode">3. Interactive Lisp mode</h3>
<div class="paragraph"><p>The best way to experience Lisp and experiment with it, is using
interactive mode in a terminal window or operating system command shell.
Since version 10.3, newLISP&#8217;s read-eval-print-loop (REPL) accepts
mult-line statements.</p></div>
<div class="paragraph"><p>To enter a multi-line statement hit the <span class="monospaced">[enter]</span> key on an empty line
after the system prompt. To exit multi-line mode, hit the <span class="monospaced">[enter]</span> key
again on an empty line. In the following example computer output is
shown with labels on the right.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="ss">&gt;</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">foo</span> <span class="ss">x</span> <span class="ss">y</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">+</span> <span class="ss">x</span> <span class="ss">y</span><span class="p">))</span>

<span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span> <span class="ss">y</span><span class="p">)</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">x</span> <span class="ss">y</span><span class="p">))</span>    <span class="c1"># &lt;output&gt;</span>
<span class="ss">&gt;</span> <span class="p">(</span><span class="nv">foo</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">)</span>
<span class="ss">7</span>                         <span class="c1"># &lt;output&gt;</span>
<span class="ss">&gt;</span>
</pre></div></div></div>
<div class="paragraph"><p>Note, that multi-line mode is only possible in an OS command terminal
window or command shell. The monitor window in the Java based newLISP-GS
IDE will not accept multi-line statements.</p></div>
<div class="paragraph"><p>Intercative Lisp mode can accept operating system shell commands. To hit
an OS command enter the <span class="monospaced">!</span> character right after the prompt,
immediately followed by the shell command:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&gt; !ls *.html
CodePatterns.html        MemoryManagement.html   newLISPdoc.html
ExpressionEvaluation.html   manual_frame.html       newlisp_index.html
License.html            newLISP-10.3-Release.html   newlisp_manual.html
&gt;</pre>
</div></div>
<div class="paragraph"><p>In the example a <span class="monospaced">ls</span> shell command is entered to show HTML files in the
current directory. On MS Windows a <span class="monospaced">dir</span> command could be used in the
same fashion.</p></div>
<div class="paragraph"><p>The mode can also be used to call an editor or any other program:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&gt; !vi foo.lsp</pre>
</div></div>
<div class="paragraph"><p>The Vi editor will open to edit the program "foo.lsp". After leaving the
editor the program could be run using a load statement:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&gt; (load "foo.lsp")</pre>
</div></div>
<div class="paragraph"><p>The program <span class="monospaced">foo.lsp</span> is now run. This mode using <span class="monospaced">!</span> can also be used
from the newLISP-GS IDE.</p></div>
<div class="paragraph"><p>When using a Unix teminal or command shell, tab-expansion for built-in
newLISP functions can be used:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&gt; (pri
print       println     primitive?
&gt; (pri</pre>
</div></div>
<div class="paragraph"><p>After entering the characters ` (pri ` hit the <span class="monospaced">[tab]</span> key once to show
all the built-in functions starting with the same characters. When
hitting <span class="monospaced">[tab]</span> twice before a function name has started, all built-in
function names will be displayed.</p></div>
</div>
<div class="sect2">
<h3 id="_4_command_line_options_startup_and_directories">4. Command-line options, startup and directories</h3>
<div class="sect3">
<h4 id="_command_line_help_summary">Command line help summary</h4>
<div class="paragraph"><p>When starting newLISP from the command-line several switches and options
and source files can be specified. Executing:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>newlisp -h</pre>
</div></div>
<div class="paragraph"><p>in a command shell will produce the following summary of options and
switches:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>-h this help
-n no init (must be first)
-s &lt;stacksize&gt;
-m &lt;max-mem-megabyte&gt;
-e &lt;quoted lisp expression&gt;
-l &lt;path-file&gt; log connections
-L &lt;path-file&gt; log all
-w &lt;working-directory&gt;
-c no prompts, HTTP
-C force prompts
-t &lt;microsec-timeout&gt;
-p &lt;port-number&gt;
-d &lt;port-number&gt;
-http HTTP only
-6 set IPv6 mode</pre>
</div></div>
<div class="paragraph"><p>Before or after the command-line switches, files to load and execute can
be specified. If a newLISP executable program is followed by parameters
the program must finish with an <span class="monospaced">(exit)</span> statement, else newLISP will
take command-line parameters as additional newLISP scripts to be loaded
and executed.</p></div>
<div class="paragraph"><p>On Linux and other Unix systems, a <span class="monospaced">newlisp</span> <em>man page</em> can be found:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>man newlisp</pre>
</div></div>
<div class="paragraph"><p>This will display a man page in the Linux/Unix shell.</p></div>
</div>
<div class="sect3">
<h4 id="_specifying_files_as_urls">Specifying files as URLs</h4>
<div class="paragraph"><p>newLISP will load and execute files specified on the command-line. Files
are specified with either their pathname or a <span class="monospaced">file://</span> URL on the local
file system or with an <span class="monospaced">http://</span> URL on remote file systems running an
HTTP server. That HTTP server can be newLISP running in HTTP server
mode.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>newlisp aprog.lsp bprog.lsp prog.lsp
newlisp http://newlisp.org/example.lsp
newlisp file:///usr/home/newlisp/demo.lsp</pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_no_loading_of_init_lsp">No loading of init.lsp</h4>
<div class="paragraph"><p>This option suppresses loading of any present initialization file
<span class="monospaced">init.lsp</span> or <span class="monospaced">.init.lsp</span>. In order to work, this must be the first
option specified:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>newlisp -n</pre>
</div></div>
<div class="paragraph"><p>More about <a href="#initialization">initialization files.</a></p></div>
</div>
<div class="sect3">
<h4 id="_stack_size">Stack size</h4>
<div class="listingblock">
<div class="content monospaced">
<pre>newlisp -s 4000
newlisp -s 100000 aprog bprog
newlisp -s 6000 myprog
newlisp -s 6000 http://asite.com/example.lsp</pre>
</div></div>
<div class="paragraph"><p>The above examples show starting newLISP with different stack sizes
using the <span class="monospaced">-s</span> option, as well as loading one or more newLISP source
files and loading files specified by a URL. When no stack size is
specified, the stack defaults to 2048. Per stack position about 80 bytes
of memory are preallocated.</p></div>
</div>
<div class="sect3">
<h4 id="_maximum_memory_usage">Maximum memory usage</h4>
<div class="listingblock">
<div class="content monospaced">
<pre>newlisp -m 128</pre>
</div></div>
<div class="paragraph"><p>This example limits newLISP cell memory to 128 megabytes. In 32-bit
newLISP, each Lisp cell consumes 16 bytes, so the argument <span class="monospaced">128</span> would
represent a maximum of 8,388,608 newLISP cells. This information is
returned by <a href="#sys-info">sys-info</a> as the list&#8217;s second element.
Although Lisp cell memory is not the only memory consumed by newLISP, it
is a good estimate of overall dynamic memory usage.</p></div>
</div>
<div class="sect3">
<h4 id="_direct_execution_mode">Direct execution mode</h4>
<div class="paragraph"><p>Small pieces of newLISP code can be executed directly from the
command-line:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>newlisp -e "(+ 3 4)"  → 7 ; On Win32 and Unix

newlisp -e '(append "abc" "def")'  → "abcdef" ; On Unix</pre>
</div></div>
<div class="paragraph"><p>The expression enclosed in quotation marks is evaluated, and the result
is printed to standard out (STDOUT). In most Unix system shells, single
quotes can also be used as command string delimiters. Note that there is
a space between <span class="monospaced">-e</span> and the quoted command string.</p></div>
</div>
<div class="sect3">
<h4 id="_logging_i_o">Logging I/O</h4>
<div class="paragraph"><p>In any mode, newLISP can write a log when started with the <span class="monospaced">-l</span> or <span class="monospaced">-L</span>
option. Depending on the mode newLISP is running, different output is
written to the log file. Both options always must specify the path of a
log-file. The path may be a relative path and can be either attached or
detached to the <span class="monospaced">-l</span> or <span class="monospaced">-L</span> option. If the file does not exist, it is
created when the first logging output is written.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>newlisp -l./logfile.txt -c

newlisp -L /usr/home/www/log.txt -http -w /usr/home/www/htpdocs</pre>
</div></div>
<div class="paragraph"><p>The following table shows the items logged in different situations:</p></div>
<table class="tableblock frame-all grid-all"
style="
width:100%;
">
<col style="width:33%;">
<col style="width:33%;">
<col style="width:33%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" >logging mode </th>
<th class="tableblock halign-left valign-top" >command-line and net-eval with <span class="monospaced">-c</span> </th>
<th class="tableblock halign-left valign-top" >HTTP server with
<span class="monospaced">-http</span></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">newlisp -l</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">log only input and network connections</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">log only network
connections</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">newlisp -L</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">log also newLISP output (w/o prompts)</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">log also HTTP
requests</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>All logging output is written to the file specified after the <span class="monospaced">-l</span> or
<span class="monospaced">-L</span> option.</p></div>
</div>
<div class="sect3">
<h4 id="_specifying_the_working_directory">Specifying the working directory</h4>
<div class="paragraph"><p>The <span class="monospaced">-w</span> option specifies the initial working directory for newLISP
after startup:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>newlisp -w /usr/home/newlisp</pre>
</div></div>
<div class="paragraph"><p>All file requests without a directory path will now be directed to the
path specified with the <span class="monospaced">-w</span> option.</p></div>
</div>
<div class="sect3">
<h4 id="_suppressing_the_prompt_and_http_processing">Suppressing the prompt and HTTP processing</h4>
<div class="paragraph"><p>The command-line prompt and initial copyright banner can be suppressed:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>newlisp -c</pre>
</div></div>
<div class="paragraph"><p>Listen and connection messages are suppressed if logging is not enabled.
The <span class="monospaced">-c</span> option is useful when controlling newLISP from other programs;
it is mandatory when setting it up as a <a href="#net-eval">net-eval</a> server.</p></div>
<div class="paragraph"><p>The <span class="monospaced">-c</span> option also enables newLISP server nodes to answer HTTP <span class="monospaced">GET</span>,
<span class="monospaced">PUT</span>, <span class="monospaced">POST</span> and <span class="monospaced">DELETE</span> requests, as well as perform CGI processing.
Using the <span class="monospaced">-c</span> option, together with the <span class="monospaced">-w</span> and <span class="monospaced">-d</span> options, newLISP
can serve as a standalone <span class="monospaced">httpd</span> webserver:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>newlisp -c -d 8080 -w /usr/home/www</pre>
</div></div>
<div class="paragraph"><p>When running newLISP as an <span class="monospaced">inetd</span> or <span class="monospaced">xinetd</span> enabled server on Unix
machines, use:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>newlisp -c -w /usr/home/www</pre>
</div></div>
<div class="paragraph"><p>In <span class="monospaced">-c</span> mode, newLISP processes command-line requests as well as HTTP
and <a href="#net-eval">net-eval</a> requests. Running newLISP in this mode is
only recommended on a machine behind a firewall. This mode should not be
run on machines open and accessible through the Internet. To suppress
the processing of <a href="#net-eval">net-eval</a> and command-line–like
requests, use the safer <span class="monospaced">-http</span> option.</p></div>
</div>
<div class="sect3">
<h4 id="_forcing_prompts_in_pipe_i_o_mode">Forcing prompts in pipe I/O mode</h4>
<div class="paragraph"><p>A capital <span class="monospaced">C</span> forces prompts when running newLISP in pipe I/O mode
inside the Emacs editor:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>newlisp -C</pre>
</div></div>
<div class="paragraph"><p>To suppress console output from return values from evaluations, use
<a href="#silent">silent</a>.</p></div>
</div>
<div class="sect3">
<h4 id="_newlisp_as_a_tcp_ip_server">newLISP as a TCP/IP server</h4>
<div class="listingblock">
<div class="content monospaced">
<pre>newlisp some.lsp -p 9090</pre>
</div></div>
<div class="paragraph"><p>This example shows how newLISP can listen for commands on a TCP/IP
socket connection. In this case, standard I/O is redirected to the port
specified with the <span class="monospaced">-p</span> option. <span class="monospaced">some.lsp</span> is an optional file loaded
during startup, before listening for a connection begins.</p></div>
<div class="paragraph"><p>The <span class="monospaced">-p</span> option is mainly used to control newLISP from another
application, such as a newLISP GUI front-end or a program written in
another language. As soon as the controlling client closes the
connection, newLISP will exit.</p></div>
<div class="paragraph"><p>A telnet application can be used to test running newLISP as a server.
First enter:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>newlisp -p 4711 &amp;</pre>
</div></div>
<div class="paragraph"><p>The <span class="monospaced">&amp;</span> indicates to a Unix shell to run the process in the background.
On Windows, start the server process without the <span class="monospaced">&amp;</span> in the foreground
and open a second command window for the telnet application. Now connect
with a telnet:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>telnet localhost 4711</pre>
</div></div>
<div class="paragraph"><p>If connected, the newLISP sign-on banner and prompt appear. Instead of
<span class="monospaced">4711</span>, any other port number could be used.</p></div>
<div class="paragraph"><p>When the client application closes the connection, newLISP will exit
too.</p></div>
</div>
<div class="sect3">
<h4 id="_tcp_ip_daemon_mode">TCP/IP daemon mode</h4>
<div class="paragraph"><p>When the connection to the client is closed in <span class="monospaced">-p</span> mode, newLISP exits.
To avoid this, use the <span class="monospaced">-d</span> option instead of the <span class="monospaced">-p</span> option:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>newlisp -d 4711 &amp;</pre>
</div></div>
<div class="paragraph"><p>This works like the <span class="monospaced">-p</span> option, but newLISP does not exit after a
connection closes. Instead, it stays in memory, listening for a new
connection and preserving its state. An <a href="#exit">exit</a> issued from a
client application closes the network connection, and the newLISP daemon
remains resident, waiting for a new connection. Any port number could be
used in place of <span class="monospaced">4711</span>.</p></div>
<div class="paragraph"><p>After each transaction, when a connection closes, newLISP will go
through a reset process, reinitialize stack and signals and go to the
<span class="monospaced">MAIN</span> context. Only the contents of program and variable symbols will
be preserved when running a stateful server.</p></div>
<div class="paragraph"><p>When running in <span class="monospaced">-p</span> or <span class="monospaced">-d</span> mode, the opening and closing tags <span class="monospaced">[cmd]</span>
and <span class="monospaced">[/cmd]</span> must be used to enclose multiline statements. They must
each appear on separate lines. This makes it possible to transfer larger
portions of code from controlling applications.</p></div>
<div class="paragraph"><p>The following variant of the <span class="monospaced">-d</span> mode is frequently used in a
distributed computing environment, together with
<a href="#net-eval">net-eval</a> on the client side:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>newlisp -c -d 4711 &amp;</pre>
</div></div>
<div class="paragraph"><p>The <span class="monospaced">-c</span> spec suppresses prompts, making this mode suitable for
receiving requests from the <a href="#net-eval">net-eval</a> function.</p></div>
<div class="paragraph"><p>newLISP server nodes running will also answer HTTP <span class="monospaced">GET</span>, <span class="monospaced">PUT</span> and
<span class="monospaced">DELETE</span> requests. This can be used to retrieve and store files with
<a href="#get-url">get-url</a>, <a href="#put-url">put-url</a>,
<a href="#delete-url">delete-url</a>, <a href="#read-file">read-file</a>,
<a href="#write-file">write-file</a> and <a href="#append-file">append-file</a>, or to
load and save programs using <a href="#load">load</a> and <a href="#save">save</a> from
and to remote server nodes. See the chapters for the <span class="monospaced">-c</span> and <span class="monospaced">-http</span>
options for more details.</p></div>
</div>
<div class="sect3">
<h4 id="_http_only_server_mode">HTTP-only server mode</h4>
<div class="paragraph"><p>newLISP can be limited to HTTP processing using the <span class="monospaced">-http</span> option. With
this mode, a secure <span class="monospaced">httpd</span> web server daemon can be configured:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>newlisp -http -d 8080 -w /usr/home/www</pre>
</div></div>
<div class="paragraph"><p>When running newLISP as an <span class="monospaced">inetd</span> or <span class="monospaced">xinetd</span>-enabled server on Unix
machines, use:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>newlisp -http -w /usr/home/www</pre>
</div></div>
<div class="paragraph"><p>To further enhance security and HTTP processing, load a program during
startup when using this mode:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>newlisp httpd-conf.lsp -http -w /usr/home/www</pre>
</div></div>
<div class="paragraph"><p>The file <span class="monospaced">httpd-conf.lsp</span> contains a <a href="#command-event">command-event</a>
function configuring a user-defined function to analyze, filter and
translate requests. See the reference for this function for a working
example.</p></div>
<div class="paragraph"><p>In the HTTP modes enabled by either <span class="monospaced">-c</span> or <span class="monospaced">-http</span>, the following file
types are recognized, and a correctly formatted <span class="monospaced">Content-Type:</span> header
is sent back:</p></div>
<table class="tableblock frame-all grid-all"
style="
width:25%;
">
<col style="width:37%;">
<col style="width:62%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" >file extension </th>
<th class="tableblock halign-left valign-top" >media type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">.avi</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">video/x-msvideo</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">.css</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">text/css</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">.gif</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">image/gif</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">.htm</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">text/htm</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">.html</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">text/html</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">.jpg</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">image/jpg</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">.js</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">application/javascript</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">.mov</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">video/quicktime</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">.mp3</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">audio/mpeg</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">.mpg</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">video/mpeg</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">.pdf</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">application/pdf</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">.png</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">image/png</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">.wav</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">audio/x-wav</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">.zip</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">application/zip</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><em>any other</em></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">text/plain</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>To serve CGI, HTTP server mode needs a <span class="monospaced">/tmp</span> directory on Unix-like
platforms or a <span class="monospaced">C:\tmp</span> directory on Win32. newLISP can process <span class="monospaced">GET</span>,
<span class="monospaced">PUT</span>, <span class="monospaced">POST</span> and <span class="monospaced">DELETE</span> requests and create custom response headers. CGI
files must have the extension <span class="monospaced">.cgi</span> and have executable permission on
Unix. More information about CGI processing for newLISP server modes can
be found in the document <a href="http://www.newlisp.org/CodePatterns.html">Code
Patterns in newLISP</a></p></div>
<div class="paragraph"><p>In both server modes <span class="monospaced">-c</span> and <span class="monospaced">-http</span> the environment variables
<span class="monospaced">DOCUMENT_ROOT</span>, <span class="monospaced">REQUEST_METHOD</span>, <span class="monospaced">SERVER_SOFTWARE</span> and
<span class="monospaced">QUERY_STRING</span> are set.  The variables <span class="monospaced">CONTENT_TYPE</span>,
<span class="monospaced">CONTENT_LENGTH</span>, <span class="monospaced">HTTP_HOST</span>, <span class="monospaced">HTTP_USER_AGENT</span> and <span class="monospaced">HTTP_COOKIE</span> are
also set, if present in the HTTP header sent by the client.</p></div>
</div>
<div class="sect3">
<h4 id="_local_domain_unix_socket_server">Local domain Unix socket server</h4>
<div class="paragraph"><p>Instead of a port, a local domain Unix socket path can be specified in
the <span class="monospaced">-d</span> or <span class="monospaced">-p</span> server modes.</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>newlisp -c -d /tmp/mysocket &amp;</pre>
</div></div>
<div class="paragraph"><p>Test the server using another newLISP process:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>newlisp -e '(net-eval "/tmp/mysocket" 0 "(symbols)")'</pre>
</div></div>
<div class="paragraph"><p>A list of all built-in symbols will be printed to the terminal</p></div>
<div class="paragraph"><p>This mode will work together with local domain socket modes of
<a href="#net-connect">net-connect</a>, <a href="#net-listen">net-listen</a>, and
<a href="#net-eval">net-eval</a>. Local domain sockets opened with <span class="monospaced">net-connect</span>
and <span class="monospaced">net-listen</span> can be served using <a href="#net-accept">net-accept</a>,
<a href="#net-receive">net-receive</a>, and <a href="#net-send">net-send</a>. Local
domain socket connections can be monitored using
<a href="#net-peek">net-peek</a> and <a href="#net-select">net-select</a>.</p></div>
<div class="paragraph"><p>Local domain socket connections are much faster than normal TCP/IP
network connections and preferred for communications between processes
on the same local file system in distributed applications. This mode is
not available on Win32.</p></div>
</div>
<div class="sect3">
<h4 id="_connection_timeout">Connection timeout</h4>
<div class="paragraph"><p>Specifies a connection timeout when running in <span class="monospaced">-p</span> or <span class="monospaced">-d</span> demon mode.
A newLISP Server will disconnect when no further input is read after
accepting a client connection. The timeout is specified in micro
seconds:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>newlisp -c -t 3000000 -d 4711 &amp;</pre>
</div></div>
<div class="paragraph"><p>The example specifies a timeout of three seconds.</p></div>
</div>
<div class="sect3">
<h4 id="_span_class_monospaced_inetd_span_daemon_mode"><span class="monospaced">inetd</span> daemon mode</h4>
<div class="paragraph"><p>The <span class="monospaced">inetd</span> server running on virtually all Linux/Unix OSes can function
as a proxy for newLISP. The server accepts TCP/IP or UDP connections and
passes on requests via standard I/O to newLISP. <span class="monospaced">inetd</span> starts a newLISP
process for each client connection. When a client disconnects, the
connection is closed and the newLISP process exits.</p></div>
<div class="paragraph"><p><span class="monospaced">inetd</span> and newLISP together can handle multiple connections efficiently
because of newLISP&#8217;s small memory footprint, fast executable, and short
program load times. When working with <a href="#net-eval">net-eval</a>, this
mode is preferred for efficiently handling multiple requests in a
distributed computing environment.</p></div>
<div class="paragraph"><p>Two files must be configured: <span class="monospaced">services</span> and <span class="monospaced">inetd.conf</span>. Both are
ASCII-editable and can usually be found at <span class="monospaced">/etc/services</span> and
<span class="monospaced">/etc/inetd.conf</span>.</p></div>
<div class="paragraph"><p>Put one of the following lines into <span class="monospaced">inetd.conf:</span></p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>net-eval  stream  tcp  nowait  root  /usr/bin/newlisp -c

# as an alternative, a program can also be preloaded

net-eval  stream  tcp  nowait  root  /usr/bin/newlisp -c myprog.lsp</pre>
</div></div>
<div class="paragraph"><p>Instead of <span class="monospaced">root</span>, another user and optional group can be specified. For
details, see the Unix man page for <span class="monospaced">inetd</span>.</p></div>
<div class="paragraph"><p>The following line is put into the <span class="monospaced">services</span> file:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>net-eval        4711/tcp     # newLISP net-eval requests</pre>
</div></div>
<div class="paragraph"><p>On Mac OS X and some Unix systems, <span class="monospaced">xinetd</span> can be used instead of
<span class="monospaced">inetd</span>. Save the following to a file named <span class="monospaced">net-eval</span> in the
<span class="monospaced">/etc/xinetd.d/</span> directory:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>service net-eval
{
    socket_type = stream
    wait = no
    user = root
    server = /usr/bin/newlisp
    port = 4711
    server_args = -c
    only_from = localhost
}</pre>
</div></div>
<div class="paragraph"><p>For security reasons, <span class="monospaced">root</span> should be changed to a different user and
file permissions of the www document directory adjusted accordingly. The
<span class="monospaced">only_from</span> spec can be left out to permit remote access.</p></div>
<div class="paragraph"><p>See the man pages for <span class="monospaced">xinetd</span> and <span class="monospaced">xinetd.conf</span> for other configuration
options.</p></div>
<div class="paragraph"><p>After configuring the daemon, <span class="monospaced">inetd</span> or <span class="monospaced">xinetd</span> must be restarted to
allow the new or changed configuration files to be read:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>kill -HUP &lt;pid&gt;</pre>
</div></div>
<div class="paragraph"><p>Replace <span class="monospaced">&lt;pid&gt;</span> with the process ID of the running <span class="monospaced">xinetd</span> process.</p></div>
<div class="paragraph"><p>A number or network protocol other than 4711 or TCP can be specified.</p></div>
<div class="paragraph"><p>newLISP handles everything as if the input were being entered on a
newLISP command-line without a prompt. To test the <span class="monospaced">inetd</span> setup, the
<span class="monospaced">telnet</span> program can be used:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>telnet localhost 4711</pre>
</div></div>
<div class="paragraph"><p>newLISP expressions can now be entered, and <span class="monospaced">inetd</span> will automatically
handle the startup and communications of a newLISP process. Multiline
expressions can be entered by bracketing them with <span class="monospaced">[cmd]</span> and <span class="monospaced">[/cmd]</span>
tags, each on separate lines.</p></div>
<div class="paragraph"><p>newLISP server nodes answer HTTP <span class="monospaced">GET</span> and <span class="monospaced">PUT</span> requests. This can be
used to retrieve and store files with <a href="#get-url">get-url</a>,
<a href="#put-url">put-url</a>, <a href="#read-file">read-file</a>,
<a href="#write-file">write-file</a> and <a href="#append-file">append-file</a>, or to
load and save programs using <a href="#load">load</a> and <a href="#save">save</a> from
and to remote server nodes.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_5_startup_directories_environment">5. Startup, directories, environment</h3>
<div class="sect3">
<h4 id="_environment_variable_span_class_monospaced_newlispdir_span">Environment variable <span class="monospaced">NEWLISPDIR</span></h4>
<div class="paragraph"><p>During startup, newLISP sets the environment variable <span class="monospaced">NEWLISPDIR</span>, if
it is not set already. On Linux, BSDs, Mac OS X and other Unixes the
variable is set to <span class="monospaced">/usr/share/newlisp</span>. On Win32 the variable is set to
<span class="monospaced">%PROGRAMFILES%/newlisp</span>.</p></div>
<div class="paragraph"><p>The environment variable <span class="monospaced">NEWLISPDIR</span> is useful when loading files
installed with newLISP:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">load</span> <span class="p">(</span><span class="k">append</span> <span class="p">(</span><span class="k">env</span> <span class="s">&quot;NEWLISPDIR&quot;</span><span class="p">)</span> <span class="s">&quot;/guiserver.lsp&quot;</span><span class="p">))</span>

<span class="p">(</span><span class="k">load</span> <span class="p">(</span><span class="k">append</span> <span class="p">(</span><span class="k">env</span> <span class="s">&quot;NEWLISPDIR&quot;</span><span class="p">)</span> <span class="s">&quot;/modules/mysql.lsp&quot;</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p>A predefined function <span class="monospaced">module</span> can be used to shorten the second
statement loading from the <span class="monospaced">modules/</span> directory:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">module</span> <span class="s">&quot;mysql.lsp&quot;</span><span class="p">)</span>
</pre></div></div></div>
</div>
<div class="sect3">
<h4 id="_the_initialization_file_span_class_monospaced_init_lsp_span">The initialization file <span class="monospaced">init.lsp</span></h4>
<div class="paragraph"><p>Before loading any files specified on the command-line, and before the
banner and prompt are shown. newLISP tries to load a file <span class="monospaced">.init.lsp</span>
from the home directory of the user starting newLISP. On Mac OS X, Linux
and other Unix the home directory is found in the <span class="monospaced">HOME</span> environment
variable. On Win32 the directory name is contained in the <span class="monospaced">USERPROFILE</span>
or <span class="monospaced">DOCUMENT_ROOT</span> environment variable.</p></div>
<div class="paragraph"><p>If a <span class="monospaced">.init.lsp</span> cannot be found in the home directory newLISP tries to
load the file <span class="monospaced">init.lsp</span> from the directory found in the environment
variable <span class="monospaced">NEWLISPDIR</span>.</p></div>
<div class="paragraph"><p>When newLISP is run as a shared library, an initialization file is
looked for in the environment variable <span class="monospaced">NEWLISPLIB_INIT</span>. The full
path-name of the initialization file must be specified. If
<span class="monospaced">NEWLISPLIB_INIT</span> is not defined, no initialization file will be loaded
by the library module.</p></div>
<div class="paragraph"><p>Although newLISP does not require <span class="monospaced">init.lsp</span> to run, it is convenient
for defining functions and system-wide variables.</p></div>
<div class="paragraph"><p>Note that neither one of the initialization files <span class="monospaced">init.lsp</span> nor
<span class="monospaced">.init.lsp</span> is loaded during startup of linked programs.</p></div>
</div>
<div class="sect3">
<h4 id="_directories_on_linux_bsd_mac_os_x_and_other_unix">Directories on Linux, BSD, Mac OS X and other Unix</h4>
<div class="paragraph"><p>The directory <span class="monospaced">/usr/share/newlisp/modules</span> contains modules with useful
functions POP3 mail, etc. The directory <span class="monospaced">/usr/share/newlisp/guiserver</span>
contains sample programs for writing GUI applications with newLISP-GS.
The directory <span class="monospaced">/usr/share/doc/newlisp/</span> contains documentation in HTML
format.</p></div>
</div>
<div class="sect3">
<h4 id="_directories_on_win32">Directories on Win32</h4>
<div class="paragraph"><p>On Win32 systems, all files are installed in the default directory
<span class="monospaced">%PROGRAMFILES%\newlisp</span>. <span class="monospaced">PROGRAMFILES</span> is a Win32 environment variable
that resolves to <span class="monospaced">C:\Program files\newlisp\</span> in English language
installations. The subdirectories <span class="monospaced">%PROGRAMFILES%\newlisp\modules</span> and
<span class="monospaced">%PROGRAMFILES%\newlisp\guiserver</span> contain modules for interfacing to
external libraries and sample programs written for newLISP-GS.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_6_extending_newlisp_with_shared_libraries">6. Extending newLISP with shared libraries</h3>
<div class="paragraph"><p>Many shared libraries on Unix and Win32 systems can be used to extend
newLISP&#8217;s functionality. Examples are libraries for writing graphical
user interfaces, libraries for encryption or decryption and libraries
for accessing databases.</p></div>
<div class="paragraph"><p>The function <a href="#import">import</a> is used to import functions from
external libraries. The function <a href="#callback">callback</a> is used to
register callback functions in external libraries. Other functions like
<a href="#pack">pack</a>, <a href="#unpack">unpack</a>, <a href="#get-string">get-string</a>,
<a href="#get-int">get-int</a> and <a href="#get-long">get-long</a> exist to facilitate
formatting input and output to and from imported library functions.</p></div>
<div class="paragraph"><p>See also chapter
<a href="http://www.newlisp.org/downloads/CodePatterns.html#toc-23">23. Extending
newLISP</a> in the <a href="http://www.newlisp.org/downloads/CodePatterns.html">Code
Patterns in newLISP</a> document.</p></div>
</div>
<div class="sect2">
<h3 id="_7_newlisp_as_a_shared_library">7. newLISP as a shared library</h3>
<div class="paragraph"><p>newLISP can be compiled as a shared library. On Linux, BSDs and other
Unix flavors the library is called <span class="monospaced">newlisp.so</span>. On Windows it is called
<span class="monospaced">newlisp.dll</span> and <span class="monospaced">newlisp.dylib</span> on Mac OS X. A newLISP shared library
is used like any other shared library.</p></div>
<div class="paragraph"><p>The main function to import is <span class="monospaced">newlispEvalStr</span>. Like
<a href="#eval-string">eval-string</a>, this function takes a string containing
a newLISP expression and stores the result in a string address. The
result can be retrieved using <a href="#get-string">get-string</a>. The returned
string is formatted like output from a command-line session. It contains
terminating line-feed characters, but but not the prompt string.</p></div>
<div class="paragraph"><p>When calling <span class="monospaced">newlispEvalStr</span>, output normally directed to the console
(e.g. return values or <a href="#print">print</a> statements) is returned in the
form of an integer string pointer. The output can be accessed by passing
this pointer to the <span class="monospaced">get-string</span> function. To silence the output from
return values, use the <a href="#silent">silent</a> function.</p></div>
<div class="paragraph"><p>When passing multi-line source to <span class="monospaced">newlispEvalStr</span>, that source should
be bracketed by <span class="monospaced">[cmd]</span>, <span class="monospaced">[/cmd]</span> tags, each on a different line:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">code</span> <span class="s">[text][cmd]</span>
<span class="s">...</span>
<span class="s">...</span>
<span class="s">...</span>
<span class="s">[/cmd][/text]</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Since v.10.3.3 callbacks can also be registered using <span class="monospaced">newlispCallback</span>.
For more information read chapter
<a href="http://www.newlisp.org/downloads/CodePatterns.html#toc-24">24. newLISP
compiled as a shared library</a> in the
<a href="http://www.newlisp.org/downloads/CodePatterns.html">Code Patterns in
newLISP</a> document.</p></div>
</div>
<div class="sect2">
<h3 id="_8_evaluating_newlisp_expressions">8. Evaluating newLISP expressions</h3>
<div class="paragraph"><p>The following is a short introduction to newLISP statement evaluation
and the role of integer and floating point arithmetic in newLISP.</p></div>
<div class="paragraph"><p>Top-level expressions are evaluated when using the <a href="#load">load</a>
function or when entering expressions in console mode on the
command-line.</p></div>
<div class="sect3">
<h4 id="_interactive_multiline_expressions">Interactive multiline expressions</h4>
<div class="paragraph"><p>Multiline expressions can be entered by entering an empty line first.
Once in multiline mode, another empty line returns from entry mode and
evaluates the statement(s) entered:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="ss">&gt;</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">foo</span> <span class="ss">x</span> <span class="ss">y</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">+</span> <span class="ss">x</span> <span class="ss">y</span><span class="p">))</span>

<span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span> <span class="ss">y</span><span class="p">)</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">x</span> <span class="ss">y</span><span class="p">))</span>
<span class="ss">&gt;</span> <span class="p">(</span><span class="nv">foo</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">)</span>
<span class="ss">7</span>
<span class="ss">&gt;</span> <span class="ss">_</span>
</pre></div></div></div>
<div class="paragraph"><p>Entering multiline mode by hitting the enter key on an empty line
suppresses the prompt. Entering another empty line will leave the
multiline mode and evaluate expressions.</p></div>
<div class="paragraph"><p>As an alternative to entering empty lines, the <span class="monospaced">[cmd]</span> and <span class="monospaced">[/cmd]</span> tags
are used, each entered on separate lines. This mode is used by some
interactive IDEs controllling newLISP and internally by the
<a href="#net-eval">net-eval</a> function. The <span class="monospaced">[cmd]</span> and <span class="monospaced">[/cmd]</span> tags must
also be used in the console part of the newLISP-GS Java IDE.</p></div>
</div>
<div class="sect3">
<h4 id="_integer_floating_point_data_and_operators">Integer, floating point data and operators</h4>
<div class="paragraph"><p>newLISP functions and operators accept integer and floating point
numbers, converting them into the needed format. For example, a
bit-manipulating operator converts a floating point number into an
integer by omitting the fractional part. In the same fashion, a
trigonometric function will internally convert an integer into a
floating point number before performing its calculation.</p></div>
<div class="paragraph"><p>The symbol operators (<span class="monospaced">+</span> <span class="monospaced">-</span> <span class="monospaced">*</span> <span class="monospaced">/</span> <span class="monospaced">%</span> <span class="monospaced">$</span> <span class="monospaced">~</span> <span class="monospaced">|</span> <span class="monospaced">^</span> <span class="monospaced">&lt;&lt;</span> <span class="monospaced">&gt;&gt;</span>)
return values of type integer. Functions and operators named with a word
instead of a symbol (e.g., <span class="monospaced">add</span> rather than <span class="monospaced">+</span>) return floating point
numbers. Integer operators truncate floating point numbers to integers,
discarding the fractional parts.</p></div>
<div class="paragraph"><p>newLISP has two types of basic arithmetic operators: integer (<span class="monospaced">+</span> <span class="monospaced">-</span>
<span class="monospaced">*</span> <span class="monospaced">/</span>) and floating point (<span class="monospaced">add</span> <span class="monospaced">sub</span> <span class="monospaced">mul</span> <span class="monospaced">div</span>). The arithmetic
functions convert their arguments into types compatible with the
function&#8217;s own type: integer function arguments into integers, floating
point function arguments into floating points. To make newLISP behave
more like other scripting languages, the integer operators <span class="monospaced">+</span>, <span class="monospaced">-</span>,
<span class="monospaced">*</span>, and <span class="monospaced">/</span> can be redefined to perform the floating point operators
<span class="monospaced">add</span>, <span class="monospaced">sub</span>, <span class="monospaced">mul</span>, and <span class="monospaced">div</span>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">constant</span> <span class="o">&#39;</span><span class="ss">+</span> <span class="k">add</span><span class="p">)</span>
<span class="p">(</span><span class="k">constant</span> <span class="o">&#39;</span><span class="ss">-</span> <span class="k">sub</span><span class="p">)</span>
<span class="p">(</span><span class="k">constant</span> <span class="o">&#39;</span><span class="ss">*</span> <span class="k">mul</span><span class="p">)</span>
<span class="p">(</span><span class="k">constant</span> <span class="o">&#39;</span><span class="ss">/</span> <span class="k">div</span><span class="p">)</span>

<span class="c1">;; or all 4 operators at once</span>
<span class="p">(</span><span class="k">constant</span> <span class="o">&#39;</span><span class="ss">+</span> <span class="k">add</span> <span class="o">&#39;</span><span class="ss">-</span> <span class="k">sub</span> <span class="o">&#39;</span><span class="ss">*</span> <span class="k">mul</span> <span class="o">&#39;</span><span class="ss">/</span> <span class="k">div</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Now the common arithmetic operators <span class="monospaced">+</span>, <span class="monospaced">-</span>, <span class="monospaced">*</span>, and <span class="monospaced">/</span> accept both
integer and floating point numbers and return floating point results.</p></div>
<div class="paragraph"><p>Note that the looping variables in <a href="#dotimes">dotimes</a> and
<a href="#for">for</a>, as well as the result of <a href="#sequence">sequence</a>, use
floating point numbers for their values.</p></div>
<div class="paragraph"><p>Care must be taken when <a href="#imoport">importing</a> from libraries that use
functions expecting integers. After redefining <span class="monospaced">+, -, *</span>, and <span class="monospaced">/</span>, a
double floating point number may be unintentionally passed to an
imported function instead of an integer. In this case, floating point
numbers can be converted into integers by using the function
<a href="#int">int</a>. Likewise, integers can be transformed into floating
point numbers using the <a href="#float">float</a> function:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">import</span> <span class="s">&quot;mylib.dll&quot;</span> <span class="s">&quot;foo&quot;</span><span class="p">)</span>  <span class="c1">; importing int foo(int x) from C</span>
<span class="p">(</span><span class="nv">foo</span> <span class="p">(</span><span class="k">int</span> <span class="ss">x</span><span class="p">))</span>               <span class="c1">; passed argument as integer</span>
<span class="p">(</span><span class="k">import</span> <span class="s">&quot;mylib.dll&quot;</span> <span class="s">&quot;bar&quot;</span><span class="p">)</span>  <span class="c1">; importing C int bar(double y)</span>
<span class="p">(</span><span class="nv">bar</span> <span class="p">(</span><span class="k">float</span> <span class="ss">y</span><span class="p">))</span>             <span class="c1">; force double float</span>
</pre></div></div></div>
<div class="paragraph"><p>Some of the modules shipping with newLISP are written assuming the
default implementations of <span class="monospaced">+</span>, <span class="monospaced">-</span>, <span class="monospaced">*</span>, and <span class="monospaced">/</span>. This gives imported
library functions maximum speed when performing address calculations.</p></div>
<div class="paragraph"><p>The newLISP preference is to leave <span class="monospaced">+</span>, <span class="monospaced">-</span>, <span class="monospaced">*</span>, and <span class="monospaced">/</span> defined as
integer operators and use <span class="monospaced">add</span>, <span class="monospaced">sub</span>, <span class="monospaced">mul</span>, and <span class="monospaced">div</span> when explicitly
required. Since version 8.9.7, integer operations in newLISP are 64 bit
operations, whereas 64 bit double floating point numbers offer only 52
bits of resolution in the integer part of the number.</p></div>
</div>
<div class="sect3">
<h4 id="_evaluation_rules_and_data_types">Evaluation rules and data types</h4>
<div class="paragraph"><p>Evaluate expressions by entering and editing them on the command-line.
More complicated programs can be entered using editors like Emacs and
VI, which have modes to show matching parentheses while typing. Load a
saved file back into a console session by using the <a href="#load">load</a>
function.</p></div>
<div class="paragraph"><p>A line comment begins with a <span class="monospaced">;</span> (semicolon) or a <span class="monospaced">#</span> (number sign) and
extends to the end of the line. newLISP ignores this line during
evaluation. The <span class="monospaced">#</span> is useful when using newLISP as a scripting language
in Linux/Unix environments, where the <span class="monospaced">#</span> is commonly used as a line
comment in scripts and shells.</p></div>
<div class="paragraph"><p>When evaluation occurs from the command-line, the result is printed to
the console window.</p></div>
<div class="paragraph"><p>The following examples can be entered on the command-line by typing the
code to the left of the → symbol. The result that appears on the next
line should match the code to the right of the → symbol.</p></div>
<div class="paragraph"><p><strong>nil</strong> and <strong>true</strong> are Boolean data types that evaluate to themselves:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">nil</span>    <span class="err">→</span> <span class="k">nil</span>
<span class="k">true</span>   <span class="err">→</span> <span class="k">true</span>
</pre></div></div></div>
<div class="paragraph"><p><strong>Integers</strong> and <strong>floating point</strong> numbers evaluate to themselves:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="ss">123</span>      <span class="err">→</span> <span class="ss">123</span>    <span class="c1">; decimal integer</span>
<span class="ss">0xE8</span>     <span class="err">→</span> <span class="ss">232</span>    <span class="c1">; hexadecimal prefixed by 0x</span>
<span class="ss">055</span>      <span class="err">→</span> <span class="ss">45</span>     <span class="c1">; octal prefixed by 0 (zero)</span>
<span class="ss">0b101010</span> <span class="err">→</span> <span class="ss">42</span>     <span class="c1">; binary prefixed by 0b</span>
<span class="ss">1.23</span>     <span class="err">→</span> <span class="ss">1.23</span>   <span class="c1">; float</span>
<span class="ss">123e-3</span>   <span class="err">→</span> <span class="ss">0.123</span>  <span class="c1">; float in scientific notation</span>
</pre></div></div></div>
<div class="paragraph"><p>Integers are 64-bit numbers (including the sign bit, 32-bit before
version 8.9.7). Valid integers are numbers between
-9,223,372,036,854,775,808 and +9,223,372,036,854,775,807. Larger
numbers converted from floating point numbers are truncated to one of
the two limits. Integers internal to newLISP, which are limited to
32-bit numbers, overflow to either +2,147,483,647 or -2,147,483,648.
Floating point numbers are IEEE 754 64-bit doubles. Unsigned numbers up
to 18,446,744,073,709,551,615 can be displayed using special formatting
characters for <a href="#format">format</a>.</p></div>
<div class="paragraph"><p><strong>Strings</strong> may contain null characters and can have different delimiters.
They evaluate to themselves.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="s">&quot;hello&quot;</span>             <span class="err">→</span><span class="s">&quot;hello&quot;</span>
<span class="s">&quot;\032\032\065\032&quot;</span>  <span class="err">→</span><span class="s">&quot;  A &quot;</span>
<span class="s">&quot;\x20\x20\x41\x20&quot;</span>  <span class="err">→</span><span class="s">&quot;  A &quot;</span>
<span class="s">&quot;\t\r\n&quot;</span>            <span class="err">→</span><span class="s">&quot;\t\r\n&quot;</span>
<span class="s">&quot;\x09\x0d\x0a&quot;</span>      <span class="err">→</span><span class="s">&quot;\t\r\n&quot;</span>

<span class="c1">;; null characters are legal in strings:</span>
<span class="s">&quot;\000\001\002&quot;</span>       <span class="err">→</span> <span class="s">&quot;\000\001\002&quot;</span>
<span class="s">{this &quot;is&quot; a string}</span> <span class="err">→</span> <span class="s">&quot;this \&quot;is\&quot; a string&quot;</span>

<span class="c1">;; use [text] tags for text longer than 2048 bytes:</span>
<span class="s">[text]this is a string, too[/text]</span>
<span class="err">→</span> <span class="s">&quot;this is a string, too&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>Strings delimited by <span class="monospaced">"</span> (double quotes) will also process the following
characters escaped with a <span class="monospaced">\</span> (backslash):</p></div>
<table class="tableblock frame-all grid-all"
style="
width:100%;
">
<col style="width:9%;">
<col style="width:90%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" >character </th>
<th class="tableblock halign-left valign-top" >description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">\"</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">for a double quote inside a quoted string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">\n</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">for a line-feed character (ASCII 10)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">\r</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">for a return character (ASCII 13)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">\t</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">for a TAB character (ASCII 9)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">\nnn</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">for a three-digit ASCII number (nnn format between 000 and 255)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">\xnn</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">for a two-digit-hex ASCII number (xnn format between x00 and
xff)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">\unnnn</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">for a unicode character encoded in the four <span class="monospaced">nnnn</span>
hexadecimal digits. newLISP will translate this to a UTF8 character in
the UTF8 enabled versions of newLISP.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">\\</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">for the backslash character (ASCII 92) itself</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>Quoted strings cannot exceed 2,048 characters. Longer strings should use
the <span class="monospaced">[text]</span> and <span class="monospaced">[/text]</span> tag delimiters. newLISP automatically uses
these tags for string output longer than 2,048 characters.</p></div>
<div class="paragraph"><p>The <span class="monospaced">{</span> (left curly bracket), <span class="monospaced">}</span> (right curly bracket), and
<span class="monospaced">[text], [/text]</span> delimiters do not perform escape character processing.</p></div>
<div class="paragraph"><p><strong>Lambda and lambda-macro expressions</strong> evaluate to themselves:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">*</span> <span class="ss">x</span> <span class="ss">x</span><span class="p">))</span>                   <span class="err">→</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">*</span> <span class="ss">x</span> <span class="ss">x</span><span class="p">))</span>
<span class="p">(</span><span class="k">lambda-macro</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">b</span><span class="p">)</span> <span class="p">(</span><span class="k">set</span> <span class="p">(</span><span class="k">eval</span> <span class="ss">a</span><span class="p">)</span> <span class="ss">b</span><span class="p">))</span>  <span class="err">→</span> <span class="p">(</span><span class="k">lambda-macro</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">b</span><span class="p">)</span> <span class="p">(</span><span class="k">set</span> <span class="p">(</span><span class="k">eval</span> <span class="ss">a</span><span class="p">)</span> <span class="ss">b</span><span class="p">))</span>
<span class="p">(</span><span class="k">fn</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">*</span> <span class="ss">x</span> <span class="ss">x</span><span class="p">))</span>                       <span class="err">→</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">*</span> <span class="ss">x</span> <span class="ss">x</span><span class="p">))</span>  <span class="c1">; an alternative syntax</span>
</pre></div></div></div>
<div class="paragraph"><p><strong>Symbols</strong> evaluate to their contents:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">something</span> <span class="ss">123</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">123</span>
<span class="ss">something</span>             <span class="err">→</span> <span class="ss">123</span>
</pre></div></div></div>
<div class="paragraph"><p><strong>Contexts</strong> evaluate to themselves:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">context</span> <span class="o">&#39;</span><span class="ss">CTX</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">CTX</span>
<span class="ss">CTX</span>             <span class="err">→</span> <span class="ss">CTX</span>
</pre></div></div></div>
<div class="paragraph"><p><strong>Built-in functions</strong> also evaluate to themselves:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">add</span>                <span class="err">→</span> <span class="k">add</span> <span class="k">&lt;</span><span class="ss">B845770D&gt;</span>
<span class="p">(</span><span class="k">eval</span> <span class="p">(</span><span class="k">eval</span> <span class="k">add</span><span class="p">))</span>  <span class="err">→</span> <span class="k">add</span> <span class="k">&lt;</span><span class="ss">B845770D&gt;</span>
<span class="p">(</span><span class="k">constant</span> <span class="o">&#39;</span><span class="ss">+</span> <span class="k">add</span><span class="p">)</span>  <span class="err">→</span> <span class="k">add</span> <span class="k">&lt;</span><span class="ss">B845770D&gt;</span>
<span class="ss">+</span>                  <span class="err">→</span> <span class="k">add</span> <span class="k">&lt;</span><span class="ss">B845770D&gt;</span>
</pre></div></div></div>
<div class="paragraph"><p>In the above example, the number between the &lt; &gt; (angle brackets) is the
hexadecimal memory address (machine-dependent) of the <span class="monospaced">add</span> function. It
is displayed when printing a built-in primitive.</p></div>
<div class="paragraph"><p><strong>Quoted expressions</strong> lose one ' (single quote) when evaluated:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="o">&#39;</span><span class="ss">something</span>  <span class="err">→</span> <span class="ss">something</span>
<span class="o">&#39;&#39;&#39;&#39;</span><span class="ss">any</span>     <span class="err">→</span> <span class="o">&#39;&#39;&#39;</span><span class="ss">any</span>
<span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span> <span class="ss">d</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span> <span class="ss">d</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>A single quote is often used to <em>protect</em> an expression from evaluation
(e.g., when referring to the symbol itself instead of its contents or to
a list representing data instead of a function).</p></div>
<div class="paragraph"><p><strong>Lists</strong> are evaluated by first evaluating the first list element before
the rest of the expression (as in Scheme). The result of the evaluation
is applied to the remaining elements in the list and must be one of the
following: a <span class="monospaced">lambda</span> expression, <span class="monospaced">lambda-macro</span> expression, or
<span class="monospaced">primitive</span> (built-in) function.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="nv">+</span> <span class="ss">1</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">)</span>                  <span class="err">→</span> <span class="ss">10</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">double</span> <span class="ss">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">x</span> <span class="ss">x</span><span class="p">))</span>  <span class="err">→</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">x</span> <span class="ss">x</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p>or</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">double</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">x</span> <span class="ss">x</span><span class="p">)))</span>
<span class="p">(</span><span class="nv">double</span> <span class="ss">20</span><span class="p">)</span>               <span class="err">→</span> <span class="ss">40</span>
<span class="p">((</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">*</span> <span class="ss">x</span> <span class="ss">x</span><span class="p">))</span> <span class="ss">5</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">25</span>
</pre></div></div></div>
<div class="paragraph"><p>For a user-defined lambda expression, newLISP evaluates the arguments
from left to right and binds the results to the parameters (also from
left to right), before using the results in the body of the expression.</p></div>
<div class="paragraph"><p>Like Scheme, newLISP evaluates the <em>functor</em> (function object) part of
an expression before applying the result to its arguments. For example:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">((</span><span class="k">if</span> <span class="p">(</span><span class="nv">&gt;</span> <span class="ss">X</span> <span class="ss">10</span><span class="p">)</span> <span class="ss">*</span> <span class="ss">+</span><span class="p">)</span> <span class="ss">X</span> <span class="ss">Y</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Depending on the value of X, this expression applies the <span class="monospaced">*</span> (product)
or <span class="monospaced">+</span> (sum) function to X and Y.</p></div>
<div class="paragraph"><p>Because their arguments are not evaluated, <span class="monospaced">lambda-macro</span> expressions
are useful for extending the syntax of the language. Most built-in
functions evaluate their arguments from left to right (as needed) when
executed. Some exceptions to this rule are indicated in the reference
section of this manual. Lisp functions that do not evaluate all or some
of their arguments are called <em>special forms</em>.</p></div>
<div class="paragraph"><p><strong>Arrays</strong> evaluate to themselves:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">A</span> <span class="p">(</span><span class="k">array</span> <span class="ss">2</span> <span class="ss">2</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">)))</span> <span class="err">→</span> <span class="p">((</span><span class="nv">1</span> <span class="ss">2</span><span class="p">)</span> <span class="p">(</span><span class="nv">3</span> <span class="ss">4</span><span class="p">))</span>
<span class="p">(</span><span class="k">eval</span> <span class="ss">A</span><span class="p">)</span>                        <span class="err">→</span> <span class="p">((</span><span class="nv">1</span> <span class="ss">2</span><span class="p">)</span> <span class="p">(</span><span class="nv">3</span> <span class="ss">4</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p><strong>Shell commands</strong>: If an <span class="monospaced">!</span> (exclamation mark) is entered as the first
character on the command-line followed by a shell command, the command
will be executed. For example, <span class="monospaced">!ls</span> on Unix or <span class="monospaced">!dir</span> on Win32 will
display a listing of the present working directory. No spaces are
permitted between the <span class="monospaced">!</span> and the shell command. Symbols beginning
with an <span class="monospaced">!</span> are still allowed inside expressions or on the
command-line when preceded by a space. Note: This mode only works when
running in the shell and does not work when controlling newLISP from
another application.</p></div>
<div class="paragraph"><p>To exit the newLISP shell on Linux/Unix, press <span class="monospaced">Ctrl-D</span>; on Win32, type
<span class="monospaced">(exit)</span> or <span class="monospaced">Ctrl-C</span>, then the x key.</p></div>
<div class="paragraph"><p>Use the <a href="#exec">exec</a> function to access shell commands from other
applications or to pass results back to newLISP.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_9_lambda_expressions_in_newlisp">9. Lambda expressions in newLISP</h3>
<div class="paragraph"><p>Lambda expressions in newLISP evaluate to themselves and can be treated
just like regular lists:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">double</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">x</span> <span class="ss">x</span><span class="p">)))</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">double</span> <span class="p">(</span><span class="k">fn</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">x</span> <span class="ss">x</span><span class="p">)))</span>      <span class="c1">; alternative syntax</span>

<span class="p">(</span><span class="k">last</span> <span class="ss">double</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">x</span> <span class="ss">x</span><span class="p">)</span>            <span class="c1">; treat lambda as a list</span>
</pre></div></div></div>
<div class="paragraph"><p>Note: No <span class="monospaced">'</span> is necessary before the lambda expression because lambda
expressions evaluate to themselves in newLISP.</p></div>
<div class="paragraph"><p>The second line uses the keyword <span class="monospaced">fn</span>, an alternative syntax first
suggested by Paul Graham for his Arc language project.</p></div>
<div class="paragraph"><p>A lambda expression is a <em>lambda list</em>, a subtype of <em>list</em>, and its
arguments can associate from left to right or right to left. When using
<a href="#append">append</a>, for example, the arguments associate from left to
right:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">append</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span><span class="p">))</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">+</span> <span class="ss">x</span> <span class="ss">x</span><span class="p">)))</span>  <span class="err">→</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">x</span> <span class="ss">x</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p><a href="#cons">cons</a>, on the other hand, associates the arguments from right
to left:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">cons</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">x</span> <span class="ss">x</span><span class="p">)))</span>  <span class="err">→</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">x</span> <span class="ss">x</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p>Note that the <span class="monospaced">lambda</span> keyword is not a symbol in a list, but a
designator of a special <em>type</em> of list: the <em>lambda list</em>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">length</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">x</span> <span class="ss">x</span><span class="p">)))</span>  <span class="err">→</span> <span class="ss">2</span>
<span class="p">(</span><span class="k">first</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">x</span> <span class="ss">x</span><span class="p">)))</span>   <span class="err">→</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Lambda expressions can be mapped or applied onto arguments to work as
user-defined, anonymous functions:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">((</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">x</span> <span class="ss">x</span><span class="p">))</span> <span class="ss">123</span><span class="p">)</span>           <span class="err">→</span> <span class="ss">246</span>
<span class="p">(</span><span class="k">apply</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">x</span> <span class="ss">x</span><span class="p">))</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">123</span><span class="p">))</span>  <span class="err">→</span> <span class="ss">246</span>
<span class="p">(</span><span class="k">map</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">x</span> <span class="ss">x</span><span class="p">))</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">3</span><span class="p">))</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">2</span> <span class="ss">4</span> <span class="ss">6</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>A lambda expression can be assigned to a symbol, which in turn can be
used as a function:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">double</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">x</span> <span class="ss">x</span><span class="p">)))</span>  <span class="err">→</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">x</span> <span class="ss">x</span><span class="p">))</span>
<span class="p">(</span><span class="nv">double</span> <span class="ss">123</span><span class="p">)</span>                        <span class="err">→</span> <span class="ss">246</span>
</pre></div></div></div>
<div class="paragraph"><p>The <a href="#define">define</a> function is just a shorter way of assigning a
lambda expression to a symbol:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">double</span> <span class="ss">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">x</span> <span class="ss">x</span><span class="p">)))</span>  <span class="err">→</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">x</span> <span class="ss">x</span><span class="p">))</span>
<span class="p">(</span><span class="nv">double</span> <span class="ss">123</span><span class="p">)</span>                  <span class="err">→</span> <span class="ss">246</span>
</pre></div></div></div>
<div class="paragraph"><p>In the above example, the expressions inside the lambda list are still
accessible within <span class="monospaced">double</span>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">double</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">x</span> <span class="ss">x</span><span class="p">)))</span>  <span class="err">→</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">x</span> <span class="ss">x</span><span class="p">))</span>
<span class="p">(</span><span class="k">last</span> <span class="ss">double</span><span class="p">)</span>                       <span class="err">→</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">x</span> <span class="ss">x</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>A lambda list can be manipulated as a first-class object using any
function that operates on lists:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">setf</span> <span class="p">(</span><span class="k">nth</span> <span class="ss">1</span> <span class="ss">double</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="k">mul</span> <span class="ss">2</span> <span class="ss">x</span><span class="p">))</span> <span class="err">→</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="k">mul</span> <span class="ss">2</span> <span class="ss">x</span><span class="p">))</span>
<span class="ss">double</span>                           <span class="err">→</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="k">mul</span> <span class="ss">2</span> <span class="ss">x</span><span class="p">))</span>
<span class="p">(</span><span class="nv">double</span> <span class="ss">123</span><span class="p">)</span>                     <span class="err">→</span> <span class="ss">246</span>
</pre></div></div></div>
<div class="paragraph"><p>All arguments are optional when applying lambda expressions and default
to <span class="monospaced">nil</span> when not supplied by the user. This makes it possible to write
functions with multiple parameter signatures.</p></div>
</div>
<div class="sect2">
<h3 id="_10_span_class_monospaced_nil_span_span_class_monospaced_true_span_span_class_monospaced_cons_span_and_span_class_monospaced_span">10. <span class="monospaced">nil</span>, <span class="monospaced">true</span>, <span class="monospaced">cons</span>, and <span class="monospaced">()</span></h3>
<div class="paragraph"><p>In newLISP, <span class="monospaced">nil</span> and <span class="monospaced">true</span> represent both the symbols and the Boolean
values <em>false</em> and <em>true</em>. Depending on their context, <span class="monospaced">nil</span> and <span class="monospaced">true</span>
are treated differently. The following examples use <span class="monospaced">nil</span>, but they can
be applied to <span class="monospaced">true</span> by simply reversing the logic.</p></div>
<div class="paragraph"><p>Evaluation of <span class="monospaced">nil</span> yields a Boolean false and is treated as such inside
flow control expressions such as <span class="monospaced">if</span>, <span class="monospaced">unless</span>, <span class="monospaced">while</span>, <span class="monospaced">until</span>, and
<span class="monospaced">not</span>. Likewise, evaluating <span class="monospaced">true</span> yields true.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">lst</span> <span class="o">&#39;</span><span class="p">(</span><span class="k">nil</span> <span class="k">nil</span> <span class="k">nil</span><span class="p">))</span>  <span class="err">→</span> <span class="p">(</span><span class="k">nil</span> <span class="k">nil</span> <span class="k">nil</span><span class="p">)</span>
<span class="p">(</span><span class="k">map</span> <span class="ss">symbol?</span> <span class="ss">lst</span><span class="p">)</span>          <span class="err">→</span> <span class="p">(</span><span class="k">true</span> <span class="k">true</span> <span class="k">true</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>In the above example, <span class="monospaced">nil</span> represents a symbol. In the following
example, <span class="monospaced">nil</span> and <span class="monospaced">true</span> are evaluated and represent Boolean values:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">if</span> <span class="k">nil</span> <span class="s">&quot;no&quot;</span> <span class="s">&quot;yes&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;yes&quot;</span>
<span class="p">(</span><span class="k">if</span> <span class="k">true</span> <span class="s">&quot;yes&quot;</span> <span class="s">&quot;no&quot;</span><span class="p">)</span> <span class="err">→</span> <span class="s">&quot;yes&quot;</span>
<span class="p">(</span><span class="k">map</span> <span class="k">not</span> <span class="ss">lst</span><span class="p">)</span>        <span class="err">→</span> <span class="p">(</span><span class="k">true</span> <span class="k">true</span> <span class="k">true</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>In newLISP, <span class="monospaced">nil</span> and the empty list <span class="monospaced">()</span> are not the same as in some
other Lisps. Only in conditional expressions are they treated as a
Boolean false, as in <span class="monospaced">and</span>, <span class="monospaced">or</span>, <span class="monospaced">if</span>, <span class="monospaced">while</span>, <span class="monospaced">unless</span>, <span class="monospaced">until</span>, and
<span class="monospaced">cond</span>.</p></div>
<div class="paragraph"><p>Evaluation of <span class="monospaced">(cons 'x '())</span> yields <span class="monospaced">(x)</span>, but <span class="monospaced">(cons 'x nil)</span> yields
<span class="monospaced">(x nil)</span> because <span class="monospaced">nil</span> is treated as a Boolean value when evaluated,
not as an empty list. The <span class="monospaced">cons</span> of two atoms in newLISP does not yield
a dotted pair, but rather a two-element list. The predicate <span class="monospaced">atom?</span> is
true for <span class="monospaced">nil</span>, but false for the empty list. The empty list in newLISP
is only an empty list and not equal to <span class="monospaced">nil</span>.</p></div>
<div class="paragraph"><p>A list in newLISP is a newLISP cell of type list. It acts like a
container for the linked list of elements making up the list cell&#8217;s
contents. There is no <em>dotted pair</em> in newLISP because the <em>cdr</em> (tail)
part of a Lisp cell always points to another Lisp cell and never to a
basic data type, such as a number or a symbol. Only the <em>car</em> (head)
part may contain a basic data type. Early Lisp implementations used
<em>car</em> and <em>cdr</em> for the names <em>head</em> and <em>tail</em>.</p></div>
</div>
<div class="sect2">
<h3 id="_11_arrays">11. Arrays</h3>
<div class="paragraph"><p>newLISP&#8217;s arrays enable fast element access within large lists. New
arrays can be constructed and initialized with the contents of an
existing list using the function <a href="#array">array</a>. Lists can be
converted into arrays, and vice versa. Most of the same functions used
for modifying and accessing lists can be applied to arrays, as well.
Arrays can hold any type of data or combination thereof.</p></div>
<div class="paragraph"><p>In particular, the following functions can be used for creating,
accessing, and modifying arrays:</p></div>
<table class="tableblock frame-all grid-all"
style="
width:40%;
">
<col style="width:9%;">
<col style="width:90%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" >function </th>
<th class="tableblock halign-left valign-top" >description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#append">append</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">appends arrays</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#array">array</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">creates and initializes an array with up to 16
dimensions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#array-list">array-list</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">converts an array into a list</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#arrayp">array?</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">checks if expression is an array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#det">det</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">returns the determinant of a matrix</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#first">first</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">returns the first row of an array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#invert">invert</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">returns the inversion of a matrix</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#last">last</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">returns the last row of an array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#mat">mat</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">perform scalar operations on matrices</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#multiply">multiply</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">multiplies two matrices</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#nth">nth</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">returns an element of and array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#rest">rest</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">returns all but the first row of an array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#setf">setf</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">sets contents of an array reference</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#slice">slice</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">returns a slice of an array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#sort">sort</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">sort the elements in an array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#transpose">transpose</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">transposes a matrix</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>newLISP represents multidimensional arrays with an array of arrays
(i.e., the elements of the array are themselves arrays).</p></div>
<div class="paragraph"><p>When used interactively, newLISP prints and displays arrays as lists,
with no way of distinguishing between them.</p></div>
<div class="paragraph"><p>Use the <a href="#source">source</a> or <a href="#save">save</a> functions to serialize
arrays (or the variables containing them). The <a href="#array">array</a>
statement is included as part of the definition when serializing arrays.</p></div>
<div class="paragraph"><p>Like lists, negative indices can be used to enumerate the elements of an
array, starting from the last element.</p></div>
<div class="paragraph"><p>An out-of-bounds index will cause an error message on an array or list.</p></div>
<div class="paragraph"><p>Arrays can be non-rectangular, but they are made rectangular during
serialization when using <a href="#source">source</a> or <a href="#save">save</a>. The
<a href="#array">array</a> function always constructs arrays in rectangular
form.</p></div>
<div class="paragraph"><p>The matrix functions <a href="#det">det</a>, <a href="#transpose">transpose</a>,
<a href="#multiply">multiply</a>, and <a href="#invert">invert</a> can be used on
matrices built with nested lists or arrays built with
<a href="#array">array</a>.</p></div>
<div class="paragraph"><p>For more details, see <a href="#array">array</a>, <a href="#arrayp">array?</a>, and
<a href="#array-list">array-list</a> in the reference section of this manual.</p></div>
</div>
<div class="sect2">
<h3 id="_12_indexing_elements_of_strings_lists_and_arrays">12. Indexing elements of strings, lists, and arrays</h3>
<div class="paragraph"><p>Some functions take array, list, or string elements (characters)
specified by one or more <em>int-index</em> (integer index). The positive
indices run <span class="monospaced">0, 1, …, N-2, N-1</span>, where <span class="monospaced">N</span> is the number of elements in
the list. If <em>int-index</em> is negative, the sequence is
<span class="monospaced">-N, -N+1, …, -2, -1</span>. Adding <span class="monospaced">N</span> to the negative index of an element
yields the positive index. Unless a function does otherwise, an index
greater than <span class="monospaced">N-1</span> or less then -N causes an out-of-bounds error in
lists and arrays.</p></div>
<div class="sect3">
<h4 id="_implicit_indexing_for_span_class_monospaced_nth_span">Implicit indexing for <span class="monospaced">nth</span></h4>
<div class="paragraph"><p>Implicit indexing can be used instead of <a href="#nth">nth</a> to retrieve the
elements of a list or array or the characters of a string:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">lst</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span> <span class="p">(</span><span class="nv">d</span> <span class="ss">e</span><span class="p">)</span> <span class="p">(</span><span class="nv">f</span> <span class="ss">g</span><span class="p">)))</span>

<span class="p">(</span><span class="nv">lst</span> <span class="ss">0</span><span class="p">)</span>    <span class="err">→</span> <span class="ss">a</span>      <span class="c1">; same as (nth 0 lst)</span>
<span class="p">(</span><span class="nv">lst</span> <span class="ss">3</span><span class="p">)</span>    <span class="err">→</span> <span class="p">(</span><span class="nv">d</span> <span class="ss">e</span><span class="p">)</span>
<span class="p">(</span><span class="nv">lst</span> <span class="ss">3</span> <span class="ss">1</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">e</span>      <span class="c1">; same as (nth &#39;(3 1) lst)</span>
<span class="p">(</span><span class="nv">lst</span> <span class="k">-</span><span class="ss">1</span><span class="p">)</span>   <span class="err">→</span> <span class="p">(</span><span class="nv">f</span> <span class="ss">g</span><span class="p">)</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">myarray</span> <span class="p">(</span><span class="k">array</span> <span class="ss">3</span> <span class="ss">2</span> <span class="p">(</span><span class="k">sequence</span> <span class="ss">1</span> <span class="ss">6</span><span class="p">)))</span>

<span class="p">(</span><span class="nv">myarray</span> <span class="ss">1</span><span class="p">)</span>     <span class="err">→</span> <span class="p">(</span><span class="nv">3</span> <span class="ss">4</span><span class="p">)</span>
<span class="p">(</span><span class="nv">myarray</span> <span class="ss">1</span> <span class="ss">0</span><span class="p">)</span>   <span class="err">→</span> <span class="ss">3</span>
<span class="p">(</span><span class="nv">myarray</span> <span class="ss">0</span> <span class="k">-</span><span class="ss">1</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">2</span>

<span class="p">(</span><span class="s">&quot;newLISP&quot;</span> <span class="ss">3</span><span class="p">)</span>   <span class="err">→</span> <span class="s">&quot;L&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>Indices may also be supplied from a list. In this way, implicit indexing
works together with functions that take or produce index vectors, such
as <a href="#push">push</a>, <a href="#pop">pop</a>, <a href="#ref">ref</a> and
<a href="#ref-all">ref-all</a>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="nv">lst</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">3</span> <span class="ss">1</span><span class="p">))</span>                <span class="err">→</span> <span class="ss">e</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">vec</span> <span class="p">(</span><span class="k">ref</span> <span class="o">&#39;</span><span class="ss">e</span> <span class="ss">lst</span><span class="p">))</span>     <span class="err">→</span> <span class="p">(</span><span class="nv">3</span> <span class="ss">1</span><span class="p">)</span>
<span class="p">(</span><span class="nv">lst</span> <span class="ss">vec</span><span class="p">)</span>                   <span class="err">→</span> <span class="ss">e</span>
</pre></div></div></div>
<div class="paragraph"><p>Note that implicit indexing is not breaking newLISP syntax rules but is
merely an expansion of existing rules to other data types in the functor
position of an s-expression. In original Lisp, the first element in an
s-expression list is applied as a function to the rest elements as
arguments. In newLISP, a list in the functor position of an s-expression
assumes self-indexing functionality using the index arguments following
it.</p></div>
<div class="paragraph"><p>Implicit indexing is faster than the explicit forms, but the explicit
forms may be more readable depending on context.</p></div>
<div class="paragraph"><p>Note that in the UTF-8–enabled version of newLISP, implicit indexing of
strings or using the <a href="#nth">nth</a> function work on character rather
than single-byte boundaries.</p></div>
</div>
<div class="sect3">
<h4 id="_implicit_indexing_and_the_default_functor">Implicit indexing and the default functor</h4>
<div class="paragraph"><p>The <em>default functor</em> is a functor inside a context with the same name
as the context itself. See <a href="#default_function">The context default
function</a> chapter. A default functor can be used together with implicit
indexing to serve as a mechanism for referencing lists:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">MyList</span><span class="o">:</span><span class="ss">MyList</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span> <span class="ss">d</span> <span class="ss">e</span> <span class="ss">f</span> <span class="ss">g</span><span class="p">))</span>

<span class="p">(</span><span class="nv">MyList</span> <span class="ss">0</span><span class="p">)</span>   <span class="err">→</span> <span class="ss">a</span>
<span class="p">(</span><span class="nv">MyList</span> <span class="ss">3</span><span class="p">)</span>   <span class="err">→</span> <span class="ss">d</span>
<span class="p">(</span><span class="nv">MyList</span> <span class="k">-</span><span class="ss">1</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">g</span>

<span class="p">(</span><span class="nv">3</span> <span class="ss">2</span> <span class="ss">MyList</span><span class="p">)</span> <span class="err">→</span> <span class="p">(</span><span class="nv">d</span> <span class="ss">e</span><span class="p">)</span>
<span class="p">(</span><span class="k">-</span><span class="ss">3</span> <span class="ss">MyList</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">e</span> <span class="ss">f</span> <span class="ss">g</span><span class="p">)</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">aList</span> <span class="ss">MyList</span><span class="p">)</span>

<span class="p">(</span><span class="nv">aList</span> <span class="ss">3</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">d</span>
</pre></div></div></div>
<div class="paragraph"><p>In this example, <span class="monospaced">aList</span> references <span class="monospaced">MyList:MyList</span>, not a copy of it.
For more information about contexts, see
<a href="#context_objects">Programming with contexts</a>.</p></div>
<div class="paragraph"><p>The indexed default functor can also be used with <a href="#setf">setf</a> as
shown in the following example:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">MyList</span><span class="o">:</span><span class="ss">MyList</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span> <span class="ss">d</span> <span class="ss">e</span> <span class="ss">f</span> <span class="ss">g</span><span class="p">))</span>

<span class="p">(</span><span class="k">setf</span> <span class="p">(</span><span class="nv">MyList</span> <span class="ss">3</span><span class="p">)</span> <span class="ss">999</span><span class="p">)</span>   <span class="err">→</span> <span class="ss">999</span>
<span class="p">(</span><span class="nv">MyList</span> <span class="ss">3</span><span class="p">)</span>              <span class="err">→</span> <span class="ss">999</span>

<span class="ss">MyList</span><span class="o">:</span><span class="ss">MyList</span>           <span class="err">→</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span> <span class="ss">999</span> <span class="ss">e</span> <span class="ss">f</span> <span class="ss">g</span><span class="p">)</span>
</pre></div></div></div>
</div>
<div class="sect3">
<h4 id="_implicit_indexing_for_span_class_monospaced_rest_span_and_span_class_monospaced_slice_span">Implicit indexing for <span class="monospaced">rest</span> and <span class="monospaced">slice</span></h4>
<div class="paragraph"><p>Implicit forms of <a href="#rest">rest</a> and <a href="#slice">slice</a> can be created
by prepending a list with one or two numbers for offset and length. If
the length is negative it counts from the end of the list or string:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">lst</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span> <span class="ss">d</span> <span class="ss">e</span> <span class="ss">f</span> <span class="ss">g</span><span class="p">))</span>
<span class="c1">; or as array</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">lst</span> <span class="p">(</span><span class="k">array</span> <span class="ss">7</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span> <span class="ss">d</span> <span class="ss">e</span> <span class="ss">f</span> <span class="ss">g</span><span class="p">)))</span>

<span class="p">(</span><span class="nv">1</span> <span class="ss">lst</span><span class="p">)</span>      <span class="err">→</span> <span class="p">(</span><span class="nv">b</span> <span class="ss">c</span> <span class="ss">d</span> <span class="ss">e</span> <span class="ss">f</span> <span class="ss">g</span><span class="p">)</span>
<span class="p">(</span><span class="nv">2</span> <span class="ss">lst</span><span class="p">)</span>      <span class="err">→</span> <span class="p">(</span><span class="nv">c</span> <span class="ss">d</span> <span class="ss">e</span> <span class="ss">f</span> <span class="ss">g</span><span class="p">)</span>
<span class="p">(</span><span class="nv">2</span> <span class="ss">3</span> <span class="ss">lst</span><span class="p">)</span>    <span class="err">→</span> <span class="p">(</span><span class="nv">c</span> <span class="ss">d</span> <span class="ss">e</span><span class="p">)</span>
<span class="p">(</span><span class="k">-</span><span class="ss">3</span> <span class="ss">2</span> <span class="ss">lst</span><span class="p">)</span>   <span class="err">→</span> <span class="p">(</span><span class="nv">e</span> <span class="ss">f</span><span class="p">)</span>
<span class="p">(</span><span class="nv">2</span> <span class="k">-</span><span class="ss">2</span> <span class="ss">lst</span><span class="p">)</span>   <span class="err">→</span> <span class="p">(</span><span class="nv">c</span> <span class="ss">d</span> <span class="ss">e</span><span class="p">)</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">str</span> <span class="s">&quot;abcdefg&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="nv">1</span> <span class="ss">str</span><span class="p">)</span>      <span class="err">→</span> <span class="s">&quot;bcdefg&quot;</span>
<span class="p">(</span><span class="nv">2</span> <span class="ss">str</span><span class="p">)</span>      <span class="err">→</span> <span class="s">&quot;cdefg&quot;</span>
<span class="p">(</span><span class="nv">2</span> <span class="ss">3</span> <span class="ss">str</span><span class="p">)</span>    <span class="err">→</span> <span class="s">&quot;cde&quot;</span>
<span class="p">(</span><span class="k">-</span><span class="ss">3</span> <span class="ss">2</span> <span class="ss">str</span><span class="p">)</span>   <span class="err">→</span> <span class="s">&quot;ef&quot;</span>
<span class="p">(</span><span class="nv">2</span> <span class="k">-</span><span class="ss">2</span> <span class="ss">str</span><span class="p">)</span>   <span class="err">→</span> <span class="s">&quot;cde&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>The functions <a href="#rest">rest</a>, <a href="#first">first</a> and <a href="#last">last</a>
work on multi-byte character boundaries in UTF-8 enabled versions of
newLISP. But the implicit indexing forms for slicing and resting will
always work on single-byte boundaries and can be used for binary
content. Offset and length results from the regular expression functions
<a href="#find">find</a> and <a href="#regex">regex</a> are also in single-byte counts
and can be further processed with <a href="#slice">slice</a> or its implicit
form.</p></div>
</div>
<div class="sect3">
<h4 id="_modify_references_in_lists_arrays_and_strings">Modify references in lists, arrays and strings</h4>
<div class="paragraph"><p>Parts in lists, arrays and strings referenced by indices can be modified
using <a href="#setf">setf</a>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">; lists</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">lst</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span> <span class="ss">d</span> <span class="p">(</span><span class="nv">e</span> <span class="ss">f</span> <span class="ss">g</span><span class="p">)))</span>

<span class="p">(</span><span class="nv">lst</span> <span class="ss">1</span><span class="p">)</span> <span class="err">→</span> <span class="ss">b</span>

<span class="p">(</span><span class="k">setf</span> <span class="p">(</span><span class="nv">lst</span> <span class="ss">1</span><span class="p">)</span> <span class="o">&#39;</span><span class="ss">z</span><span class="p">)</span> <span class="err">→</span> <span class="ss">z</span>

<span class="ss">lst</span> <span class="err">→</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">z</span> <span class="ss">c</span> <span class="ss">d</span> <span class="p">(</span><span class="nv">e</span> <span class="ss">f</span> <span class="ss">g</span><span class="p">))</span>

<span class="p">(</span><span class="k">setf</span> <span class="p">(</span><span class="nv">lst</span> <span class="k">-</span><span class="ss">1</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">E</span> <span class="ss">F</span> <span class="ss">G</span><span class="p">))</span> <span class="err">→</span> <span class="p">(</span><span class="nv">E</span> <span class="ss">F</span> <span class="ss">G</span><span class="p">)</span>

<span class="ss">lst</span> <span class="err">→</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">z</span> <span class="ss">c</span> <span class="ss">d</span> <span class="p">(</span><span class="nv">E</span> <span class="ss">F</span> <span class="ss">G</span><span class="p">))</span>

<span class="c1">; arrays</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">myarray</span> <span class="p">(</span><span class="k">array</span> <span class="ss">2</span> <span class="ss">3</span> <span class="p">(</span><span class="k">sequence</span> <span class="ss">1</span> <span class="ss">6</span><span class="p">)))</span> <span class="err">→</span> <span class="p">((</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">3</span><span class="p">)</span> <span class="p">(</span><span class="nv">4</span> <span class="ss">5</span> <span class="ss">6</span><span class="p">))</span>

<span class="p">(</span><span class="k">setf</span> <span class="p">(</span><span class="nv">myarray</span> <span class="ss">1</span> <span class="ss">2</span><span class="p">)</span> <span class="ss">66</span><span class="p">)</span> <span class="err">→</span> <span class="ss">66</span>

<span class="ss">myarray</span> <span class="err">→</span> <span class="p">((</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">3</span><span class="p">)</span> <span class="p">(</span><span class="nv">4</span> <span class="ss">5</span> <span class="ss">66</span><span class="p">))</span>

<span class="c1">; strings</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">s</span> <span class="s">&quot;NewLISP&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">setf</span> <span class="p">(</span><span class="nv">s</span> <span class="ss">0</span><span class="p">)</span> <span class="s">&quot;n&quot;</span><span class="p">)</span> <span class="err">→</span> <span class="s">&quot;n&quot;</span>

<span class="ss">s</span> <span class="err">→</span> <span class="s">&quot;newLISP&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>Note that only full elements or nested lists or arrays can be changed
this way. Slices or rest parts of lists or arrays as used in implicit
resting or slicing cannot be substituted at once using <a href="#setf">setf</a>,
but would have to be substituted element by element. In strings only one
character can be replaced at a time, but that character can be replaced
by a multi-chracacter string.</p></div>
<div class="paragraph"><p><a id="destructive"></a></p></div>
</div>
</div>
<div class="sect2">
<h3 id="_13_destructive_versus_nondestructive_functions">13. Destructive versus nondestructive functions</h3>
<div class="paragraph"><p>Most of the primitives in newLISP are nondestructive (no <em>side effects</em>)
and leave existing objects untouched, although they may create new ones.
There are a few destructive functions, however, that <em>do</em> change the
contents of a variable, list, array, or string:</p></div>
<table class="tableblock frame-all grid-all"
style="
width:100%;
">
<col style="width:16%;">
<col style="width:83%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" >function </th>
<th class="tableblock halign-left valign-top" >description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#inci">++</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">increments numbers in integer mode</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#deci">--</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">decrements numbers in integer mode</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#bind">bind</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">binds variable associations in a list</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#constant">constant</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">sets the contents of a variable and protects
it</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#extend">extend</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">extends a list or string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#dec">dec</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">decrements a number referenced by a variable, list or
array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#define">define</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">sets the contents of a variable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#inc">inc</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">increments a number referenced by a variable, list or
array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#net-receive">net-receive</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">reads into a buffer variable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#pop">pop</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">pops an element from a list or string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#pop-assoc">pop-assoc</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">removes an association from an association
list</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#push">push</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">pushes a new element onto a list or string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#read">read</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">reads into a buffer variable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#receive">receive</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">receives a message from a parent or child
process</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#replace">replace</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">replaces elements in a list or string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#reverse">reverse</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">reverses a list or string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#rotate">rotate</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">rotates the elements of a list or characters of a
string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#set">set</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">sets the contents of a variable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#setf">setf setq</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">sets the contents of a variable, list, array or
string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#set-ref">set-ref</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">searches for an element in a nested list and
replaces it</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#set-ref-all">set-ref-all</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">searches for an element in a nested
list and replaces all instances</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#sort">sort</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">sorts the elements of a list or array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#swap">swap</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">swaps two elements inside a list or string</p></td>
</tr>
</tbody>
</table>
<div class="sect3">
<h4 id="_make_a_destructive_function_non_destructive">Make a destructive function non-destructive</h4>
<div class="paragraph"><p>Some destructive functions can be made non-destructive by wrapping the
target object into the <a href="#copy">copy</a> function.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">aList</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span> <span class="ss">d</span> <span class="ss">e</span> <span class="ss">f</span><span class="p">))</span>

<span class="p">(</span><span class="k">replace</span> <span class="o">&#39;</span><span class="ss">c</span> <span class="p">(</span><span class="k">copy</span> <span class="ss">aList</span><span class="p">))</span> <span class="err">→</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">d</span> <span class="ss">e</span> <span class="ss">f</span><span class="p">)</span>

<span class="ss">aList</span> <span class="err">→</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span> <span class="ss">d</span> <span class="ss">e</span> <span class="ss">f</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The list in <span class="monospaced">aList</span> is left unchanged.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_14_early_return_from_functions_loops_and_blocks">14. Early return from functions, loops, and blocks</h3>
<div class="paragraph"><p>What follows are methods of interrupting the control flow inside both
loops and the <a href="#begin">begin</a> expression.</p></div>
<div class="paragraph"><p>The looping functions <a href="#dolist">dolist</a> and <a href="#dotimes">dotimes</a>
can take optional conditional expressions to leave the loop early.
<a href="#catch">catch</a> and <a href="#throw">throw</a> are a more general form to
break out of a loop body and are also applicable to other forms or
statement blocks.</p></div>
<div class="sect3">
<h4 id="_using_span_class_monospaced_catch_span_and_span_class_monospaced_throw_span">Using <span class="monospaced">catch</span> and <span class="monospaced">throw</span></h4>
<div class="paragraph"><p>Because newLISP is a functional language, it uses no <span class="monospaced">break</span> or <span class="monospaced">return</span>
statements to exit functions or iterations. Instead, a block or function
can be exited at any point using the functions <a href="#catch">catch</a> and
<a href="#throw">throw</a>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">foo</span> <span class="ss">x</span><span class="p">)</span>
    <span class="ss">...</span>
    <span class="p">(</span><span class="k">if</span> <span class="ss">condition</span> <span class="p">(</span><span class="k">throw</span> <span class="ss">123</span><span class="p">))</span>
    <span class="ss">...</span>
    <span class="ss">456</span>
<span class="p">)</span>

<span class="c1">;; if condition is true</span>

<span class="p">(</span><span class="k">catch</span> <span class="p">(</span><span class="nv">foo</span> <span class="ss">p</span><span class="p">))</span>  <span class="err">→</span> <span class="ss">123</span>

<span class="c1">;; if condition is not true</span>

<span class="p">(</span><span class="k">catch</span> <span class="p">(</span><span class="nv">foo</span> <span class="ss">p</span><span class="p">))</span>  <span class="err">→</span> <span class="ss">456</span>
</pre></div></div></div>
<div class="paragraph"><p>Breaking out of loops works in a similar way:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">catch</span>
    <span class="p">(</span><span class="k">dotimes</span> <span class="p">(</span><span class="nv">i</span> <span class="ss">N</span><span class="p">)</span>
        <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">=</span> <span class="p">(</span><span class="nv">foo</span> <span class="ss">i</span><span class="p">)</span> <span class="ss">100</span><span class="p">)</span> <span class="p">(</span><span class="k">throw</span> <span class="ss">i</span><span class="p">))))</span>

<span class="err">→</span> <span class="ss">value</span> <span class="ss">of</span> <span class="ss">i</span> <span class="k">when</span> <span class="ss">foo</span><span class="p">(</span><span class="nv">i</span><span class="p">)</span> <span class="ss">equals</span> <span class="ss">100</span>
</pre></div></div></div>
<div class="paragraph"><p>The example shows how an iteration can be exited before executing <span class="monospaced">N</span>
times.</p></div>
<div class="paragraph"><p>Multiple points of return can be coded using <a href="#throw">throw</a>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">catch</span> <span class="p">(</span><span class="k">begin</span>
    <span class="p">(</span><span class="nv">foo1</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">foo2</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if</span> <span class="ss">condition-A</span> <span class="p">(</span><span class="k">throw</span> <span class="o">&#39;</span><span class="ss">x</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">foo3</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if</span> <span class="ss">condition-B</span> <span class="p">(</span><span class="k">throw</span> <span class="o">&#39;</span><span class="ss">y</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">foo4</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">foo5</span><span class="p">)))</span>
</pre></div></div></div>
<div class="paragraph"><p>If <span class="monospaced">condition-A</span> is true, <span class="monospaced">x</span> will be returned from the <span class="monospaced">catch</span>
expression; if <span class="monospaced">condition-B</span> is true, the value returned is <span class="monospaced">y</span>.
Otherwise, the result from <span class="monospaced">foo5</span> will be used as the return value.</p></div>
<div class="paragraph"><p>As an alternative to <a href="#catch">catch</a>, the
<a href="#error-event">error-event</a> function can be used to catch errors
caused by faulty code or user-initiated exceptions.</p></div>
<div class="paragraph"><p>The <a href="#throw-error">throw-error</a> function may be used to throw
user-defined errors.</p></div>
</div>
<div class="sect3">
<h4 id="_using_span_class_monospaced_and_span_and_span_class_monospaced_or_span">Using <span class="monospaced">and</span> and <span class="monospaced">or</span></h4>
<div class="paragraph"><p>Using the logical functions <a href="#and">and</a> and <a href="#or">or</a>, blocks of
statements can be built that are exited depending on the Boolean result
of the enclosed functions:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">and</span>
    <span class="p">(</span><span class="nv">func-a</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">func-b</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">func-c</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">func-d</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p>The <a href="#and">and</a> expression will return as soon as one of the block&#8217;s
functions returns <span class="monospaced">nil</span> or an <span class="monospaced">()</span> (empty list). If none of the
preceding functions causes an exit from the block, the result of the
last function is returned.</p></div>
<div class="paragraph"><p><a href="#or">or</a> can be used in a similar fashion:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">or</span>
    <span class="p">(</span><span class="nv">func-a</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">func-b</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">func-c</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">func-d</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p>The result of the <a href="#or">or</a> expression will be the first function
that returns a value which is <em>not</em> <span class="monospaced">nil</span> or <span class="monospaced">()</span>.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_15_dynamic_and_lexical_scoping">15. Dynamic and lexical scoping</h3>
<div class="paragraph"><p>newLISP uses dynamic scoping <em>inside</em> contexts. A context is a lexically
closed namespace. In this way, parts of a newLISP program can live in
different namespaces taking advantage of <em>lexical scoping</em>.</p></div>
<div class="paragraph"><p>When the parameter symbols of a lambda expression are bound to its
arguments, the old bindings are pushed onto a stack. newLISP
automatically restores the original variable bindings when leaving the
lambda function.</p></div>
<div class="paragraph"><p>The following example illustrates the <em>dynamic scoping</em> mechanism. The
text without the <span class="monospaced">&gt;</span> prompt is the output from newLISP:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="ss">&gt;</span> <span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">x</span> <span class="ss">1</span><span class="p">)</span>
<span class="ss">1</span>
<span class="ss">&gt;</span> <span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">f</span><span class="p">)</span> <span class="ss">x</span><span class="p">)</span>
<span class="p">(</span><span class="k">lambda</span> <span class="p">()</span> <span class="ss">x</span><span class="p">)</span>
<span class="ss">&gt;</span> <span class="p">(</span><span class="nv">f</span><span class="p">)</span>
<span class="ss">1</span>
<span class="ss">&gt;</span> <span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">g</span> <span class="ss">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">f</span><span class="p">))</span>
<span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">f</span><span class="p">))</span>
<span class="ss">&gt;</span> <span class="p">(</span><span class="nv">g</span> <span class="ss">0</span><span class="p">)</span>
<span class="ss">0</span>
<span class="ss">&gt;</span> <span class="p">(</span><span class="nv">f</span><span class="p">)</span>
<span class="ss">1</span>
<span class="ss">&gt;</span> <span class="ss">_</span>
</pre></div></div></div>
<div class="paragraph"><p>The variable <span class="monospaced">x</span> is first set to <span class="monospaced">1</span>. But when <span class="monospaced">(g 0)</span> is called, <span class="monospaced">x</span> is
bound to <span class="monospaced">0</span> and <span class="monospaced">x</span> is reported by <span class="monospaced">(f)</span> as <span class="monospaced">0</span> during execution of
<span class="monospaced">(g 0)</span>. After execution of <span class="monospaced">(g 0)</span>, the call to <span class="monospaced">(f)</span> will report <span class="monospaced">x</span>
as <span class="monospaced">1</span> again.</p></div>
<div class="paragraph"><p>This is different from the <em>lexical scoping</em> mechanisms found in
languages like C or Java, where the binding of local parameters occurs
inside the function only. In lexically scoped languages like C, <span class="monospaced">(f)</span>
would always print the global bindings of the symbol <span class="monospaced">x</span> with <span class="monospaced">1</span>.</p></div>
<div class="paragraph"><p>Be aware that passing quoted symbols to a user-defined function causes a
name clash if the same variable name is used as a function parameter:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="k">inc-</span><span class="ss">symbol</span> <span class="ss">x</span> <span class="ss">y</span><span class="p">)</span> <span class="p">(</span><span class="k">inc</span> <span class="p">(</span><span class="k">eval</span> <span class="ss">x</span><span class="p">)</span> <span class="ss">y</span><span class="p">))</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">y</span> <span class="ss">200</span><span class="p">)</span>
<span class="p">(</span><span class="k">inc-</span><span class="ss">symbol</span> <span class="o">&#39;</span><span class="ss">y</span> <span class="ss">123</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">246</span>
<span class="ss">y</span>                    <span class="err">→</span> <span class="ss">200</span>  <span class="c1">; y is still 200</span>
</pre></div></div></div>
<div class="paragraph"><p>Because the global <span class="monospaced">y</span> shares the same symbol as the function&#8217;s second
parameter, <span class="monospaced">inc-symbol</span> returns 246 (123 + 123), leaving the global <span class="monospaced">y</span>
unaffected. Dynamic scoping&#8217;s <em>variable capture</em> can be a disadvantage
when passing symbol references to user-defined functions. newLISP offers
several methods to avoid variable capture.</p></div>
<div class="ulist"><ul>
<li>
<p>
The function <a href="#args">args</a> can be used when passing symbols.
</p>
</li>
<li>
<p>
One or more user-defined functions can be placed in their own
  namespace called a <a href="#contexts">context</a>. A symbol name clash
  cannot occur when accessing symbols and calling functions from
  <em>outside</em> of the defining context.
</p>
</li>
</ul></div>
<div class="paragraph"><p>Contexts should be used to group related functions when creating
interfaces or function libraries. This surrounds the functions with a
lexical "fence", thus avoiding variable name clashes with the calling
functions.</p></div>
<div class="paragraph"><p>newLISP uses contexts for different forms of lexical scoping. See the
chapters <a href="#contexts">Contexts</a> and <a href="#context_objects">Programming
with contexts</a>, as well as the section <a href="#default_function">default
functors</a> for more information.</p></div>
</div>
<div class="sect2">
<h3 id="_16_contexts">16. Contexts</h3>
<div class="paragraph"><p>In newLISP, symbols can be separated into namespaces called <em>contexts</em>.
Each context has a private symbol table separate from all other
contexts. Symbols known in one context are unknown in others, so the
same name may be used in different contexts without conflict.</p></div>
<div class="paragraph"><p>Contexts are used to build modules of isolated variable and function
definitions. They can also be copied and dynamically assigned to
variables or passed as arguments. Because contexts in newLISP have
lexically separated namespaces, they allow programming with <em>lexical
scoping</em> and software object styles of programming.</p></div>
<div class="paragraph"><p>Contexts are identified by symbols that are part of the root or <span class="monospaced">MAIN</span>
context. Although context symbols are uppercased in this chapter,
lowercase symbols may also be used.</p></div>
<div class="paragraph"><p>In addition to context names, <span class="monospaced">MAIN</span> contains the symbols for built-in
functions and special symbols such as <span class="monospaced">true</span> and <span class="monospaced">nil</span>. The <span class="monospaced">MAIN</span>
context is created automatically each time newLISP is run. To see all
the symbols in <span class="monospaced">MAIN</span>, enter the following expression after starting
newLISP:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">symbols</span><span class="p">)</span>
</pre></div></div></div>
<div class="sect3">
<h4 id="_symbol_creation_in_contexts">Symbol creation in contexts</h4>
<div class="paragraph"><p>The following rules should simplify the process of understanding
contexts by identifying to which context the created symbols are being
assigned.</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
newLISP first parses and translates each top level expression. The
symbols are created during this phase. After the expression is
translated, it gets evaluated.
</p>
</li>
<li>
<p>
A symbol is created when newLISP first <em>sees</em> it, when calling the
<a href="#load">load</a>, <a href="#sym">sym</a>, or <a href="#eval-string">eval-string</a>
functions. When newLISP reads a source file, symbols are created
<em>before</em> evaluation occurs.
</p>
</li>
<li>
<p>
When an unknown symbol is encountered during code translation, a
search for its definition begins inside the current context. Failing
that, the search continues inside <span class="monospaced">MAIN</span> for a built-in function,
context, or global symbol. If no definition is found, the symbol is
created locally inside the current context.
</p>
</li>
<li>
<p>
Once a symbol is created and assigned to a specific context, it will
belong to that context permanently.
</p>
</li>
<li>
<p>
When a user-defined function is evaluated, the context is switched
to the parent context of the symbol it is called with.
</p>
</li>
<li>
<p>
A context switch only influences symbol creation during
<a href="#load">load</a>, <a href="#sym">sym</a>, or <a href="#eval-string">eval-string</a>.
<a href="#load">load</a> by default loads into MAIN except when context switches
occur on the top level of the file loaded. The context should always be
specified when the functions <a href="#sym">sym</a> and
<a href="#eval-string">eval-string</a> are used. When this rule is followed, a
context switch should only occur on the top level of a program, never
inside a function.
</p>
</li>
</ol></div>
</div>
<div class="sect3">
<h4 id="_creating_contexts">Creating contexts</h4>
<div class="paragraph"><p>Contexts can be created either by using the <a href="#context">context</a>
function or via implicit creation. The first method is used when writing
larger portions of code belonging the same context:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">context</span> <span class="o">&#39;</span><span class="ss">FOO</span><span class="p">)</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">var</span> <span class="ss">123</span><span class="p">)</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">func</span> <span class="ss">x</span> <span class="ss">y</span> <span class="ss">z</span><span class="p">)</span>
    <span class="ss">...</span> <span class="p">)</span>

<span class="p">(</span><span class="k">context</span> <span class="k">MAIN</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>If the context does not exist yet, the context symbol must be quoted. If
the symbol is not quoted, newLISP assumes the symbol is a variable
holding the symbol of the context to create. Because a context evaluates
to itself, existing contexts like MAIN do not require quoting.</p></div>
<div class="paragraph"><p>When newLISP reads the above code, it will read, then evaluate the first
statement: <span class="monospaced">(context 'FOO)</span>. This causes newLISP to switch the namespace
to <span class="monospaced">FOO</span> and the following symbols <span class="monospaced">var</span>, <span class="monospaced">x</span>, <span class="monospaced">y</span> and <span class="monospaced">z</span> will all be
created in the <span class="monospaced">FOO</span> context when reading and evaluating the remaining
expressions.</p></div>
<div class="paragraph"><p>To refer to <span class="monospaced">var</span> or <span class="monospaced">func</span> from anywhere else outside the <span class="monospaced">FOO</span> namespace
they need to be prefixed with the context name:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="ss">FOO</span><span class="o">:</span><span class="ss">var</span> <span class="err">→</span> <span class="ss">123</span>

<span class="p">(</span><span class="nv">FOO</span><span class="o">:</span><span class="ss">func</span> <span class="ss">p</span> <span class="ss">q</span> <span class="ss">r</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The <a href="#symbols">symbols</a> function is used to show all symbols
belonging to a context:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">symbols</span> <span class="ss">FOO</span><span class="p">)</span> <span class="err">→</span> <span class="p">(</span><span class="nv">FOO</span><span class="o">:</span><span class="ss">func</span> <span class="ss">FOO</span><span class="o">:</span><span class="ss">var</span> <span class="ss">FOO</span><span class="o">:</span><span class="ss">x</span> <span class="ss">FOO</span><span class="o">:</span><span class="ss">y</span> <span class="ss">FOO</span><span class="o">:</span><span class="ss">z</span><span class="p">)</span>
</pre></div></div></div>
<div class="sect4">
<h5 id="_implicitly_creating_contexts">Implicitly creating contexts</h5>
<div class="paragraph"><p>A context is implicitly created when referring to one that does not yet
exist. Unlike the <span class="monospaced">context</span> function, the context is not switched. The
following statements are all executed inside the <span class="monospaced">MAIN</span> context:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="ss">&gt;</span> <span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">ACTX</span><span class="o">:</span><span class="ss">var</span> <span class="s">&quot;hello&quot;</span><span class="p">)</span>
<span class="s">&quot;hello&quot;</span>
<span class="ss">&gt;</span> <span class="ss">ACTX</span><span class="o">:</span><span class="ss">var</span>
<span class="s">&quot;hello&quot;</span>
<span class="ss">&gt;</span> <span class="ss">_</span>
</pre></div></div></div>
<div class="paragraph"><p>Note that only the symbols prefixed with their context name will be part
of the context:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">ACTX</span><span class="o">:</span><span class="ss">foo</span> <span class="ss">x</span> <span class="ss">y</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">+</span> <span class="ss">x</span> <span class="ss">y</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p>When above code is loaded in MAIN only <span class="monospaced">foo</span> will be part of <span class="monospaced">ACTX</span>. The
symbols <span class="monospaced">x</span> and <span class="monospaced">y</span> will still be part of <span class="monospaced">MAIN</span>.</p></div>
</div>
<div class="sect4">
<h5 id="_loading_module_files">Loading module files</h5>
<div class="paragraph"><p>When loading source files on the command-line with <a href="#load">load</a>, or
when executing the functions <a href="#eval-string">eval-string</a> or
<a href="#sym">sym</a>, the <span class="monospaced">context</span> function tells newLISP where to put all of
the symbols and definitions:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">;;; file MY_PROG.LSP</span>
<span class="c1">;;</span>
<span class="c1">;; everything from here on goes into GRAPH</span>
<span class="p">(</span><span class="k">context</span> <span class="o">&#39;</span><span class="ss">GRAPH</span><span class="p">)</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">draw-triangle</span> <span class="ss">x</span> <span class="ss">y</span> <span class="ss">z</span><span class="p">)</span>
    <span class="p">(</span><span class="err">…</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">draw-circle</span><span class="p">)</span>
    <span class="p">(</span><span class="err">…</span><span class="p">))</span>

<span class="c1">;; show the runtime context, which is GRAPH</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">foo</span><span class="p">)</span>
    <span class="p">(</span><span class="k">context</span><span class="p">))</span>

<span class="c1">;; switch back to MAIN</span>
<span class="p">(</span><span class="k">context</span> <span class="o">&#39;</span><span class="k">MAIN</span><span class="p">)</span>

<span class="c1">;; end of file</span>
</pre></div></div></div>
<div class="paragraph"><p>The <span class="monospaced">draw-triangle</span> and <span class="monospaced">draw-circle</span> functions&#8201;&#8212;&#8201;along with their <span class="monospaced">x</span>,
<span class="monospaced">y</span>, and <span class="monospaced">z</span> parameters&#8201;&#8212;&#8201;are now part of the <span class="monospaced">GRAPH</span> context. These
symbols are known only to <span class="monospaced">GRAPH</span>. To call these functions from another
context, prefix them with <span class="monospaced">GRAPH:</span></p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="nv">GRAPH</span><span class="o">:</span><span class="ss">draw-triangle</span> <span class="ss">1</span> <span class="ss">2</span> <span class="ss">3</span><span class="p">)</span>
<span class="p">(</span><span class="nv">GRAPH</span><span class="o">:</span><span class="ss">foo</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">GRAPH</span>
</pre></div></div></div>
<div class="paragraph"><p>The last statement shows how the runtime context has changed to <span class="monospaced">GRAPH</span>
(function <span class="monospaced">foo</span>'s context).</p></div>
<div class="paragraph"><p>A symbol&#8217;s name and context are used when comparing symbols from
different contexts. The <a href="#term">term</a> function can be used to extract
the term part from a fully qualified symbol.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">;; same symbol name, but different context name</span>
<span class="p">(</span><span class="nv">=</span> <span class="o">&#39;</span><span class="ss">A</span><span class="o">:</span><span class="ss">val</span> <span class="o">&#39;</span><span class="ss">B</span><span class="o">:</span><span class="ss">val</span><span class="p">)</span>                <span class="err">→</span> <span class="k">nil</span>
<span class="p">(</span><span class="nv">=</span> <span class="p">(</span><span class="k">term</span> <span class="o">&#39;</span><span class="ss">A</span><span class="o">:</span><span class="ss">val</span><span class="p">)</span> <span class="p">(</span><span class="k">term</span> <span class="o">&#39;</span><span class="ss">B</span><span class="o">:</span><span class="ss">val</span><span class="p">))</span>  <span class="err">→</span> <span class="k">true</span>
</pre></div></div></div>
<div class="paragraph"><p>Note: The symbols are quoted with a <span class="monospaced">'</span> (single quote) because we are
interested in the symbol itself, not in the contents of the symbol.</p></div>
</div>
</div>
<div class="sect3">
<h4 id="_global_scope">Global scope</h4>
<div class="paragraph"><p>By default, only built-in functions and symbols like <span class="monospaced">nil</span> and <span class="monospaced">true</span>
are visible inside contexts other than <span class="monospaced">MAIN</span>. To make a symbol visible
to every context, use the <a href="#global">global</a> function:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>(set 'aVar 123) → 123
(global 'aVar)  → aVar

(context 'FOO)  → FOO

aVar            → 123</pre>
</div></div>
<div class="paragraph"><p>Without the <span class="monospaced">global</span> statement, the second <span class="monospaced">aVar</span> would have returned
<span class="monospaced">nil</span> instead of <span class="monospaced">123</span>. If <span class="monospaced">FOO</span> had a previously defined symbol (<span class="monospaced">aVar</span>
in this example) <em>that</em> symbol&#8217;s value&#8201;&#8212;&#8201;and not the global&#8217;s&#8201;&#8212;&#8201;would be
returned instead. Note that only symbols from the <span class="monospaced">MAIN</span> context can be
made global.</p></div>
<div class="paragraph"><p>Once it is made visible to contexts through the <a href="#global">global</a>
function, a symbol cannot be hidden from them again.</p></div>
</div>
<div class="sect3">
<h4 id="_symbol_protection">Symbol protection</h4>
<div class="paragraph"><p>By using the <a href="#constant">constant</a> function, symbols can be both set
and protected from change at the same time:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="ss">&gt;</span> <span class="p">(</span><span class="k">constant</span> <span class="o">&#39;</span><span class="ss">aVar</span> <span class="ss">123</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">123</span>
<span class="ss">&gt;</span> <span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">aVar</span> <span class="ss">999</span><span class="p">)</span>
<span class="ss">ERR</span><span class="o">:</span> <span class="ss">symbol</span> <span class="ss">is</span> <span class="ss">protected</span> <span class="ss">in</span> <span class="ss">function</span> <span class="k">set</span> <span class="o">:</span> <span class="ss">aVar</span>
<span class="k">&gt;</span><span class="ss">_</span>
</pre></div></div></div>
<div class="paragraph"><p>A symbol needing to be both a constant and a global can be defined
simultaneously:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">constant</span> <span class="p">(</span><span class="k">global</span> <span class="o">&#39;</span><span class="ss">aVar</span><span class="p">)</span> <span class="ss">123</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>In the current context, symbols protected by <span class="monospaced">constant</span> can be
overwritten by using the <span class="monospaced">constant</span> function again. This protects the
symbols from being overwritten by code in other contexts.</p></div>
</div>
<div class="sect3">
<h4 id="_overwriting_global_symbols_and_built_ins">Overwriting global symbols and built-ins</h4>
<div class="paragraph"><p>Global and built-in function symbols can be overwritten inside a context
by prefixing them with their <em>own</em> context symbol:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>(context 'Account)

(define (Account:new …)
    (…))

(context 'MAIN)</pre>
</div></div>
<div class="paragraph"><p>In this example, the built-in function <a href="#new">new</a> is overwritten by
<span class="monospaced">Account:new</span>, a different function that is private to the <span class="monospaced">Account</span>
context.</p></div>
</div>
<div class="sect3">
<h4 id="_variables_containing_contexts">Variables containing contexts</h4>
<div class="paragraph"><p>Variables can be used to refer to contexts:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">FOO</span><span class="o">:</span><span class="ss">x</span> <span class="ss">123</span><span class="p">)</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">ctx</span> <span class="ss">FOO</span><span class="p">)</span>    <span class="err">→</span> <span class="ss">FOO</span>

<span class="ss">ctx</span><span class="o">:</span><span class="ss">x</span>             <span class="err">→</span> <span class="ss">123</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">ctx</span><span class="o">:</span><span class="ss">x</span> <span class="ss">999</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">999</span>

<span class="ss">FOO</span><span class="o">:</span><span class="ss">x</span>             <span class="err">→</span> <span class="ss">999</span>
</pre></div></div></div>
<div class="paragraph"><p>Context variables are useful when writing functions, which need to
switch contexts or use contexts which do not exist yet:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">update</span> <span class="ss">ctx</span> <span class="ss">val</span><span class="p">)</span>
    <span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">ctx</span><span class="o">:</span><span class="ss">sum</span> <span class="ss">val</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">ctx</span><span class="o">:</span><span class="ss">func</span> <span class="ss">999</span><span class="p">)</span>
<span class="p">)</span>

<span class="p">(</span><span class="k">context</span> <span class="o">&#39;</span><span class="ss">FOO</span><span class="p">)</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">func</span> <span class="ss">x</span><span class="p">)</span>
    <span class="p">(</span><span class="k">println</span> <span class="s">&quot;=&gt;&quot;</span> <span class="ss">x</span><span class="p">))</span>
<span class="p">(</span><span class="k">context</span> <span class="k">MAIN</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The following shows a terminal session using above definitions. The
program output is shown with labels on the right:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="ss">&gt;</span> <span class="p">(</span><span class="nv">update</span> <span class="ss">FOO</span> <span class="ss">123</span><span class="p">)</span>
<span class="ss">=&gt;</span> <span class="ss">999</span>                 <span class="c1"># &lt;output&gt;</span>

<span class="ss">&gt;</span> <span class="ss">FOO</span><span class="o">:</span><span class="ss">sum</span>
<span class="ss">123</span>                    <span class="c1"># &lt;output&gt;</span>
<span class="ss">&gt;</span>
</pre></div></div></div>
<div class="paragraph"><p>The same one function <span class="monospaced">update</span> can display different behavior depending
on the context passed as first parameter.</p></div>
</div>
<div class="sect3">
<h4 id="_sequence_of_creating_or_loading_contexts">Sequence of creating or loading contexts</h4>
<div class="paragraph"><p>The sequence in which contexts are created or loaded can lead to
unexpected results. Enter the following code into a file called <span class="monospaced">demo</span>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">;; demo - file for loading contexts</span>
<span class="p">(</span><span class="k">context</span> <span class="o">&#39;</span><span class="ss">FOO</span><span class="p">)</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">ABC</span> <span class="ss">123</span><span class="p">)</span>
<span class="p">(</span><span class="k">context</span> <span class="k">MAIN</span><span class="p">)</span>

<span class="p">(</span><span class="k">context</span> <span class="o">&#39;</span><span class="ss">ABC</span><span class="p">)</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">FOO</span> <span class="ss">456</span><span class="p">)</span>
<span class="p">(</span><span class="k">context</span> <span class="o">&#39;</span><span class="k">MAIN</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Now load the file into the newlisp shell:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="ss">&gt;</span> <span class="p">(</span><span class="k">load</span> <span class="s">&quot;demo&quot;</span><span class="p">)</span>
<span class="ss">ERR</span><span class="o">:</span> <span class="ss">symbol</span> <span class="ss">is</span> <span class="ss">protected</span> <span class="ss">in</span> <span class="ss">function</span> <span class="k">set</span> <span class="o">:</span> <span class="ss">FOO</span>
<span class="ss">&gt;</span> <span class="ss">_</span>
</pre></div></div></div>
<div class="paragraph"><p>Loading the file causes an error message for <span class="monospaced">FOO</span>, but not for <span class="monospaced">ABC</span>.
When the first context <span class="monospaced">FOO</span> is loaded, the context <span class="monospaced">ABC</span> does not exist
yet, so a local variable <span class="monospaced">FOO:ABC</span> gets created. When <span class="monospaced">ABC</span> loads, <span class="monospaced">FOO</span>
already exists as a global protected symbol and will be correctly
flagged as protected.</p></div>
<div class="paragraph"><p><span class="monospaced">FOO</span> could still be used as a local variable in the <span class="monospaced">ABC</span> context by
explicitly prefixing it, as in <span class="monospaced">ABC:FOO</span>.</p></div>
<div class="paragraph"><p>The following pattern can be applied to avoid unexpected behavior when
loading contexts being used as modules to build larger applications:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">;; begin of file - MyModule.lsp</span>
<span class="p">(</span><span class="k">load</span> <span class="s">&quot;This.lsp&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">load</span> <span class="s">&quot;That.lsp&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">load</span> <span class="s">&quot;Other.lsp&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">context</span> <span class="o">&#39;</span><span class="ss">MyModule</span><span class="p">)</span>

<span class="err">…</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">func</span> <span class="ss">x</span> <span class="ss">y</span> <span class="ss">z</span><span class="p">)</span> <span class="p">(</span><span class="err">…</span><span class="p">))</span>

<span class="err">…</span>

<span class="p">(</span><span class="k">context</span> <span class="o">&#39;</span><span class="k">MAIN</span><span class="p">)</span>

<span class="p">(</span><span class="nv">MyModule</span><span class="o">:</span><span class="ss">func</span> <span class="ss">1</span> <span class="ss">2</span> <span class="ss">3</span><span class="p">)</span>

<span class="p">(</span><span class="k">exit</span><span class="p">)</span>

<span class="c1">;; end of file</span>
</pre></div></div></div>
<div class="paragraph"><p>Always load the modules required by a context <em>before</em> the module&#8217;s
<span class="monospaced">context</span> statement. Always finish by switching back to the <span class="monospaced">MAIN</span>
context, where the module&#8217;s functions and values can be safely accessed.</p></div>
</div>
<div class="sect3">
<h4 id="_contexts_as_programming_modules">Contexts as programming modules</h4>
<div class="paragraph"><p>Contexts in newLISP are mainly used for partitioning source into
modules. Because each module lives in a different namespace, modules are
lexically separated and the names of symbols cannot clash with identical
names in other modules.</p></div>
<div class="paragraph"><p>The <a href="http://newlisp.org/code/modules/">modules</a>, which are part of the
newLISP distribution, are a good example of how to put related functions
into a module file, and how to document modules using the
<a href="http://newlisp.org/newLISPdoc.html">newLISPdoc</a> utility.</p></div>
<div class="paragraph"><p>For best programming practice, a file should only contain one module and
the filename should be similar if not identical to the context name
used:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">;; file db.lsp, commonly used database functions</span>

<span class="p">(</span><span class="k">context</span> <span class="o">&#39;</span><span class="ss">db</span><span class="p">)</span>

<span class="c1">;; Variables used throughout this namespace</span>

<span class="p">(</span><span class="k">define</span> <span class="ss">db</span><span class="o">:</span><span class="ss">handle</span><span class="p">)</span>
<span class="p">(</span><span class="k">define</span> <span class="ss">db</span><span class="o">:</span><span class="ss">host</span> <span class="s">&quot;http://localhost&quot;</span><span class="p">)</span>

<span class="c1">;; Constants</span>

<span class="p">(</span><span class="k">constant</span> <span class="o">&#39;</span><span class="ss">Max_N</span> <span class="ss">1000000</span><span class="p">)</span>
<span class="p">(</span><span class="k">constant</span> <span class="o">&#39;</span><span class="ss">Path</span> <span class="s">&quot;/usr/data/&quot;</span><span class="p">)</span>

<span class="c1">;; Functions</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">db</span><span class="o">:</span><span class="k">open</span> <span class="ss">...</span> <span class="p">)</span>
    <span class="ss">...</span> <span class="p">)</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">db</span><span class="o">:</span><span class="k">close</span> <span class="ss">...</span> <span class="p">)</span>
    <span class="ss">...</span> <span class="p">)</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">db</span><span class="o">:</span><span class="ss">update</span> <span class="ss">...</span> <span class="p">)</span>
    <span class="ss">...</span> <span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The example shows a good practice of predefining variables, which are
global inside the namespace, and defining as constants the variables
that will not change.</p></div>
<div class="paragraph"><p>If a file contains more than one context, then the end of the context
should be marked with a switch back to <span class="monospaced">MAIN</span>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">;; Multi context file multi.lsp</span>

<span class="p">(</span><span class="k">context</span> <span class="o">&#39;</span><span class="ss">A-ctx</span><span class="p">)</span>
<span class="ss">...</span>
<span class="p">(</span><span class="k">context</span> <span class="k">MAIN</span><span class="p">)</span>

<span class="p">(</span><span class="k">context</span> <span class="o">&#39;</span><span class="ss">B-ctx</span><span class="p">)</span>
<span class="ss">...</span>
<span class="p">(</span><span class="k">context</span> <span class="k">MAIN</span><span class="p">)</span>

<span class="p">(</span><span class="k">context</span> <span class="o">&#39;</span><span class="ss">C-ctx</span><span class="p">)</span>
<span class="ss">...</span>
<span class="p">(</span><span class="k">context</span> <span class="k">MAIN</span><span class="p">)</span>
</pre></div></div></div>
</div>
<div class="sect3">
<h4 id="_contexts_as_data_containers">Contexts as data containers</h4>
<div class="paragraph"><p>Contexts are frequently uses as data containers, e.g. for hash-like
dictionaries and configuration data:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">;; Config.lsp - configuration setup</span>

<span class="p">(</span><span class="k">context</span> <span class="o">&#39;</span><span class="ss">Config</span><span class="p">)</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">user-name</span> <span class="s">&quot;admin&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">password</span> <span class="s">&quot;secret&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">db-name</span> <span class="s">&quot;/usr/data/db.lsp&quot;</span><span class="p">)</span>
<span class="ss">...</span>

<span class="c1">;; eof</span>
</pre></div></div></div>
<div class="paragraph"><p>Loading the <span class="monospaced">Config</span> namespace will now load a whole variable set into
memory at once:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">load</span> <span class="s">&quot;Config.lsp&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">file</span> <span class="p">(</span><span class="k">open</span> <span class="ss">Config</span><span class="o">:</span><span class="ss">db-name</span> <span class="s">&quot;read&quot;</span><span class="p">))</span>
<span class="ss">...</span>
<span class="ss">...</span>
</pre></div></div></div>
<div class="paragraph"><p>In a similar fashion a whole data set can be saved:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">save</span> <span class="s">&quot;Config.lsp&quot;</span> <span class="o">&#39;</span><span class="ss">Config</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Read more about this in the section <a href="#serializing">Serializing
contexts</a>.</p></div>
</div>
<div class="sect3">
<h4 id="_loading_and_declaring_contexts">Loading and declaring contexts</h4>
<div class="paragraph"><p>Module files are loaded using the <a href="#load">load</a> function. If a
programming project contains numerous modules that refer to each other,
they should be pre-declared to avoid problems due to context forward
references that can occur before the loading of that context.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">;; pre-declaring contexts, finish with Main to return</span>
<span class="p">(</span><span class="k">map</span> <span class="k">context</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">Utilities</span> <span class="ss">Config</span> <span class="ss">Acquisition</span> <span class="ss">Analysis</span> <span class="ss">SysLog</span> <span class="k">MAIN</span><span class="p">))</span>

<span class="c1">;; loading context module files</span>
<span class="p">(</span><span class="k">load</span> <span class="s">&quot;Utilities.lsp&quot;</span> <span class="s">&quot;Acquisition.lsp&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">load</span> <span class="s">&quot;http://192.168.1.34/Config.lsp&quot;</span><span class="p">)</span> <span class="c1">; load module from remote location</span>
<span class="p">(</span><span class="k">load</span> <span class="s">&quot;Analysis.lsp&quot;</span> <span class="s">&quot;SysLog.lsp&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">run</span><span class="p">)</span>
    <span class="ss">...</span> <span class="p">)</span>

<span class="p">(</span><span class="nv">run</span><span class="p">)</span>

<span class="c1">;; end of file</span>
</pre></div></div></div>
<div class="paragraph"><p>When pre-declaring and loading modules as shown in the example, the
sequence of declaration or loading can be neglected. All forward
references to variables and definitions in modules not loaded yet will
be translated correctly.</p></div>
<div class="paragraph"><p>Modules not starting with a context switch are always loaded into <span class="monospaced">MAIN</span>
except when the <a href="#load">load</a> statement specifies a target context as
the last parameter. The <a href="#load">load</a> function can take <span class="monospaced">URL`s to
load modules from remote locations, via `HTTP</span>.</p></div>
<div class="paragraph"><p>The current context after the <a href="#load">load</a> statement will always be
the same as before the <a href="#load">load</a>.</p></div>
</div>
<div class="sect3">
<h4 id="_serializing_contexts">Serializing contexts</h4>
<div class="paragraph"><p>Serialization makes a software object <em>persistent</em> by converting it into
a character stream, which is then saved to a file or string in memory.
In newLISP, anything referenced by a symbol can be serialized to a file
by using the <a href="#save">save</a> function. Like other symbols, contexts are
saved just by using their names:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">save</span> <span class="s">&quot;mycontext.lsp&quot;</span> <span class="o">&#39;</span><span class="ss">MyCtx</span><span class="p">)</span>              <span class="c1">; save MyCtx to mycontext.lsp</span>

<span class="p">(</span><span class="k">load</span> <span class="s">&quot;mycontext.lsp&quot;</span><span class="p">)</span>                     <span class="c1">; loads MyCtx into memory</span>

<span class="p">(</span><span class="k">save</span> <span class="s">&quot;mycontexts.lsp&quot;</span> <span class="o">&#39;</span><span class="ss">Ctx1</span> <span class="o">&#39;</span><span class="ss">Ctx2</span> <span class="o">&#39;</span><span class="ss">Ctx3</span><span class="p">)</span>  <span class="c1">; save multiple contexts at once</span>
</pre></div></div></div>
<div class="paragraph"><p>For details, see the functions <a href="#save">save</a> (mentioned above) and
<a href="#source">source</a> (for serializing to a newLISP string).</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_17_the_context_default_functor">17. The context default functor</h3>
<div class="paragraph"><p>A <em>default functor</em> or <em>default function</em> is a symbol or user-defined
function or macro with the same name as its namespace. When the context
is used as the name of a function or in the functor position of an
s-expression, newLISP executes the default function.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">;; the default function</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">Foo</span><span class="o">:</span><span class="ss">Foo</span> <span class="ss">a</span> <span class="ss">b</span> <span class="ss">c</span><span class="p">)</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">a</span> <span class="ss">b</span> <span class="ss">c</span><span class="p">))</span>

<span class="p">(</span><span class="nv">Foo</span> <span class="ss">1</span> <span class="ss">2</span> <span class="ss">3</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">6</span>
</pre></div></div></div>
<div class="paragraph"><p>If a default function is called from a context other than <span class="monospaced">MAIN</span>, the
context must already exist or be declared with a <em>forward declaration</em>,
which creates the context and the function symbol:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">;; forward declaration of a default function</span>
<span class="p">(</span><span class="k">define</span> <span class="ss">Fubar</span><span class="o">:</span><span class="ss">Fubar</span><span class="p">)</span>

<span class="p">(</span><span class="k">context</span> <span class="o">&#39;</span><span class="ss">Foo</span><span class="p">)</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">Foo</span><span class="o">:</span><span class="ss">Foo</span> <span class="ss">a</span> <span class="ss">b</span> <span class="ss">c</span><span class="p">)</span>
    <span class="err">…</span>
    <span class="p">(</span><span class="nv">Fubar</span> <span class="ss">a</span> <span class="ss">b</span><span class="p">)</span>         <span class="c1">; forward reference</span>
    <span class="p">(</span><span class="err">…</span><span class="p">))</span>         <span class="c1">; to default function</span>

<span class="p">(</span><span class="k">context</span> <span class="k">MAIN</span><span class="p">)</span>

<span class="c1">;; definition of previously declared default function</span>

<span class="p">(</span><span class="k">context</span> <span class="o">&#39;</span><span class="ss">Fubar</span><span class="p">)</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">Fubar</span><span class="o">:</span><span class="ss">Fubar</span> <span class="ss">x</span> <span class="ss">y</span><span class="p">)</span>
    <span class="p">(</span><span class="err">…</span><span class="p">))</span>

<span class="p">(</span><span class="k">context</span> <span class="k">MAIN</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Default functions work like global functions, but they are lexically
separate from the context in which they are called.</p></div>
<div class="paragraph"><p>Like a lambda or lambda-macro function, default functions can be used
with <a href="#map">map</a> or <a href="#apply">apply</a>.</p></div>
<div class="sect3">
<h4 id="_functions_with_memory">Functions with memory</h4>
<div class="paragraph"><p>A default function can update the lexically isolated static variables
contained inside its namespace:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">;; a function with memory</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">Gen</span><span class="o">:</span><span class="ss">Gen</span> <span class="ss">x</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if</span> <span class="ss">Gen</span><span class="o">:</span><span class="ss">acc</span>
        <span class="p">(</span><span class="k">inc</span> <span class="ss">Gen</span><span class="o">:</span><span class="ss">acc</span> <span class="ss">x</span><span class="p">)</span>
        <span class="p">(</span><span class="k">setq</span> <span class="ss">Gen</span><span class="o">:</span><span class="ss">acc</span> <span class="ss">x</span><span class="p">)))</span>

<span class="p">(</span><span class="nv">Gen</span> <span class="ss">1</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">1</span>
<span class="p">(</span><span class="nv">Gen</span> <span class="ss">1</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">2</span>
<span class="p">(</span><span class="nv">Gen</span> <span class="ss">2</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">4</span>
<span class="p">(</span><span class="nv">Gen</span> <span class="ss">3</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">7</span>

<span class="ss">gen</span><span class="o">:</span><span class="ss">acc</span>  <span class="err">→</span> <span class="ss">7</span>
</pre></div></div></div>
<div class="paragraph"><p>The first time the <span class="monospaced">Gen</span> function is called, its accumulator is set to
the value of the argument. Each successive call increments <span class="monospaced">Gen</span>'s
accumulator by the argument&#8217;s value.</p></div>
<div class="paragraph"><p>The definition of <span class="monospaced">Gen:Gen</span> shows, how a function is put in its own
namespace without using the surrounding <span class="monospaced">(context 'Gen)</span> and
<span class="monospaced">(context MAIN)</span> statements. In that case only symbols qualified by the
namespace prefix will end up in the <span class="monospaced">Gen</span> context. In the above example
the variable <span class="monospaced">x</span> is still part of <span class="monospaced">MAIN</span>.</p></div>
</div>
<div class="sect3">
<h4 id="_hash_functions_and_dictionaries">Hash functions and dictionaries</h4>
<div class="paragraph"><p>There are several functions that can be used to place symbols into
namespace contexts. When using dictionaries as simple hash-like
collections of variable → value pairs, use the uninitialized
<a href="#default_function">default functor</a>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">define</span> <span class="ss">Myhash</span><span class="o">:</span><span class="ss">Myhash</span><span class="p">)</span> <span class="c1">; create namespace and default functor</span>

<span class="c1">; or as an alternative use</span>

<span class="p">(</span><span class="k">new</span> <span class="k">Tree</span> <span class="o">&#39;</span><span class="ss">MyHash</span><span class="p">)</span> <span class="c1">; create from built-in template</span>
</pre></div></div></div>
<div class="paragraph"><p>Either method can be used to make the <span class="monospaced">MyHash</span> dictionary space and
default functor. Creating key-value pairs and retrieving a value is
easy:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="nv">Myhash</span> <span class="s">&quot;var&quot;</span> <span class="ss">123</span><span class="p">)</span> <span class="c1">; create and set variable/value pair</span>

<span class="p">(</span><span class="nv">Myhash</span> <span class="s">&quot;var&quot;</span><span class="p">)</span> <span class="c1">; → 123 ; retrieve value</span>
</pre></div></div></div>
<div class="paragraph"><p>Note that the <em>default functor</em> should not be initialized to any value
other than <span class="monospaced">nil</span>. The default functor works like a dictionary hash
function creating the symbols in the string following it and setting it
to the value if specified.</p></div>
<div class="paragraph"><p>Symbol variables created this way can contain spaces or other characters
normally not allowed in newLISP symbol names:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">define</span> <span class="ss">Foo</span><span class="o">:</span><span class="ss">Foo</span><span class="p">)</span>

<span class="p">(</span><span class="nv">Foo</span> <span class="s">&quot;John Doe&quot;</span> <span class="ss">123</span><span class="p">)</span>         <span class="err">→</span> <span class="ss">123</span>
<span class="p">(</span><span class="nv">Foo</span> <span class="s">&quot;#1234&quot;</span> <span class="s">&quot;hello world&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;hello world&quot;</span>
<span class="p">(</span><span class="nv">Foo</span> <span class="s">&quot;var&quot;</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span> <span class="ss">d</span><span class="p">))</span>       <span class="err">→</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span> <span class="ss">d</span><span class="p">)</span>

<span class="p">(</span><span class="nv">Foo</span> <span class="s">&quot;John Doe&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">123</span>
<span class="p">(</span><span class="nv">Foo</span> <span class="s">&quot;#1234&quot;</span><span class="p">)</span>     <span class="err">→</span> <span class="s">&quot;hello world&quot;</span>
<span class="p">(</span><span class="nv">Foo</span> <span class="s">&quot;var&quot;</span><span class="p">)</span>     <span class="err">→</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span> <span class="ss">d</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>An entry which doesn&#8217;t exist will return <span class="monospaced">nil</span>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="nv">Foo</span> <span class="s">&quot;bar&quot;</span><span class="p">)</span>    <span class="err">→</span> <span class="k">nil</span>
</pre></div></div></div>
<div class="paragraph"><p>Setting an entry to <span class="monospaced">nil</span> will effectively delete it from the namespace.</p></div>
<div class="paragraph"><p>An association list can be generated from the contents of the namespace:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="nv">Foo</span><span class="p">)</span> <span class="err">→</span> <span class="p">((</span><span class="s">&quot;#1234&quot;</span> <span class="s">&quot;hello world&quot;</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;John Doe&quot;</span> <span class="ss">123</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;var&quot;</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span> <span class="ss">d</span><span class="p">)))</span>
</pre></div></div></div>
<div class="paragraph"><p>Entries in the dictionary can also be created from a list:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="nv">Foo</span> <span class="o">&#39;</span><span class="p">((</span><span class="s">&quot;#1234&quot;</span> <span class="s">&quot;hello world&quot;</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;John Doe&quot;</span> <span class="ss">123</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;var&quot;</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span> <span class="ss">d</span><span class="p">)))</span> <span class="err">→</span> <span class="ss">Foo</span>
</pre></div></div></div>
<div class="paragraph"><p>The list can also be used to iterate through the sorted key &#8594; value
pairs:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">dolist</span> <span class="p">(</span><span class="nv">item</span> <span class="p">(</span><span class="nv">Foo</span><span class="p">))</span> <span class="p">(</span><span class="k">println</span> <span class="p">(</span><span class="nv">item</span> <span class="ss">0</span><span class="p">)</span> <span class="s">&quot; -&gt; &quot;</span> <span class="p">(</span><span class="nv">item</span> <span class="ss">1</span><span class="p">)))</span>

<span class="c1">#1234 -&gt; hello world</span>
<span class="ss">John</span> <span class="ss">Doe</span> <span class="ss">-&gt;</span> <span class="ss">123</span>
<span class="ss">var</span> <span class="ss">-&gt;</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span> <span class="ss">d</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Like many built-in functions, hash expressions return a reference to
their content which can be modified directly:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">pop</span> <span class="p">(</span><span class="nv">Foo</span> <span class="s">&quot;var&quot;</span><span class="p">))</span> <span class="err">→</span> <span class="ss">a</span>

<span class="p">(</span><span class="nv">Foo</span> <span class="s">&quot;var&quot;</span><span class="p">)</span> <span class="err">→</span> <span class="p">(</span><span class="nv">b</span> <span class="ss">c</span> <span class="ss">d</span><span class="p">)</span>

<span class="p">(</span><span class="k">push</span> <span class="o">&#39;</span><span class="ss">z</span> <span class="p">(</span><span class="nv">Foo</span> <span class="s">&quot;var&quot;</span><span class="p">))</span> <span class="err">→</span> <span class="p">(</span><span class="nv">z</span> <span class="ss">b</span> <span class="ss">c</span> <span class="ss">d</span><span class="p">)</span>

<span class="p">(</span><span class="nv">Foo</span> <span class="s">&quot;var&quot;</span><span class="p">)</span> <span class="err">→</span> <span class="p">(</span><span class="nv">z</span> <span class="ss">b</span> <span class="ss">c</span> <span class="ss">d</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>When setting hash values, the anaphoric system variable <span class="monospaced">$it</span> can be used
to refer to the old value when setting the new:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="nv">Foo</span> <span class="s">&quot;bar&quot;</span> <span class="s">&quot;hello world&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="nv">Foo</span> <span class="s">&quot;bar&quot;</span> <span class="p">(</span><span class="k">upper-case</span> <span class="k">$</span><span class="ss">it</span><span class="p">))</span>

<span class="p">(</span><span class="nv">Foo</span> <span class="s">&quot;bar&quot;</span><span class="p">)</span> <span class="err">→</span> <span class="s">&quot;HELLO WORLD&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>Hash values also can be modified using <a href="#setf">setf</a>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="nv">Foo</span> <span class="s">&quot;bar&quot;</span> <span class="ss">123</span><span class="p">)</span>        <span class="err">→</span> <span class="ss">123</span>

<span class="p">(</span><span class="k">setf</span> <span class="p">(</span><span class="nv">Foo</span> <span class="s">&quot;bar&quot;</span><span class="p">)</span> <span class="ss">456</span><span class="p">)</span> <span class="err">→</span> <span class="ss">456</span>

<span class="p">(</span><span class="nv">Foo</span> <span class="s">&quot;bar&quot;</span><span class="p">)</span>            <span class="err">→</span> <span class="ss">456</span>
</pre></div></div></div>
<div class="paragraph"><p>But supplying the value as a second parameter to the hash functions is
shorter to write and faster.</p></div>
<div class="paragraph"><p>Dictionaries can easily be saved to a file and reloaded later:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">; save dictionary</span>
<span class="p">(</span><span class="k">save</span> <span class="s">&quot;Foo.lsp&quot;</span> <span class="o">&#39;</span><span class="ss">Foo</span><span class="p">)</span>

<span class="c1">; load dictionary</span>
<span class="p">(</span><span class="k">load</span> <span class="s">&quot;Foo.lsp&quot;</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Internally the key strings are created and stored as symbols in the hash
context. All key strings are prepended with an <span class="monospaced">_</span> underscore character.
This protects against overwriting the default symbol and symbols like
<span class="monospaced">set</span> and <span class="monospaced">sym</span>, which are needed when loading a hash namespace from
disk or over <span class="monospaced">HTTP</span>. Note the following difference:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="nv">Foo</span><span class="p">)</span> <span class="err">→</span> <span class="p">((</span><span class="s">&quot;#1234&quot;</span> <span class="s">&quot;hello world&quot;</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;John Doe&quot;</span> <span class="ss">123</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;var&quot;</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span> <span class="ss">d</span><span class="p">)))</span>

<span class="p">(</span><span class="k">symbols</span> <span class="ss">Foo</span><span class="p">)</span> <span class="err">→</span> <span class="p">(</span><span class="nv">Foo</span><span class="o">:</span><span class="ss">Foo</span> <span class="ss">Foo</span><span class="o">:</span><span class="ss">_</span><span class="c1">#1234 Foo:_John Doe Foo:_var)</span>
</pre></div></div></div>
<div class="paragraph"><p>In the first line hash symbols are shown as strings without without the
preceding underscore characters. The second line shows the internal form
of the symbols with prepended underscore characters.</p></div>
<div class="paragraph"><p>For a more detailed introduction to <em>namespaces</em>, see the chapter on
<a href="#contexts">Contexts</a>.</p></div>
</div>
<div class="sect3">
<h4 id="_passing_data_by_reference">Passing data by reference</h4>
<div class="paragraph"><p>A <a href="#default_function">default functor</a> can also be used to hold data.
If this data contains a list or string, the context name can be used as
a reference to the data:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">;; the default functor for holding data</span>

<span class="p">(</span><span class="k">define</span> <span class="ss">Mylist</span><span class="o">:</span><span class="ss">Mylist</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span> <span class="ss">d</span> <span class="ss">e</span> <span class="ss">f</span> <span class="ss">g</span><span class="p">))</span>

<span class="p">(</span><span class="nv">Mylist</span> <span class="ss">3</span><span class="p">)</span> <span class="err">→</span> <span class="ss">d</span>

<span class="p">(</span><span class="k">setf</span> <span class="p">(</span><span class="nv">Mylist</span> <span class="ss">3</span><span class="p">)</span> <span class="o">&#39;</span><span class="ss">D</span><span class="p">)</span> <span class="err">→</span> <span class="ss">D</span>

<span class="ss">Mylist</span><span class="o">:</span><span class="ss">Mylist</span> <span class="err">→</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span> <span class="ss">D</span> <span class="ss">e</span> <span class="ss">f</span> <span class="ss">g</span><span class="p">)</span>

<span class="c1">;; access list or string data from a default functor</span>

<span class="p">(</span><span class="k">first</span> <span class="ss">Mylist</span><span class="p">)</span> <span class="err">→</span> <span class="ss">a</span>

<span class="p">(</span><span class="k">reverse</span> <span class="ss">Mylist</span><span class="p">)</span> <span class="err">→</span> <span class="p">(</span><span class="nv">g</span> <span class="ss">f</span> <span class="ss">e</span> <span class="ss">D</span> <span class="ss">c</span> <span class="ss">b</span> <span class="ss">a</span><span class="p">)</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">Str</span><span class="o">:</span><span class="ss">Str</span> <span class="s">&quot;acdefghijklmnop&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">upper-case</span> <span class="ss">Str</span><span class="p">)</span> <span class="err">→</span> <span class="s">&quot;ACDEFGHIJKLMNOP&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>Most of the time, newLISP passes parameters by <em>value copy</em>. This poses
a potential problem when passing large lists or strings to user-defined
functions or macros. Strings and lists, which are packed in a namespace
using default functors, are passed automatically by reference:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">;; use a default functor to hold a list</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">Mydb</span><span class="o">:</span><span class="ss">Mydb</span> <span class="p">(</span><span class="k">sequence</span> <span class="ss">1</span> <span class="ss">100000</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">change-db</span> <span class="ss">obj</span> <span class="ss">idx</span> <span class="ss">value</span><span class="p">)</span>
    <span class="p">(</span><span class="k">setf</span> <span class="p">(</span><span class="nv">obj</span> <span class="ss">idx</span><span class="p">)</span> <span class="ss">value</span><span class="p">))</span>

<span class="c1">; pass by context reference</span>
<span class="p">(</span><span class="nv">change-db</span> <span class="ss">Mydb</span> <span class="ss">1234</span> <span class="s">&quot;abcdefg&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="nv">Mydb</span> <span class="ss">1234</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;abcdefg&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>Any argument of a built-in function calling for either a list or a
string&#8201;&#8212;&#8201;but no other data type&#8201;&#8212;&#8201;can receive data passed by reference.
Any user-defined function can take either normal variables, or can take
a context name for passing a reference to the default functor containing
a list or string.</p></div>
<div class="paragraph"><p>Note that on lists with less than about 100 elements or strings of less
than about 50000 characters, the speed difference between reference and
value passing is negligible. But on bigger data objects, differences in
both speed and memory usage between reference and value passing can be
significant.</p></div>
<div class="paragraph"><p>Built-in and user-defined functions are suitable for both types of
arguments, but when passing context names, data will be passed by
reference.</p></div>
<div class="paragraph"><p>Quoted symbols can also be used to pass data by reference, but this
method has disadvantages:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">change-list</span> <span class="ss">aList</span><span class="p">)</span> <span class="p">(</span><span class="k">push</span> <span class="ss">999</span> <span class="p">(</span><span class="k">eval</span> <span class="ss">aList</span><span class="p">)))</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">data</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">4</span> <span class="ss">5</span><span class="p">))</span>

<span class="c1">; note the quote &#39; in front of data</span>
<span class="p">(</span><span class="nv">change-list</span> <span class="o">&#39;</span><span class="ss">data</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">999</span> <span class="ss">1</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">4</span> <span class="ss">5</span><span class="p">)</span>

<span class="ss">data</span>  <span class="err">→</span>  <span class="p">(</span><span class="nv">999</span> <span class="ss">1</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">4</span> <span class="ss">5</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Although this method is simple to understand and use, it poses the
potential problem of <em>variable capture</em> when passing the same symbol as
used as a function parameter:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">;; pass data by symbol reference</span>

<span class="ss">&gt;</span> <span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">aList</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span> <span class="ss">d</span><span class="p">))</span>
<span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span> <span class="ss">d</span><span class="p">)</span>
<span class="ss">&gt;</span> <span class="p">(</span><span class="nv">change-list</span> <span class="o">&#39;</span><span class="ss">aList</span><span class="p">)</span>

<span class="ss">ERR</span><span class="o">:</span> <span class="k">list</span> <span class="k">or</span> <span class="k">string</span> <span class="ss">expected</span> <span class="o">:</span> <span class="p">(</span><span class="k">eval</span> <span class="ss">aList</span><span class="p">)</span>
<span class="ss">called</span> <span class="ss">from</span> <span class="ss">user</span> <span class="ss">defined</span> <span class="ss">function</span> <span class="ss">change-list</span>
<span class="ss">&gt;</span>
</pre></div></div></div>
<div class="paragraph"><p>At the beginning of the chapter it was shown how to package data in a
name-space using a default functor. Not only the default functor but any
symbol in context can be used to hold data. The disadvantage is that the
calling function must have knowledge about the symbol being used:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">;; pass data by context reference</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">Mydb</span><span class="o">:</span><span class="ss">data</span> <span class="p">(</span><span class="k">sequence</span> <span class="ss">1</span> <span class="ss">100000</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">change-db</span> <span class="ss">obj</span> <span class="ss">idx</span> <span class="ss">value</span><span class="p">)</span>
    <span class="p">(</span><span class="k">setf</span> <span class="p">(</span><span class="nv">obj</span><span class="o">:</span><span class="ss">data</span> <span class="ss">idx</span><span class="p">)</span> <span class="ss">value</span><span class="p">))</span>

<span class="p">(</span><span class="nv">change-db</span> <span class="ss">Mydb</span> <span class="ss">1234</span> <span class="s">&quot;abcdefg&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">nth</span> <span class="ss">1234</span> <span class="ss">Mydb</span><span class="o">:</span><span class="ss">data</span><span class="p">)</span>   <span class="err">→</span> <span class="s">&quot;abcdefg&quot;</span>
<span class="c1">; or</span>
<span class="p">(</span><span class="nv">Mydb</span><span class="o">:</span><span class="ss">data</span> <span class="ss">1234</span><span class="p">)</span>   <span class="err">→</span> <span class="s">&quot;abcdefg&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>The function receives the namespace in the variable <span class="monospaced">obj</span>, but it must
have the knowledge that the list to access is contained in the <span class="monospaced">data</span>
symbol of that namespace (context).</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_18_functional_object_oriented_programming">18. Functional object-oriented programming</h3>
<div class="paragraph"><p>Functional-object oriented programming (FOOP) is based on the following
five principles:</p></div>
<div class="ulist"><ul>
<li>
<p>
Class attributes and methods are stored in the namespace of the object
class.
</p>
</li>
<li>
<p>
The namespace default functor holds the object constructor method.
</p>
</li>
<li>
<p>
An object is constructed using a list, the first element of which is
the context symbol describing the class of the object.
</p>
</li>
<li>
<p>
Polymorphism is implemented using the <a href="#colon"><span class="monospaced">:</span> (colon)</a>
operator, which selects the appropriate class from the object.
</p>
</li>
<li>
<p>
A target object inside a class-method function is accessed via the
<a href="#self">self</a> function.
</p>
</li>
</ul></div>
<div class="paragraph"><p>The following paragraphs are a short introduction to FOOP as designed by
<em>Michael Michaels</em> from <a href="http://neglook.com">neglook.com</a>.</p></div>
<div class="sect3">
<h4 id="_foop_classes_and_constructors">FOOP classes and constructors</h4>
<div class="paragraph"><p>Class attributes and methods are stored in the namespace of the object
class. No object instance data is stored in this namespace/context. Data
variables in the class namespace only describe the class of objects as a
whole but don&#8217;t contain any object specific information. A generic FOOP
object constructor can be used as a template for specific object
constructors when creating new object classes with <span class="monospaced">new</span>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">; built-in generic FOOP object constructor</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="k">Class</span><span class="o">:</span><span class="k">Class</span><span class="p">)</span>
    <span class="p">(</span><span class="k">cons</span> <span class="p">(</span><span class="k">context</span><span class="p">)</span> <span class="p">(</span><span class="k">args</span><span class="p">)))</span>

<span class="c1">; create some new classes</span>

<span class="p">(</span><span class="k">new</span> <span class="k">Class</span> <span class="o">&#39;</span><span class="ss">Rectangle</span><span class="p">)</span>   <span class="err">→</span> <span class="ss">Rectangle</span>
<span class="p">(</span><span class="k">new</span> <span class="k">Class</span> <span class="o">&#39;</span><span class="ss">Circle</span><span class="p">)</span>      <span class="err">→</span> <span class="ss">Circle</span>

<span class="c1">; create some objects using the default constructor</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">rect</span> <span class="p">(</span><span class="nv">Rectangle</span> <span class="ss">10</span> <span class="ss">20</span><span class="p">))</span>   <span class="err">→</span> <span class="p">(</span><span class="nv">Rectangle</span> <span class="ss">10</span> <span class="ss">20</span><span class="p">)</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">circ</span> <span class="p">(</span><span class="nv">Circle</span> <span class="ss">10</span> <span class="ss">10</span> <span class="ss">20</span><span class="p">))</span>   <span class="err">→</span> <span class="p">(</span><span class="nv">Circle</span> <span class="ss">10</span> <span class="ss">10</span> <span class="ss">20</span><span class="p">)</span>

<span class="c1">; create a list of objects</span>
<span class="c1">; building the list using the list function instead of assigning</span>
<span class="c1">; a quoted list ensures that the object constructors are executed</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">shapes</span> <span class="p">(</span><span class="k">list</span> <span class="p">(</span><span class="nv">Circle</span> <span class="ss">5</span> <span class="ss">8</span> <span class="ss">12</span><span class="p">)</span> <span class="p">(</span><span class="nv">Rectangle</span> <span class="ss">4</span> <span class="ss">8</span><span class="p">)</span> <span class="p">(</span><span class="nv">Circle</span> <span class="ss">7</span> <span class="ss">7</span> <span class="ss">15</span><span class="p">)))</span>
<span class="err">→</span> <span class="p">((</span><span class="nv">Circle</span> <span class="ss">5</span> <span class="ss">8</span> <span class="ss">12</span><span class="p">)</span> <span class="p">(</span><span class="nv">Rectangle</span> <span class="ss">4</span> <span class="ss">8</span><span class="p">)</span> <span class="p">(</span><span class="nv">Circle</span> <span class="ss">7</span> <span class="ss">7</span> <span class="ss">15</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p>The generic FOOP constructor is already pre-defined, and FOOP code can
start with <span class="monospaced">(new Class ...)</span> statements right away.</p></div>
<div class="paragraph"><p>As a matter of style, new classes should only be created in the MAIN
context. If creating a new class while in a different namespace, the new
class name must be prefixed with MAIN and the statement should be on the
top-level:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">context</span> <span class="o">&#39;</span><span class="ss">Geometry</span><span class="p">)</span>

<span class="p">(</span><span class="k">new</span> <span class="k">Class</span> <span class="o">&#39;</span><span class="k">MAIN</span><span class="o">:</span><span class="ss">Rectangle</span><span class="p">)</span>
<span class="p">(</span><span class="k">new</span> <span class="k">Class</span> <span class="o">&#39;</span><span class="k">MAIN</span><span class="o">:</span><span class="ss">Circle</span><span class="p">)</span>

<span class="ss">...</span>
</pre></div></div></div>
<div class="paragraph"><p>Creating the namespace classes using <a href="#new">new</a> reserves the class
name as a context in newLISP and facilitates forward references. At the
same time, a simple constructor is defined for the new class for
instantiating new objects. As a convention, it is recommended to start
class names in upper-case to signal that the name stands for a
namespace.</p></div>
<div class="paragraph"><p>In some cases, it may be useful to overwrite the simple constructor,
that was created during class creation, with <span class="monospaced">new</span>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">; overwrite simple constructor</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">Circle</span><span class="o">:</span><span class="ss">Circle</span> <span class="ss">x</span> <span class="ss">y</span> <span class="ss">radius</span><span class="p">)</span>
    <span class="p">(</span><span class="k">list</span> <span class="ss">Circle</span> <span class="ss">x</span> <span class="ss">y</span> <span class="ss">radius</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p>A constructor can also specify defaults:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">; constructor with defaults</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">Circle</span><span class="o">:</span><span class="ss">Circle</span> <span class="p">(</span><span class="nv">x</span> <span class="ss">10</span><span class="p">)</span> <span class="p">(</span><span class="nv">y</span> <span class="ss">10</span><span class="p">)</span> <span class="p">(</span><span class="nv">radius</span> <span class="ss">3</span><span class="p">))</span>
    <span class="p">(</span><span class="k">list</span> <span class="ss">Circle</span> <span class="ss">x</span> <span class="ss">y</span> <span class="ss">radius</span><span class="p">))</span>

<span class="p">(</span><span class="nv">Circle</span><span class="p">)</span> <span class="err">→</span> <span class="p">(</span><span class="nv">Circle</span> <span class="ss">10</span> <span class="ss">10</span> <span class="ss">3</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>In many cases the constructor as created when using <span class="monospaced">new</span> is sufficient
and overwriting it is not necessary.</p></div>
</div>
<div class="sect3">
<h4 id="_objects_and_associations">Objects and associations</h4>
<div class="paragraph"><p>FOOP represents objects as lists. The first element of the list
indicates the object&#8217;s kind or class, while the remaining elements
contain the data. The following statements define two <em>objects</em> using
any of the constructors defined previously:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">myrect</span> <span class="p">(</span><span class="nv">Rectangle</span> <span class="ss">5</span> <span class="ss">5</span> <span class="ss">10</span> <span class="ss">20</span><span class="p">))</span> <span class="err">→</span> <span class="p">(</span><span class="nv">Rectangle</span> <span class="ss">5</span> <span class="ss">5</span> <span class="ss">10</span> <span class="ss">20</span><span class="p">)</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">mycircle</span> <span class="p">(</span><span class="nv">Circle</span> <span class="ss">1</span> <span class="ss">2</span> <span class="ss">10</span><span class="p">))</span> <span class="err">→</span> <span class="p">(</span><span class="nv">Circle</span> <span class="ss">1</span> <span class="ss">2</span> <span class="ss">10</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>An object created is identical to the function necessary to create it
(hence FOOP). Nested objects can be created in a similar manner:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">; create classes</span>
<span class="p">(</span><span class="k">new</span> <span class="k">Class</span> <span class="o">&#39;</span><span class="ss">Person</span><span class="p">)</span>
<span class="p">(</span><span class="k">new</span> <span class="k">Class</span> <span class="o">&#39;</span><span class="k">Address</span><span class="p">)</span>
<span class="p">(</span><span class="k">new</span> <span class="k">Class</span> <span class="o">&#39;</span><span class="ss">City</span><span class="p">)</span>
<span class="p">(</span><span class="k">new</span> <span class="k">Class</span> <span class="o">&#39;</span><span class="ss">Street</span><span class="p">)</span>

<span class="c1">; create an object containing other objects</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">JohnDoe</span> <span class="p">(</span><span class="nv">Person</span> <span class="p">(</span><span class="k">Address</span> <span class="p">(</span><span class="nv">City</span> <span class="s">&quot;Boston&quot;</span><span class="p">)</span> <span class="p">(</span><span class="nv">Street</span> <span class="ss">123</span> <span class="s">&quot;Main Street&quot;</span><span class="p">))))</span>
<span class="err">→</span> <span class="p">(</span><span class="nv">Person</span> <span class="p">(</span><span class="k">Address</span> <span class="p">(</span><span class="nv">City</span> <span class="s">&quot;Boston&quot;</span><span class="p">)</span> <span class="p">(</span><span class="nv">Street</span> <span class="ss">123</span> <span class="s">&quot;Main Street&quot;</span><span class="p">)))</span>
</pre></div></div></div>
<div class="paragraph"><p>Objects in FOOP not only resemble functions they also resemble
associations. The <a href="#assoc">assoc</a> function can be used to access
object data by name:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">assoc</span> <span class="k">Address</span> <span class="ss">JohnDoe</span><span class="p">)</span> <span class="err">→</span> <span class="p">(</span><span class="k">Address</span> <span class="p">(</span><span class="nv">City</span> <span class="s">&quot;Boston&quot;</span><span class="p">)</span> <span class="p">(</span><span class="nv">Street</span> <span class="ss">123</span> <span class="s">&quot;Main Street&quot;</span><span class="p">))</span>

<span class="p">(</span><span class="k">assoc</span> <span class="p">(</span><span class="k">list</span> <span class="k">Address</span> <span class="ss">Street</span><span class="p">)</span> <span class="ss">JohnDoe</span><span class="p">)</span> <span class="err">→</span> <span class="p">(</span><span class="nv">Street</span> <span class="ss">123</span> <span class="s">&quot;Main Street&quot;</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>In a similar manner <a href="#setf">setf</a> together with <a href="#assoc">assoc</a>
can be used to modify object data:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">setf</span> <span class="p">(</span><span class="k">assoc</span> <span class="p">(</span><span class="k">list</span> <span class="k">Address</span> <span class="ss">Street</span><span class="p">)</span> <span class="ss">JohnDoe</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">Street</span> <span class="ss">456</span> <span class="s">&quot;Main Street&quot;</span><span class="p">))</span>
<span class="err">→</span> <span class="p">(</span><span class="nv">Street</span> <span class="ss">456</span> <span class="s">&quot;Main Street&quot;</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The street number has been changed from <span class="monospaced">123</span> to <span class="monospaced">456</span>.</p></div>
<div class="paragraph"><p>Note that in none of the <span class="monospaced">assoc</span> statements <span class="monospaced">Address</span> and <span class="monospaced">Street</span> need
to carry quotes. The same is true in the set statement:
<span class="monospaced">(set 'JohnDoe (Person ...))</span> for the data part assigned. In both cases
we do not deal with symbols or lists of symbols but rather with contexts
and FOOP objects which evaluate to themselves. Quoting would not make a
difference.</p></div>
</div>
<div class="sect3">
<h4 id="_the_colon_span_class_monospaced_span_operator_and_polymorphism">The colon <span class="monospaced">:</span> operator and polymorphism</h4>
<div class="paragraph"><p>In newLISP, the colon character <span class="monospaced">:</span> is primarily used to connect the
context symbol with the symbol it is qualifying. Secondly, the colon
function is used in FOOP to resolve a function&#8217;s application
<em>polymorphously</em>.</p></div>
<div class="paragraph"><p>The following code defines two functions called <span class="monospaced">area</span>, each belonging
to a different namespace / class. Both functions could have been defined
in different modules for better separation, but in this case they are
defined in the same file and without bracketing <a href="#context">context</a>
statements. Here, only the symbols <span class="monospaced">rectangle:area</span> and <span class="monospaced">circle:area</span>
belong to different namespaces. The local parameters <span class="monospaced">p</span>, <span class="monospaced">c</span>, <span class="monospaced">dx</span>, and
<span class="monospaced">dy</span> are all part of <span class="monospaced">MAIN</span>, but this is of no concern.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">;; class methods for rectangles</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">Rectangle</span><span class="o">:</span><span class="ss">area</span><span class="p">)</span>
    <span class="p">(</span><span class="k">mul</span> <span class="p">(</span><span class="k">self</span> <span class="ss">3</span><span class="p">)</span> <span class="p">(</span><span class="k">self</span> <span class="ss">4</span><span class="p">)))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">Rectangle</span><span class="o">:</span><span class="ss">move</span> <span class="ss">dx</span> <span class="ss">dy</span><span class="p">)</span>
    <span class="p">(</span><span class="k">inc</span> <span class="p">(</span><span class="k">self</span> <span class="ss">1</span><span class="p">)</span> <span class="ss">dx</span><span class="p">)</span>
    <span class="p">(</span><span class="k">inc</span> <span class="p">(</span><span class="k">self</span> <span class="ss">2</span><span class="p">)</span> <span class="ss">dy</span><span class="p">))</span>

<span class="c1">;; class methods for circles</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">Circle</span><span class="o">:</span><span class="ss">area</span><span class="p">)</span>
    <span class="p">(</span><span class="k">mul</span> <span class="p">(</span><span class="k">pow</span> <span class="p">(</span><span class="k">self</span> <span class="ss">3</span><span class="p">)</span> <span class="ss">2</span><span class="p">)</span> <span class="p">(</span><span class="k">acos</span> <span class="ss">0</span><span class="p">)</span> <span class="ss">2</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">Circle</span><span class="o">:</span><span class="ss">move</span> <span class="ss">dx</span> <span class="ss">dy</span><span class="p">)</span>
    <span class="p">(</span><span class="k">inc</span> <span class="p">(</span><span class="k">self</span> <span class="ss">1</span><span class="p">)</span> <span class="ss">dx</span><span class="p">)</span>
    <span class="p">(</span><span class="k">inc</span> <span class="p">(</span><span class="k">self</span> <span class="ss">2</span><span class="p">)</span> <span class="ss">dy</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p>By prefixing the <span class="monospaced">area</span> or <span class="monospaced">move</span> symbol with the <a href="#colon"><span class="monospaced">:</span>
(colon)</a>, we can call these functions for each class of object. Although
there is no space between the colon and the symbol following it, newLISP
parses them as distinct entities. The colon works as a function that
processes parameters:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="o">:</span><span class="ss">area</span> <span class="ss">myrect</span><span class="p">)</span> <span class="err">→</span> <span class="ss">200</span> <span class="c1">; same as (: area myrect)</span>
<span class="p">(</span><span class="o">:</span><span class="ss">area</span> <span class="ss">mycircle</span><span class="p">)</span> <span class="err">→</span> <span class="ss">314.1592654</span> <span class="c1">; same as (: area mycircle)</span>

<span class="c1">;; map class methods uses curry to enclose the colon operator and class function</span>

<span class="p">(</span><span class="k">map</span> <span class="p">(</span><span class="k">curry</span> <span class="o">:</span><span class="ss">area</span><span class="p">)</span> <span class="p">(</span><span class="k">list</span> <span class="ss">myrect</span> <span class="ss">mycircle</span><span class="p">))</span> <span class="err">→</span> <span class="p">(</span><span class="nv">200</span> <span class="ss">314.1592654</span><span class="p">)</span>

<span class="p">(</span><span class="k">map</span> <span class="p">(</span><span class="k">curry</span> <span class="o">:</span><span class="ss">area</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">Rectangle</span> <span class="ss">5</span> <span class="ss">5</span> <span class="ss">10</span> <span class="ss">20</span><span class="p">)</span> <span class="p">(</span><span class="nv">Circle</span> <span class="ss">1</span> <span class="ss">2</span> <span class="ss">10</span><span class="p">)))</span> <span class="err">→</span> <span class="p">(</span><span class="nv">200</span> <span class="ss">314.1592654</span><span class="p">)</span>

<span class="c1">;; objects are mutable (since v10.1.8)</span>

<span class="p">(</span><span class="o">:</span><span class="ss">move</span> <span class="ss">myrect</span> <span class="ss">2</span> <span class="ss">3</span><span class="p">)</span>
<span class="p">(</span><span class="o">:</span><span class="ss">move</span> <span class="ss">mycircle</span> <span class="ss">4</span> <span class="ss">5</span><span class="p">)</span>

<span class="ss">myrect</span>    <span class="err">→</span> <span class="p">(</span><span class="nv">Rectangle</span> <span class="ss">7</span> <span class="ss">8</span> <span class="ss">10</span> <span class="ss">20</span><span class="p">)</span>
<span class="ss">mycircle</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">Circle</span> <span class="ss">5</span> <span class="ss">7</span> <span class="ss">10</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>In this example, the correct qualified symbol (<span class="monospaced">rectangle:area</span> or
<span class="monospaced">circle:area</span>) is constructed and applied to the object data based on
the symbol following the colon and the context name (the first element
of the object list).</p></div>
<div class="paragraph"><p>Note, that although the caller specifies the called target object of the
call, the method definition does not include the object as a parameter.
When writing functions to modify FOOP objects, instead the function
<a href="#self">self</a> is used to access and index the object.</p></div>
</div>
<div class="sect3">
<h4 id="_structuring_a_larger_foop_program">Structuring a larger FOOP program</h4>
<div class="paragraph"><p>In all the previous examples, class function methods where directly
written into the MAIN context namespace. This works and is adequate for
smaller programs written by just one programmer. When writing larger
systems, all the methods for one class should be surrounded by
<a href="#context">context</a> statements to provide better isolation of
parameter variables used and to create an isolated location for
potential class variables.</p></div>
<div class="paragraph"><p>Class variables could be used in this example as a container for lists
of objects, counters or other information specific to a class but not to
a specific object. The following code segment rewrites the example from
above in this fashion.</p></div>
<div class="paragraph"><p>Each context / namespace could go into an extra file with the same name
as the class contained. Class creation, startup code and the main
control code is in a file <span class="monospaced">MAIN.lsp</span>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">; file MAIN.lsp - declare all classes used in MAIN</span>

<span class="p">(</span><span class="k">new</span> <span class="k">Class</span> <span class="o">&#39;</span><span class="ss">Rectangle</span><span class="p">)</span>
<span class="p">(</span><span class="k">new</span> <span class="k">Class</span> <span class="o">&#39;</span><span class="ss">Circle</span><span class="p">)</span>

<span class="c1">; start up code</span>

<span class="p">(</span><span class="k">load</span> <span class="s">&quot;Rectangle.lsp&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">load</span> <span class="s">&quot;Circle.lsp&quot;</span><span class="p">)</span>

<span class="c1">; main control code</span>

<span class="c1">; end of file</span>
</pre></div></div></div>
<div class="paragraph"><p>Each class is in a separate file:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">; file Rectangle.lsp - class methods for rectangles</span>

<span class="p">(</span><span class="k">context</span> <span class="ss">Rectangle</span><span class="p">)</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">Rectangle</span><span class="o">:</span><span class="ss">area</span><span class="p">)</span>
<span class="p">(</span><span class="k">mul</span> <span class="p">(</span><span class="k">self</span> <span class="ss">3</span><span class="p">)</span> <span class="p">(</span><span class="k">self</span> <span class="ss">4</span><span class="p">)))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">Rectangle</span><span class="o">:</span><span class="ss">move</span> <span class="ss">dx</span> <span class="ss">dy</span><span class="p">)</span>
<span class="p">(</span><span class="k">inc</span> <span class="p">(</span><span class="k">self</span> <span class="ss">1</span><span class="p">)</span> <span class="ss">dx</span><span class="p">)</span>
<span class="p">(</span><span class="k">inc</span> <span class="p">(</span><span class="k">self</span> <span class="ss">2</span><span class="p">)</span> <span class="ss">dy</span><span class="p">))</span>

<span class="c1">; end of file</span>
</pre></div></div></div>
<div class="paragraph"><p>And the <span class="monospaced">Circle</span> class file follows:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">; file Circle.lsp - class methods for circles</span>

<span class="p">(</span><span class="k">context</span> <span class="ss">Circle</span><span class="p">)</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">Circle</span><span class="o">:</span><span class="ss">area</span><span class="p">)</span>
    <span class="p">(</span><span class="k">mul</span> <span class="p">(</span><span class="k">pow</span> <span class="p">(</span><span class="k">self</span> <span class="ss">3</span><span class="p">)</span> <span class="ss">2</span><span class="p">)</span> <span class="p">(</span><span class="k">acos</span> <span class="ss">0</span><span class="p">)</span> <span class="ss">2</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">Circle</span><span class="o">:</span><span class="ss">move</span> <span class="ss">dx</span> <span class="ss">dy</span><span class="p">)</span>
    <span class="p">(</span><span class="k">inc</span> <span class="p">(</span><span class="k">self</span> <span class="ss">1</span><span class="p">)</span> <span class="ss">dx</span><span class="p">)</span>
    <span class="p">(</span><span class="k">inc</span> <span class="p">(</span><span class="k">self</span> <span class="ss">2</span><span class="p">)</span> <span class="ss">dy</span><span class="p">))</span>

<span class="c1">; end of file</span>
</pre></div></div></div>
<div class="paragraph"><p>All sets of class functions are now lexically separated from each other.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_19_concurrent_processing_and_distributed_computing">19. Concurrent processing and distributed computing</h3>
<div class="paragraph"><p>newLISP has high-level APIs to control multiple processes on the same
CPU or distributed onto different computer nodes on a TCP/IP network.</p></div>
<div class="sect3">
<h4 id="_cilk_api">Cilk API</h4>
<div class="paragraph"><p>newLISP implements a <a href="http://supertech.csail.mit.edu/cilk/">Cilk</a>-like
API to launch and control concurrent processes. The API can take
advantage of multi-core computer architectures. Only three functions,
<a href="#spawn">spawn</a>, <a href="#sync">sync</a> and <a href="#abort">abort</a>, are
necessary to start multiple processes and collect the results in a
synchronized fashion. The underlying operating system distributes
processes onto different cores inside the CPU or executes them on the
same core in parallel if there are not enough cores present. Note that
newLISP only implements the API; optimized scheduling of spawned
procedures is not performed as in Cilk. Functions are started in the
order they appear in <span class="monospaced">spawn</span> statements and are distributed and
scheduled onto different cores in the CPU by the operating system.</p></div>
<div class="paragraph"><p>When multiple cores are present, this can increase overall processing
speed by evaluating functions in parallel. But even when running on
single core CPUs, the Cilk API makes concurrent processing much easier
for the programmer and may speed up processing if subtasks include
waiting for I/O or sleeping.</p></div>
<div class="paragraph"><p>Since version 10.1 <a href="#send">send</a> and <a href="#receive">receive</a> message
functions are available for communications between parent and child
processes. The functions can be used in blocking and non blocking
communications and can transfer any kind of newLISP data or expressions.
Transmitted expressions can be evaluated in the recipients environment.</p></div>
<div class="paragraph"><p>Internally, newLISP uses the lower level <a href="#fork">fork</a>,
<a href="#wait-pid">wait-pid</a>, <a href="#destroy">destroy</a>, and <a href="#share">share</a>
functionalities to control processes and synchronize the passing of
computed results via a shared memory interface.</p></div>
<div class="paragraph"><p>Only on Mac OS X and other Unixes will the Cilk API parallelize tasks.
On Win32, the API partly simulates the behavior on Unix but executes
tasks sequentially. This way, code can be written that runs on all
platforms.</p></div>
</div>
<div class="sect3">
<h4 id="_distributed_network_computing">Distributed network computing</h4>
<div class="paragraph"><p>With only one function, <a href="#net-eval">net-eval</a>, newLISP implements
distributed computing. Using <span class="monospaced">net-eval</span>, different tasks can be mapped
and evaluated on different nodes running on a TCP/IP network or local
domain Unix sockets network when running on the same computer.
<span class="monospaced">net-eval</span> does all the housekeeping required to connect to remote
nodes, transfer functions to execute, and collect the results.
<span class="monospaced">net-eval</span> can also use a call-back function to further structure
consolidation of incoming results from remote nodes.</p></div>
<div class="paragraph"><p>The functions <a href="#read-file">read-file</a>, <a href="#write-file">write-file</a>,
<a href="#append-file">append-file</a> and <a href="#delete-file">delete-file</a> all
can take URLs instead of path-file names. Server side newLISP running in
demon mode or an other HTTP server like Apache, receive standard HTTP
requests and translate them into the corresponding actions on files.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_20_xml_s_xml_and_xml_rpc">20. XML, S-XML, and XML-RPC</h3>
<div class="paragraph"><p>newLISP&#8217;s built-in support for XML-encoded data or documents comprises
three functions: <a href="#xml-parse">xml-parse</a>,
<a href="#xml-type-tags">xml-type-tags</a>, and <a href="#xml-error">xml-error</a>.</p></div>
<div class="paragraph"><p>Use the <a href="#xml-parse">xml-parse</a> function to parse XML-encoded
strings. When <span class="monospaced">xml-parse</span> encounters an error, <span class="monospaced">nil</span> is returned. To
diagnose syntax errors caused by incorrectly formatted XML, use the
function <a href="#xml-error">xml-error</a>. The
<a href="#xml-type-tags">xml-type-tags</a> function can be used to control or
suppress the appearance of XML type tags. These tags classify XML into
one of four categories: text, raw string data, comments, and element
data.</p></div>
<div class="listingblock">
<div class="title">XML source:</div>
<div class="content"><div class="highlight"><pre><span class="ss">&lt;?xml</span> <span class="ss">version=</span><span class="s">&quot;1.0&quot;</span><span class="ss">?&gt;</span>
<span class="k">&lt;</span><span class="ss">DATABASE</span> <span class="ss">name=</span><span class="s">&quot;example.xml&quot;</span><span class="ss">&gt;</span>
<span class="ss">&lt;!--This</span> <span class="ss">is</span> <span class="ss">a</span> <span class="ss">database</span> <span class="ss">of</span> <span class="ss">fruits--&gt;</span>
<span class="k">&lt;</span><span class="ss">FRUIT&gt;</span>
<span class="k">&lt;</span><span class="ss">NAME&gt;apple&lt;/NAME&gt;</span>
<span class="k">&lt;</span><span class="ss">COLOR&gt;red&lt;/COLOR&gt;</span>
<span class="k">&lt;</span><span class="ss">PRICE&gt;0.80&lt;/PRICE&gt;</span>
<span class="ss">&lt;/FRUIT&gt;</span>
<span class="ss">&lt;/DATABASE&gt;</span>
</pre></div></div></div>
<div class="listingblock">
<div class="title">Parsing without options:</div>
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">xml-parse</span> <span class="p">(</span><span class="k">read-</span><span class="ss">file</span> <span class="s">&quot;example.xml&quot;</span><span class="p">))</span>
<span class="err">→</span>  <span class="p">((</span><span class="s">&quot;ELEMENT&quot;</span> <span class="s">&quot;DATABASE&quot;</span> <span class="p">((</span><span class="s">&quot;name&quot;</span> <span class="s">&quot;example.xml&quot;</span><span class="p">))</span> <span class="p">((</span><span class="s">&quot;TEXT&quot;</span> <span class="s">&quot;\r\n&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="s">&quot;COMMENT&quot;</span> <span class="s">&quot;This is a database of fruits&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="s">&quot;TEXT&quot;</span> <span class="s">&quot;\r\n        &quot;</span><span class="p">)</span>
<span class="p">(</span><span class="s">&quot;ELEMENT&quot;</span> <span class="s">&quot;FRUIT&quot;</span> <span class="p">()</span> <span class="p">(</span>
    <span class="p">(</span><span class="s">&quot;TEXT&quot;</span> <span class="s">&quot;\r\n\t        &quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&quot;ELEMENT&quot;</span> <span class="s">&quot;NAME&quot;</span> <span class="p">()</span> <span class="p">((</span><span class="s">&quot;TEXT&quot;</span> <span class="s">&quot;apple&quot;</span><span class="p">)))</span>
    <span class="p">(</span><span class="s">&quot;TEXT&quot;</span> <span class="s">&quot;\r\n\t\t&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&quot;ELEMENT&quot;</span> <span class="s">&quot;COLOR&quot;</span> <span class="p">()</span> <span class="p">((</span><span class="s">&quot;TEXT&quot;</span> <span class="s">&quot;red&quot;</span><span class="p">)))</span>
    <span class="p">(</span><span class="s">&quot;TEXT&quot;</span> <span class="s">&quot;\r\n\t\t&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&quot;ELEMENT&quot;</span> <span class="s">&quot;PRICE&quot;</span> <span class="p">()</span> <span class="p">((</span><span class="s">&quot;TEXT&quot;</span> <span class="s">&quot;0.80&quot;</span><span class="p">)))</span>
    <span class="p">(</span><span class="s">&quot;TEXT&quot;</span> <span class="s">&quot;\r\n\t&quot;</span><span class="p">)))</span>
<span class="p">(</span><span class="s">&quot;TEXT&quot;</span> <span class="s">&quot;\r\n&quot;</span><span class="p">))))</span>
</pre></div></div></div>
<div class="paragraph"><p>S-XML can be generated directly from XML using
<a href="#xml-type-tags">xml-type-tags</a> and the special option parameters of
the <a href="#xml-parse">xml-parse</a> function:</p></div>
<div class="listingblock">
<div class="title">S-XML generation using all options:</div>
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">xml-type-tags</span> <span class="k">nil</span> <span class="k">nil</span> <span class="k">nil</span> <span class="k">nil</span><span class="p">)</span>
<span class="p">(</span><span class="k">xml-parse</span> <span class="p">(</span><span class="k">read-</span><span class="ss">file</span> <span class="s">&quot;example.xml&quot;</span><span class="p">)</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">1</span> <span class="ss">2</span> <span class="ss">4</span> <span class="ss">8</span> <span class="ss">16</span><span class="p">))</span>
<span class="err">→</span>  <span class="p">((</span><span class="nv">DATABASE</span> <span class="p">(</span><span class="nv">@</span> <span class="p">(</span><span class="nv">name</span> <span class="s">&quot;example.xml&quot;</span><span class="p">))</span>
  <span class="p">(</span><span class="nv">FRUIT</span> <span class="p">(</span><span class="nv">NAME</span> <span class="s">&quot;apple&quot;</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">COLOR</span> <span class="s">&quot;red&quot;</span><span class="p">)</span>
      <span class="p">(</span><span class="nv">PRICE</span> <span class="s">&quot;0.80&quot;</span><span class="p">))))</span>
</pre></div></div></div>
<div class="paragraph"><p>S-XML is XML reformatted as newLISP <em>S-expressions</em>. The <span class="monospaced">@</span> (at symbol)
denotes an XML attribute specification.</p></div>
<div class="paragraph"><p>See <a href="#xml-parse">xml-parse</a> in the reference section of the manual
for details on parsing and option numbers, as well as for a longer
example.</p></div>
<div class="sect3">
<h4 id="_xml_rpc">XML-RPC</h4>
<div class="paragraph"><p>The remote procedure calling protocol XML-RPC uses HTTP post requests as
a transport and XML for the encoding of method names, parameters, and
parameter types. XML-RPC client libraries and servers have been
implemented for most popular compiled and scripting languages.</p></div>
<div class="paragraph"><p>For more information about XML, visit
<a href="http://www.xmlrpc.com/">www.xmlrpc.com</a>.</p></div>
<div class="paragraph"><p>XML-RPC clients and servers are easy to write using newLISP&#8217;s built-in
network and XML support. A stateless XML-RPC server implemented as a CGI
service can be found in the file <span class="monospaced">examples/xmlrpc.cgi</span>. This script can
be used together with a web server, like Apache. This XML-RPC service
script implements the following methods:</p></div>
<table class="tableblock frame-all grid-all"
style="
width:60%;
">
<col style="width:33%;">
<col style="width:66%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" >method </th>
<th class="tableblock halign-left valign-top" >description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">system.listMethods</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Returns a list of all method names</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">system.methodHelp</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Returns help for a specific method</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">system.methodSignature</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Returns a list of return/calling signatures
for a specific method</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">newLISP.evalString</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Evaluates a Base64 newLISP expression string</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>The first three methods are <em>discovery</em> methods implemented by most
XML-RPC servers. The last one is specific to the newLISP XML-RPC server
script and implements remote evaluation of a Base64-encoded string of
newLISP source code. newLISP&#8217;s <a href="#base64-enc">base64-enc</a> and
<a href="#base64-dec">base64-dec</a> functions can be used to encode and decode
Base64-encoded information.</p></div>
<div class="paragraph"><p>In the <span class="monospaced">modules</span> directory of the source distribution, the file
<span class="monospaced">xmlrpc-client.lsp</span> implements a specific client interface for all of
the above methods.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">load</span> <span class="s">&quot;xmlrpc-client.lsp&quot;</span><span class="p">)</span>  <span class="c1">; load XML-RPC client routines</span>

<span class="p">(</span><span class="nv">XMLRPC</span><span class="o">:</span><span class="ss">newLISP.evalString</span>
<span class="s">&quot;http://localhost:8080/xmlrpc.cgi&quot;</span>
<span class="s">&quot;(+ 3 4)&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;7&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>In a similar fashion, standard <span class="monospaced">system.xxx</span> calls can be issued.</p></div>
<div class="paragraph"><p>All functions return either a result if successful, or <span class="monospaced">nil</span> if a
request fails. In case of failure, the expression <span class="monospaced">(XMLRPC:error)</span> can
be evaluated to return an error message.</p></div>
<div class="paragraph"><p>For more information, please consult the header of the file
<span class="monospaced">modules/xmlrpc-client.lsp</span>.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_21_customization_localization_and_utf_8">21. Customization, localization, and UTF-8</h3>
<div class="sect3">
<h4 id="_customizing_function_names">Customizing function names</h4>
<div class="paragraph"><p>All built-in primitives in newLISP can be easily renamed:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">constant</span> <span class="o">&#39;</span><span class="ss">plus</span> <span class="ss">+</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Now, <span class="monospaced">plus</span> is functionally equivalent to <span class="monospaced">+</span> and runs at the same
speed.</p></div>
<div class="paragraph"><p>The <a href="#constant">constant</a> function, rather than the <span class="monospaced">set</span> function,
must be used to rename built-in primitive symbols. By default, all
built-in function symbols are protected against accidental overwriting.</p></div>
<div class="paragraph"><p>It is possible to redefine all integer arithmetic operators to their
floating point equivalents:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">constant</span> <span class="o">&#39;</span><span class="ss">+</span> <span class="k">add</span><span class="p">)</span>
<span class="p">(</span><span class="k">constant</span> <span class="o">&#39;</span><span class="ss">-</span> <span class="k">sub</span><span class="p">)</span>
<span class="p">(</span><span class="k">constant</span> <span class="o">&#39;</span><span class="ss">*</span> <span class="k">mul</span><span class="p">)</span>
<span class="p">(</span><span class="k">constant</span> <span class="o">&#39;</span><span class="ss">/</span> <span class="k">div</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>All operations using <span class="monospaced">+</span>, <span class="monospaced">-</span>, <span class="monospaced">*</span>, and <span class="monospaced">/</span> are now performed as
floating point operations.</p></div>
<div class="paragraph"><p>Using the same mechanism, the names of built-in functions can be
translated into languages other than English:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">constant</span> <span class="o">&#39;</span><span class="ss">wurzel</span> <span class="k">sqrt</span><span class="p">)</span>    <span class="c1">; German for &#39;square-root&#39;</span>

<span class="c1">; make the new symbol global at the same time</span>
<span class="p">(</span><span class="k">constant</span> <span class="p">(</span><span class="k">global</span> <span class="o">&#39;</span><span class="ss">imprime</span><span class="p">)</span> <span class="k">print</span><span class="p">)</span>  <span class="c1">; Spanish for &#39;print&#39;</span>
<span class="err">…</span>
</pre></div></div></div>
<div class="paragraph"><p>The new symbol can be made global at the same time using
<a href="#global">global</a>.</p></div>
</div>
<div class="sect3">
<h4 id="_switching_the_locale">Switching the locale</h4>
<div class="paragraph"><p>newLISP can switch locales based on the platform and operating system.
On startup, non-UTF-8 enabled newLISP attempts to set the ISO C standard
default POSIX locale, available for most platforms and locales. On UTF-8
enabled newLISP the default locale for the platform is set. The
<a href="#set-locale">set-locale</a> function can also be used to switch to the
default locale:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set-locale</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>This switches to the default locale used on your platform/operating
system and ensures character handling (e.g.,
<a href="#upper-case">upper-case</a>) works correctly.</p></div>
<div class="paragraph"><p>Many Unix systems have a variety of locales available. To find out which
ones are available on a particular Linux/Unix/BSD system, execute the
following command in a system shell:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>locale -a</pre>
</div></div>
<div class="paragraph"><p>This command prints a list of all the locales available on your system.
Any of these may be used as arguments to <a href="#set-locale">set-locale</a>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set-locale</span> <span class="s">&quot;es_US&quot;</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>This would switch to a U.S. Spanish locale. Accents or other characters
used in a U.S. Spanish environment would be correctly converted.</p></div>
<div class="paragraph"><p>See the manual description for more details on the usage of
<a href="#set-locale">set-locale</a>.</p></div>
</div>
<div class="sect3">
<h4 id="_decimal_point_and_decimal_comma">Decimal point and decimal comma</h4>
<div class="paragraph"><p>Many countries use a comma instead of a period as a decimal separator in
numbers. newLISP correctly parses numbers depending on the locale set:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">; switch to German locale on a Linux system</span>
<span class="p">(</span><span class="k">set-locale</span> <span class="s">&quot;de_DE&quot;</span><span class="p">)</span> <span class="err">→</span> <span class="p">(</span><span class="s">&quot;de_DE&quot;</span> <span class="s">&quot;,&quot;</span><span class="p">)</span>

<span class="c1">; newLISP source and output use a decimal comma</span>
<span class="p">(</span><span class="k">div</span> <span class="ss">1,2</span> <span class="ss">3</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">0,4</span>
</pre></div></div></div>
<div class="paragraph"><p>The default POSIX C locale, which is set when newLISP starts up, uses a
period as a decimal separator.</p></div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph"><p>The following countries use a <strong>period as a decimal separator</strong>:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>Australia, Botswana, Canada (English-speaking), China, Costa Rica,
Dominican Republic, El Salvador, Guatemala, Honduras, Hong Kong, India,
Ireland, Israel, Japan, Korea (both North and South), Malaysia, Mexico,
Nicaragua, New Zealand, Panama, Philippines, Puerto Rico, Saudi Arabia,
Singapore, Switzerland, Thailand, United Kingdom, and United States.</pre>
</div></div>
<div class="paragraph"><p>The following countries use a <strong>comma as a decimal separator</strong>:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>Albania, Andorra, Argentina, Austria, Belarus, Belgium, Bolivia, Brazil,
Bulgaria, Canada (French-speaking), Croatia, Cuba, Chile, Colombia,
Czech Republic, Denmark, Ecuador, Estonia, Faroes, Finland, France,
Germany, Greece, Greenland, Hungary, Indonesia, Iceland, Italy, Latvia,
Lithuania, Luxembourg, Macedonia, Moldova, Netherlands, Norway,
Paraguay, Peru, Poland, Portugal, Romania, Russia, Serbia, Slovakia,
Slovenia, Spain, South Africa, Sweden, Ukraine, Uruguay, Venezuela, and
Zimbabwe.</pre>
</div></div>
</div></div>
</div>
<div class="sect3">
<h4 id="_unicode_and_utf_8_encoding">Unicode and UTF-8 encoding</h4>
<div class="paragraph"><p>Note that for many European languages, the <a href="#set-locale">set-locale</a>
mechanism is sufficient to display non-ASCII character sets, as long as
each character is presented as <em>one</em> byte internally. UTF-8 encoding is
only necessary for multi-byte character sets as described in this
chapter.</p></div>
<div class="paragraph"><p>newLISP can be compiled as a UTF-8–enabled application. UTF-8 is a
multi-byte encoding of the international Unicode character set. A
UTF-8–enabled newLISP running on an operating system with UTF-8 enabled
can handle any character of the installed locale.</p></div>
<div class="olist arabic"><div class="title">The following steps make UTF-8 work with newLISP on a specific operating system and platform:</div><ol class="arabic">
<li>
<p>
Use one of the makefiles ending in <span class="monospaced">utf8</span> to compile newLISP as a
   UTF-8 application. If no UTF-8 makefile is available for your
   platform, the normal makefile for your operating system contains
   instructions on how to change it for UTF-8.
</p>
<div class="paragraph"><p>The Mac OS X binary installer contains a UTF-8–enabled version by
default.</p></div>
</li>
<li>
<p>
Enable the UTF-8 locale on your operating system. Check and set a
   UTF-8 locale on Unix and Unix-like OSes by using the <span class="monospaced">locale</span> command
   or the <span class="monospaced">set-locale</span> function within newLISP. On Linux, the locale can
   be changed by setting the appropriate environment variable. The
   following example uses <span class="monospaced">bash</span> to set the U.S. locale:
</p>
<div class="listingblock">
<div class="content monospaced">
<pre>export LC_CTYPE=en_US.UTF-8</pre>
</div></div>
</li>
<li>
<p>
The UTF-8–enabled newLISP automatically switches to the locale found
   on the operating system. Make sure the command shell is
   UTF-8–enabled. When using the Tcl/Tk front-end on Linux/Unix, Tcl/Tk
   will automatically switch to UTF-8 display as long as the Unix
   environment variable is set correctly. The U.S. version of WinXP&#8217;s
   <span class="monospaced">notepad.exe</span> can display Unicode UTF-8–encoded characters, but the
   command shell and the Tcl/Tk front-end cannot. On Linux and other
   Unixes, the Xterm shell can be used when started as follows:
</p>
<div class="listingblock">
<div class="content monospaced">
<pre>LC_CTYPE=en_US.UTF-8 xterm</pre>
</div></div>
</li>
</ol></div>
<div class="listingblock">
<div class="title">The following procedure can now be used to check for UTF-8 support.  After starting newLISP, type:</div>
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">println</span> <span class="p">(</span><span class="k">char</span> <span class="ss">937</span><span class="p">))</span>               <span class="c1">; displays Greek uppercase omega</span>
<span class="p">(</span><span class="k">println</span> <span class="p">(</span><span class="k">lower-case</span> <span class="p">(</span><span class="k">char</span> <span class="ss">937</span><span class="p">)))</span>  <span class="c1">; displays lowercase omega</span>
</pre></div></div></div>
<div class="paragraph"><p>While the uppercase omega (Ω) looks like a big O on two tiny legs, the
lowercase omega (ω) has a shape similar to a small <span class="monospaced">w</span> in the Latin
alphabet.</p></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img alt="Note" src="data:image/png;base64,
iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAJXElEQVRo3u2ZW4xcZ5HHf1Xf951z
uudqD2PPxRPs2AnGTlg7K0jihDiBJIzA4g5P8IDywOUBgUBaZK3EC/JK2dU+IMFmxQMrJavdDCgo
SOQCwUYBh4ADCIOdYM84YYjHl/Gt7UnPTE+fr/bhnG57nAXHyQSC5E8qzZxudc/3r/pX1b9qxMz4
ez7K3/m5AuAKgL8lgLGxMRsdHbW+vj7r6+uz0dFRGxsb+6tWBXm1VWj79u02/sB9bN92J5XpY+Rn
TnFqdoavT9ZY94nPsGPHDnnDRmBsbMzGH7iPHe96B+nk88wfeI54ZIrlMzN8bVXK+AP38eCDD9ob
NgKjo6N27+oOKrVTzP9+LxocziviFeeF02kn/+zW8OijjxZ/RETeUBHYs2cPPVlG8w/7CNVAqARC
FkiyQMgSBkdWsWfPHmKMAFh5Xg8A/rLCJWIiQqVSIT82SagG1CvqFBcU9UUkdHiYubmn8f5lX28i
gojgnFv0RpIkpGna/kyz2aTRaHDu3DlZSgCcOfZbPvCRezg5fZwVWSguHAoQ6h2udxk1Ejo7K/zs
h99i2bJuujorZFmKqtJmk1wIIBZkEEVEy6jBqmvuxszsL1HwsgB472mc3ccH77qKf/3WTv5tQw++
mqAl9/3QavL+q/nPXXs5WzvLzPEn8fMZ2lUhZgHnpARwEXPFgSaIZoiEAgBGmqbEGF8WrVedA0V4
lffeeT2dt27ky/trTDcDumIQ9w9bOd0xzFfGnmBmfB/RIo2FnBghj5FWCkQTDIdpdt4kgKQgCWgC
LkM0bQNYMgqFEIg41Kd87lPv4pPPHOKepycZ3/U88AtuGuhlW7XJ2r7AU9lKZl5q0N2VEU3Jo+Lw
gBQet/MXE00QDYVJAqKYRNI0Jc9zQghLE4FKpYKqw/uENMv4wqfv4re1Ov+zoYtfvX053xhR1mbC
tl8fZ+uWtbw0mzM3ZzQXhIiC+NICoh1tgwASyggEEI8Q8N4vbQTSNEXF43yC88Z1bxlhx/YP8U/f
eYr9vz6MGTTzyB1b1tFZzZhvROYWjHMvLRDSBKfgvOLEYeSLIgCuBOfKhDacc1yq+l42hdR7RAPq
IiHNeOu1q/jSZ+9m5twMj+zcz4GJ43R1ZQTvUfUYiqljds5QB5koooq7uMS2L1/SDOOV9L/LAuCc
Q8QjmhC8kKQLVCoVurvmUTHu3rqet20Yptk0li3vIkkCgsNrwIeAmbCQQxSo+D/D6FaVski8IPmX
DADicK6gUPCBjmpGnldwKlQrGStXLKfZjIgolWrRnAyl2RScKkkaLuoBgOsBrWDSBTYHoiBckv+X
DSDGCCaAEHxCkgbyPMWsShocC80m0UBR1DmS4HGqpFmGiKLOE6MS1AN5cfFFp1FcHsHQpQdQr9dR
VVQE54TEJ1iaguWkwZPnOSCIFpcIwZMkgTRNgLJbO4cLKaYJSPUCkZGXzM8Q8jaFlj4CIqhz5FEI
icNiwElKjIE8RlQVp44YDVSLvFFH8J7TtTpTR09zw+bNWNFuOXjoMKfOzPCPmzaSuBQRxTDAXhGA
y+oDqopoUS1c8DhN+Pkz40RTfv/cESYm5+jsGaTaPcCv9p3gP/7rp+zd/yLOJxw+epbdeyZ5fNez
HPrjMUQTvv3fP+LFw6fo7e7m2w88gmhx9aLRXbqEXjaA7q4qoh71Kd4HVD0nT9d5+NHf8NK8o3a2
zk9/vo8jx04zfaLGlz//cQ5N1jkyLczMpSRplZtu3MTVa0YwYPrkGW6/7QbWv2UNQwN9mChC0QdM
3dJH4GXa2IwV/T08e/AYd91+A+/euomDE4f55TN/4J03X4+I8OH338zjT+zm+reuYsP6NW1hZnh6
e3r4l3//Xx586Eluu+XGopm9nvPA/3dWruilt7ez/byst4uJF6bYcuOGNsg8Lz1pCzTmZwF45LEn
2fy2tdyw6VqeO/AnFprzQOfrB6Ber7+MkOqrDKwcYmHhF+cB9ffSt7yb7/3gKa65ephnD/yJD7zv
9lLNOmbn5gE4N1NnzeohnHNsWL+aY9PnWi25tLi0AGq1GlddNYBIwLmEPM9R16BvWZUvfnYb6grF
uPXWzYDwzps3cfxEjdtu2UyWJYgoK1f0sXzqFCLKRz94N4//+Gl+s/cQMc+57rprGRocBBUQg+iW
FsDU1BRvWtZTdtGAc44oxTTV1dWJxVnMiioi4kjSDlYN9RdTVtkXsqzCrTdtApQQYNvoLS01V5pg
SKE1yMnz/JJ66BUDGB8fZ2iwvwAgvtTzOeCK0opg0QozKSQBgqpiOEQcqF2geRZ7WPAIWjigGJ6X
VsxNTEzQ399TzKztZlO0fIvFc7RIbtCqfqpSRAAFWiXSl2LNFitR1cIZUipR4y8OMpddRl944Xmu
GhkqQoyAcf53UcyUGB15VPJcCovFa2ZalsjCwyDF4NIyKb+nbJSiBaAkSZYGwM6dO23Xrp9wxx13
Fl43w1pS1ygjUihVMy1N2k62lm4o+W6imMW2FTR0SCkUBSlF4xIl8dTUFB/70B1UKykL9ZOYWJln
0m4+xb4nomrlpQoKiRTvtXS+mIIqqpWLhBaggpiVjim00GsaKVs7mb179/K+94yWnAeLBtEwYtuz
IkXC+lIzAWj52vlktKJEGkQWFlNBBMwRpQBgllOv11/7QGNmdv/99/PVr9xDY/YEZpGjR6fJmw1+
t+8A0ydO87v9E1iMdHV20NPTwdrVg1y3YR0iMDzUX0Shve2JCBGJzcUBUI/aAmbGi0eOsn/fBLVa
bUkAFFOV5Xz34SewPOexH+1maNVaurs66ehezpprljEwMMDs7Cxnz9WYnDYe++b3mTlznGo1o7O7
g5GhAa5dN8L1G69hYKAfs/ND/dSRUxydPsn4xCR/nDzC5ORRjk6f4t57721H81Vtp83MYowMDw/T
bDYREbZs2cLo6CgDAwN0dnYiIsXGrtFAVQkhkOc58/PzqCr1ep3du3fT0dHBwYMHeeihh1BVVq9+
8wWjqmdwcJD169ezbt06Nm7cSH9/P1mWMTIyQqVSkVe9Xm82m9ZsNpmdnWVubo5Go0GMsc3rVqK1
nluc997jnGv/bOWImTE3N7do8WtmNJvN9hDvnCNJEpIkoVKp4L1/7btRVW17uDXge+9pbZtb1gr5
hc8X7za994uoISLEGNvSoWVJkrw2Cl35L+UVAFcAXAFwBcClzv8B3eu58OmgDQoAAAAASUVORK5C
YII=">
</td>
<td class="content">Only the output of <span class="monospaced">println</span> will be displayed as a character;
<span class="monospaced">println</span>'s return value will appear on the console as a multi-byte
ASCII character.</td>
</tr></table>
</div>
<div class="paragraph"><p>When UTF-8–enabled newLISP is used on a non-UTF-8–enabled display, both
the output and the return value will be two characters. These are the
two bytes necessary to encode the omega character.</p></div>
<div class="paragraph"><p><a id="utf8_capable"></a></p></div>
</div>
<div class="sect3">
<h4 id="_functions_working_on_utf_8_characters">Functions working on UTF-8 characters</h4>
<div class="paragraph"><p>When UTF-8–enabled newLISP is used, the following string functions work
on one- or multi-byte characters rather than one 8-bit byte boundaries:</p></div>
<table class="tableblock frame-all grid-all"
style="
width:60%;
">
<col style="width:33%;">
<col style="width:66%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" >function </th>
<th class="tableblock halign-left valign-top" >description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#char">char</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">translates between characters and ASCII/Unicode</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#chop">chop</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">chops characters from the end of a string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#date">date</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">converts date number to string (when used with the
third argument)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#dostring">dostring</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">evaluates once for each character in a string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#explode">explode</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">transforms a string into a list of characters</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#first">first</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">gets first element in a list (car, head) or string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#last">last</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">returns the last element of a list or string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#lower-case">lower-case</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">converts a string to lowercase characters</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#nth">nth</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">gets the <em>nth</em> element of a list or string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#pop">pop</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">deletes an element from a list or string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#push">push</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">inserts a new element in a list or string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#rest">rest</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">gets all but the first element of a list (cdr, tail)
or string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#select">select</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">selects and permutes elements from a list or
string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#title-case">title-case</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">converts the first character of a string
to uppercase</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#trim">trim</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">trims a string from both sides</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#upper-case">upper-case</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">converts a string to uppercase characters</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>All other string functions work on 8-bit bytes. When positions are
returned, as in <a href="#find">find</a> or <a href="#regex">regex</a>, they are single
8-bit byte positions rather than character positions which may be
multi-byte. The <a href="#get-char">get-char</a> and <a href="#slice">slice</a>
functions do not take multi-byte character offsets, but single-byte
offsets, even in UTF-8 enabled versions of newLISP. The
<a href="#reverse">reverse</a> function reverses a byte vector, not a character
vector. The last three functions can still be used to manipulate binary
non-textual data in the UTF-8–enabled version of newLISP.</p></div>
<div class="paragraph"><p>To enable UTF-8 in Perl Compatible Regular Expressions (PCRE)&#8201;&#8212;&#8201;used by
<a href="#directory">directory</a>, <a href="#find">find</a>, <a href="#member">member</a>,
<a href="#parse">parse</a>, <a href="#regex">regex</a>, <a href="#regex-comp">regex-comp</a> and
<a href="#replace">replace</a>&#8201;&#8212;&#8201;set the option number accordingly (2048). Note
that offset and lengths in <a href="#regex">regex</a> results are always in
single byte counts. See the <a href="#regex">regex</a> documentation for
details.</p></div>
<div class="paragraph"><p>Use <a href="#explode">explode</a> to obtain an array of UTF-8 characters and to
manipulate characters rather than bytes when a UTF-8–enabled function is
unavailable:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">join</span> <span class="p">(</span><span class="k">reverse</span> <span class="p">(</span><span class="k">explode</span> <span class="ss">str</span><span class="p">)))</span>  <span class="c1">; reverse UTF-8 characters</span>
</pre></div></div></div>
<div class="paragraph"><p>The above string functions (often used to manipulate non-textual binary
data) now work on character, rather than byte, boundaries, so care must
be exercised when using the UTF-8–enabled version. The size of the first
127 ASCII characters&#8201;&#8212;&#8201;along with the characters in popular code pages
such as ISO 8859&#8201;&#8212;&#8201;is one byte long. When working exclusively within
these code pages, UTF-8–enabled newLISP is not required. The
<a href="#set-locale">set-locale</a> function alone is sufficient for localized
behavior.</p></div>
</div>
<div class="sect3">
<h4 id="_functions_only_available_on_utf_8_enabled_versions">Functions only available on UTF-8 enabled versions</h4>
<table class="tableblock frame-all grid-all"
style="
width:60%;
">
<col style="width:33%;">
<col style="width:66%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" >function </th>
<th class="tableblock halign-left valign-top" >description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#unicode">unicode</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">converts UTF-8 or ASCII strings into USC-4
Unicode</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#utf8">utf8</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">converts UCS-4 Unicode strings to UTF-8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#utf8len">utf8len</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">returns the number of UTF-8 characters in a a
string</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>The first two functions are rarely used in practice, as most Unicode
text files are already UTF-8–encoded (rather than UCS-4, which uses
four-byte integer characters). Unicode can be displayed directly when
using the <span class="monospaced">"%ls"</span> <a href="#format">format</a> specifier.</p></div>
<div class="paragraph"><p>For further details on UTF-8 and Unicode, consult
<a href="http://www.cl.cam.ac.uk/~mgk25/unicode.html"><em>UTF-8 and Unicode FAQ for
Unix/Linux</em></a> by <em>Markus Kuhn</em>.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_22_commas_in_parameter_lists">22. Commas in parameter lists</h3>
<div class="paragraph"><p>Some of the example programs contain functions that use a comma to
separate the parameters into two groups. This is not a special syntax of
newLISP, but rather a visual trick. The comma is a symbol just like any
other symbol. The parameters after the comma are not required when
calling the function; they simply declare local variables in a
convenient way. This is possible in newLISP because parameter variables
in lambda expressions are local and arguments are optional:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">my-func</span> <span class="ss">a</span> <span class="ss">b</span> <span class="ss">c</span> <span class="ss">,</span> <span class="ss">x</span> <span class="ss">y</span> <span class="ss">z</span><span class="p">)</span>
    <span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">x</span> <span class="err">…</span><span class="p">)</span>
<span class="p">(</span><span class="err">…</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p>When calling this function, only <span class="monospaced">a, b</span>, and <span class="monospaced">c</span> are used as parameters.
The others (the comma symbol, <span class="monospaced">x</span>, ` y`, and <span class="monospaced">z</span>) are initialized to
<span class="monospaced">nil</span> and are local to the function. After execution, the function&#8217;s
contents are forgotten and the environment&#8217;s symbols are restored to
their previous values.</p></div>
<div class="paragraph"><p>For other ways of declaring and initializing local variables, see
<a href="#let">let</a>, <a href="#letex">letex</a> and <a href="#letn">letn</a>.</p></div>
</div>
<div class="sect2">
<h3 id="_23_linking_newlisp_source_and_executable">23. Linking newLISP source and executable</h3>
<div class="paragraph"><p>On MS Windows, source code and the newLISP executable can be linked
together to build a self-contained application by using <span class="monospaced">link.lsp</span>. On
UNIX, the new linked executable will only work correctly when called
with the full pathname.</p></div>
<div class="paragraph"><p>The <span class="monospaced">link.lsp</span> program is located in the <span class="monospaced">newlisp/util</span> directory of the
source distributions. As an example, the following code is linked to the
newLISP executable to form a simple, self-contained application:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">;; uppercase.lsp - Link example</span>
<span class="p">(</span><span class="k">println</span> <span class="p">(</span><span class="k">upper-case</span> <span class="p">(</span><span class="k">main-args</span> <span class="ss">1</span><span class="p">)))</span>
<span class="p">(</span><span class="k">exit</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>This program, which resides in the file <span class="monospaced">uppercase.lsp</span>, takes the first
word on the command-line and converts it to uppercase.</p></div>
<div class="olist arabic"><div class="title">To build this program as a self-contained executable, follow these four steps:</div><ol class="arabic">
<li>
<p>
Put the following files into the same directory: (a) a copy of the
   newLISP executable; (b) <span class="monospaced">newlisp.exe</span>; (c) <span class="monospaced">link.lsp</span>; and (d) the
   program to link with (<span class="monospaced">uppercase.lsp</span> in this example).
</p>
</li>
<li>
<p>
In a shell, go to the directory referred to in step 1 and load
   <span class="monospaced">link.lsp</span>:
</p>
<div class="listingblock">
<div class="content monospaced">
<pre>newlisp link.lsp</pre>
</div></div>
</li>
<li>
<p>
In the newLISP shell, type one of the following:
</p>
<div class="listingblock">
<div class="content monospaced">
<pre>(link "newlisp.exe" "uppercase.exe" "uppercase.lsp")</pre>
</div></div>
</li>
<li>
<p>
Exit the newLISP shell and type:
</p>
<div class="listingblock">
<div class="content monospaced">
<pre>uppercase "convert me to uppercase"</pre>
</div></div>
</li>
</ol></div>
<div class="listingblock">
<div class="title">The console should print:</div>
<div class="content monospaced">
<pre>CONVERT ME TO UPPERCASE</pre>
</div></div>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img alt="Note" src="data:image/png;base64,
iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAJXElEQVRo3u2ZW4xcZ5HHf1Xf951z
uudqD2PPxRPs2AnGTlg7K0jihDiBJIzA4g5P8IDywOUBgUBaZK3EC/JK2dU+IMFmxQMrJavdDCgo
SOQCwUYBh4ADCIOdYM84YYjHl/Gt7UnPTE+fr/bhnG57nAXHyQSC5E8qzZxudc/3r/pX1b9qxMz4
ez7K3/m5AuAKgL8lgLGxMRsdHbW+vj7r6+uz0dFRGxsb+6tWBXm1VWj79u02/sB9bN92J5XpY+Rn
TnFqdoavT9ZY94nPsGPHDnnDRmBsbMzGH7iPHe96B+nk88wfeI54ZIrlMzN8bVXK+AP38eCDD9ob
NgKjo6N27+oOKrVTzP9+LxocziviFeeF02kn/+zW8OijjxZ/RETeUBHYs2cPPVlG8w/7CNVAqARC
FkiyQMgSBkdWsWfPHmKMAFh5Xg8A/rLCJWIiQqVSIT82SagG1CvqFBcU9UUkdHiYubmn8f5lX28i
gojgnFv0RpIkpGna/kyz2aTRaHDu3DlZSgCcOfZbPvCRezg5fZwVWSguHAoQ6h2udxk1Ejo7K/zs
h99i2bJuujorZFmKqtJmk1wIIBZkEEVEy6jBqmvuxszsL1HwsgB472mc3ccH77qKf/3WTv5tQw++
mqAl9/3QavL+q/nPXXs5WzvLzPEn8fMZ2lUhZgHnpARwEXPFgSaIZoiEAgBGmqbEGF8WrVedA0V4
lffeeT2dt27ky/trTDcDumIQ9w9bOd0xzFfGnmBmfB/RIo2FnBghj5FWCkQTDIdpdt4kgKQgCWgC
LkM0bQNYMgqFEIg41Kd87lPv4pPPHOKepycZ3/U88AtuGuhlW7XJ2r7AU9lKZl5q0N2VEU3Jo+Lw
gBQet/MXE00QDYVJAqKYRNI0Jc9zQghLE4FKpYKqw/uENMv4wqfv4re1Ov+zoYtfvX053xhR1mbC
tl8fZ+uWtbw0mzM3ZzQXhIiC+NICoh1tgwASyggEEI8Q8N4vbQTSNEXF43yC88Z1bxlhx/YP8U/f
eYr9vz6MGTTzyB1b1tFZzZhvROYWjHMvLRDSBKfgvOLEYeSLIgCuBOfKhDacc1yq+l42hdR7RAPq
IiHNeOu1q/jSZ+9m5twMj+zcz4GJ43R1ZQTvUfUYiqljds5QB5koooq7uMS2L1/SDOOV9L/LAuCc
Q8QjmhC8kKQLVCoVurvmUTHu3rqet20Yptk0li3vIkkCgsNrwIeAmbCQQxSo+D/D6FaVski8IPmX
DADicK6gUPCBjmpGnldwKlQrGStXLKfZjIgolWrRnAyl2RScKkkaLuoBgOsBrWDSBTYHoiBckv+X
DSDGCCaAEHxCkgbyPMWsShocC80m0UBR1DmS4HGqpFmGiKLOE6MS1AN5cfFFp1FcHsHQpQdQr9dR
VVQE54TEJ1iaguWkwZPnOSCIFpcIwZMkgTRNgLJbO4cLKaYJSPUCkZGXzM8Q8jaFlj4CIqhz5FEI
icNiwElKjIE8RlQVp44YDVSLvFFH8J7TtTpTR09zw+bNWNFuOXjoMKfOzPCPmzaSuBQRxTDAXhGA
y+oDqopoUS1c8DhN+Pkz40RTfv/cESYm5+jsGaTaPcCv9p3gP/7rp+zd/yLOJxw+epbdeyZ5fNez
HPrjMUQTvv3fP+LFw6fo7e7m2w88gmhx9aLRXbqEXjaA7q4qoh71Kd4HVD0nT9d5+NHf8NK8o3a2
zk9/vo8jx04zfaLGlz//cQ5N1jkyLczMpSRplZtu3MTVa0YwYPrkGW6/7QbWv2UNQwN9mChC0QdM
3dJH4GXa2IwV/T08e/AYd91+A+/euomDE4f55TN/4J03X4+I8OH338zjT+zm+reuYsP6NW1hZnh6
e3r4l3//Xx586Eluu+XGopm9nvPA/3dWruilt7ez/byst4uJF6bYcuOGNsg8Lz1pCzTmZwF45LEn
2fy2tdyw6VqeO/AnFprzQOfrB6Ber7+MkOqrDKwcYmHhF+cB9ffSt7yb7/3gKa65ephnD/yJD7zv
9lLNOmbn5gE4N1NnzeohnHNsWL+aY9PnWi25tLi0AGq1GlddNYBIwLmEPM9R16BvWZUvfnYb6grF
uPXWzYDwzps3cfxEjdtu2UyWJYgoK1f0sXzqFCLKRz94N4//+Gl+s/cQMc+57rprGRocBBUQg+iW
FsDU1BRvWtZTdtGAc44oxTTV1dWJxVnMiioi4kjSDlYN9RdTVtkXsqzCrTdtApQQYNvoLS01V5pg
SKE1yMnz/JJ66BUDGB8fZ2iwvwAgvtTzOeCK0opg0QozKSQBgqpiOEQcqF2geRZ7WPAIWjigGJ6X
VsxNTEzQ399TzKztZlO0fIvFc7RIbtCqfqpSRAAFWiXSl2LNFitR1cIZUipR4y8OMpddRl944Xmu
GhkqQoyAcf53UcyUGB15VPJcCovFa2ZalsjCwyDF4NIyKb+nbJSiBaAkSZYGwM6dO23Xrp9wxx13
Fl43w1pS1ygjUihVMy1N2k62lm4o+W6imMW2FTR0SCkUBSlF4xIl8dTUFB/70B1UKykL9ZOYWJln
0m4+xb4nomrlpQoKiRTvtXS+mIIqqpWLhBaggpiVjim00GsaKVs7mb179/K+94yWnAeLBtEwYtuz
IkXC+lIzAWj52vlktKJEGkQWFlNBBMwRpQBgllOv11/7QGNmdv/99/PVr9xDY/YEZpGjR6fJmw1+
t+8A0ydO87v9E1iMdHV20NPTwdrVg1y3YR0iMDzUX0Shve2JCBGJzcUBUI/aAmbGi0eOsn/fBLVa
bUkAFFOV5Xz34SewPOexH+1maNVaurs66ehezpprljEwMMDs7Cxnz9WYnDYe++b3mTlznGo1o7O7
g5GhAa5dN8L1G69hYKAfs/ND/dSRUxydPsn4xCR/nDzC5ORRjk6f4t57721H81Vtp83MYowMDw/T
bDYREbZs2cLo6CgDAwN0dnYiIsXGrtFAVQkhkOc58/PzqCr1ep3du3fT0dHBwYMHeeihh1BVVq9+
8wWjqmdwcJD169ezbt06Nm7cSH9/P1mWMTIyQqVSkVe9Xm82m9ZsNpmdnWVubo5Go0GMsc3rVqK1
nluc997jnGv/bOWImTE3N7do8WtmNJvN9hDvnCNJEpIkoVKp4L1/7btRVW17uDXge+9pbZtb1gr5
hc8X7za994uoISLEGNvSoWVJkrw2Cl35L+UVAFcAXAFwBcClzv8B3eu58OmgDQoAAAAASUVORK5C
YII=">
</td>
<td class="content">Neither one of the initialization files <span class="monospaced">init.lsp</span> nor
<span class="monospaced">.init.lsp</span> is loaded during startup of linked programs.</td>
</tr></table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_newlisp_function_reference">newLISP Function Reference</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_1_syntax_of_symbol_variables_and_numbers">1. Syntax of symbol variables and numbers</h3>
<div class="paragraph"><p>Source code in newLISP is parsed according to the rules outlined here.
When in doubt, verify the behavior of newLISP&#8217;s internal parser by
calling <a href="#parse">parse</a> without optional arguments.</p></div>
<div class="sect3">
<h4 id="_symbols_for_variable_names">Symbols for variable names</h4>
<div class="paragraph"><p>The following rules apply to the naming of symbols used as variables or
functions:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Variable symbols may not start with any of the following
    characters:<br>
    <span class="monospaced"># ; " ' ( )  { } . , 0 1 2 3 4 5 6 7 8 9</span>
</p>
</li>
<li>
<p>
Variable symbols starting with a <span class="monospaced">+</span> or <span class="monospaced">-</span> cannot have a number
    as the second character.
</p>
</li>
<li>
<p>
Any character is allowed inside a variable name, except for:<br>
    <span class="monospaced">" ' ( ) : ,</span><br>
    and the space character. These mark the end of a variable symbol.
</p>
</li>
<li>
<p>
A symbol name starting with <span class="monospaced">[</span> (left square bracket) and ending
    with <span class="monospaced">]</span> (right square bracket) may contain any character except
    the right square bracket.
</p>
</li>
</ol></div>
<div class="paragraph"><p>All of the following symbols are legal variable names in newLISP:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="ss">myvar</span>
<span class="ss">A-name</span>
<span class="ss">X34-zz</span>
<span class="nv">[* 7 5 ()};]</span>
<span class="k">*</span><span class="ss">111*</span>
</pre></div></div></div>
<div class="paragraph"><p>Sometimes it is useful to create hash-like <a href="#hash">lookup
dictionaries</a> with keys containing characters that are illegal in
newLISP variables. The functions <a href="#sym">sym</a> and
<a href="#context">context</a> can be used to create symbols containing these
characters:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="p">(</span><span class="k">sym</span> <span class="s">&quot;(#:L*&quot;</span><span class="p">)</span> <span class="ss">456</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">456</span>

<span class="p">(</span><span class="k">eval</span> <span class="p">(</span><span class="k">sym</span> <span class="s">&quot;(#:L*&quot;</span><span class="p">))</span>     <span class="err">→</span> <span class="ss">456</span>

<span class="p">(</span><span class="k">set</span> <span class="p">(</span><span class="k">sym</span> <span class="ss">1</span><span class="p">)</span> <span class="ss">123</span><span class="p">)</span>        <span class="err">→</span> <span class="ss">123</span>

<span class="p">(</span><span class="k">eval</span> <span class="p">(</span><span class="k">sym</span> <span class="ss">1</span><span class="p">))</span>           <span class="err">→</span> <span class="ss">123</span>

<span class="ss">1</span>                        <span class="err">→</span> <span class="ss">1</span>
<span class="p">(</span><span class="nv">+</span> <span class="ss">1</span> <span class="ss">2</span><span class="p">)</span>                  <span class="err">→</span> <span class="ss">3</span>
</pre></div></div></div>
<div class="paragraph"><p>The last example creates the symbol <span class="monospaced">1</span> containing the value <span class="monospaced">123</span>. Also
note that creating such a symbol does not alter newLISP&#8217;s normal
operations, since <span class="monospaced">1</span> is still parsed as the number one.</p></div>
</div>
<div class="sect3">
<h4 id="_numbers">Numbers</h4>
<div class="paragraph"><p>newLISP recognizes the following number formats:</p></div>
<div class="paragraph"><p><strong>Integers</strong> are one or more digits long, optionally preceded by a <span class="monospaced">+</span> or
<span class="monospaced">-</span> sign. Any other character marks the end of the integer or may be
part of the sequence if parsed as a float (see float syntax below).</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="ss">123</span>
<span class="k">+</span><span class="ss">4567</span>
<span class="k">-</span><span class="ss">999</span>
</pre></div></div></div>
<div class="paragraph"><p><strong>Hexadecimals</strong> start with a <span class="monospaced">0x</span> (or <span class="monospaced">0X</span>), followed by any combination
of the hexadecimal digits: <span class="monospaced">0123456789abcdefABCDEF</span>. Any other character
ends the hexadecimal number.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="ss">0xFF</span>    <span class="err">→</span>  <span class="ss">255</span>
<span class="ss">0x10ab</span>  <span class="err">→</span> <span class="ss">4267</span>
<span class="ss">0X10CC</span>  <span class="err">→</span> <span class="ss">4300</span>
</pre></div></div></div>
<div class="paragraph"><p><strong>Binaries</strong> start with a <span class="monospaced">0b</span> (or <span class="monospaced">0B</span>), followed by up to 64 1&#8217;s or 0s.
Any other character ends the binary number.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="ss">0b101010</span>   <span class="err">→</span>  <span class="ss">42</span>
</pre></div></div></div>
<div class="paragraph"><p><strong>Octals</strong> start with an optional <span class="monospaced">+</span> (plus) or <span class="monospaced">-</span> (minus) sign and a <span class="monospaced">0</span>
(zero), followed by any combination of the octal digits: <span class="monospaced">01234567</span>. Any
other character ends the octal number.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="ss">012</span>   <span class="err">→</span>  <span class="ss">10</span>
<span class="ss">010</span>   <span class="err">→</span>   <span class="ss">8</span>
<span class="ss">077</span>   <span class="err">→</span>  <span class="ss">63</span>
<span class="k">-</span><span class="ss">077</span>  <span class="err">→</span> <span class="k">-</span><span class="ss">63</span>
</pre></div></div></div>
<div class="paragraph"><p><strong>Floating point</strong> numbers can start with an optional <span class="monospaced">+</span> (plus) or <span class="monospaced">-</span>
(minus) sign, but they cannot be followed by a <span class="monospaced">0</span> (zero); this would
make them octal numbers instead of floating points. A single <span class="monospaced">.</span>
(decimal point) can appear anywhere within a floating point number,
including at the beginning.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="ss">1.23</span>     <span class="err">→</span>  <span class="ss">1.23</span>
<span class="k">-</span><span class="ss">1.23</span>    <span class="err">→</span> <span class="k">-</span><span class="ss">1.23</span>
<span class="k">+</span><span class="ss">2.3456</span>  <span class="err">→</span>  <span class="ss">2.3456</span>
<span class="ss">.506</span>     <span class="err">→</span>  <span class="ss">0.506</span>
</pre></div></div></div>
<div class="paragraph"><p>As described below, <strong>scientific notation</strong> starts with a floating point
number called the <em>significand</em> (or <em>mantissa</em>), followed by the letter
<span class="monospaced">e</span> or <span class="monospaced">E</span> and an integer <em>exponent</em>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="ss">1.23e3</span>    <span class="err">→</span>  <span class="ss">1230</span>
<span class="k">-</span><span class="ss">1.23E3</span>   <span class="err">→</span> <span class="k">-</span><span class="ss">1230</span>
<span class="k">+</span><span class="ss">2.34e-2</span>  <span class="err">→</span>  <span class="ss">0.0234</span>
<span class="ss">.506E3</span>    <span class="err">→</span>  <span class="ss">506</span>
</pre></div></div></div>
</div>
</div>
<div class="sect2">
<h3 id="_2_data_types_and_names_in_the_reference">2. Data types and names in the reference</h3>
<div class="paragraph"><p>To describe the types and names of a function&#8217;s parameters, the
following naming convention is used throughout the reference section:</p></div>
<div class="paragraph"><p><strong>syntax: (format <em>str-format</em> <em>exp-data-1</em> [<em>exp-data-i</em> &#8230; ])</strong></p></div>
<div class="paragraph"><p>Arguments are represented by symbols formed by the argument&#8217;s type and
name, separated by a <span class="monospaced">-</span> (hyphen). Here, <em>str-format</em> (a string) and
<em>exp-data-1</em> (an expression) are named "format" and "data-1",
respectively.</p></div>
<div class="paragraph"><p>Arguments enclosed in brackets <span class="monospaced">[</span> and <span class="monospaced">]</span> are optional. When arguments
are separated by a vertical <span class="monospaced">|</span> then one of them must be chosen.</p></div>
<div class="sect3">
<h4 id="_array">array</h4>
<div class="paragraph"><p>An array (constructed with the <a href="#array">array</a> function).</p></div>
</div>
<div class="sect3">
<h4 id="_body">body</h4>
<div class="paragraph"><p>One or more expressions for evaluation. The expressions are evaluated
sequentially if there is more than one.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="ss">1</span> <span class="ss">7.8</span>
<span class="k">nil</span>
<span class="p">(</span><span class="nv">+</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">)</span>
<span class="s">&quot;Hi&quot;</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">a</span> <span class="ss">b</span><span class="p">)(</span><span class="k">print</span> <span class="ss">result</span><span class="p">)</span>
<span class="p">(</span><span class="nv">do-this</span><span class="p">)(</span><span class="nv">do-that</span><span class="p">)</span> <span class="ss">123</span>
</pre></div></div></div>
</div>
<div class="sect3">
<h4 id="_bool">bool</h4>
<div class="paragraph"><p><span class="monospaced">true</span>, <span class="monospaced">nil</span>, or an expression evaluating to one of these two.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">true</span><span class="ss">,</span> <span class="k">nil</span><span class="ss">,</span> <span class="p">(</span><span class="nv">&lt;=</span> <span class="ss">X</span> <span class="ss">10</span><span class="p">)</span>
</pre></div></div></div>
</div>
<div class="sect3">
<h4 id="_context">context</h4>
<div class="paragraph"><p>An expression evaluating to a context (namespace) or a variable symbol
holding a context.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="ss">MyContext,</span> <span class="ss">aCtx,</span> <span class="ss">TheCTX</span>
</pre></div></div></div>
</div>
<div class="sect3">
<h4 id="_exp">exp</h4>
<div class="paragraph"><p>Any data type described in this chapter.</p></div>
</div>
<div class="sect3">
<h4 id="_func">func</h4>
<div class="paragraph"><p>A symbol or an expression evaluating to an operator symbol or lambda
expression.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="ss">+,</span> <span class="k">add</span><span class="ss">,</span> <span class="p">(</span><span class="k">first</span> <span class="o">&#39;</span><span class="p">(</span><span class="k">add</span> <span class="k">sub</span><span class="p">))</span><span class="ss">,</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">x</span> <span class="ss">x</span><span class="p">))</span>
</pre></div></div></div>
</div>
<div class="sect3">
<h4 id="_int">int</h4>
<div class="paragraph"><p>An integer or an expression evaluating to an integer. Generally, if a
floating point number is used when an int is expected, the value is
truncated to an integer.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="ss">123,</span> <span class="ss">5,</span> <span class="p">(</span><span class="nv">*</span> <span class="ss">X</span> <span class="ss">5</span><span class="p">)</span>
</pre></div></div></div>
</div>
<div class="sect3">
<h4 id="_list">list</h4>
<div class="paragraph"><p>A list of elements (any type) or an expression evaluating to a list.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span> <span class="s">&quot;hello&quot;</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">))</span>
</pre></div></div></div>
</div>
<div class="sect3">
<h4 id="_num">num</h4>
<div class="paragraph"><p>An integer, a floating point number, or an expression evaluating to one
of these two. If an integer is passed, it is converted to a floating
point number.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="ss">1.234,</span> <span class="p">(</span><span class="k">div</span> <span class="ss">10</span> <span class="ss">3</span><span class="p">)</span><span class="ss">,</span> <span class="p">(</span><span class="k">sin</span> <span class="ss">1</span><span class="p">)</span>
</pre></div></div></div>
</div>
<div class="sect3">
<h4 id="_matrix">matrix</h4>
<div class="paragraph"><p>A list in which each row element is itself a list or an array in which
each row element is itself an array. All element lists or arrays (rows)
are of the same length. Any data type can be element of a matrix, but
when using specific matrix operations like <a href="#det">det</a>,
<a href="#multiply">multiply</a>, or <a href="#invert">invert</a>, all numbers must be
floats or integers.</p></div>
<div class="paragraph"><p>The dimensions of a matrix are defined by indicating the number of rows
and the number of column elements per row. Functions working on matrices
ignore superfluous columns in a row. For missing row elements, <span class="monospaced">0.0</span> is
assumed by the functions <a href="#det">det</a>, <a href="#multiply">multiply</a>, and
<a href="#invert">invert</a>, while <a href="#transpose">transpose</a> assumes <span class="monospaced">nil</span>.
Special rules apply for <a href="#transpose">transpose</a> when a whole row is
not a list or an array, but some other data type.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">((</span><span class="nv">1</span>  <span class="ss">2</span>  <span class="ss">3</span>  <span class="ss">4</span><span class="p">)</span>
<span class="p">(</span><span class="nv">5</span>  <span class="ss">6</span>  <span class="ss">7</span>  <span class="ss">8</span><span class="p">)</span>
<span class="p">(</span><span class="nv">9</span> <span class="ss">10</span> <span class="ss">11</span> <span class="ss">12</span><span class="p">))</span>        <span class="c1">; 3 rows 4 columns</span>

<span class="p">((</span><span class="nv">1</span> <span class="ss">2</span><span class="p">)</span> <span class="p">(</span><span class="nv">3</span> <span class="ss">4</span><span class="p">)</span> <span class="p">(</span><span class="nv">5</span> <span class="ss">6</span><span class="p">))</span>  <span class="c1">; 3 rows 2 columns</span>
</pre></div></div></div>
</div>
<div class="sect3">
<h4 id="_place">place</h4>
<div class="paragraph"><p>A place referenced by a symbol or a place defined in a list, array or
string by indexing with <a href="#nth">nth</a> or <a href="#indexing">implicit
indexing</a> or a place referenced by functions like <a href="#first">first</a>,
<a href="#last">last</a>, <a href="#assoc">assoc</a> or <a href="#lookup">lookup</a>.</p></div>
</div>
<div class="sect3">
<h4 id="_str">str</h4>
<div class="paragraph"><p>A string or an expression that evaluates to a string.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="s">&quot;Hello&quot;</span><span class="ss">,</span> <span class="p">(</span><span class="k">append</span> <span class="k">first-</span><span class="ss">name</span>  <span class="s">&quot; Miller&quot;</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Special characters can be included in quoted strings by placing a <span class="monospaced">\</span>
(backslash) before the character or digits to escape them:</p></div>
<table class="tableblock frame-all grid-all"
style="
width:100%;
">
<col style="width:9%;">
<col style="width:90%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" >character </th>
<th class="tableblock halign-left valign-top" >description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">\"</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">for a double quote inside a quoted string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">\n</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">the line-feed character (ASCII 10)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">\r</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">the carriage return character (ASCII 13)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">\t</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">the tab character (ASCII 9)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">\nnn</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">a decimal ASCII code where nnn is between 000 and 255</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">\xnn</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">a hexadecimal code where nn is between 00 and FF</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">\unnnn</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">a unicode character encoded in the four <span class="monospaced">nnnn</span> hexadecimal
digits. When reading a quoted string, newLISP will translate this to a
UTF8 character in the UTF8 enabled versions of newLISP.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">\\</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">the backslash character itself</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>Decimals start with a digit. Hexadecimals start with <span class="monospaced">x</span>:.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="s">&quot;\065\066\067&quot;</span> <span class="err">→</span> <span class="s">&quot;ABC&quot;</span>
<span class="s">&quot;\x41\x42\x43&quot;</span> <span class="err">→</span> <span class="s">&quot;ABC&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>Instead of a <span class="monospaced">"</span> (double quote), a <span class="monospaced">{</span> (left curly bracket) and <span class="monospaced">}</span>
(right curly bracket) can be used to delimit strings. This is useful
when quotation marks need to occur inside strings. Quoting with the
curly brackets suppresses the backslash escape effect for special
characters. Balanced nested curly brackets may be used within a string.
This aids in writing regular expressions or short sections of HTML.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">print</span> <span class="s">&quot;&lt;A href=\&quot;http://mysite.com\&quot;&gt;&quot;</span> <span class="p">)</span> <span class="c1">; the cryptic way</span>

<span class="p">(</span><span class="k">print</span> <span class="s">{&lt;A href=&quot;http://mysite.com&quot;&gt;}</span> <span class="p">)</span>   <span class="c1">; the readable way</span>

<span class="c1">; path names on MS Windows</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">path</span> <span class="s">&quot;C:\\MyDir\\example.lsp&quot;</span><span class="p">)</span>

<span class="c1">; no escaping when using braces</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">path</span> <span class="s">{C:\MyDir\example.lsp}</span><span class="p">)</span>

<span class="c1">; on MS Windows the forward slash can be used in path names</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">path</span> <span class="s">&quot;C:/MyDir/example.lsp&quot;</span><span class="p">)</span>

<span class="c1">; inner braces are balanced</span>
<span class="p">(</span><span class="k">regex</span> <span class="s">{abc{1,2}}</span> <span class="ss">line</span><span class="p">)</span>

<span class="p">(</span><span class="k">print</span> <span class="s">[text]</span>
<span class="s">  this could be</span>
<span class="s">  a very long (&gt; 2048 characters) text,</span>
<span class="s">  i.e. HTML.</span>
<span class="s">[/text]</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The tags <span class="monospaced">[text]</span> and <span class="monospaced">[/text]</span> can be used to delimit long strings and
suppress escape character translation. This is useful for delimiting
long HTML passages in CGI files written in newLISP or for situations
where character translation should be completely suppressed. Always use
the <span class="monospaced">[text]</span> tags for strings longer than 2048 characters.</p></div>
</div>
<div class="sect3">
<h4 id="_sym">sym</h4>
<div class="paragraph"><p>A symbol or expression evaluating to a symbol.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="o">&#39;</span><span class="ss">xyz,</span> <span class="p">(</span><span class="k">first</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">+</span> <span class="ss">-</span> <span class="ss">/</span><span class="p">))</span><span class="ss">,</span> <span class="o">&#39;</span><span class="ss">*,</span> <span class="o">&#39;</span><span class="ss">-</span> <span class="ss">,</span> <span class="ss">someSymbol,</span>
</pre></div></div></div>
<div class="paragraph"><p>Most of the context symbols in this manual start with an uppercase
letter to distinguish them from other symbols.</p></div>
</div>
<div class="sect3">
<h4 id="_sym_context">sym-context</h4>
<div class="paragraph"><p>A symbol, an existing context, or an expression evaluating to a symbol
from which a context will be created. If a context does not already
exist, many functions implicitly create them (e.g.,
<a href="#bayes-train">bayes-train</a>, <a href="#context">context</a>,
<a href="#eval-string">eval-string</a>, <a href="#load">load</a>, <a href="#sym">sym</a>, and
<a href="#xml-parse">xml-parse</a>). The context must be specified when these
functions are used on an existing context. Even if a context already
exists, some functions may continue to take quoted symbols (e.g.,
<a href="#context">context</a>). For other functions, such as
<a href="#contextp">context?</a>, the distinction is critical.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_3_functions_in_groups">3. Functions in groups</h3>
<div class="paragraph"><p>Some functions appear in more than one group.</p></div>
<div class="sect3">
<h4 id="_list_processing_flow_control_and_integer_arithmetic">List processing, flow control, and integer arithmetic</h4>
<table class="tableblock frame-all grid-all"
style="
width:60%;
">
<col style="width:16%;">
<col style="width:83%;">
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#arithmetic">+, -, *, /, %</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">integer arithmetic</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#inci">++</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">increment integer numbers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#deci">--</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">decrement integer numbers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#logical">&lt;, &gt;, =</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">compares any data type: less, greater, equal</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#logical">&#8656;, &gt;=, !=</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">compares any data type: less-equal,
greater-equal, not-equal</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#colon">:</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">constructs a context symbol and applies it to an
object</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#and">and</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">logical <span class="monospaced">and</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#append">append</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">appends lists ,arrays or strings to form a new
list, array or string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#apply">apply</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">applies a function or primitive to a list of
arguments</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#args">args</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">retrieves the argument list of a function or macro
expression</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#assoc">assoc</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">searches for keyword associations in a list</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#begin">begin</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">begins a block of functions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#bind">bind</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">binds variable associations in a list</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#case">case</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">branches depending on contents of control variable</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#catch">catch</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">evaluates an expression, possibly catching errors</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#chop">chop</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">chops elements from the end of a list</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#clean">clean</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">cleans elements from a list</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#cond">cond</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">branches conditionally to expressions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#cons">cons</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">prepends an element to a list, making a new list</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#constant">constant</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">defines a constant symbol</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#count">count</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">counts elements of one list that occur in another
list</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#curry">curry</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">transforms a function f(x, y) into a function
fx(y)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#define">define</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">defines a new function or lambda expression</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#define-macro">define-macro</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">defines a macro or lambda-macro
expression</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#def-new">def-new</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">copies a symbol to a different context
(namespace)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#difference">difference</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">returns the difference between two
lists</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#doargs">doargs</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">iterates through the arguments of a function</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#dolist">dolist</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">evaluates once for each element in a list</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#dostring">dostring</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">evaluates once for each character in a
string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#dotimes">dotimes</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">evaluates once for each number in a range</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#dotree">dotree</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">iterates through the symbols of a context</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#do-until">do-until</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">repeats evaluation of an expression until
the condition is met</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#do-while">do-while</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">repeats evaluation of an expression while
the condition is true</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#dup">dup</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">duplicates a list or string a specified number of
times</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#ends-with">ends-with</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">checks the end of a string or list
against a key of the same type</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#eval">eval</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">evaluates an expression</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#exists">exists</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">checks for the existence of a condition in a
list</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#expand">expand</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">replaces a symbol in a nested list</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#explode">explode</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">explodes a list or string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#extend">extend</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">extends a list or string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#first">first</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">gets the first element of a list or string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#filter">filter</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">filters a list</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#find">find</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">searches for an element in a list or string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#flat">flat</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">returns the flattened list</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#define">fn</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">defines a new function or lambda expression</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#for">for</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">evaluates once for each number in a range</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#for-all">for-all</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">checks if all elements in a list meet a
condition</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#if">if</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">evaluates an expression conditionally</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#index">index</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">filters elements from a list and returns their
indices</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#intersect">intersect</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">returns the intersection of two lists</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#define">lambda</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">defines a new function or lambda expression</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#last">last</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">returns the last element of a list or string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#length">length</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">calculates the length of a list or string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#let">let</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">declares and initializes local variables</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#letex">letex</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">expands local variables into an expression, then
evaluates</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#letn">letn</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">initializes local variables incrementally, like
<em>nested lets</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#list">list</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">makes a list</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#lookup">lookup</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">looks up members in an association list</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#map">map</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">maps a function over members of a list, collecting
the results</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#match">match</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">matches patterns against lists; for matching
against strings, see <a href="#find">find</a> and <a href="#regex">regex</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#member">member</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">finds a member of a list or string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#not">not</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">logical <span class="monospaced">not</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#nth">nth</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">gets the <em>nth</em> element of a list or string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#or">or</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">logical <span class="monospaced">or</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#pop">pop</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">deletes and returns an element from a list or string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#pop-assoc">pop-assoc</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">removes an association from an
association list</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#push">push</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">inserts a new element into a list or string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#quote">quote</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">quotes an expression</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#ref">ref</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">returns the position of an element inside a nested
list</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#ref-all">ref-all</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">returns a list of index vectors of elements
inside a nested list</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#rest">rest</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">returns all but the first element of a list or
string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#replace">replace</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">replaces elements inside a list or string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#reverse">reverse</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">reverses a list or string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#rotate">rotate</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">rotates a list or string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#select">select</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">selects and permutes elements from a list or
string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#self">self</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Accesses the target object inside a FOOP method</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#set">set</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">sets the binding or contents of a symbol</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#setf">setf setq</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">sets contents of a symbol or list, array or
string reference</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#set-ref">set-ref</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">searches for an element in a nested list and
replaces it</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#set-ref-all">set-ref-all</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">searches for an element in a nested
list and replaces all instances</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#silent">silent</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">works like <a href="#begin">begin</a> but suppresses
console output of the return value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#slice">slice</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">extracts a sublist or substring</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#sort">sort</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">sorts the members of a list</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#starts-with">starts-with</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">checks the beginning of a string or
list against a key of the same type</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#swap">swap</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">swaps two elements inside a list or string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#unify">unify</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">unifies two expressions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#unique">unique</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">returns a list without duplicates</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#union">union</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">returns a unique list of elements found in two or
more lists.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#unless">unless</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">evaluates an expression conditionally</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#until">until</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">repeats evaluation of an expression until the
condition is met</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#when">when</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">evaluates a block of statements conditionally</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#while">while</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">repeats evaluation of an expression while the
condition is true</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_string_and_conversion_functions">String and conversion functions</h4>
<table class="tableblock frame-all grid-all"
style="
width:60%;
">
<col style="width:16%;">
<col style="width:83%;">
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#address">address</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">gets the memory address of a number or string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#append">append</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">appends lists, arrays or strings to form a new
list, array or string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#bits">bits</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">translates a number into binary representation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#char">char</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">translates between characters and ASCII codes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#chop">chop</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">chops off characters from the end of a string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#dostring">dostring</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">evaluates once for each character in a string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#dup">dup</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">duplicates a list or string a specified number of times</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#ends-with">ends-with</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">checks the end of a string or list against
a key of the same type</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#encrypt">encrypt</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">does a one-time–pad encryption and decryption
of a string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#eval-string">eval-string</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">compiles, then evaluates a string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#explode">explode</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">transforms a string into a list of characters</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#extend">extend</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">extends a list or string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#find">find</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">searches for an element in a list or string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#find-all">find-all</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">returns a list of all pattern matches found
in string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#first">first</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">gets the first element in a list or string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#float">float</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">translates a string or integer into a floating
point number</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#format">format</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">formats numbers and strings as in the C language</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#get-char">get-char</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">gets a character from a memory address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#get-float">get-float</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">gets a double float from a memory address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#get-int">get-int</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">gets a 32-bit integer from a memory address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#get-long">get-long</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">gets a long 64-bit integer from a memory
address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#get-string">get-string</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">gets a string from a memory address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#int">int</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">translates a string or float into an integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#join">join</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">joins a list of strings</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#last">last</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">returns the last element of a list or string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#lower-case">lower-case</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">converts a string to lowercase characters</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#member">member</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">finds a list or string member</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#name">name</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">returns the name of a symbol or its context as a
string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#nth">nth</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">gets the <em>nth</em> element in a list or string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#pack">pack</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">packs newLISP expressions into a binary structure</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#parse">parse</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">breaks a string into tokens</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#pop">pop</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">pops from a string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#push">push</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">pushes onto a string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#regex">regex</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">performs a Perl-compatible regular expression
search</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#regex-comp">regex-comp</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">pre-compiles a regular expression pattern</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#replace">replace</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">replaces elements in a list or string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#rest">rest</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">gets all but the first element of a list or string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#reverse">reverse</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">reverses a list or string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#rotate">rotate</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">rotates a list or string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#select">select</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">selects and permutes elements from a list or
string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#setf">setf setq</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">sets contents of a string reference</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#slice">slice</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">extracts a substring or sublist</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#source">source</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">returns the source required to bind a symbol as a
string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#starts-with">starts-with</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">checks the start of the string or list
against a key string or list</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#string">string</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">transforms anything into a string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#sym">sym</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">translates a string into a symbol</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#title-case">title-case</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">converts the first character of a string
to uppercase</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#trim">trim</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">trims a string on one or both sides</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#unicode">unicode</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">converts ASCII or UTF-8 to UCS-4 Unicode</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#utf8">utf8</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">converts UCS-4 Unicode to UTF-8</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#utf8len">utf8len</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">returns length of an UTF-8 string in UTF-8
characters</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#unpack">unpack</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">unpacks a binary structure into newLISP
expressions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#upper-case">upper-case</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">converts a string to uppercase characters</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_floating_point_math_and_special_functions">Floating point math and special functions</h4>
<table class="tableblock frame-all grid-all"
style="
width:60%;
">
<col style="width:16%;">
<col style="width:83%;">
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#abs">abs</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">returns the absolute value of a number</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#acos">acos</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">calculates the arc-cosine of a number</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#acosh">acosh</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">calculates the inverse hyperbolic cosine of a
number</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#add">add</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">adds floating point or integer numbers and returns a
floating point number</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#array">array</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">creates an array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#array-list">array-list</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">returns a list conversion from an array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#asin">asin</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">calculates the arcsine of a number</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#asinh">asinh</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">calculates the inverse hyperbolic sine of a number</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#atan">atan</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">calculates the arctangent of a number</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#atanh">atanh</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">calculates the inverse hyperbolic tangent of a
number</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#atan2">atan2</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">computes the principal value of the arctangent of Y
/ X in radians</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#beta">beta</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">calculates the beta function</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#betai">betai</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">calculates the incomplete beta function</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#binomial">binomial</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">calculates the binomial function</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#ceil">ceil</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">rounds up to the next integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#cos">cos</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">calculates the cosine of a number</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#cosh">cosh</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">calculates the hyperbolic cosine of a number</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#crc32">crc32</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">calculates a 32-bit CRC for a data buffer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#dec">dec</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">decrements a number in a variable, list or array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#div">div</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">divides floating point or integer numbers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#erf">erf</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">calculates the error function of a number</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#exp">exp</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">calculates the exponential <em>e</em> of a number</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#factor">factor</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">factors a number into primes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#fft">fft</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">performs a fast Fourier transform (FFT)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#floor">floor</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">rounds down to the next integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#flt">flt</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">converts a number to a 32-bit integer representing a
float</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#gammai">gammai</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">calculates the incomplete Gamma function</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#gammaln">gammaln</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">calculates the log Gamma function</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#gcd">gcd</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">calculates the greatest common divisor of a group of
integers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#ifft">ifft</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">performs an inverse fast Fourier transform (IFFT)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#inc">inc</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">increments a number in a variable, list or array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#infp">inf?</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">checks if a floating point value is infinite</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#log">log</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">calculates the natural or other logarithm of a number</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#min">min</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">finds the smallest value in a series of values</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#max">max</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">finds the largest value in a series of values</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#mod">mod</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">calculates the modulo of two numbers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#mul">mul</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">multiplies floating point or integer numbers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#NaNp">NaN?</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">checks if a float is NaN (not a number)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#round">round</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">rounds a number</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#pow">pow</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">calculates <em>x</em> to the power of <em>y</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#sequence">sequence</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">generates a list sequence of numbers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#series">series</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">creates a geometric sequence of numbers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#sgn">sgn</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">calculates the signum function of a number</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#sin">sin</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">calculates the sine of a number</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#sinh">sinh</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">calculates the hyperbolic sine of a number</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#sqrt">sqrt</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">calculates the square root of a number</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#sub">sub</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">subtracts floating point or integer numbers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#tan">tan</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">calculates the tangent of a number</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#tanh">tanh</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">calculates the hyperbolic tangent of a number</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#uuid">uuid</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">returns a UUID (Universal Unique IDentifier)</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_matrix_functions">Matrix functions</h4>
<table class="tableblock frame-all grid-all"
style="
width:60%;
">
<col style="width:16%;">
<col style="width:83%;">
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#det">det</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">returns the determinant of a matrix</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#invert">invert</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">returns the inversion of a matrix</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#mat">mat</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">performs scalar operations on matrices</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#multiply">multiply</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">multiplies two matrices</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#transpose">transpose</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">returns the transposition of a matrix</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_array_functions">Array functions</h4>
<table class="tableblock frame-all grid-all"
style="
width:60%;
">
<col style="width:16%;">
<col style="width:83%;">
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#append">append</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">appends arrays</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#array">array</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">creates and initializes an array with up to 16
dimensions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#array-list">array-list</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">converts an array into a list</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#arrayp">array?</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">checks if expression is an array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#det">det</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">returns the determinant of a matrix</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#first">first</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">returns the first row of an array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#invert">invert</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">returns the inversion of a matrix</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#last">last</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">returns the last row of an array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#mat">mat</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">performs scalar operations on matrices</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#multiply">multiply</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">multiplies two matrices</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#nth">nth</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">returns an element of an array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#rest">rest</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">returns all but the first row of an array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#setf">setf</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">sets contents of an array reference</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#slice">slice</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">returns a slice of an array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#transpose">transpose</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">transposes a matrix</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_bit_operators">Bit operators</h4>
<table class="tableblock frame-all grid-all"
style="
width:60%;
">
<col style="width:16%;">
<col style="width:83%;">
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#bit_shift">&lt;&lt;, &gt;&gt;</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">bit shift left, bit shift right</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#bit_and">&amp;</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">bitwise and</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">link:#bit_inclusive[</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">bitwise inclusive or</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#bit_exclusive">^</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">bitwise exclusive or</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#bit_not">~</a></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_predicates">Predicates</h4>
<table class="tableblock frame-all grid-all"
style="
width:60%;
">
<col style="width:16%;">
<col style="width:83%;">
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#atomp">atom?</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">checks if an expression is an atom</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#arrayp">array?</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">checks if an expression is an array</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#contextp">context?</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">checks if an expression is a context</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#directoryp">directory?</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">checks if a disk node is a directory</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#emptyp">empty?</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">checks if a list or string is empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#evenp">even?</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">checks the parity of an integer number</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#filep">file?</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">checks if a file exists</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#floatp">float?</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">checks if an expression is a float</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#globalp">global?</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">checks if a symbol is global</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#infp">inf?</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">checks if a floating point value is infinite</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#integerp">integer?</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">checks if an expression is an integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#lambdap">lambda?</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">checks if an expression is a lambda expression</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#legalp">legal?</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">checks if a string contains a legal symbol</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#listp">list?</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">checks if an expression is a list</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#macrop">macro?</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">checks if an expression is a lambda-macro
expression</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#NaNp">NaN?</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">checks if a float is NaN (not a number)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#nilp">nil?</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">checks if an expression is <span class="monospaced">nil</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#nullp">null?</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">checks if an expression is <span class="monospaced">nil</span>, <span class="monospaced">""</span>, <span class="monospaced">()</span>, <span class="monospaced">0</span>
or <span class="monospaced">0.0</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#numberp">number?</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">checks if an expression is a float or an
integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#oddp">odd?</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">checks the parity of an integer number</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#protectedp">protected?</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">checks if a symbol is protected</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#primitivep">primitive?</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">checks if an expression is a primitive</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#quotep">quote?</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">checks if an expression is quoted</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#stringp">string?</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">checks if an expression is a string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#symbolp">symbol?</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">checks if an expression is a symbol</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#truep">true?</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">checks if an expression is not <span class="monospaced">nil</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#zerop">zero?</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">checks if an expression is <span class="monospaced">0</span> or <span class="monospaced">0.0</span></p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_date_and_time_functions">Date and time functions</h4>
<table class="tableblock frame-all grid-all"
style="
width:60%;
">
<col style="width:16%;">
<col style="width:83%;">
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#date">date</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">converts a date-time value to a string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#date-list">date-list</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">returns a list of year, month, day, hours,
minutes, seconds from a time value in seconds</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#date-parse">date-parse</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">parses a date string and returns the
number of seconds passed since January 1, 1970, (formerly <span class="monospaced">parse-date</span>)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#date-value">date-value</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">calculates the time in seconds since
January 1, 1970 for a date and time</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#now">now</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">returns a list of current date-time information</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#time">time</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">calculates the time it takes to evaluate an
expression in milliseconds</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#time-of-day">time-of-day</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">calculates the number of milliseconds
elapsed since the day started</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_statistics_simulation_and_modeling_functions">Statistics, simulation and modeling functions</h4>
<table class="tableblock frame-all grid-all"
style="
width:60%;
">
<col style="width:16%;">
<col style="width:83%;">
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#amb">amb</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">randomly selects an argument and evaluates it</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#bayes-query">bayes-query</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">calculates Bayesian probabilities for a
data set</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#bayes-train">bayes-train</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">counts items in lists for Bayesian or
frequency analysis</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#corr">corr</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">calculates the <em>product-moment correlation</em>
coefficient</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#crit-chi2">crit-chi2</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">calculates the <em>Chi²</em> statistic for a given
probability</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#crit-f">crit-f</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">calculates the <em>F</em> statistic for a given
probability</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#crit-t">crit-t</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">calculates the <em>Student&#8217;s t</em> statistic for a
given probability</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#crit-z">crit-z</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">calculates the normal distributed <em>Z</em> for a given
probability</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#normal">normal</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">makes a list of normal distributed floating point
numbers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#prob-chi2">prob-chi2</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">calculates the tail probability of a <em>Chi²</em>
distribution value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#prob-f">prob-f</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">calculates the tail probability of a <em>F</em>
distribution value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#prob-t">prob-t</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">calculates the tail probability of a <em>Student&#8217;s
t</em> distribution value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#prob-z">prob-z</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">calculates the cumulated probability of a <em>Z</em>
distribution value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#rand">rand</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">generates random numbers in a range</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#random">random</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">generates a list of evenly distributed floats</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#randomize">randomize</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">shuffles all of the elements in a list</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#seed">seed</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">seeds the internal random number generator</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#stats">stats</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">calculates some basic statistics for a data vector</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#t-test">t-test</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">performs a t-test on dependent or independent
data samples</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_pattern_matching">Pattern matching</h4>
<table class="tableblock frame-all grid-all"
style="
width:60%;
">
<col style="width:16%;">
<col style="width:83%;">
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#ends-with">ends-with</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">tests if a list or string ends with a
pattern</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#find">find</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">searches for a pattern in a list or string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#find-all">find-all</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">finds all occurrences of a pattern in a
string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#match">match</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">matches list patterns</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#parse">parse</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">breaks a string along around patterns</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#ref">ref</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">returns the position of an element inside a nested list</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#ref-all">ref-all</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">returns a list of index vectors of elements
inside a nested list</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#regex">regex</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">finds patterns in a string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#replace">replace</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">replaces patterns in a string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#search">search</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">searches for a pattern in a file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#starts-with">starts-with</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">tests if a list or string starts with a
pattern</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#unify">unify</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">performs a logical unification of patterns</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_financial_math_functions">Financial math functions</h4>
<table class="tableblock frame-all grid-all"
style="
width:60%;
">
<col style="width:16%;">
<col style="width:83%;">
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#fv">fv</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">returns the future value of an investment</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#irr">irr</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">calculates the internal rate of return</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#nper">nper</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">calculates the number of periods for an investment</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#npv">npv</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">calculates the net present value of an investment</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#pv">pv</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">calculates the present value of an investment</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#pmt">pmt</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">calculates the payment for a loan</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_input_output_and_file_operations">Input/output and file operations</h4>
<table class="tableblock frame-all grid-all"
style="
width:60%;
">
<col style="width:16%;">
<col style="width:83%;">
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#append-file">append-file</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">appends data to a file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#close">close</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">closes a file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#current-line">current-line</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">retrieves contents of last read-line
buffer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#device">device</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">sets or inquires about current print device</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#exec">exec</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">launches another program, then reads from or writes
to it</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#load">load</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">loads and evaluates a file of newLISP code</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#open">open</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">opens a file for reading or writing</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#peek">peek</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">checks file descriptor for number of bytes ready for
reading</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#print">print</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">prints to the console or a device</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#println">println</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">prints to the console or a device with a
line-feed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#read">read</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">reads binary data from a file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#read-char">read-char</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">reads an 8-bit character from a file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#read-file">read-file</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">reads a whole file in one operation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#read-key">read-key</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">reads a keyboard key</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#read-line">read-line</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">reads a line from the console or file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#read-utf8">read-utf8</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">reads UTF-8 character from a file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#save">save</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">saves a workspace, context, or symbol to a file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#search">search</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">searches a file for a string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#seek">seek</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">sets or reads a file position</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#write">write</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">writes binary data to a file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#write-char">write-char</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">writes a character to a file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#write-file">write-file</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">writes a file in one operation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#write-line">write-line</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">writes a line to the console or a file</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_processes_and_the_cilk_api">Processes and the Cilk API</h4>
<table class="tableblock frame-all grid-all"
style="
width:60%;
">
<col style="width:16%;">
<col style="width:83%;">
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#shell">!</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">shells out to the operating system</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#abort">abort</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">aborts a child process started with <span class="monospaced">spawn</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#destroy">destroy</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">destroys a process created with <span class="monospaced">fork</span> or
<span class="monospaced">process</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#exec">exec</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">runs a process, then reads from or writes to it</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#fork">fork</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">launches a newLISP child process</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#pipe">pipe</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">creates a pipe for interprocess communication</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#process">process</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">launches a child process, remapping standard
I/O and standard error</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#receive">receive</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">receive a message from another process</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#semaphore">semaphore</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">creates and controls semaphores</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#send">send</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">send a message to another process</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#share">share</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">shares memory with other processes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#spawn">spawn</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">launches a child process for Cilk process
management</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#sync">sync</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">waits for child processes launched with <span class="monospaced">spawn</span> and
collects results</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#wait-pid">wait-pid</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">waits for a child process to end</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_file_and_directory_management">File and directory management</h4>
<table class="tableblock frame-all grid-all"
style="
width:60%;
">
<col style="width:16%;">
<col style="width:83%;">
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#change-dir">change-dir</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">changes to a different drive and
directory</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#copy-file">copy-file</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">copies a file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#delete-file">delete-file</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">deletes a file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#directory">directory</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">returns a list of directory entries</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#file-info">file-info</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">gets file size, date, time, and attributes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#make-dir">make-dir</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">makes a new directory</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#real-path">real-path</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">returns the full path of the relative file
path</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#remove-dir">remove-dir</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">removes an empty directory</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#rename-file">rename-file</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">renames a file or directory</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_http_networking_api">HTTP networking API</h4>
<table class="tableblock frame-all grid-all"
style="
width:60%;
">
<col style="width:16%;">
<col style="width:83%;">
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#base64-enc">base64-enc</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">encodes a string into BASE64 format</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#base64-dec">base64-dec</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">decodes a string from BASE64 format</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#delete-url">delete-url</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">deletes a file or page from the web</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#get-url">get-url</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">reads a file or page from the web</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#post-url">post-url</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">posts info to a URL address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#put-url">put-url</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">uploads a page to a URL address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#xfer-event">xfer-event</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">registers an event handler for HTTP byte
transfers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#xml-error">xml-error</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">returns last XML parse error</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#xml-parse">xml-parse</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">parses an XML document</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#xml-type-tags">xml-type-tags</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">shows or modifies XML type tags</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_socket_tcp_ip_udp_and_icmp_network_api">Socket TCP/IP, UDP and ICMP network API</h4>
<table class="tableblock frame-all grid-all"
style="
width:60%;
">
<col style="width:16%;">
<col style="width:83%;">
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#net-accept">net-accept</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">accepts a new incoming connection</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#net-close">net-close</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">closes a socket connection</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#net-connect">net-connect</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">connects to a remote host</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#net-error">net-error</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">returns the last error</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#net-eval">net-eval</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">evaluates expressions on multiple remote
newLISP servers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#net-interface">net-interface</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Sets the default interface IP
address on multihomed computers.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#net-ipv">net-ipv</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Switches between IPv4 and IPv6 internet
protocol versions.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#net-listen">net-listen</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">listens for connections to a local socket</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#net-local">net-local</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">returns the local IP and port number for a
connection</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#net-lookup">net-lookup</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">returns the name for an IP number</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#net-packet">net-packet</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">send a custom configured IP packet over
raw sockets</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#net-peek">net-peek</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">returns the number of characters ready to be
read from a network socket</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#net-peer">net-peer</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">returns the remote IP and port for a net
connect</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#net-ping">net-ping</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">sends a ping packet (ICMP echo request) to
one or more addresses</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#net-receive">net-receive</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">reads data on a socket connection</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#net-receive-from">net-receive-from</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">reads a UDP on an open
connection</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#net-receive-udp">net-receive-udp</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">reads a UDP and closes the
connection</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#net-select">net-select</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">checks a socket or list of sockets for
status</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#net-send">net-send</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">sends data on a socket connection</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#net-send-to">net-send-to</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">sends a UDP on an open connection</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#net-send-udp">net-send-udp</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">sends a UDP and closes the connection</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#net-service">net-service</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">translates a service name into a port
number</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#net-sessions">net-sessions</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">returns a list of currently open
connections</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_reflection_and_customization">Reflection and customization</h4>
<table class="tableblock frame-all grid-all"
style="
width:60%;
">
<col style="width:16%;">
<col style="width:83%;">
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#command-event">command-event</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">pre-processes the command-line and
HTTP requests</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#error-event">error-event</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">defines an error handler</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#last-error">last-error</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">report the last error number and text</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#ostype">ostype</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">contains a string describing the OS platform</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#prefix">prefix</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Returns the context prefix of a symbol</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#prompt-event">prompt-event</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">customizes the interactive newLISP
shell prompt</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#read-expr">read-expr</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">reads and translates s-expressions from
source</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#reader-event">reader-event</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">preprocess expressions before
evaluation event-driven</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#set-locale">set-locale</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">switches to a different locale</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#source">source</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">returns the source required to bind a symbol to a
string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#sys-error">sys-error</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">reports OS system error numbers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#sys-info">sys-info</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">gives information about system resources</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#term">term</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">returns the term part of a symbol or its context as a
string</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_system_functions">System functions</h4>
<table class="tableblock frame-all grid-all"
style="
width:60%;
">
<col style="width:16%;">
<col style="width:83%;">
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#systemsymbol">$</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">accesses system variables $0 &#8594; $15</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#callback">callback</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">registers a callback function for an imported
library</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#catch">catch</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">evaluates an expression, catching errors and early
returns</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#context">context</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">creates or switches to a different namespace</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#copy">copy</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">copies the result of an evaluation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#debug">debug</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">debugs a user-defined function</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#delete">delete</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">deletes symbols from the symbol table</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#default">default</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">returns the contents of a default functor from
a context</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#env">env</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">gets or sets the operating system&#8217;s environment</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#exit">exit</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">exits newLISP, setting the exit value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#global">global</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">makes a symbol accessible outside MAIN</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#import">import</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">imports a function from a shared library</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#main-args">main-args</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">gets command-line arguments</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#new">new</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">creates a copy of a context</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#pretty-print">pretty-print</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">changes the pretty-printing
characteristics</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#read-expr">read-expr</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">translates a string to an s-expression
without evaluating it</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#reset">reset</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">goes to the top level</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#signal">signal</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">sets a signal handler</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#sleep">sleep</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">suspends processing for specified milliseconds</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#sym">sym</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">creates a symbol from a string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#symbols">symbols</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">returns a list of all symbols in the system</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#throw">throw</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">causes a previous <a href="#catch">catch</a> to return</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#throw-error">throw-error</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">throws a user-defined error</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#timer">timer</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">starts a one-shot timer, firing an event</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#trace">trace</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">sets or inquires about trace mode</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#trace-highlight">trace-highlight</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">sets highlighting strings in
trace mode</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_importing_libraries">Importing libraries</h4>
<table class="tableblock frame-all grid-all"
style="
width:60%;
">
<col style="width:16%;">
<col style="width:83%;">
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#address">address</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">returns the memory address of a number or
string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#callback">callback</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">registers a callback function for an imported
library</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#flt">flt</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">converts a number to a 32-bit integer representing a
float</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#float">float</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">translates a string or integer into a floating
point number</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#get-char">get-char</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">gets a character from a memory address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#get-float">get-float</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">gets a double float from a memory address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#get-int">get-int</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">gets a 32-bit integer from a memory address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#get-long">get-long</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">gets a long 64-bit integer from a memory
address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#get-string">get-string</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">gets a string from a memory address</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#import">import</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">imports a function from a shared library</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#int">int</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">translates a string or float into an integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#pack">pack</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">packs newLISP expressions into a binary structure</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#struct">struct</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Defines a data structure with C types</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#unpack">unpack</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">unpacks a binary structure into newLISP
expressions</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_newlisp_internals_api">newLISP internals API</h4>
<table class="tableblock frame-all grid-all"
style="
width:60%;
">
<col style="width:16%;">
<col style="width:83%;">
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#command-event">command-event</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">pre-processes the command-line and
HTTP requests</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#cpymem">cpymem</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">copies memory between addresses</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#dump">dump</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">shows memory address and contents of newLISP cells</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#prompt-event">prompt-event</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">customizes the interactive newLISP
shell prompt</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#read-expr">read-expr</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">reads and translates s-expressions from
source</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><a href="#reader-event">reader-event</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">preprocess expressions before
evaluation event-driven</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_4_functions_in_alphabetical_order">4. Functions in alphabetical order</h3>
<div class="paragraph"><p><a id="!"></a></p></div>
<div class="sect3">
<h4 id="_span_class_big_red_span"><span class="big red">!</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (! <em>str-shell-command</em> [<em>int-flags</em>])</p></div>
<div class="paragraph"><p>Executes the command in <em>str-shell-command</em> by shelling out to the operating
system and executing. This function returns a different value depending
on the host operating system.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="nv">!</span> <span class="s">&quot;vi&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="nv">!</span> <span class="s">&quot;ls -ltr&quot;</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Use the <a href="#exec">exec</a> function to execute a shell command and capture
the standard output or to feed standard input. The
<a href="#process">process</a> function may be used to launch a non-blocking
child process and redirect std I/O and std error to pipes.</p></div>
<div class="paragraph"><p>On Ms Windows the optional <em>int-flags</em> parameter takes process creation
flags as defined for the Windows <span class="monospaced">CreateProcessA</span> function to control
various parameters of process creation. The inclusion of this parameter
– which also can be <span class="monospaced">0</span> – forces a different creation of the process
without a command shell window. This parameter is ignored on Unix.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">; on MS Windows</span>
<span class="c1">; close the console of the currently running newLISP process</span>
<span class="p">(</span><span class="k">apply</span> <span class="p">(</span><span class="k">import</span> <span class="s">&quot;kernel32&quot;</span> <span class="s">&quot;FreeConsole&quot;</span><span class="p">))</span>

<span class="c1">; start another process and wait for it to finish</span>
<span class="p">(</span><span class="nv">!</span> <span class="s">&quot;notepad.exe&quot;</span> <span class="ss">0</span><span class="p">)</span>

<span class="p">(</span><span class="k">exit</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Without the additional parameter, the <span class="monospaced">!</span> call would create a new
command window replacing the closed one.</p></div>
<div class="paragraph"><p>Note that <span class="monospaced">!</span> (exclamation mark) can be also be used as a command-line
shell operator by omitting the parenthesis and space after the <span class="monospaced">!</span>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="ss">&gt;</span> <span class="k">!</span><span class="ss">ls</span> <span class="k">-</span><span class="ss">ltr</span>    <span class="c1">; executed in the newLISP shell window</span>
</pre></div></div></div>
<div class="paragraph"><p>Used in this way, the <span class="monospaced">!</span> operator is not a newLISP function at all, but
rather a special feature of the newLISP command shell. The <span class="monospaced">!</span> must be
entered as the first character on the command-line.</p></div>
<div class="paragraph"><p><a id="$"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_span_2"><span class="big red">$</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> ($ <em>int-idx</em>)</p></div>
<div class="paragraph"><p>The functions that use regular expressions (<a href="#directory">directory</a>,
<a href="#ends-with">ends-with</a>, <a href="#find">find</a>, <a href="#parse">parse</a>,
<a href="#regex">regex</a>, <a href="#search">search</a>, <a href="#starts-with">starts-with</a>
and <a href="#replace">replace</a>) all bind their results to the predefined
system variables <span class="monospaced">$0</span>, <span class="monospaced">$1</span>, <span class="monospaced">$2`–</span>$15` after or during the function&#8217;s
execution. System variables can be treated the same as any other symbol.
As an alternative, the contents of these variables may also be accessed
by using <span class="monospaced">($ 0)</span>, <span class="monospaced">($ 1)</span>, <span class="monospaced">($ 2)</span>, etc. This method allows indexed
access (i.e., <span class="monospaced">($ i)</span>, where <span class="monospaced">i</span> is an integer).</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">str</span>  <span class="s">&quot;http://newlisp.org:80&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">find</span> <span class="s">&quot;http://(.*):(.*)&quot;</span> <span class="ss">str</span> <span class="ss">0</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">0</span>

<span class="k">$</span><span class="ss">0</span>  <span class="err">→</span> <span class="s">&quot;http://newlisp.org:80&quot;</span>
<span class="k">$</span><span class="ss">1</span>  <span class="err">→</span> <span class="s">&quot;newlisp.org&quot;</span>
<span class="k">$</span><span class="ss">2</span>  <span class="err">→</span> <span class="s">&quot;80&quot;</span>

<span class="p">(</span><span class="nv">$</span> <span class="ss">0</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;http://newlisp.org:80&quot;</span>
<span class="p">(</span><span class="nv">$</span> <span class="ss">1</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;newlisp.org&quot;</span>
<span class="p">(</span><span class="nv">$</span> <span class="ss">2</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;80&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p><a id="+"></a>
<a id="-"></a>
<a id="*"></a>
<a id="/"></a>
<a id="%"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_span_3"><span class="big red">+, -, *, /, %</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (+ <em>int-1</em> [<em>int-2</em> &#8230; ])</p></div>
<div class="paragraph"><p>Returns the sum of all numbers in <em>int-1</em> --.</p></div>
<div class="paragraph"><p><strong>syntax:</strong> (- <em>int-1</em> [<em>int-2</em> &#8230; ])</p></div>
<div class="paragraph"><p>Subtracts <em>int-2</em> from <em>int-1</em>, then the next <em>int-i</em> from the previous
result. If only one argument is given, its sign is reversed.</p></div>
<div class="paragraph"><p><strong>syntax:</strong> (* <em>int-1</em> [<em>int-2</em> &#8230; ])</p></div>
<div class="paragraph"><p>The product is calculated for <em>int-1</em> to <em>int-i</em>.</p></div>
<div class="paragraph"><p><strong>syntax:</strong> (/ <em>int-1</em> [<em>int-2</em> &#8230; ])</p></div>
<div class="paragraph"><p>Each result is divided successively until the end of the list is
reached. Division by zero causes an error.</p></div>
<div class="paragraph"><p><strong>syntax:</strong> (% <em>int-1</em> [<em>int-2</em> &#8230; ])</p></div>
<div class="paragraph"><p>Each result is divided successively by the next <em>int</em>, then the rest
(modulo operation) is returned. Division by zero causes an error. For
floating point numbers, use the <a href="#mod">mod</a> function.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="nv">+</span> <span class="ss">1</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">4</span> <span class="ss">5</span><span class="p">)</span>        <span class="err">→</span> <span class="ss">15</span>
<span class="p">(</span><span class="nv">+</span> <span class="ss">1</span> <span class="ss">2</span> <span class="p">(</span><span class="nv">-</span> <span class="ss">5</span> <span class="ss">2</span><span class="p">)</span> <span class="ss">8</span><span class="p">)</span>    <span class="err">→</span> <span class="ss">14</span>
<span class="p">(</span><span class="nv">-</span> <span class="ss">10</span> <span class="ss">3</span> <span class="ss">2</span> <span class="ss">1</span><span class="p">)</span>         <span class="err">→</span> <span class="ss">4</span>
<span class="p">(</span><span class="nv">-</span> <span class="p">(</span><span class="nv">*</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">)</span> <span class="ss">6</span> <span class="ss">1</span> <span class="ss">2</span><span class="p">)</span>    <span class="err">→</span> <span class="ss">3</span>
<span class="p">(</span><span class="nv">-</span> <span class="ss">123</span><span class="p">)</span>              <span class="err">→</span> <span class="k">-</span><span class="ss">123</span>
<span class="p">(</span><span class="k">map</span> <span class="ss">-</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">10</span> <span class="ss">20</span> <span class="ss">30</span><span class="p">))</span>  <span class="err">→</span> <span class="p">(</span><span class="k">-</span><span class="ss">10</span> <span class="k">-</span><span class="ss">20</span> <span class="k">-</span><span class="ss">30</span><span class="p">)</span>
<span class="p">(</span><span class="nv">*</span> <span class="ss">1</span> <span class="ss">2</span> <span class="ss">3</span><span class="p">)</span>            <span class="err">→</span> <span class="ss">6</span>
<span class="p">(</span><span class="nv">*</span> <span class="ss">10</span> <span class="p">(</span><span class="nv">-</span> <span class="ss">8</span> <span class="ss">2</span><span class="p">))</span>       <span class="err">→</span> <span class="ss">60</span>
<span class="p">(</span><span class="nv">/</span> <span class="ss">12</span> <span class="ss">3</span><span class="p">)</span>             <span class="err">→</span> <span class="ss">4</span>
<span class="p">(</span><span class="nv">/</span> <span class="ss">120</span> <span class="ss">3</span> <span class="ss">20</span> <span class="ss">2</span><span class="p">)</span>       <span class="err">→</span> <span class="ss">1</span>
<span class="p">(</span><span class="nv">%</span> <span class="ss">10</span> <span class="ss">3</span><span class="p">)</span>             <span class="err">→</span> <span class="ss">1</span>
<span class="p">(</span><span class="nv">%</span> <span class="k">-</span><span class="ss">10</span> <span class="ss">3</span><span class="p">)</span>            <span class="err">→</span> <span class="k">-</span><span class="ss">1</span>
<span class="p">(</span><span class="nv">+</span> <span class="ss">1.2</span> <span class="ss">3.9</span><span class="p">)</span>          <span class="err">→</span> <span class="ss">4</span>
</pre></div></div></div>
<div class="paragraph"><p>Floating point values in arguments to <span class="monospaced">+</span>, <span class="monospaced">-</span>, <span class="monospaced">*</span>, <span class="monospaced">/</span>, and <span class="monospaced">%</span> are
truncated to the integer value closest to <span class="monospaced">0</span> (zero).</p></div>
<div class="paragraph"><p>Floating point values larger or smaller than the maximum
(<span class="monospaced">9,223,372,036,854,775,807</span>) or minimum (<span class="monospaced">-9,223,372,036,854,775,808</span>)
integer values are truncated to those values. This includes the values
for <span class="monospaced">+Inf</span> and <span class="monospaced">-Inf</span>.</p></div>
<div class="paragraph"><p>Calculations resulting in values larger than <span class="monospaced">9,223,372,036,854,775,807</span>
or smaller than <span class="monospaced">-9,223,372,036,854,775,808</span> wrap around from positive
to negative or negative to positive.</p></div>
<div class="paragraph"><p>Floating point values that evaluate to <span class="monospaced">NaN</span> (Not a Number), ar treated
as <span class="monospaced">0</span> (zero).</p></div>
<div class="paragraph"><p><a id="++"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_a_href_destructive_a_span"><span class="big red">++ <a href="#destructive">!</a></span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (++ <em>place</em> [<em>num</em> &#8230; ])</p></div>
<div class="paragraph"><p>The <span class="monospaced">++</span> operator works like <a href="#inc">inc</a>, but performs integer
arithmetic. Without the optional argument in <em>num</em>, <span class="monospaced">++</span> increments the
number in <em>place</em> by <span class="monospaced">1</span>.</p></div>
<div class="paragraph"><p>If floating point numbers are passed as arguments, their fractional part
gets truncated first.</p></div>
<div class="paragraph"><p>Calculations resulting in numbers greater than 9,223,372,036,854,775,807
wrap around to negative numbers. Results smaller than
-9,223,372,036,854,775,808 wrap around to positive numbers.</p></div>
<div class="paragraph"><p><em>place</em> is either a symbol or a place in a list structure holding a
number, or a number returned by an expression.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">x</span> <span class="ss">1</span><span class="p">)</span>
<span class="p">(</span><span class="nv">++</span> <span class="ss">x</span><span class="p">)</span>        <span class="err">→</span> <span class="ss">2</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">x</span> <span class="ss">3.8</span><span class="p">)</span>
<span class="p">(</span><span class="nv">++</span> <span class="ss">x</span><span class="p">)</span>        <span class="err">→</span> <span class="ss">4</span>
<span class="p">(</span><span class="nv">++</span> <span class="ss">x</span> <span class="ss">1.3</span><span class="p">)</span>    <span class="err">→</span> <span class="ss">5</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">lst</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">3</span><span class="p">))</span>
<span class="p">(</span><span class="nv">++</span> <span class="p">(</span><span class="nv">lst</span> <span class="ss">1</span><span class="p">)</span> <span class="ss">2</span><span class="p">))</span>  <span class="err">→</span> <span class="ss">4</span>
<span class="ss">lst</span>              <span class="err">→</span> <span class="p">(</span><span class="nv">1</span> <span class="ss">4</span> <span class="ss">3</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>If the symbol for <em>place</em> contains <span class="monospaced">nil</span>, it is treated as if containing
<span class="monospaced">0</span>.</p></div>
<div class="paragraph"><p>See <a href="#deci">--</a> for decrementing numbers in integer mode. See
<a href="#inc">inc</a> for incrementing numbers in floating point mode.</p></div>
<div class="paragraph"><p><a id="--"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_a_href_destructive_a_span_2"><span class="big red">-- <a href="#destructive">!</a></span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (-- <em>place</em> [<em>num</em> &#8230; ])</p></div>
<div class="paragraph"><p>The <span class="monospaced">--</span> operator works like <a href="#inc">dec</a>, but performs integer
arithmetic. Without the optional argument in <em>num-2</em>, <span class="monospaced">--</span> decrements
the number in <em>place</em> by <span class="monospaced">1</span>.</p></div>
<div class="paragraph"><p>If floating point numbers are passed as arguments, their fractional part
gets truncated first.</p></div>
<div class="paragraph"><p>Calculations resulting in numbers greater than 9,223,372,036,854,775,807
wrap around to negative numbers. Results smaller than
-9,223,372,036,854,775,808 wrap around to positive numbers.</p></div>
<div class="paragraph"><p><em>place</em> is either a symbol or a place in a list structure holding a
number, or a number returned by an expression.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">x</span> <span class="ss">1</span><span class="p">)</span>
<span class="p">(</span><span class="nv">--</span> <span class="ss">x</span><span class="p">)</span>        <span class="err">→</span> <span class="ss">0</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">x</span> <span class="ss">3.8</span><span class="p">)</span>
<span class="p">(</span><span class="nv">--</span> <span class="ss">x</span><span class="p">)</span>        <span class="err">→</span> <span class="ss">2</span>
<span class="p">(</span><span class="nv">--</span> <span class="ss">x</span> <span class="ss">1.3</span><span class="p">)</span>    <span class="err">→</span> <span class="ss">1</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">lst</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">3</span><span class="p">))</span>
<span class="p">(</span><span class="nv">--</span> <span class="p">(</span><span class="nv">lst</span> <span class="ss">1</span><span class="p">)</span> <span class="ss">2</span><span class="p">))</span>  <span class="err">→</span> <span class="ss">0</span>
<span class="ss">lst</span>              <span class="err">→</span> <span class="p">(</span><span class="nv">1</span> <span class="ss">0</span> <span class="ss">3</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>If the symbol for <em>place</em> contains <span class="monospaced">nil</span>, it is treated as if containing
<span class="monospaced">0</span>.</p></div>
<div class="paragraph"><p>See <a href="#inci">++</a> for incrementing numbers in integer mode. See
<a href="#dec">dec</a> for decrementing numbers in floating point mode.</p></div>
<div class="paragraph"><p><a id="&lt;"></a>
<a id="&gt;"></a>
<a id="="></a>
<a id="&#8656;"></a>
<a id="&gt;="></a>
<a id="!="></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_lt_gt_8656_gt_span"><span class="big red">&lt;, &gt;, =, &#8656;, &gt;=, !=</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (&lt; <em>exp-1</em> [<em>exp-2</em> &#8230; ])<br>
<strong>syntax:</strong> (&gt; <em>exp-1</em> [<em>exp-2</em> &#8230; ])<br>
<strong>syntax:</strong> (= <em>exp-1</em> [<em>exp-2</em> &#8230; ])<br>
<strong>syntax:</strong> (&#8656; <em>exp-1</em> [<em>exp-2</em> &#8230; ])<br>
<strong>syntax:</strong> (&gt;= <em>exp-1</em> [<em>exp-2</em> &#8230; ])<br>
<strong>syntax:</strong> (!= <em>exp-1</em> [<em>exp-2</em> &#8230; ])</p></div>
<div class="paragraph"><p>Expressions are evaluated and the results are compared successively. As
long as the comparisons conform to the comparison operators, evaluation
and comparison will continue until all arguments are tested and the
result is <span class="monospaced">true</span>. As soon as one comparison fails, <span class="monospaced">nil</span> is returned.</p></div>
<div class="paragraph"><p>If only one argument is supplied, all comparison operators assume <span class="monospaced">0</span>
(zero) as a second argument. This can be used to check if a numer is
negative, positive, zero or not zero.</p></div>
<div class="paragraph"><p>All types of expressions can be compared: atoms, numbers, symbols, and
strings. List expressions can also be compared (list elements are
compared recursively).</p></div>
<div class="paragraph"><p>When comparing lists, elements at the beginning of the list are
considered more significant than the elements following (similar to
characters in a string). When comparing lists of different lengths but
equal elements, the longer list is considered greater (see examples).</p></div>
<div class="paragraph"><p>In mixed-type expressions, the types are compared from lowest to
highest. Floats and integers are compared by first converting them to
the needed type, then comparing them as numbers.</p></div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph"><p><strong>Atoms:</strong> nil, true, integer or float, string, symbol, primitive<br>
<strong>Lists:</strong> quoted list/expression, list/expression, lambda, lambda-macro</p></div>
</div></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="nv">&lt;</span> <span class="ss">3</span> <span class="ss">5</span> <span class="ss">8</span> <span class="ss">9</span><span class="p">)</span>                     <span class="err">→</span> <span class="k">true</span>
<span class="p">(</span><span class="nv">&gt;</span> <span class="ss">4</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">6</span><span class="p">)</span>                     <span class="err">→</span> <span class="k">nil</span>
<span class="p">(</span><span class="nv">&lt;</span> <span class="s">&quot;a&quot;</span> <span class="s">&quot;c&quot;</span> <span class="s">&quot;d&quot;</span><span class="p">)</span>                 <span class="err">→</span> <span class="k">true</span>
<span class="p">(</span><span class="nv">&gt;=</span> <span class="ss">duba</span> <span class="ss">aba</span><span class="p">)</span>                   <span class="err">→</span> <span class="k">true</span>
<span class="p">(</span><span class="nv">&lt;</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">3</span> <span class="ss">4</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1</span> <span class="ss">5</span><span class="p">))</span>               <span class="err">→</span> <span class="k">nil</span>
<span class="p">(</span><span class="nv">&gt;</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">3</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1</span> <span class="ss">2</span><span class="p">))</span>             <span class="err">→</span> <span class="k">true</span>
<span class="p">(</span><span class="nv">=</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">5</span> <span class="ss">7</span> <span class="ss">8</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">5</span> <span class="ss">7</span> <span class="ss">8</span><span class="p">))</span>           <span class="err">→</span> <span class="k">true</span>
<span class="p">(</span><span class="nv">!=</span> <span class="ss">1</span> <span class="ss">4</span> <span class="ss">3</span> <span class="ss">7</span> <span class="ss">3</span><span class="p">)</span>                  <span class="err">→</span> <span class="k">true</span>
<span class="p">(</span><span class="nv">&lt;</span> <span class="ss">1.2</span> <span class="ss">6</span> <span class="s">&quot;Hello&quot;</span> <span class="o">&#39;</span><span class="ss">any</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">3</span><span class="p">))</span>           <span class="err">→</span> <span class="k">true</span>
<span class="p">(</span><span class="nv">&lt;</span> <span class="k">nil</span> <span class="k">true</span><span class="p">)</span>                              <span class="err">→</span> <span class="k">true</span>
<span class="p">(</span><span class="nv">&lt;</span> <span class="o">&#39;</span><span class="p">(((</span><span class="nv">a</span> <span class="ss">b</span><span class="p">)))</span> <span class="o">&#39;</span><span class="p">(((</span><span class="nv">b</span> <span class="ss">c</span><span class="p">))))</span>                 <span class="err">→</span> <span class="k">true</span>
<span class="p">(</span><span class="nv">&lt;</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">a</span> <span class="p">(</span><span class="nv">b</span> <span class="ss">c</span><span class="p">))</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="p">(</span><span class="nv">b</span> <span class="ss">d</span><span class="p">))</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="p">(</span><span class="nv">b</span> <span class="p">(</span><span class="nv">d</span><span class="p">)))))</span>  <span class="err">→</span> <span class="k">true</span>

<span class="c1">; with single argument compares against 0</span>

<span class="p">(</span><span class="nv">&gt;</span> <span class="ss">1</span><span class="p">)</span>    <span class="err">→</span> <span class="k">true</span> <span class="c1">; checks for positive</span>
<span class="p">(</span><span class="nv">&gt;</span> <span class="k">-</span><span class="ss">1</span><span class="p">)</span>   <span class="err">→</span> <span class="k">nil</span> <span class="c1">; checks for negative</span>
<span class="p">(</span><span class="nv">=</span> <span class="ss">123</span><span class="p">)</span>  <span class="err">→</span> <span class="k">nil</span> <span class="c1">; checks for zero</span>

<span class="p">(</span><span class="k">map</span> <span class="ss">&gt;</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1</span> <span class="ss">3</span> <span class="k">-</span><span class="ss">4</span> <span class="k">-</span><span class="ss">3</span> <span class="ss">1</span> <span class="ss">2</span><span class="p">))</span>   <span class="err">→</span> <span class="p">(</span><span class="k">true</span> <span class="k">true</span> <span class="k">nil</span> <span class="k">nil</span> <span class="k">true</span> <span class="k">true</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p><a id="<a href="#></a> <a id=">[></a> <a id=]</a>"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_lt_lt_gt_gt_span"><span class="big red">&lt;&lt;, &gt;&gt;</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (&lt;&lt; <em>int-1</em> <em>int-2</em> [<em>int-3</em> &#8230; ])<br>
<strong>syntax:</strong> (&gt;&gt; <em>int-1</em> <em>int-2</em> [<em>int-3</em> &#8230; ])<br>
<strong>syntax:</strong> (&lt;&lt; <em>int-1</em>)<br>
<strong>syntax:</strong> (&gt;&gt; <em>int-1</em>)</p></div>
<div class="paragraph"><p>The number <em>int-1</em> is arithmetically shifted to the left or right by the
number of bits given as <em>int-2</em>, then shifted by <em>int-3</em> and so on. For
example, 64-bit integers may be shifted up to 63 positions. When
shifting right, the most significant bit is duplicated (<em>arithmetic
shift</em>):</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="nv">&gt;&gt;</span> <span class="ss">0x8000000000000000</span> <span class="ss">1</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">0xC000000000000000</span>  <span class="c1">; not 0x0400000000000000!</span>
</pre></div></div></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="nv">&lt;&lt;</span> <span class="ss">1</span> <span class="ss">3</span><span class="p">)</span>      <span class="err">→</span>  <span class="ss">8</span>
<span class="p">(</span><span class="nv">&lt;&lt;</span> <span class="ss">1</span> <span class="ss">2</span> <span class="ss">1</span><span class="p">)</span>    <span class="err">→</span>  <span class="ss">8</span>
<span class="p">(</span><span class="nv">&gt;&gt;</span> <span class="ss">1024</span> <span class="ss">10</span><span class="p">)</span>  <span class="err">→</span>  <span class="ss">1</span>
<span class="p">(</span><span class="nv">&gt;&gt;</span> <span class="ss">160</span> <span class="ss">2</span> <span class="ss">2</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">10</span>

<span class="p">(</span><span class="nv">&lt;&lt;</span> <span class="ss">3</span><span class="p">)</span>        <span class="err">→</span>  <span class="ss">6</span>
<span class="p">(</span><span class="nv">&gt;&gt;</span> <span class="ss">8</span><span class="p">)</span>        <span class="err">→</span>  <span class="ss">4</span>
</pre></div></div></div>
<div class="paragraph"><p>When <em>int-1</em> is the only argument <span class="monospaced">&lt;&lt;</span> and <span class="monospaced">&gt;&gt;</span> shift by one bit.</p></div>
<div class="paragraph"><p><a id="&amp;"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_amp_span"><span class="big red">&amp;</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (&amp; <em>int-1</em> <em>int-2</em> [<em>int-3</em> &#8230; ])</p></div>
<div class="paragraph"><p>A bitwise <span class="monospaced">and</span> operation is performed on the number in <em>int-1</em> with the
number in <em>int-2</em>, then successively with <em>int-3</em>, etc.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="nv">&amp;</span> <span class="ss">0xAABB</span> <span class="ss">0x000F</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">11</span>  <span class="c1">; which is 0xB</span>
</pre></div></div></div>
<div class="paragraph"><p><a id="|"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_span_4"><span class="big red">|</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (| <em>int-1</em> <em>int-2</em> [<em>int-3</em> &#8230; ])</p></div>
<div class="paragraph"><p>A bitwise <span class="monospaced">or</span> operation is performed on the number in <em>int-1</em> with the
number in <em>int-2</em>, then successively with <em>int-3</em>, etc.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="nv">|</span> <span class="ss">0x10</span> <span class="ss">0x80</span> <span class="ss">2</span> <span class="ss">1</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">147</span>
</pre></div></div></div>
<div class="paragraph"><p><a id="^"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_span_5"><span class="big red">^</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (^ <em>int-1</em> <em>int-2</em> [<em>int-3</em> &#8230; ])</p></div>
<div class="paragraph"><p>A bitwise <span class="monospaced">xor</span> operation is performed on the number in <em>int-1</em> with the
number in <em>int-2</em>, then successively with <em>int-3</em>, etc.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="nv">^</span> <span class="ss">0xAA</span> <span class="ss">0x55</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">255</span>
</pre></div></div></div>
<div class="paragraph"><p><a id="~"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_span_6"><span class="big red">~</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (~ <em>int</em>)</p></div>
<div class="paragraph"><p>A bitwise <span class="monospaced">not</span> operation is performed on the number in <em>int</em>, reversing
all of the bits.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">format</span> <span class="s">&quot;%X&quot;</span> <span class="p">(</span><span class="nv">~</span> <span class="ss">0xFFFFFFAA</span><span class="p">))</span>  <span class="err">→</span> <span class="s">&quot;55&quot;</span>
<span class="p">(</span><span class="nv">~</span> <span class="ss">0xFFFFFFFF</span><span class="p">)</span>                <span class="err">→</span> <span class="ss">0</span>
</pre></div></div></div>
<div class="paragraph"><p><a id=":"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_span_7"><span class="big red">:</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (: <em>sym-function</em> <em>list-object</em> [ &#8230; ])</p></div>
<div class="paragraph"><p>The colon is used not only as a syntactic separator between between
namespace prefix and the term inside but also as an operator. When used
as an operator, the colon <span class="monospaced">:</span> constructs a context symbol from the
context name in the object list and the symbol following the colon. The
object list in <em>list-object</em> can be followed by other parameters.</p></div>
<div class="paragraph"><p>The <span class="monospaced">:</span> operator implements <em>polymorphism</em> of object methods, which are
part of different object classes represented by contexts (namespaces).
In newLISP, an object is represented by a list, the first element of
which is the symbol (name) of its class context. The class context
implements the functions applicable to the object. No space is required
between the colon and the symbol following it.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">Rectangle</span><span class="o">:</span><span class="ss">area</span><span class="p">)</span>
    <span class="p">(</span><span class="k">mul</span> <span class="p">(</span><span class="k">self</span> <span class="ss">3</span><span class="p">)</span> <span class="p">(</span><span class="k">self</span> <span class="ss">4</span><span class="p">)))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">Circle</span><span class="o">:</span><span class="ss">area</span><span class="p">)</span>
    <span class="p">(</span><span class="k">mul</span> <span class="p">(</span><span class="k">pow</span> <span class="p">(</span><span class="k">self</span> <span class="ss">3</span><span class="p">)</span> <span class="ss">2</span><span class="p">)</span> <span class="p">(</span><span class="k">acos</span> <span class="ss">0</span><span class="p">)</span> <span class="ss">2</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">Rectangle</span><span class="o">:</span><span class="ss">move</span> <span class="ss">dx</span> <span class="ss">dy</span><span class="p">)</span>
    <span class="p">(</span><span class="k">inc</span> <span class="p">(</span><span class="k">self</span> <span class="ss">1</span><span class="p">)</span> <span class="ss">dx</span><span class="p">)</span>
    <span class="p">(</span><span class="k">inc</span> <span class="p">(</span><span class="k">self</span> <span class="ss">2</span><span class="p">)</span> <span class="ss">dy</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">Circle</span><span class="o">:</span><span class="ss">move</span> <span class="ss">p</span> <span class="ss">dx</span> <span class="ss">dy</span><span class="p">)</span>
    <span class="p">(</span><span class="k">inc</span> <span class="p">(</span><span class="k">self</span> <span class="ss">1</span><span class="p">)</span> <span class="ss">dx</span><span class="p">)</span> <span class="p">(</span><span class="k">inc</span> <span class="p">(</span><span class="k">self</span> <span class="ss">2</span><span class="p">)</span> <span class="ss">dy</span><span class="p">))</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">myrect</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">Rectangle</span> <span class="ss">5</span> <span class="ss">5</span> <span class="ss">10</span> <span class="ss">20</span><span class="p">))</span> <span class="c1">; x y width height</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">mycircle</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">Circle</span> <span class="ss">1</span> <span class="ss">2</span> <span class="ss">10</span><span class="p">))</span> <span class="c1">; x y radius</span>

<span class="c1">;; using the : (colon) operator to resolve to a specific context</span>

<span class="p">(</span><span class="o">:</span><span class="ss">area</span> <span class="ss">myrect</span><span class="p">)</span>     <span class="err">→</span> <span class="ss">200</span>
<span class="p">(</span><span class="o">:</span><span class="ss">area</span> <span class="ss">mycircle</span><span class="p">)</span>   <span class="err">→</span> <span class="ss">314.1592654</span>

<span class="c1">;; map class methods uses curry to enclose the colon operator and class function</span>

<span class="p">(</span><span class="k">map</span> <span class="p">(</span><span class="k">curry</span> <span class="o">:</span><span class="ss">area</span><span class="p">)</span> <span class="p">(</span><span class="k">list</span> <span class="ss">myrect</span> <span class="ss">mycircle</span><span class="p">))</span> <span class="err">→</span> <span class="p">(</span><span class="nv">200</span> <span class="ss">314.1592654</span><span class="p">)</span>

<span class="p">(</span><span class="k">map</span> <span class="p">(</span><span class="k">curry</span> <span class="o">:</span><span class="ss">area</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">Rectangle</span> <span class="ss">5</span> <span class="ss">5</span> <span class="ss">10</span> <span class="ss">20</span><span class="p">)</span> <span class="p">(</span><span class="nv">Circle</span> <span class="ss">1</span> <span class="ss">2</span> <span class="ss">10</span><span class="p">)))</span> <span class="err">→</span> <span class="p">(</span><span class="nv">200</span> <span class="ss">314.1592654</span><span class="p">)</span>

<span class="c1">;; change object attributes using a function and re-assigning</span>
<span class="c1">;; to the objects name</span>

<span class="p">(</span><span class="o">:</span><span class="ss">move</span> <span class="ss">myrect</span> <span class="ss">2</span> <span class="ss">3</span><span class="p">)</span>
<span class="ss">myrect</span>   <span class="err">→</span> <span class="p">(</span><span class="nv">Rectangle</span> <span class="ss">7</span> <span class="ss">8</span> <span class="ss">10</span> <span class="ss">20</span><span class="p">)</span>

<span class="p">(</span><span class="o">:</span><span class="ss">move</span> <span class="ss">mycircle</span> <span class="ss">4</span> <span class="ss">5</span><span class="p">)</span>
<span class="ss">mycircle</span> <span class="err">→</span> <span class="p">(</span><span class="nv">Circle</span> <span class="ss">5</span> <span class="ss">7</span> <span class="ss">10</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Inside the FOOP methods the <a href="#self">self</a> function is used to access
the target object of the method.</p></div>
<div class="paragraph"><p><a id="abort"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_abort_span"><span class="big red">abort</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (abort <em>int-pid</em>)<br>
<strong>syntax:</strong> (abort)</p></div>
<div class="paragraph"><p>In the first form, <span class="monospaced">abort</span> aborts a specific child process of the
current parent process giving the process id in <em>int-pid</em>. The process
must have been started using <a href="#spawn">spawn</a>. For processes started
using <a href="#fork">fork</a>, use <a href="#destroy">destroy</a> instead.</p></div>
<div class="paragraph"><p>The function <span class="monospaced">abort</span> is not available on Win32.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">abort</span> <span class="ss">2245</span><span class="p">)</span>  <span class="err">→</span> <span class="k">true</span>
</pre></div></div></div>
<div class="paragraph"><p>To abort all child processes spawned from the current process use
<span class="monospaced">abort</span> without any parameters:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">abort</span><span class="p">)</span>  <span class="err">→</span> <span class="k">true</span> <span class="c1">; abort all</span>
</pre></div></div></div>
<div class="paragraph"><p>The function <span class="monospaced">abort</span> is part of the Cilk API for synchronizing child
processes and process parallelization. See the reference for the
function <a href="#spawn">spawn</a> for a full discussion of the Cilk API.</p></div>
<div class="paragraph"><p><a id="abs"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_abs_span"><span class="big red">abs</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (abs <em>num</em>)</p></div>
<div class="paragraph"><p>Returns the absolute value of the number in <em>num</em>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">abs</span> <span class="k">-</span><span class="ss">3.5</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">3.5</span>
</pre></div></div></div>
<div class="paragraph"><p><a id="acos"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_acos_span"><span class="big red">acos</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (acos <em>num-radians</em>)</p></div>
<div class="paragraph"><p>The arc-cosine function is calculated from the number in <em>num-radians</em>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">acos</span> <span class="ss">1</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">0</span>
<span class="p">(</span><span class="k">cos</span> <span class="p">(</span><span class="k">acos</span> <span class="ss">1</span><span class="p">))</span> <span class="err">→</span> <span class="ss">1</span>
</pre></div></div></div>
<div class="paragraph"><p><a id="acosh"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_acosh_span"><span class="big red">acosh</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (acosh <em>num-radians</em>)</p></div>
<div class="paragraph"><p>Calculates the inverse hyperbolic cosine of <em>num-radians</em>, the value
whose hyperbolic cosine is <em>num-radians</em>. If <em>num-radians</em> is less than
1, <span class="monospaced">acosh</span> returns <span class="monospaced">NaN</span>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">acosh</span> <span class="ss">2</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">1.316957897</span>
<span class="p">(</span><span class="k">cosh</span> <span class="p">(</span><span class="k">acosh</span> <span class="ss">2</span><span class="p">))</span> <span class="err">→</span> <span class="ss">2</span>
<span class="p">(</span><span class="k">acosh</span> <span class="ss">0.5</span><span class="p">)</span> <span class="err">→</span> <span class="ss">NaN</span>
</pre></div></div></div>
<div class="paragraph"><p><a id="add"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_add_span"><span class="big red">add</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (add <em>num-1</em> [<em>num-2</em> &#8230; ])</p></div>
<div class="paragraph"><p>All of the numbers in <em>num-1</em>, <em>num-2</em>, and on are summed. <span class="monospaced">add</span> accepts
float or integer operands, but it always returns a floating point
number. Any floating point calculation with <span class="monospaced">NaN</span> also returns <span class="monospaced">NaN</span>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">add</span> <span class="ss">2</span> <span class="ss">3.25</span> <span class="ss">9</span><span class="p">)</span>   <span class="err">→</span> <span class="ss">14.25</span>
<span class="p">(</span><span class="k">add</span> <span class="ss">1</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">4</span> <span class="ss">5</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">15</span>
</pre></div></div></div>
<div class="paragraph"><p><a id="address"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_address_span"><span class="big red">address</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (address <em>int</em>)<br>
<strong>syntax:</strong> (address <em>float</em>)<br>
<strong>syntax:</strong> (address <em>str</em>)</p></div>
<div class="paragraph"><p>Returns the memory address of the integer in <em>int</em>, the double floating
point number in <em>float</em>, or the string in <em>str</em>. This function is used
for passing parameters to library functions that have been imported
using the <a href="#import">import</a> function.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">s</span> <span class="s">&quot;\001\002\003\004&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">get-char</span> <span class="p">(</span><span class="nv">+</span> <span class="p">(</span><span class="k">address</span> <span class="ss">s</span><span class="p">)</span> <span class="ss">3</span><span class="p">))</span>   <span class="err">→</span> <span class="ss">4</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">x</span> <span class="ss">12345</span><span class="p">)</span> <span class="c1">; x is a 64-bit long int</span>

<span class="c1">; on a big-endian CPU, i.e. PPC or SPARC</span>
<span class="p">(</span><span class="k">get-long</span> <span class="p">(</span><span class="k">address</span> <span class="ss">x</span><span class="p">))</span>         <span class="err">→</span> <span class="ss">12345</span>
<span class="c1">; the 32-bit int is in high 32-bit part of the long int</span>
<span class="p">(</span><span class="k">get-int</span> <span class="p">(</span><span class="nv">+</span> <span class="p">(</span><span class="k">address</span> <span class="ss">x</span><span class="p">)</span> <span class="ss">4</span><span class="p">))</span>    <span class="err">→</span> <span class="ss">12345</span>

<span class="c1">; on a little-endian CPU, i.e. Intel i386</span>
<span class="c1">; the 32-bit int is in the low 32-bit part of the long int</span>
<span class="p">(</span><span class="k">get-int</span> <span class="p">(</span><span class="k">address</span> <span class="ss">x</span><span class="p">))</span>          <span class="err">→</span> <span class="ss">12345</span>

<span class="c1">; on both architectures (integers are 64 bit in newLISP)</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">x</span> <span class="ss">1234567890</span><span class="p">)</span>
<span class="p">(</span><span class="k">get-long</span> <span class="p">(</span><span class="k">address</span> <span class="ss">x</span><span class="p">))</span>         <span class="err">→</span>  <span class="ss">1234567890</span>
</pre></div></div></div>
<div class="paragraph"><p>When a string is passed to C library function the address of the string
is used automatically, and it is not necessary to use the <span class="monospaced">address</span>
function in that case. As the example shows, <span class="monospaced">address</span> can be used to do
pointer arithmetic on the string&#8217;s address.</p></div>
<div class="paragraph"><p><span class="monospaced">address</span> should only be used on persistent addresses from data objects
referred to by a variable symbol, not from volatile intermediate
expression objects.</p></div>
<div class="paragraph"><p>See also the <a href="#get-char">get-char</a>, <a href="#get-int">get-int</a>,
<a href="#get-long">get-long</a> and <a href="#get-float">get-float</a> functions.</p></div>
<div class="paragraph"><p><a id="amb"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_amb_span"><span class="big red">amb</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (amb <em>exp-1</em> [<em>exp-2</em> &#8230; ])</p></div>
<div class="paragraph"><p>One of the expressions <em>exp-1</em> &#8230; <em>n</em> is selected at random, and the
evaluation result is returned.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">amb</span> <span class="o">&#39;</span><span class="ss">a</span> <span class="o">&#39;</span><span class="ss">b</span> <span class="o">&#39;</span><span class="ss">c</span> <span class="o">&#39;</span><span class="ss">d</span> <span class="o">&#39;</span><span class="ss">e</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">one</span> <span class="ss">of</span><span class="o">:</span> <span class="ss">a,</span> <span class="ss">b,</span> <span class="ss">c,</span> <span class="ss">d,</span> <span class="k">or</span> <span class="ss">e</span> <span class="ss">at</span> <span class="k">random</span>

<span class="p">(</span><span class="k">dotimes</span> <span class="p">(</span><span class="nv">x</span> <span class="ss">10</span><span class="p">)</span> <span class="p">(</span><span class="k">print</span> <span class="p">(</span><span class="k">amb</span> <span class="ss">3</span> <span class="ss">5</span> <span class="ss">7</span><span class="p">)))</span>  <span class="err">→</span> <span class="ss">35777535755</span>
</pre></div></div></div>
<div class="paragraph"><p>Internally, newLISP uses the same function as <a href="#rand">rand</a> to pick a
random number. To generate random floating point numbers, use
<a href="#random">random</a>, <a href="#randomize">randomize</a>, or
<a href="#normal">normal</a>. To initialize the pseudo random number generating
process at a specific starting point, use the <a href="#seed">seed</a> function.</p></div>
<div class="paragraph"><p><a id="and"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_and_span"><span class="big red">and</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (and <em>exp-1</em> [<em>exp-2</em> &#8230; ])</p></div>
<div class="paragraph"><p>The expressions <em>exp-1</em>, <em>exp-2</em>, <em>etc.</em> are evaluated in order,
returning the result of the last expression. If any of the expressions
yield <span class="monospaced">nil</span> or the empty list <span class="monospaced">()</span>, evaluation is terminated and <span class="monospaced">nil</span>
or the empty list <span class="monospaced">()</span> is returned.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">x</span> <span class="ss">10</span><span class="p">)</span>                       <span class="err">→</span> <span class="ss">10</span>
<span class="p">(</span><span class="k">and</span> <span class="p">(</span><span class="nv">&lt;</span> <span class="ss">x</span> <span class="ss">100</span><span class="p">)</span> <span class="p">(</span><span class="nv">&gt;</span> <span class="ss">x</span> <span class="ss">2</span><span class="p">))</span>           <span class="err">→</span> <span class="k">true</span>
<span class="p">(</span><span class="k">and</span> <span class="p">(</span><span class="nv">&lt;</span> <span class="ss">x</span> <span class="ss">100</span><span class="p">)</span> <span class="p">(</span><span class="nv">&gt;</span> <span class="ss">x</span> <span class="ss">2</span><span class="p">)</span> <span class="s">&quot;passed&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;passed&quot;</span>
<span class="p">(</span><span class="k">and</span> <span class="o">&#39;</span><span class="p">())</span>                         <span class="err">→</span> <span class="p">()</span>
<span class="p">(</span><span class="k">and</span> <span class="k">true</span><span class="p">)</span>                        <span class="err">→</span> <span class="k">true</span>
<span class="p">(</span><span class="k">and</span><span class="p">)</span>                             <span class="err">→</span> <span class="k">true</span>
</pre></div></div></div>
<div class="paragraph"><p><a id="append"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_append_span"><span class="big red">append</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (append <em>list-1</em> [<em>list-2</em> &#8230; ])<br>
<strong>syntax:</strong> (append <em>array-1</em> [<em>array-2</em> &#8230; ])<br>
<strong>syntax:</strong> (append <em>str-1</em> [<em>str-2</em> &#8230; ])</p></div>
<div class="paragraph"><p>In the first form, <span class="monospaced">append</span> works with lists, appending <em>list-1</em> through
<em>list-n</em> to form a new list. The original lists are left unchanged.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">append</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">3</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">4</span> <span class="ss">5</span> <span class="ss">6</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span><span class="p">))</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">4</span> <span class="ss">5</span> <span class="ss">6</span> <span class="ss">a</span> <span class="ss">b</span><span class="p">)</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">aList</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;hello&quot;</span> <span class="s">&quot;world&quot;</span><span class="p">))</span>    <span class="err">→</span> <span class="p">(</span><span class="s">&quot;hello&quot;</span> <span class="s">&quot;world&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">append</span> <span class="ss">aList</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;here&quot;</span> <span class="s">&quot;I am&quot;</span><span class="p">))</span>    <span class="err">→</span> <span class="p">(</span><span class="s">&quot;hello&quot;</span> <span class="s">&quot;world&quot;</span> <span class="s">&quot;here&quot;</span> <span class="s">&quot;I am&quot;</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>In the second form <span class="monospaced">append</span> works on arrays:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">A</span> <span class="p">(</span><span class="k">array</span> <span class="ss">3</span> <span class="ss">2</span> <span class="p">(</span><span class="k">sequence</span> <span class="ss">1</span> <span class="ss">6</span><span class="p">)))</span>
<span class="err">→</span> <span class="p">((</span><span class="nv">1</span> <span class="ss">2</span><span class="p">)</span> <span class="p">(</span><span class="nv">3</span> <span class="ss">4</span><span class="p">)</span> <span class="p">(</span><span class="nv">5</span> <span class="ss">6</span><span class="p">))</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">B</span> <span class="p">(</span><span class="k">array</span> <span class="ss">2</span> <span class="ss">2</span> <span class="p">(</span><span class="k">sequence</span> <span class="ss">7</span> <span class="ss">10</span><span class="p">)))</span>
<span class="err">→</span> <span class="p">((</span><span class="nv">7</span> <span class="ss">8</span><span class="p">)</span> <span class="p">(</span><span class="nv">9</span> <span class="ss">10</span><span class="p">))</span>

<span class="p">(</span><span class="k">append</span> <span class="ss">A</span> <span class="ss">B</span><span class="p">)</span>
<span class="err">→</span> <span class="p">((</span><span class="nv">1</span> <span class="ss">2</span><span class="p">)</span> <span class="p">(</span><span class="nv">3</span> <span class="ss">4</span><span class="p">)</span> <span class="p">(</span><span class="nv">5</span> <span class="ss">6</span><span class="p">)</span> <span class="p">(</span><span class="nv">7</span> <span class="ss">8</span><span class="p">)</span> <span class="p">(</span><span class="nv">9</span> <span class="ss">10</span><span class="p">))</span>

<span class="p">(</span><span class="k">append</span> <span class="ss">B</span> <span class="ss">B</span> <span class="ss">B</span><span class="p">)</span>
<span class="err">→</span> <span class="p">((</span><span class="nv">7</span> <span class="ss">8</span><span class="p">)</span> <span class="p">(</span><span class="nv">9</span> <span class="ss">10</span><span class="p">)</span> <span class="p">(</span><span class="nv">7</span> <span class="ss">8</span><span class="p">)</span> <span class="p">(</span><span class="nv">9</span> <span class="ss">10</span><span class="p">)</span> <span class="p">(</span><span class="nv">7</span> <span class="ss">8</span><span class="p">)</span> <span class="p">(</span><span class="nv">9</span> <span class="ss">10</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p>In the third form, <span class="monospaced">append</span> works on strings. The strings in <em>str-n</em> are
concatenated into a new string and returned.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">more</span> <span class="s">&quot; how are you&quot;</span><span class="p">)</span>       <span class="err">→</span> <span class="s">&quot; how are you&quot;</span>

<span class="p">(</span><span class="k">append</span> <span class="s">&quot;Hello &quot;</span> <span class="s">&quot;world,&quot;</span> <span class="ss">more</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;Hello world, how are you&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p><span class="monospaced">append</span> is also suitable for processing binary strings containing
zeroes. The <a href="#string">string</a> function would cut of strings at zero
bytes.</p></div>
<div class="paragraph"><p>Linkage characters or strings can be specified using the
<a href="#join">join</a> function. Use the <a href="#string">string</a> function to
convert arguments to strings and append in one step.</p></div>
<div class="paragraph"><p>Use the functions <a href="#extend">extend</a> and <a href="#push">push</a> to append to
an existing list or string modifying the target.</p></div>
<div class="paragraph"><p><a id="append-file"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_append_file_span"><span class="big red">append-file</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (append-file <em>str-filename</em> <em>str-buffer</em>)</p></div>
<div class="paragraph"><p>Works similarly to <a href="#write-file">write-file</a>, but the content in
<em>str-buffer</em> is appended if the file in <em>str-filename</em> exists. If the
file does not exist, it is created (in this case, <span class="monospaced">append-file</span> works
identically to <a href="#write-file">write-file</a>). This function returns the
number of bytes written.</p></div>
<div class="paragraph"><p>On failure the function returns <span class="monospaced">nil</span>. For error information, use
<a href="#sys-error">sys-error</a> when used on files. When used on URLs
<a href="#net-error">net-error</a> gives more error information.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">write-</span><span class="ss">file</span> <span class="s">&quot;myfile.txt&quot;</span> <span class="s">&quot;ABC&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">append-file</span> <span class="s">&quot;myfile.txt&quot;</span> <span class="s">&quot;DEF&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">read-</span><span class="ss">file</span> <span class="s">&quot;myfile.txt&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;ABCDEF&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p><span class="monospaced">append-file</span> can take a <span class="monospaced">http://</span> or <span class="monospaced">file://</span> URL in <em>str-file-name</em>.
In case of the <span class="monospaced">http://</span> prefix , <span class="monospaced">append-file</span> works exactly like
<a href="#put-url">put-url</a> with <span class="monospaced">"Pragma: append\r\n"</span> in the header option
and can take the same additional parameters. The <span class="monospaced">"Pragma: append\r\n"</span>
option is supplied automatically.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">append-file</span> <span class="s">&quot;http://asite.com/message.txt&quot;</span> <span class="s">&quot;More message text.&quot;</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The file <span class="monospaced">message.txt</span> is appended at a remote location
<span class="monospaced">http://asite.com</span> with the contents of <em>str-buffer</em>. If the file does
not yet exist, it will be created. In this mode, <span class="monospaced">append-file</span> can also
be used to transfer files to remote newLISP server nodes.</p></div>
<div class="paragraph"><p>See also <a href="#read-file">read-file</a> and <a href="#write-file">write-file</a>.</p></div>
<div class="paragraph"><p><a id="apply"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_apply_span"><span class="big red">apply</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (apply <em>func list</em> [<em>int-reduce</em>])</p></div>
<div class="paragraph"><p>Applies the contents of <em>func</em> (primitive, user-defined function, or
lambda expression) to the arguments in <em>list</em>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">apply</span> <span class="ss">+</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">))</span>                   <span class="err">→</span> <span class="ss">10</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">aList</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">3</span> <span class="ss">4</span> <span class="ss">5</span><span class="p">))</span>                  <span class="err">→</span> <span class="p">(</span><span class="nv">3</span> <span class="ss">4</span> <span class="ss">5</span><span class="p">)</span>
<span class="p">(</span><span class="k">apply</span> <span class="ss">*</span> <span class="ss">aList</span><span class="p">)</span>                        <span class="err">→</span> <span class="ss">60</span>
<span class="p">(</span><span class="k">apply</span> <span class="k">sqrt</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">25</span><span class="p">))</span>                     <span class="err">→</span> <span class="ss">5</span>
<span class="p">(</span><span class="k">apply</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span> <span class="ss">y</span><span class="p">)</span> <span class="p">(</span><span class="nv">*</span> <span class="ss">x</span> <span class="ss">y</span><span class="p">))</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">3</span> <span class="ss">4</span><span class="p">))</span>  <span class="err">→</span> <span class="ss">12</span>
</pre></div></div></div>
<div class="paragraph"><p>The <em>int-reduce</em> parameter can optionally contain the number of
arguments taken by the function in <em>func</em>. In this case, <em>func</em> will be
repeatedly applied using the previous result as the first argument and
taking the other arguments required successively from <em>list</em> (in
left-associative order). For example, if <span class="monospaced">op</span> takes two arguments, then:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">apply</span> <span class="ss">op</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">4</span> <span class="ss">5</span><span class="p">)</span> <span class="ss">2</span><span class="p">)</span>

<span class="c1">;; is equivalent to</span>

<span class="p">(</span><span class="nv">op</span> <span class="p">(</span><span class="nv">op</span> <span class="p">(</span><span class="nv">op</span> <span class="p">(</span><span class="nv">op</span> <span class="ss">1</span> <span class="ss">2</span><span class="p">)</span> <span class="ss">3</span><span class="p">)</span> <span class="ss">4</span><span class="p">)</span> <span class="ss">5</span><span class="p">)</span>

<span class="c1">;; find the greatest common divisor</span>
<span class="c1">;; of two or more integers</span>
<span class="c1">;; note that newLISP already has a gcd function</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">gcd_</span> <span class="ss">a</span> <span class="ss">b</span><span class="p">)</span>
    <span class="p">(</span><span class="k">let</span> <span class="p">(</span><span class="nv">r</span> <span class="p">(</span><span class="nv">%</span> <span class="ss">b</span> <span class="ss">a</span><span class="p">))</span>
        <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">=</span> <span class="ss">r</span> <span class="ss">0</span><span class="p">)</span> <span class="ss">a</span> <span class="p">(</span><span class="nv">gcd_</span> <span class="ss">r</span> <span class="ss">a</span><span class="p">))))</span>

<span class="p">(</span><span class="k">define-macro</span> <span class="p">(</span><span class="nv">my-gcd</span><span class="p">)</span>
    <span class="p">(</span><span class="k">apply</span> <span class="ss">gcd_</span> <span class="p">(</span><span class="k">args</span><span class="p">)</span> <span class="ss">2</span><span class="p">))</span>

<span class="p">(</span><span class="nv">my-gcd</span> <span class="ss">12</span> <span class="ss">18</span> <span class="ss">6</span><span class="p">)</span>    <span class="err">→</span> <span class="ss">6</span>
<span class="p">(</span><span class="nv">my-gcd</span> <span class="ss">12</span> <span class="ss">18</span> <span class="ss">6</span> <span class="ss">4</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">2</span>
</pre></div></div></div>
<div class="paragraph"><p>The last example shows how <span class="monospaced">apply</span>'s <em>reduce</em> functionality can be used
to convert a two-argument function into one that takes multiple
arguments. Note, that a built-in <a href="#gcd">gcd</a> is available.</p></div>
<div class="paragraph"><p><span class="monospaced">apply</span> should only be used on functions and operators that evaluate all
of their arguments, not on <em>special forms</em> like <a href="#dotimes">dotimes</a>
or <a href="#case">case</a>, which evaluate only some of their arguments. Doing
so will cause the function to fail.</p></div>
<div class="paragraph"><p><a id="args"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_args_span"><span class="big red">args</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (args)<br>
<strong>syntax:</strong> (args <em>int-idx-1</em> [<em>int-idx-2</em> &#8230; ])</p></div>
<div class="paragraph"><p>Accesses a list of all unbound arguments passed to the currently
evaluating <a href="#define">define</a>, <a href="#define-macro">define-macro</a>
lambda, or lambda-macro expression. Only the arguments of the current
function or macro that remain after local variable binding has occurred
are available. The <span class="monospaced">args</span> function is useful for defining functions or
macros with a variable number of parameters.</p></div>
<div class="paragraph"><p><span class="monospaced">args</span> can be used to define hygienic macros that avoid the danger of
variable capture. See <a href="#define-macro">define-macro</a>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">define-macro</span> <span class="p">(</span><span class="k">print-</span><span class="ss">line</span><span class="p">)</span>
    <span class="p">(</span><span class="k">dolist</span> <span class="p">(</span><span class="nv">x</span> <span class="p">(</span><span class="k">args</span><span class="p">))</span>
        <span class="p">(</span><span class="k">print</span> <span class="ss">x</span> <span class="s">&quot;\n&quot;</span><span class="p">)))</span>

<span class="p">(</span><span class="k">print-</span><span class="ss">line</span> <span class="s">&quot;hello&quot;</span> <span class="s">&quot;World&quot;</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>This example prints a line-feed after each argument. The macro mimics
the effect of the built-in function <a href="#println">println</a>.</p></div>
<div class="paragraph"><p>In the second syntax, <span class="monospaced">args</span> can take one or more indices (<em>int-idx-n</em>).</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">define-macro</span> <span class="p">(</span><span class="nv">foo</span><span class="p">)</span>
    <span class="p">(</span><span class="k">print</span> <span class="p">(</span><span class="k">args</span> <span class="ss">2</span><span class="p">)</span> <span class="p">(</span><span class="k">args</span> <span class="ss">1</span><span class="p">)</span> <span class="p">(</span><span class="k">args</span> <span class="ss">0</span><span class="p">)))</span>

<span class="p">(</span><span class="nv">foo</span> <span class="ss">x</span> <span class="ss">y</span> <span class="ss">z</span><span class="p">)</span>
<span class="ss">zyx</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">bar</span><span class="p">)</span>
    <span class="p">(</span><span class="k">args</span> <span class="ss">0</span> <span class="ss">2</span> <span class="k">-</span><span class="ss">1</span><span class="p">))</span>

<span class="p">(</span><span class="nv">bar</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1</span> <span class="ss">2</span> <span class="p">(</span><span class="nv">3</span> <span class="ss">4</span><span class="p">)))</span>  <span class="err">→</span> <span class="ss">4</span>
</pre></div></div></div>
<div class="paragraph"><p>The function <span class="monospaced">foo</span> prints out the arguments in reverse order. The <span class="monospaced">bar</span>
function shows <span class="monospaced">args</span> being used with multiple indices to access nested
lists.</p></div>
<div class="paragraph"><p>Remember that <span class="monospaced">(args)</span> only contains the arguments not already bound to
local variables of the current function or macro:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">foo</span> <span class="ss">a</span> <span class="ss">b</span><span class="p">)</span> <span class="p">(</span><span class="k">args</span><span class="p">))</span>

<span class="p">(</span><span class="nv">foo</span> <span class="ss">1</span> <span class="ss">2</span><span class="p">)</span>        <span class="err">→</span> <span class="p">()</span>

<span class="p">(</span><span class="nv">foo</span> <span class="ss">1</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">4</span> <span class="ss">5</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">3</span> <span class="ss">4</span> <span class="ss">5</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>In the first example, an empty list is returned because the arguments
are bound to the two local symbols, <span class="monospaced">a</span> and <span class="monospaced">b</span>. The second example
demonstrates that, after the first two arguments are bound (as in the
first example), three arguments remain and are then returned by <span class="monospaced">args</span>.</p></div>
<div class="paragraph"><p><span class="monospaced">(args)</span> can be used as an argument to a built-in or user-defined
function call, but it should not be used as an argument to another
macro, in which case <span class="monospaced">(args)</span> would not be evaluated and would therefore
have the wrong contents in the new macro environment.</p></div>
<div class="paragraph"><p><a id="array"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_array_span"><span class="big red">array</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (array <em>int-n1</em> [<em>int-n2</em> &#8230; ] [<em>list-init</em>])</p></div>
<div class="paragraph"><p>Creates an array with <em>int-n1</em> elements, optionally initializing it with
the contents of <em>list-init</em>. Up to sixteen dimensions may be specified
for multidimensional arrays.</p></div>
<div class="paragraph"><p>Internally, newLISP builds multidimensional arrays by using arrays as
the elements of an array. newLISP arrays should be used whenever random
indexing into a large list becomes too slow. Not all list functions may
be used on arrays. For a more detailed discussion, see the chapter on
<a href="#arrays">arrays</a>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">array</span> <span class="ss">5</span><span class="p">)</span>                  <span class="err">→</span> <span class="p">(</span><span class="k">nil</span> <span class="k">nil</span> <span class="k">nil</span> <span class="k">nil</span> <span class="k">nil</span><span class="p">)</span>

<span class="p">(</span><span class="k">array</span> <span class="ss">5</span> <span class="p">(</span><span class="k">sequence</span> <span class="ss">1</span>  <span class="ss">5</span><span class="p">))</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">4</span> <span class="ss">5</span><span class="p">)</span>

<span class="p">(</span><span class="k">array</span> <span class="ss">10</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1</span> <span class="ss">2</span><span class="p">))</span>          <span class="err">→</span> <span class="p">(</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">1</span> <span class="ss">2</span> <span class="ss">1</span> <span class="ss">2</span> <span class="ss">1</span> <span class="ss">2</span> <span class="ss">1</span> <span class="ss">2</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Arrays can be initialized with objects of any type. If fewer
initializers than elements are provided, the list is repeated until all
elements of the array are initialized.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">myarray</span> <span class="p">(</span><span class="k">array</span> <span class="ss">3</span> <span class="ss">4</span> <span class="p">(</span><span class="k">sequence</span> <span class="ss">1</span> <span class="ss">12</span><span class="p">)))</span>
<span class="err">→</span> <span class="p">((</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">)</span> <span class="p">(</span><span class="nv">5</span> <span class="ss">6</span> <span class="ss">7</span> <span class="ss">8</span><span class="p">)</span> <span class="p">(</span><span class="nv">9</span> <span class="ss">10</span> <span class="ss">11</span> <span class="ss">12</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p>Arrays are modified and accessed using most of the same functions used
for modifying lists:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>(setf (myarray 2 3) 99) → 99)
myarray → ((1 2 3 4) (5 6 7 8) (9 10 11 99))

(setf (myarray 1 1) "hello")  → "hello"

myarray → ((1 2 3 4) (5 "hello" 7 8) (9 10 11 99))

(setf (myarray 1) '(a b c d)) → (a b c d)
myarray → ((1 2 3 4) (a b c d) (9 10 11 99))

(nth 1 myarray)     → (a b c d)  ; access a whole row

(myarray 0 -1)      → 4

;; use implicit indexing and slicing on arrays

(myarray 1)     → (a b c d)

(myarray 0 -1)  → 4

(2 myarray)     → (c d)

(-3 2 myarray)  → (b c)</pre>
</div></div>
<div class="paragraph"><p>Care must be taken to use an array when replacing a whole row.</p></div>
<div class="paragraph"><p><a href="#array-list">array-list</a> can be used to convert arrays back into
lists:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">array-list</span> <span class="ss">myarray</span><span class="p">)</span>  <span class="err">→</span> <span class="p">((</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">)</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span> <span class="ss">d</span><span class="p">)</span> <span class="p">(</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">99</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p>To convert a list back into an array, apply <a href="#flat">flat</a> to the
list:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">aList</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">1</span> <span class="ss">2</span><span class="p">)</span> <span class="p">(</span><span class="nv">3</span> <span class="ss">4</span><span class="p">)))</span>             <span class="err">→</span> <span class="p">((</span><span class="nv">1</span> <span class="ss">2</span><span class="p">)</span> <span class="p">(</span><span class="nv">3</span> <span class="ss">4</span><span class="p">))</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">aArray</span> <span class="p">(</span><span class="k">array</span> <span class="ss">2</span> <span class="ss">2</span> <span class="p">(</span><span class="k">flat</span> <span class="ss">aList</span><span class="p">)))</span>  <span class="err">→</span> <span class="p">((</span><span class="nv">1</span> <span class="ss">2</span><span class="p">)</span> <span class="p">(</span><span class="nv">3</span> <span class="ss">4</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p>The <a href="#arrayp">array?</a> function can be used to check if an expression
is an array:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">array</span><span class="ss">?</span> <span class="ss">myarray</span><span class="p">)</span>               <span class="err">→</span> <span class="k">true</span>

<span class="p">(</span><span class="k">array</span><span class="ss">?</span> <span class="p">(</span><span class="k">array-list</span> <span class="ss">myarray</span><span class="p">))</span>  <span class="err">→</span> <span class="k">nil</span>
</pre></div></div></div>
<div class="paragraph"><p>When serializing arrays using the function <a href="#source">source</a> or
<a href="#save">save</a>, the generated code includes the <span class="monospaced">array</span> statement
necessary to create them. This way, variables containing arrays are
correctly serialized when saving with <a href="#save">save</a> or creating
source strings using <a href="#source">source</a>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">myarray</span> <span class="p">(</span><span class="k">array</span> <span class="ss">3</span> <span class="ss">4</span> <span class="p">(</span><span class="k">sequence</span> <span class="ss">1</span> <span class="ss">12</span><span class="p">)))</span>

<span class="p">(</span><span class="k">save</span> <span class="s">&quot;array.lsp&quot;</span> <span class="o">&#39;</span><span class="ss">myarray</span><span class="p">)</span>

<span class="c1">;; contents of file arraylsp ;;</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">myarray</span> <span class="p">(</span><span class="k">array</span> <span class="ss">3</span> <span class="ss">4</span> <span class="p">(</span><span class="k">flat</span> <span class="o">&#39;</span><span class="p">(</span>
  <span class="p">(</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">5</span> <span class="ss">6</span> <span class="ss">7</span> <span class="ss">8</span><span class="p">)</span>
  <span class="p">(</span><span class="nv">9</span> <span class="ss">10</span> <span class="ss">11</span> <span class="ss">12</span><span class="p">)))))</span>
</pre></div></div></div>
<div class="paragraph"><p><a id="array-list"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_array_list_span"><span class="big red">array-list</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (array-list <em>array</em>)</p></div>
<div class="paragraph"><p>Returns a list conversion from <em>array</em>, leaving the original array
unchanged:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">myarray</span> <span class="p">(</span><span class="k">array</span> <span class="ss">3</span> <span class="ss">4</span> <span class="p">(</span><span class="k">sequence</span> <span class="ss">1</span> <span class="ss">12</span><span class="p">)))</span>
<span class="err">→</span> <span class="p">((</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">)</span> <span class="p">(</span><span class="nv">5</span> <span class="ss">6</span> <span class="ss">7</span> <span class="ss">8</span><span class="p">)</span> <span class="p">(</span><span class="nv">9</span> <span class="ss">10</span> <span class="ss">11</span> <span class="ss">12</span><span class="p">))</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">mylist</span> <span class="p">(</span><span class="k">array-list</span> <span class="ss">myarray</span><span class="p">))</span>
<span class="err">→</span> <span class="p">((</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">)</span> <span class="p">(</span><span class="nv">5</span> <span class="ss">6</span> <span class="ss">7</span> <span class="ss">8</span><span class="p">)</span> <span class="p">(</span><span class="nv">9</span> <span class="ss">10</span> <span class="ss">11</span> <span class="ss">12</span><span class="p">))</span>

<span class="p">(</span><span class="k">list</span> <span class="p">(</span><span class="k">array</span><span class="ss">?</span> <span class="ss">myarray</span><span class="p">)</span> <span class="p">(</span><span class="k">list</span><span class="ss">?</span> <span class="ss">mylist</span><span class="p">))</span>
<span class="err">→</span> <span class="p">(</span><span class="k">true</span> <span class="k">true</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p><a id="array?"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_array_span_2"><span class="big red">array?</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (array? <em>exp</em>)</p></div>
<div class="paragraph"><p>Checks if <em>exp</em> is an array:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">M</span> <span class="p">(</span><span class="k">array</span> <span class="ss">3</span> <span class="ss">4</span> <span class="p">(</span><span class="k">sequence</span> <span class="ss">1</span> <span class="ss">4</span><span class="p">)))</span>
<span class="err">→</span> <span class="p">((</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">)</span> <span class="p">(</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">)</span> <span class="p">(</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">)))</span>

<span class="p">(</span><span class="k">array</span><span class="ss">?</span> <span class="ss">M</span><span class="p">)</span>               <span class="err">→</span> <span class="k">true</span>

<span class="p">(</span><span class="k">array</span><span class="ss">?</span> <span class="p">(</span><span class="k">array-list</span> <span class="ss">M</span><span class="p">))</span>  <span class="err">→</span> <span class="k">nil</span>
</pre></div></div></div>
<div class="paragraph"><p><a id="asin"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_asin_span"><span class="big red">asin</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (asin <em>num-radians</em>)</p></div>
<div class="paragraph"><p>Calculates the arcsine function from the number in <em>num-radians</em> and
returns the result.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">asin</span> <span class="ss">1</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">1.570796327</span>
<span class="p">(</span><span class="k">sin</span> <span class="p">(</span><span class="k">asin</span> <span class="ss">1</span><span class="p">))</span> <span class="err">→</span> <span class="ss">1</span>
</pre></div></div></div>
<div class="paragraph"><p><a id="asinh"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_asinh_span"><span class="big red">asinh</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (asinh <em>num-radians</em>)</p></div>
<div class="paragraph"><p>Calculates the inverse hyperbolic sine of <em>num-radians</em>, the value whose
hyperbolic sine is <em>num-radians</em>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">asinh</span> <span class="ss">2</span><span class="p">)</span>         <span class="err">→</span> <span class="ss">1.443635475</span>
<span class="p">(</span><span class="k">sinh</span> <span class="p">(</span><span class="k">asinh</span> <span class="ss">2</span><span class="p">))</span>  <span class="err">→</span> <span class="ss">2</span>
</pre></div></div></div>
<div class="paragraph"><p><a id="assoc"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_assoc_span"><span class="big red">assoc</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (assoc <em>exp-key</em> <em>list-alist</em>)<br>
<strong>syntax:</strong> (assoc <em>list-exp-key</em> <em>list-alist</em>)</p></div>
<div class="paragraph"><p>In the first syntax the value of <em>exp-key</em> is used to search
<em>list-alist</em> for a <em>member-list</em> whose first element matches the key
value. If found, the <em>member-list</em> is returned; otherwise, the result
will be <span class="monospaced">nil</span>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">assoc</span> <span class="ss">1</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">3</span> <span class="ss">4</span><span class="p">)</span> <span class="p">(</span><span class="nv">1</span> <span class="ss">2</span><span class="p">)))</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">1</span> <span class="ss">2</span><span class="p">)</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">data</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">apples</span> <span class="ss">123</span><span class="p">)</span> <span class="p">(</span><span class="nv">bananas</span> <span class="ss">123</span> <span class="ss">45</span><span class="p">)</span> <span class="p">(</span><span class="nv">pears</span> <span class="ss">7</span><span class="p">)))</span>

<span class="p">(</span><span class="k">assoc</span> <span class="o">&#39;</span><span class="ss">bananas</span> <span class="ss">data</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">bananas</span> <span class="ss">123</span> <span class="ss">45</span><span class="p">)</span>
<span class="p">(</span><span class="k">assoc</span> <span class="o">&#39;</span><span class="ss">oranges</span> <span class="ss">data</span><span class="p">)</span>  <span class="err">→</span> <span class="k">nil</span>
</pre></div></div></div>
<div class="paragraph"><p>Together with <a href="#setf">setf</a> <span class="monospaced">assoc</span> can be used to change an
association.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">setf</span> <span class="p">(</span><span class="k">assoc</span> <span class="o">&#39;</span><span class="ss">pears</span> <span class="ss">data</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">pears</span> <span class="ss">8</span><span class="p">))</span>

<span class="ss">data</span>  <span class="err">→</span> <span class="p">((</span><span class="nv">apples</span> <span class="ss">123</span><span class="p">)</span> <span class="p">(</span><span class="nv">bananas</span> <span class="ss">123</span> <span class="ss">45</span><span class="p">)</span> <span class="p">(</span><span class="nv">pears</span> <span class="ss">8</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p>In the second syntax more then one key expressions can be specified to
search in nested, multilevel association lists:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">persons</span> <span class="o">&#39;</span><span class="p">(</span>
    <span class="p">(</span><span class="nv">id001</span> <span class="p">(</span><span class="nv">name</span> <span class="s">&quot;Anne&quot;</span><span class="p">)</span> <span class="p">(</span><span class="k">address</span> <span class="p">(</span><span class="nv">country</span> <span class="s">&quot;USA&quot;</span><span class="p">)</span> <span class="p">(</span><span class="nv">city</span> <span class="s">&quot;New York&quot;</span><span class="p">)))</span>
    <span class="p">(</span><span class="nv">id002</span> <span class="p">(</span><span class="nv">name</span> <span class="s">&quot;Jean&quot;</span><span class="p">)</span> <span class="p">(</span><span class="k">address</span> <span class="p">(</span><span class="nv">country</span> <span class="s">&quot;France&quot;</span><span class="p">)</span> <span class="p">(</span><span class="nv">city</span> <span class="s">&quot;Paris&quot;</span><span class="p">)))</span>
<span class="p">))</span>

<span class="p">(</span><span class="k">assoc</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">id001</span> <span class="k">address</span><span class="p">)</span> <span class="ss">persons</span><span class="p">)</span> <span class="err">→</span> <span class="p">(</span><span class="k">address</span> <span class="p">(</span><span class="nv">country</span> <span class="s">&quot;USA&quot;</span><span class="p">)</span> <span class="p">(</span><span class="nv">city</span> <span class="s">&quot;New York&quot;</span><span class="p">))</span>
<span class="p">(</span><span class="k">assoc</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">id001</span> <span class="k">address</span> <span class="ss">city</span><span class="p">)</span> <span class="ss">persons</span><span class="p">)</span> <span class="err">→</span> <span class="p">(</span><span class="nv">city</span> <span class="s">&quot;New York&quot;</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The list in <em>list-aList</em> can be a context which will be interpreted as
its <em>default functor</em>. This way very big lists can be passed by
reference for speedier access and less memory usage:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">persons</span><span class="o">:</span><span class="ss">persons</span> <span class="o">&#39;</span><span class="p">(</span>
    <span class="p">(</span><span class="nv">id001</span> <span class="p">(</span><span class="nv">name</span> <span class="s">&quot;Anne&quot;</span><span class="p">)</span> <span class="p">(</span><span class="k">address</span> <span class="p">(</span><span class="nv">country</span> <span class="s">&quot;USA&quot;</span><span class="p">)</span> <span class="p">(</span><span class="nv">city</span> <span class="s">&quot;New York&quot;</span><span class="p">)))</span>
    <span class="p">(</span><span class="nv">id002</span> <span class="p">(</span><span class="nv">name</span> <span class="s">&quot;Jean&quot;</span><span class="p">)</span> <span class="p">(</span><span class="k">address</span> <span class="p">(</span><span class="nv">country</span> <span class="s">&quot;France&quot;</span><span class="p">)</span> <span class="p">(</span><span class="nv">city</span> <span class="s">&quot;Paris&quot;</span><span class="p">)))</span>
<span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">get-city</span> <span class="ss">db</span> <span class="ss">id</span><span class="p">)</span>
    <span class="p">(</span><span class="k">last</span> <span class="p">(</span><span class="k">assoc</span> <span class="p">(</span><span class="k">list</span> <span class="ss">id</span> <span class="o">&#39;</span><span class="k">address</span> <span class="o">&#39;</span><span class="ss">city</span><span class="p">)</span> <span class="ss">db</span> <span class="p">))</span>
<span class="p">)</span>

<span class="p">(</span><span class="nv">get-city</span> <span class="ss">persons</span> <span class="o">&#39;</span><span class="ss">id001</span><span class="p">)</span> <span class="err">→</span> <span class="s">&quot;New York&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>For making replacements in association lists, use the <a href="#setf">setf</a>
together with the <span class="monospaced">assoc</span> function. The <a href="#lookup">lookup</a> function is
used to perform association lookup and element extraction in one step.</p></div>
<div class="paragraph"><p><a id="atan"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_atan_span"><span class="big red">atan</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (atan <em>num-radians</em>)</p></div>
<div class="paragraph"><p>The arctangent of <em>num-radians</em> is calculated and returned.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">atan</span> <span class="ss">1</span><span class="p">)</span>        <span class="err">→</span> <span class="ss">0.7853981634</span>
<span class="p">(</span><span class="k">tan</span> <span class="p">(</span><span class="k">atan</span> <span class="ss">1</span><span class="p">))</span>  <span class="err">→</span> <span class="ss">1</span>
</pre></div></div></div>
<div class="paragraph"><p><a id="atan2"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_atan2_span"><span class="big red">atan2</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (atan2 <em>num-Y-radians</em> <em>num-X-radians</em>)</p></div>
<div class="paragraph"><p>The <span class="monospaced">atan2</span> function computes the principal value of the arctangent of Y
/ X in radians. It uses the signs of both arguments to determine the
quadrant of the return value. <span class="monospaced">atan2</span> is useful for converting Cartesian
coordinates into polar coordinates.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">atan2</span> <span class="ss">1</span> <span class="ss">1</span><span class="p">)</span>                       <span class="err">→</span> <span class="ss">0.7853981634</span>
<span class="p">(</span><span class="k">div</span> <span class="p">(</span><span class="k">acos</span> <span class="ss">0</span><span class="p">)</span> <span class="p">(</span><span class="k">atan2</span> <span class="ss">1</span> <span class="ss">1</span><span class="p">))</span>        <span class="err">→</span> <span class="ss">2</span>
<span class="p">(</span><span class="k">atan2</span> <span class="ss">0</span> <span class="k">-</span><span class="ss">1</span><span class="p">)</span>                      <span class="err">→</span> <span class="ss">3.141592654</span>
<span class="p">(</span><span class="nv">=</span> <span class="p">(</span><span class="k">atan2</span> <span class="ss">1</span> <span class="ss">2</span><span class="p">)</span> <span class="p">(</span><span class="k">atan</span> <span class="p">(</span><span class="k">div</span> <span class="ss">1</span> <span class="ss">2</span><span class="p">)))</span>  <span class="err">→</span> <span class="k">true</span>
</pre></div></div></div>
<div class="paragraph"><p><a id="atanh"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_atanh_span"><span class="big red">atanh</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (atanh <em>num-radians</em>)</p></div>
<div class="paragraph"><p>Calculates the inverse hyperbolic tangent of <em>num-radians</em>, the value
whose hyperbolic tangent is <em>num-radians</em>. If the absolute value of
<em>num-radians</em> is greater than 1, <span class="monospaced">atanh</span> returns <span class="monospaced">NaN</span>; if it is equal
to 1, <span class="monospaced">atanh</span> returns infinity.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">atanh</span> <span class="ss">0.5</span><span class="p">)</span> <span class="err">→</span> <span class="ss">0.5493061443</span>
<span class="p">(</span><span class="k">tanh</span> <span class="p">(</span><span class="k">atanh</span> <span class="ss">0.5</span><span class="p">))</span> <span class="err">→</span> <span class="ss">0.5</span>
<span class="p">(</span><span class="k">atanh</span> <span class="ss">1.1</span><span class="p">)</span> <span class="err">→</span> <span class="ss">NaN</span>
<span class="p">(</span><span class="k">atanh</span> <span class="ss">1</span><span class="p">)</span> <span class="err">→</span> <span class="ss">inf</span>
</pre></div></div></div>
<div class="paragraph"><p><a id="atom?"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_atom_span"><span class="big red">atom?</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (atom? <em>exp</em>)</p></div>
<div class="paragraph"><p>Returns <span class="monospaced">true</span> if the value of <em>exp</em> is an atom, otherwise <span class="monospaced">nil</span>. An
expression is an atom if it evaluates to nil, true, an integer, a float,
a string, a symbol or a primitive. Lists, lambda or lambda-macro
expressions, and quoted expressions are not atoms.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="nv">atom?</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">3</span><span class="p">))</span>      <span class="err">→</span> <span class="k">nil</span>
<span class="p">(</span><span class="k">and</span> <span class="p">(</span><span class="nv">atom?</span> <span class="ss">123</span><span class="p">)</span>
     <span class="p">(</span><span class="nv">atom?</span> <span class="s">&quot;hello&quot;</span><span class="p">)</span>
     <span class="p">(</span><span class="nv">atom?</span> <span class="o">&#39;</span><span class="ss">foo</span><span class="p">))</span>    <span class="err">→</span> <span class="k">true</span>
<span class="p">(</span><span class="nv">atom?</span> <span class="o">&#39;&#39;</span><span class="ss">foo</span><span class="p">)</span>         <span class="err">→</span> <span class="k">nil</span>
</pre></div></div></div>
<div class="paragraph"><p><a id="base64-dec"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_base64_dec_span"><span class="big red">base64-dec</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (base64-dec <em>str</em>)</p></div>
<div class="paragraph"><p>The BASE64 string in <em>str</em> is decoded. Note that <em>str</em> is not verified
to be a valid BASE64 string. The decoded string is returned.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">base64-dec</span> <span class="s">&quot;SGVsbG8gV29ybGQ=&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;Hello World&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>For encoding, use the <a href="#base64-enc">base64-enc</a> function.</p></div>
<div class="paragraph"><p>newLISP&#8217;s BASE64 handling is derived from routines found in the Unix
<a href="http://curl.haxx.se/">curl</a> utility and conforms to the RFC 4648
standard.</p></div>
<div class="paragraph"><p><a id="base64-enc"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_base64_enc_span"><span class="big red">base64-enc</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (base64-enc <em>str</em> [<em>bool-flag</em>])</p></div>
<div class="paragraph"><p>The string in <em>str</em> is encoded into BASE64 format. This format encodes
groups of 3 * 8 = 24 input bits into 4 * 8 = 32 output bits, where each
8-bit output group represents 6 bits from the input string. The 6 bits
are encoded into 64 possibilities from the letters A–Z and a–z; the
numbers 0–9; and the characters + (plus sign) and / (slash). The =
(equals sign) is used as a filler in unused 3- to 4-byte translations.
This function is helpful for converting binary content into printable
characters.</p></div>
<div class="paragraph"><p>Without the optional <em>bool-flag</em> parameter the empty string <span class="monospaced">""</span> is
encoded into <span class="monospaced">"===="</span>. If <em>bool-flag</em> evaluates to <span class="monospaced">true</span>, the the empty
string <span class="monospaced">""</span> is translated into <span class="monospaced">""</span>. Both translations result in <span class="monospaced">""</span>
when using <a href="base64-dec">base64-dec</a>.</p></div>
<div class="paragraph"><p>The encoded string is returned.</p></div>
<div class="paragraph"><p>BASE64 encoding is used with many Internet protocols to encode binary
data for inclusion in text-based messages (e.g., XML-RPC).</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">base64-enc</span> <span class="s">&quot;Hello World&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;SGVsbG8gV29ybGQ=&quot;</span>

<span class="p">(</span><span class="k">base64-enc</span> <span class="s">&quot;&quot;</span><span class="p">)</span>             <span class="err">→</span> <span class="s">&quot;====&quot;</span>
<span class="p">(</span><span class="k">base64-enc</span> <span class="s">&quot;&quot;</span> <span class="k">true</span><span class="p">)</span>        <span class="err">→</span> <span class="s">&quot;&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>Note that <span class="monospaced">base64-enc</span> does not insert carriage-return/line-feed pairs
in longer BASE64 sequences but instead returns a pure BASE64-encoded
string.</p></div>
<div class="paragraph"><p>For decoding, use the <a href="#base64-dec">base64-dec</a> function.</p></div>
<div class="paragraph"><p>newLISP&#8217;s BASE64 handling is derived from routines found in the Unix
<a href="http://curl.haxx.se/">curl</a> utility and conforms to the RFC 4648
standard.</p></div>
<div class="paragraph"><p><a id="bayes-query"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_bayes_query_span"><span class="big red">bayes-query</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (bayes-query <em>list-L</em> <em>context-D</em> [<em>bool-chain</em> [<em>bool-probs</em>]])</p></div>
<div class="paragraph"><p>Takes a list of tokens (<em>list-L</em>) and a trained dictionary (<em>context-D</em>)
and returns a list of the combined probabilities of the tokens in one
category (<em>A</em> or <em>Mc</em>) versus a category (<em>B</em>) against all other
categories (<em>Mi</em>). All tokens in <em>list-L</em> should occur in <em>context-D</em>.
When using the default <em>R.A. Fisher Chi²</em> mode, nonexistent tokens will
skew results toward equal probability in all categories.</p></div>
<div class="paragraph"><p>Non-existing tokens will not have any influence on the result when using
the true <em>Chain Bayesian</em> mode with <em>bool-chain</em> set to <span class="monospaced">true</span>. The
optional last flag, <em>bool-probs</em>, indicates whether frequencies or
probability values are used in the data set. The
<a href="#bayes-train">bayes-train</a> function is typically used to generate a
data set&#8217;s frequencies.</p></div>
<div class="paragraph"><p>Tokens can be strings or symbols. If strings are used, they are
prepended with an underscore before being looked up in <em>context-D</em>. If
<a href="#bayes-train">bayes-train</a> was used to generate <em>context-D</em>'s
frequencies, the underscore was automatically prepended during the
learning process.</p></div>
<div class="paragraph"><p>Depending on the flag specified in <em>bool-probs</em>,
<a href="#bayes-query">bayes-query</a> employs either the R. A. Fisher Chi²
method of compounding probabilities or the Chain Bayesian method. By
default, when no flag or <span class="monospaced">nil</span> is specified in <em>bool-probs</em>, the <em>Chi²</em>
method of compounding probabilities is used. When specifying <span class="monospaced">true</span> in
<em>bool-probs</em>, the Chain Bayesian method is used.</p></div>
<div class="paragraph"><p>If the R.A. Fisher Chi² method is used, the total number of tokens in
the different training set&#8217;s categories should be equal or similar.
Uneven frequencies in categories will skew the results.</p></div>
<div class="paragraph"><p>For two categories <em>A</em> and <em>B</em>, <span class="monospaced">bayes-query</span> uses the following
formula:</p></div>
<div class="paragraph"><p><strong><em>p(A|tkn) = p(tkn|A) * p(A) / p(tkn|A) * p(A) + p(tkn|B) * p(B)</em></strong></p></div>
<div class="paragraph"><p>For <em>N</em> categories, this formula is used:</p></div>
<div class="paragraph"><p><strong><em>p(Mc|tkn) = p(tkn|Mc) * p(Mc) / sum-i-N( p(tkn|Mi) * p(Mi) )</em></strong></p></div>
<div class="paragraph"><p>The probabilities (<em>p(Mi)</em> or <em>p(A)</em>, along with <em>p(B)</em>) represent the
<em>Bayesian prior probabilities</em>. <em>p(Mc|tkn)</em> and <em>p(A|tkn)</em> are the
<em>posterior Bayesian</em> probabilities of a category or model.</p></div>
<div class="paragraph"><p>Priors are handled differently, depending on whether the R.A. Fisher
Chi² or the Chain Bayesian method is used. In Chain Bayesian mode,
posteriors from one token calculation get the priors in the next
calculation. In the default R.A. Fisher method, priors are not passed on
via chaining, but probabilities are compounded using the Chi² method.</p></div>
<div class="paragraph"><p>In Chain Bayes mode, tokens with zero frequency in one category will
effectively put the probability of that category to 0 (zero). This also
causes all posterior priors to be set to 0 and the category to be
completely suppressed in the result. Queries resulting in zero
probabilities for all categories yield <em>NaN</em> values.</p></div>
<div class="paragraph"><p>The default R.A. Fisher Chi² method is less sensitive about zero
frequencies and still maintains a low probability for that token. This
may be an important feature in natural language processing when using
<em>Bayesian statistics</em>. Imagine that five different language <em>corpus</em>
categories have been trained, but some words occurring in one category
are not present in another. When the pure Chain Bayesian method is used,
a sentence could never be classified into its correct category because
the zero-count of just one word token could effectively exclude it from
the category to which it belongs.</p></div>
<div class="paragraph"><p>On the other hand, the Chain Bayesian method offers exact results for
specific proportions in the data. When using Chain Bayesian mode for
natural language data, all zero frequencies should be removed from the
trained dictionary first.</p></div>
<div class="paragraph"><p>The return value of <span class="monospaced">bayes-query</span> is a list of probability values, one
for each category. Following are two examples: the first for the default
R.A. Fisher mode, the second for a data set processed with the Chain
Bayesian method.</p></div>
<div class="paragraph"><p>Previous to version 10.3.0 the list of probability values returned in
Fisher Chi² mode was normalized by dividing each value by the sum of the
whole list. This normalization has been dropped in version 10.3.0.</p></div>
</div>
<div class="sect3">
<h4 id="_r_a_fisher_chi²_method">R.A. Fisher Chi² method</h4>
<div class="paragraph"><p>In the following example, the two data sets are books from Project
Gutenberg. We assume that different authors use certain words with
different frequencies and want to determine if a sentence is more likely
to occur in one or the other author&#8217;s writing. A similar method is
frequently used to differentiate between spam and legitimate email.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">;; from Project Gutenberg: http://www.gutenberg.org/catalog/</span>
<span class="c1">;; The Adventures of Sherlock Holmes - Sir Arthur Conan Doyle</span>

<span class="p">(</span><span class="k">bayes-train</span> <span class="p">(</span><span class="k">parse</span> <span class="p">(</span><span class="k">lower-case</span> <span class="p">(</span><span class="k">read-</span><span class="ss">file</span> <span class="s">&quot;Doyle.txt&quot;</span><span class="p">))</span>
                    <span class="s">&quot;[^a-z]+&quot;</span> <span class="ss">0</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">()</span> <span class="o">&#39;</span><span class="ss">DoyleDowson</span><span class="p">)</span>

<span class="c1">;; A Comedy of Masks - Ernest Dowson and Arthur Moore</span>

<span class="p">(</span><span class="k">bayes-train</span> <span class="o">&#39;</span><span class="p">()</span> <span class="p">(</span><span class="k">parse</span> <span class="p">(</span><span class="k">lower-case</span> <span class="p">(</span><span class="k">read-</span><span class="ss">file</span> <span class="s">&quot;Dowson.txt&quot;</span><span class="p">))</span>
                    <span class="s">&quot;[^a-z]+&quot;</span> <span class="ss">0</span><span class="p">)</span> <span class="o">&#39;</span><span class="ss">DoyleDowson</span><span class="p">)</span>

<span class="p">(</span><span class="k">save</span> <span class="s">&quot;DoyleDowson.lsp&quot;</span> <span class="o">&#39;</span><span class="ss">DoyleDowson</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The two training sets are loaded, split into tokens, and processed by
the <a href="#bayes-train">bayes-train</a> function. In the end, the
<span class="monospaced">DoyleDowson</span> dictionary is saved to a file, which will be used later
with the <span class="monospaced">bayes-query</span> function.</p></div>
<div class="paragraph"><p>The following code illustrates how <span class="monospaced">bayes-query</span> is used to classify a
sentence as <em>Doyle</em> or <em>Dowson</em>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">load</span> <span class="s">&quot;DoyleDowson.lsp&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">bayes-query</span> <span class="p">(</span><span class="k">parse</span> <span class="s">&quot;he was putting the last touches to a picture&quot;</span><span class="p">)</span>
    <span class="o">&#39;</span><span class="ss">DoyleDowson</span><span class="p">)</span>
<span class="err">→</span> <span class="p">(</span><span class="nv">0.03802079132</span> <span class="ss">0.9619792087</span><span class="p">)</span>

<span class="p">(</span><span class="k">bayes-query</span> <span class="p">(</span><span class="k">parse</span> <span class="s">&quot;immense faculties and extraordinary powers of observation&quot;</span><span class="p">)</span>
    <span class="o">&#39;</span><span class="ss">DoyleDowson</span><span class="p">)</span>
<span class="err">→</span> <span class="p">(</span><span class="nv">0.985108793</span> <span class="ss">0.01489120699</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The queries correctly identify the first sentence as a <em>Dowson</em>
sentence, and the second one as a <em>Doyle</em> sentence.</p></div>
</div>
<div class="sect3">
<h4 id="_chain_bayesian_method">Chain Bayesian method</h4>
<div class="paragraph"><p>The second example is frequently found in introductory literature on
Bayesian statistics. It shows the Chain Bayesian method of using
<span class="monospaced">bayes-query</span> on the data of a previously processed data set:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">Data</span><span class="o">:</span><span class="ss">test-positive</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">8</span> <span class="ss">18</span><span class="p">))</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">Data</span><span class="o">:</span><span class="ss">test-negative</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">2</span> <span class="ss">72</span><span class="p">))</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">Data</span><span class="o">:</span><span class="ss">total</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">10</span> <span class="ss">90</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p>A disease occurs in 10 percent of the population. A blood test developed
to detect this disease produces a false positive rate of 20 percent in
the healthy population and a false negative rate of 20 percent in the
sick. What is the probability of a person carrying the disease after
testing positive?</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">bayes-query</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">test-positive</span><span class="p">)</span> <span class="ss">Data</span> <span class="k">true</span><span class="p">)</span>
<span class="err">→</span> <span class="p">(</span><span class="nv">0.3076923077</span> <span class="ss">0.6923076923</span><span class="p">)</span>

<span class="p">(</span><span class="k">bayes-query</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">test-positive</span> <span class="ss">test-positive</span><span class="p">)</span> <span class="ss">Data</span> <span class="k">true</span><span class="p">)</span>
<span class="err">→</span> <span class="p">(</span><span class="nv">0.64</span> <span class="ss">0.36</span><span class="p">)</span>

<span class="p">(</span><span class="k">bayes-query</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">test-positive</span> <span class="ss">test-positive</span> <span class="ss">test-positive</span><span class="p">)</span> <span class="ss">Data</span> <span class="k">true</span><span class="p">)</span>
<span class="err">→</span> <span class="p">(</span><span class="nv">0.8767123288</span> <span class="ss">0.1232876712</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Note that the Bayesian formulas used assume statistical independence of
events for the <span class="monospaced">bayes-query</span> to work correctly.</p></div>
<div class="paragraph"><p>The example shows that a person must test positive several times before
they can be confidently classified as sick.</p></div>
<div class="paragraph"><p>Calculating the same example using the R.A. Fisher Chi² method will give
less-distinguished results.</p></div>
</div>
<div class="sect3">
<h4 id="_specifying_probabilities_instead_of_counts">Specifying probabilities instead of counts</h4>
<div class="paragraph"><p>Often, data is already available as probability values and would require
additional work to reverse them into frequencies. In the last example,
the data were originally defined as percentages. The additional optional
<em>bool-probs</em> flag allows probabilities to be entered directly and should
be used together with the Chain Bayesian mode for maximum performance:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">Data</span><span class="o">:</span><span class="ss">test-positive</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">0.8</span> <span class="ss">0.2</span><span class="p">))</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">Data</span><span class="o">:</span><span class="ss">test-negative</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">0.2</span> <span class="ss">0.8</span><span class="p">))</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">Data</span><span class="o">:</span><span class="ss">total</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">0.1</span> <span class="ss">0.9</span><span class="p">))</span>

<span class="p">(</span><span class="k">bayes-query</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">test-positive</span><span class="p">)</span> <span class="ss">Data</span> <span class="k">true</span> <span class="k">true</span><span class="p">)</span>
<span class="err">→</span> <span class="p">(</span><span class="nv">0.3076923077</span> <span class="ss">0.6923076923</span><span class="p">)</span>

<span class="p">(</span><span class="k">bayes-query</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">test-positive</span> <span class="ss">test-positive</span><span class="p">)</span> <span class="ss">Data</span> <span class="k">true</span> <span class="k">true</span><span class="p">)</span>
<span class="err">→</span> <span class="p">(</span><span class="nv">0.64</span> <span class="ss">0.36</span><span class="p">)</span>

<span class="p">(</span><span class="k">bayes-query</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">test-positive</span> <span class="ss">test-positive</span> <span class="ss">test-positive</span><span class="p">)</span> <span class="ss">Data</span> <span class="k">true</span> <span class="k">true</span><span class="p">)</span>
<span class="err">→</span> <span class="p">(</span><span class="nv">0.8767123288</span> <span class="ss">0.1232876712</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>As expected, the results are the same for probabilities as they are for
frequencies.</p></div>
<div class="paragraph"><p><a id="bayes-train"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_bayes_train_span"><span class="big red">bayes-train</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (bayes-train <em>list-M1</em> [<em>list-M2</em> &#8230; ] <em>sym-context-D</em>)</p></div>
<div class="paragraph"><p>Takes one or more lists of tokens (<em>M1</em>, <em>M2—</em>) from a joint set of
tokens. In newLISP, tokens can be symbols or strings (other data types
are ignored). Tokens are placed in a common dictionary in
<em>sym-context-D</em>, and the frequency is counted for each token in each
category <em>Mi</em>. If the context does not yet exist, it must be quoted.</p></div>
<div class="paragraph"><p>The <em>M</em> categories represent data models for which sequences of tokens
can be classified (see <a href="#bayes-query">bayes-query</a>). Each token in
<em>D</em> is a content-addressable symbol containing a list of the frequencies
for this token within each category. String tokens are prepended with an
<span class="monospaced">_</span> (underscore) before being converted into symbols. A symbol named
<span class="monospaced">total</span> is created containing the total of each category. The <span class="monospaced">total</span>
symbol cannot be part of the symbols passed as an <em>Mi</em> category.</p></div>
<div class="paragraph"><p>The function returns a list of token frequencies found in the different
categories or models.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">bayes-train</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">A</span> <span class="ss">A</span> <span class="ss">B</span> <span class="ss">C</span> <span class="ss">C</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">A</span> <span class="ss">B</span> <span class="ss">B</span> <span class="ss">C</span> <span class="ss">C</span> <span class="ss">C</span><span class="p">)</span> <span class="o">&#39;</span><span class="ss">L</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">5</span> <span class="ss">6</span><span class="p">)</span>

<span class="ss">L</span><span class="o">:</span><span class="ss">A</span>      <span class="err">→</span> <span class="p">(</span><span class="nv">2</span> <span class="ss">1</span><span class="p">)</span>
<span class="ss">L</span><span class="o">:</span><span class="ss">B</span>      <span class="err">→</span> <span class="p">(</span><span class="nv">1</span> <span class="ss">2</span><span class="p">)</span>
<span class="ss">L</span><span class="o">:</span><span class="ss">C</span>      <span class="err">→</span> <span class="p">(</span><span class="nv">2</span> <span class="ss">3</span><span class="p">)</span>
<span class="ss">L</span><span class="o">:</span><span class="ss">total</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">5</span> <span class="ss">6</span><span class="p">)</span>

<span class="p">(</span><span class="k">bayes-train</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;one&quot;</span> <span class="s">&quot;two&quot;</span> <span class="s">&quot;two&quot;</span> <span class="s">&quot;three&quot;</span><span class="p">)</span>
             <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;three&quot;</span> <span class="s">&quot;one&quot;</span> <span class="s">&quot;three&quot;</span><span class="p">)</span>
             <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;one&quot;</span> <span class="s">&quot;two&quot;</span> <span class="s">&quot;three&quot;</span><span class="p">)</span> <span class="o">&#39;</span><span class="ss">S</span><span class="p">)</span>
<span class="err">→</span> <span class="p">(</span><span class="nv">4</span> <span class="ss">3</span> <span class="ss">3</span><span class="p">)</span>

<span class="ss">S</span><span class="o">:</span><span class="ss">_one</span>    <span class="err">→</span> <span class="p">(</span><span class="nv">1</span> <span class="ss">1</span> <span class="ss">1</span><span class="p">)</span>
<span class="ss">S</span><span class="o">:</span><span class="ss">_two</span>    <span class="err">→</span> <span class="p">(</span><span class="nv">2</span> <span class="ss">0</span> <span class="ss">1</span><span class="p">)</span>
<span class="ss">S</span><span class="o">:</span><span class="ss">_three</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">1</span><span class="p">)</span>
<span class="ss">S</span><span class="o">:</span><span class="ss">total</span>   <span class="err">→</span> <span class="p">(</span><span class="nv">4</span> <span class="ss">3</span> <span class="ss">3</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The first example shows training with two lists of symbols. The second
example illustrates how an <span class="monospaced">_</span> is prepended when training with strings.</p></div>
<div class="paragraph"><p><span class="monospaced">bayes-train</span> creates symbols from strings prepending an underscore
character. This is the same way hashes are created and contexts
populates with symbols by <span class="monospaced">bayes-train</span> can be used like hashes:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">; use a bayes-trained context namespace like a hash dictionary</span>

<span class="p">(</span><span class="nv">S</span> <span class="s">&quot;two&quot;</span><span class="p">)</span>   <span class="err">→</span> <span class="p">(</span><span class="nv">2</span> <span class="ss">0</span> <span class="ss">1</span><span class="p">)</span>
<span class="p">(</span><span class="nv">S</span> <span class="s">&quot;three&quot;</span><span class="p">)</span> <span class="err">→</span> <span class="p">(</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">1</span><span class="p">)</span>

<span class="p">(</span><span class="nv">S</span><span class="p">)</span> <span class="err">→</span> <span class="p">((</span><span class="s">&quot;one&quot;</span> <span class="p">(</span><span class="nv">1</span> <span class="ss">1</span> <span class="ss">1</span><span class="p">))</span> <span class="p">(</span><span class="s">&quot;three&quot;</span> <span class="p">(</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">1</span><span class="p">))</span> <span class="p">(</span><span class="s">&quot;two&quot;</span> <span class="p">(</span><span class="nv">2</span> <span class="ss">0</span> <span class="ss">1</span><span class="p">)))</span>
</pre></div></div></div>
<div class="paragraph"><p>Note that these examples are just for demonstration purposes. In
reality, training sets may contain thousands or millions of words,
especially when training natural language models. But small data sets
may be used when the frequency of symbols just describe already-known
proportions. In this case, it may be better to describe the model data
set explicitly, without the <span class="monospaced">bayes-train</span> function:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">Data</span><span class="o">:</span><span class="ss">tested-positive</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">8</span> <span class="ss">18</span><span class="p">))</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">Data</span><span class="o">:</span><span class="ss">tested-negative</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">2</span> <span class="ss">72</span><span class="p">))</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">Data</span><span class="o">:</span><span class="ss">total</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">10</span> <span class="ss">90</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p>The last data are from a popular example used to describe the
<a href="#bayes-query">bayes-query</a> function in introductory papers and books
about <em>bayesian networks</em>.</p></div>
<div class="paragraph"><p>Training can be done in different stages by using <span class="monospaced">bayes-train</span> on an
existing trained context with the same number of categories. The new
symbols will be added, then counts and totals will be correctly updated.</p></div>
<div class="paragraph"><p>Training in multiple batches may be necessary on big text corpora or
documents that must be tokenized first. These corpora can be tokenized
in small portions, then fed into <span class="monospaced">bayes-train</span> in multiple stages.
Categories can also be singularly trained by specifying an empty list
for the absent corpus:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">bayes-train</span> <span class="ss">shakespeare1</span> <span class="o">&#39;</span><span class="p">()</span> <span class="o">&#39;</span><span class="ss">data</span><span class="p">)</span>
<span class="p">(</span><span class="k">bayes-train</span> <span class="ss">shakespeare2</span> <span class="o">&#39;</span><span class="p">()</span> <span class="o">&#39;</span><span class="ss">data</span><span class="p">)</span>
<span class="p">(</span><span class="k">bayes-train</span> <span class="o">&#39;</span><span class="p">()</span> <span class="ss">hemingway1</span> <span class="o">&#39;</span><span class="ss">data</span><span class="p">)</span>
<span class="p">(</span><span class="k">bayes-train</span> <span class="o">&#39;</span><span class="p">()</span> <span class="ss">hemingway2</span> <span class="o">&#39;</span><span class="ss">data</span><span class="p">)</span>
<span class="p">(</span><span class="k">bayes-train</span> <span class="ss">shakepeare-rest</span> <span class="ss">hemingway-rest</span> <span class="o">&#39;</span><span class="ss">data</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p><span class="monospaced">bayes-train</span> will correctly update word counts and totals.</p></div>
<div class="paragraph"><p>Using <span class="monospaced">bayes-train</span> inside a context other than <span class="monospaced">MAIN</span> requires the
training contexts to have been created previously within the <span class="monospaced">MAIN</span>
context via the <a href="#context">context</a> function.</p></div>
<div class="paragraph"><p><span class="monospaced">bayes-train</span> is not only useful with the <a href="#bayes-query">bayes-query</a>
function, but also as a function for counting in general. For instance,
the resulting frequencies could be analyzed using
<a href="#prob-chi2">prob-chi2</a> against a <em>null hypothesis</em> of proportional
distribution of items across categories.</p></div>
<div class="paragraph"><p><a id="begin"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_begin_span"><span class="big red">begin</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (begin <em>body</em>)</p></div>
<div class="paragraph"><p>The <span class="monospaced">begin</span> function is used to group a block of expressions. The
expressions in <em>body</em> are evaluated in sequence, and the value of the
last expression in <em>body</em> is returned.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">begin</span>
  <span class="p">(</span><span class="k">print</span> <span class="s">&quot;This is a block of 2 expressions\n&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="k">print</span> <span class="s">&quot;================================&quot;</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p>Some built-in functions like <a href="#cond">cond</a>, <a href="#define">define</a>,
<a href="#doargs">doargs</a>, <a href="#dolist">dolist</a>, <a href="#dostring">dostring</a>,
<a href="#dotimes">dotimes</a>, <a href="#when">when</a> and <a href="#while">while</a> already
allow multiple expressions in their bodies, but <span class="monospaced">begin</span> is often used in
an <a href="#if">if</a> expression.</p></div>
<div class="paragraph"><p>The <a href="#silent">silent</a> function works like <span class="monospaced">begin</span>, but suppresses
console output on return.</p></div>
<div class="paragraph"><p><a id="beta"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_beta_span"><span class="big red">beta</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (beta <em>cum-a</em> <em>num-b</em>)</p></div>
<div class="paragraph"><p>The <em>Beta</em> function, <span class="monospaced">beta</span>, is derived from the <em>log Gamma</em> <span class="monospaced">gammaln</span>
function as follows:</p></div>
<div class="paragraph"><p><em>*beta = exp(gammaln(a) + gammaln(b) - gammaln(a + b))*</em></p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">beta</span> <span class="ss">1</span> <span class="ss">2</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">0.5</span>
</pre></div></div></div>
<div class="paragraph"><p><a id="betai"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_betai_span"><span class="big red">betai</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (betai <em>num-x</em> <em>num-a</em> <em>num-b</em>)</p></div>
<div class="paragraph"><p>The <em>Incomplete Beta</em> function, <span class="monospaced">betai</span>, equals the cumulative
probability of the <em>Beta</em> distribution, <span class="monospaced">betai</span>, at <em>x</em> in <em>num-x</em>. The
cumulative binomial distribution is defined as the probability of an
event, <em>pev</em>, with probability <em>p</em> to occur <em>k</em> or more times in <em>N</em>
trials:</p></div>
<div class="paragraph"><p><em>*pev = Betai(p, k, N - k + 1)*</em></p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">betai</span> <span class="ss">0.5</span> <span class="ss">3</span> <span class="ss">8</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">0.9453125</span>
</pre></div></div></div>
<div class="paragraph"><p>The example calculates the probability for an event with a probability
of 0.5 to occur 3 or more times in 10 trials (8 = 10 - 3 + 1). The
incomplete Beta distribution can be used to derive a variety of other
functions in mathematics and statistics. See also the
<a href="#binomial">binomial</a> function.</p></div>
<div class="paragraph"><p><a id="bind"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_bind_a_href_destructive_a_span"><span class="big red">bind <a href="#destructive">!</a></span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (bind <em>list-variable-associations</em> [<em>bool-eval</em>])</p></div>
<div class="paragraph"><p><em>list-variable-associations</em> contains an association list of symbols and
their values. <span class="monospaced">bind</span> sets all symbols to their associated values.</p></div>
<div class="paragraph"><p>The associated values are evaluated if the <em>bool-eval</em> flag is <span class="monospaced">true</span>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">lst</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">a</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">))</span> <span class="p">(</span><span class="nv">b</span> <span class="s">&quot;hello&quot;</span><span class="p">)))</span>

<span class="p">(</span><span class="k">bind</span> <span class="ss">lst</span><span class="p">)</span>         <span class="err">→</span> <span class="s">&quot;hello&quot;</span>

<span class="ss">a</span>    <span class="err">→</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">)</span>
<span class="ss">b</span>    <span class="err">→</span> <span class="s">&quot;hello&quot;</span>

<span class="p">(</span><span class="k">bind</span> <span class="ss">lst</span> <span class="k">true</span><span class="p">)</span>    <span class="err">→</span> <span class="s">&quot;hello&quot;</span>

<span class="ss">a</span>    <span class="err">→</span> <span class="ss">7</span>
</pre></div></div></div>
<div class="paragraph"><p>The return value of bind is the value of the last association.</p></div>
<div class="paragraph"><p><span class="monospaced">bind</span> is often used to bind association lists returned by
<a href="#unify">unify</a>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">bind</span> <span class="p">(</span><span class="k">unify</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">p</span> <span class="ss">X</span> <span class="ss">Y</span> <span class="ss">a</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">p</span> <span class="ss">Y</span> <span class="ss">X</span> <span class="ss">X</span><span class="p">)))</span>    <span class="err">→</span> <span class="ss">a</span>

<span class="ss">X</span>    <span class="err">→</span> <span class="ss">a</span>
<span class="ss">Y</span>    <span class="err">→</span> <span class="ss">a</span>
</pre></div></div></div>
<div class="paragraph"><p>This can be used for de-structuring:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">structure</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">one</span> <span class="s">&quot;two&quot;</span><span class="p">)</span> <span class="ss">3</span> <span class="p">(</span><span class="nv">four</span> <span class="p">(</span><span class="nv">x</span> <span class="ss">y</span> <span class="ss">z</span><span class="p">))))</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">pattern</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">A</span> <span class="ss">B</span><span class="p">)</span> <span class="ss">C</span> <span class="p">(</span><span class="nv">D</span> <span class="ss">E</span><span class="p">)))</span>
<span class="p">(</span><span class="k">bind</span> <span class="p">(</span><span class="k">unify</span> <span class="ss">pattern</span> <span class="ss">structure</span><span class="p">))</span>

<span class="ss">A</span> <span class="err">→</span> <span class="ss">one</span>
<span class="ss">B</span> <span class="err">→</span> <span class="s">&quot;two&quot;</span>
<span class="ss">C</span> <span class="err">→</span> <span class="ss">3</span>
<span class="ss">D</span> <span class="err">→</span> <span class="ss">four</span>
<span class="ss">E</span> <span class="err">→</span> <span class="p">(</span><span class="nv">x</span> <span class="ss">y</span> <span class="ss">z</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p><a href="#unify">unify</a> returns an association list and <span class="monospaced">bind</span> binds the
associations.</p></div>
<div class="paragraph"><p><a id="binomial"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_binomial_span"><span class="big red">binomial</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (binomial <em>int-n</em> <em>int-k</em> <em>float-p</em>)</p></div>
<div class="paragraph"><p>The binomial distribution function is defined as the probability for an
event to occur <em>int-k</em> times in <em>int-n</em> trials if that event has a
probability of <em>float-p</em> and all trials are independent of one another:</p></div>
<div class="paragraph"><p><em>*binomial = pow(p, k) * pow(1.0 - p, n - k) * n! / (k! * (n - k)!)*</em></p></div>
<div class="paragraph"><p>where <em>x!</em> is the factorial of <em>x</em> and <em>pow(x, y)</em> is <em>x</em> raised to the
power of <em>y</em>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">binomial</span> <span class="ss">10</span> <span class="ss">3</span> <span class="ss">0.5</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">0.1171875</span>
</pre></div></div></div>
<div class="paragraph"><p>The example calculates the probability for an event with a probability
of 0.5 to occur 3 times in 10 trials. For a cumulated distribution, see
the <a href="#betai">betai</a> function.</p></div>
<div class="paragraph"><p><a id="bits"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_bits_span"><span class="big red">bits</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (bits <em>int</em> [<em>bool</em>])</p></div>
<div class="paragraph"><p>Transforms a number in <em>int</em> to a string of 1&#8217;s and 0&#8217;s or a list, if
<em>bool</em> evaluates to anything not <span class="monospaced">nil</span>.</p></div>
<div class="paragraph"><p>In string representation bits are in high to low order. In list
presentation 1&#8217;s and 0&#8217;s are represented as <span class="monospaced">true</span> and <span class="monospaced">nil</span> and in
order from the lowest to the highest bit. This allows direct indexing
and program control switching on the result.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">bits</span> <span class="ss">1234</span><span class="p">)</span>      <span class="err">→</span> <span class="s">&quot;10011010010&quot;</span>

<span class="p">(</span><span class="k">int</span> <span class="p">(</span><span class="k">bits</span> <span class="ss">1234</span><span class="p">)</span> <span class="ss">0</span> <span class="ss">2</span><span class="p">)</span> <span class="err">→</span> <span class="ss">1234</span>

<span class="p">(</span><span class="k">bits</span> <span class="ss">1234</span> <span class="k">true</span><span class="p">)</span>     <span class="err">→</span> <span class="p">(</span><span class="k">nil</span> <span class="k">true</span> <span class="k">nil</span> <span class="k">nil</span> <span class="k">true</span> <span class="k">nil</span> <span class="k">true</span> <span class="k">true</span> <span class="k">nil</span> <span class="k">nil</span> <span class="k">true</span><span class="p">)</span>

<span class="p">((</span><span class="k">bits</span> <span class="ss">1234</span> <span class="k">true</span><span class="p">)</span> <span class="ss">0</span><span class="p">)</span> <span class="err">→</span> <span class="k">nil</span> <span class="c1">; indexing of the result</span>
</pre></div></div></div>
<div class="paragraph"><p><a href="#int">int</a> with a base of 2 is the inverse function to <span class="monospaced">bits</span>.</p></div>
<div class="paragraph"><p><a id="callback"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_callback_span"><span class="big red">callback</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (callback <em>int-index</em> <em>sym-function</em>)<br>
<strong>syntax:</strong> (callback <em>sym-function</em> <em>str-return-type</em> [<em>str_param_type</em> &#8230;])<br>
<strong>stntax:</strong> (callback <em>sym-function</em>)</p></div>
<div class="paragraph"><p>In the first <strong>simple <span class="monospaced">callback</span> syntax</strong> up to sixteen (0 to 15)
<em>callback</em> functions for up to eight parameters can be registered with
imported libraries. The <span class="monospaced">callback</span> function returns a procedure address
that invokes a user-defined function in <em>sym-function</em>. The following
example shows the usage of callback functions when importing the
<a href="http://www.opengl.org">OpenGL</a> graphics library:</p></div>
<div class="paragraph"><p>If more than sixteen callback functions are required, slots must be
reassigned to a different callback function.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="ss">...</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">draw</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">glClear</span> <span class="ss">GL_COLOR_BUFFER_BIT</span> <span class="p">)</span>
    <span class="p">(</span><span class="nv">glRotated</span> <span class="ss">rotx</span> <span class="ss">0.0</span> <span class="ss">1.0</span> <span class="ss">0.0</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">glRotated</span> <span class="ss">roty</span> <span class="ss">1.0</span> <span class="ss">0.0</span> <span class="ss">0.0</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">glutWireTeapot</span> <span class="ss">0.5</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">glutSwapBuffers</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">keyboard</span> <span class="ss">key</span> <span class="ss">x</span> <span class="ss">y</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">=</span> <span class="p">(</span><span class="nv">&amp;</span> <span class="ss">key</span> <span class="ss">0xFF</span><span class="p">)</span> <span class="ss">27</span><span class="p">)</span> <span class="p">(</span><span class="k">exit</span><span class="p">))</span> <span class="c1">; exit program with ESC</span>
    <span class="p">(</span><span class="k">println</span> <span class="s">&quot;key:&quot;</span> <span class="p">(</span><span class="nv">&amp;</span> <span class="ss">key</span> <span class="ss">0xFF</span><span class="p">)</span> <span class="s">&quot; x:&quot;</span> <span class="ss">x</span>  <span class="s">&quot; y:&quot;</span> <span class="ss">y</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">mouse</span> <span class="ss">button</span> <span class="ss">state</span> <span class="ss">x</span> <span class="ss">y</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">=</span> <span class="ss">state</span> <span class="ss">0</span><span class="p">)</span>
        <span class="p">(</span><span class="nv">glutIdleFunc</span> <span class="ss">0</span><span class="p">)</span> <span class="c1">; stop rotation on button press</span>
        <span class="p">(</span><span class="nv">glutIdleFunc</span> <span class="p">(</span><span class="k">callback</span> <span class="ss">4</span> <span class="o">&#39;</span><span class="ss">rotation</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">println</span> <span class="s">&quot;button: &quot;</span> <span class="ss">button</span> <span class="s">&quot; state:&quot;</span> <span class="ss">state</span> <span class="s">&quot; x:&quot;</span> <span class="ss">x</span> <span class="s">&quot; y:&quot;</span> <span class="ss">y</span><span class="p">))</span>

<span class="p">(</span><span class="nv">glutDisplayFunc</span> <span class="p">(</span><span class="k">callback</span> <span class="ss">0</span> <span class="o">&#39;</span><span class="ss">draw</span><span class="p">))</span>
<span class="p">(</span><span class="nv">glutKeyboardFunc</span> <span class="p">(</span><span class="k">callback</span> <span class="ss">1</span> <span class="o">&#39;</span><span class="ss">keyboard</span><span class="p">))</span>
<span class="p">(</span><span class="nv">glutMouseFunc</span> <span class="p">(</span><span class="k">callback</span> <span class="ss">2</span> <span class="o">&#39;</span><span class="ss">mouse</span><span class="p">))</span>
<span class="ss">...</span>
</pre></div></div></div>
<div class="paragraph"><p>The address returned by <span class="monospaced">callback</span> is registered with the
<a href="http://www.opengl.org/documentation/specs/glut/spec3/spec3.html">Glut</a>
library. The above code is a snippet from the file <span class="monospaced">opengl-demo.lsp</span>, in
the <span class="monospaced">examples/</span> directory of the source distribution of newLISP.</p></div>
<div class="paragraph"><p>In the second <strong>extended <span class="monospaced">callback</span> syntax</strong> type specifiers are used to
describe the functions return and parameter value types when the
function is called. An unlimited number of callback functions can be
registered with the second syntax, and return values are passed back to
the calling function. The symbol in <em>sym-function</em> contains a newLISP
defined function used as a callback function callable from a C program.</p></div>
<div class="paragraph"><p>In the third syntax <span class="monospaced">callback</span> returns a previously returned C-callable
address for that symbol.</p></div>
<div class="paragraph"><p>While the first simple <span class="monospaced">callback</span> syntax only handles integers and
pointer values, <span class="monospaced">callback</span> in the expanded syntax can also handle simple
and double precision floationg point numbers passed in an out of the
<span class="monospaced">callback</span> function.</p></div>
<div class="paragraph"><p>Both the simple and extended syntax can be mixed inside the same
program.</p></div>
<div class="paragraph"><p>The following example shows the <a href="#import">import</a> of the <span class="monospaced">qsort</span> C
library function, which takes as one of it&#8217;s arguments the address of a
comparison function. The comparison function in this case is written in
newLISP and called into by the imported <span class="monospaced">qsort</span> function:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">; C void qsort(...) takes an integer array with number and width</span>
<span class="c1">; of array elements and a pointer to the comparison function</span>
<span class="p">(</span><span class="k">import</span> <span class="s">&quot;libc.dylib&quot;</span> <span class="s">&quot;qsort&quot;</span> <span class="s">&quot;void&quot;</span> <span class="s">&quot;void*&quot;</span> <span class="s">&quot;int&quot;</span> <span class="s">&quot;int&quot;</span> <span class="s">&quot;void*&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">rlist</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">2</span> <span class="ss">3</span> <span class="ss">1</span> <span class="ss">2</span> <span class="ss">4</span> <span class="ss">4</span> <span class="ss">3</span> <span class="ss">3</span> <span class="ss">0</span> <span class="ss">3</span><span class="p">))</span>
<span class="c1">; pack the list into an C readable 32-bit integer array</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">carray</span> <span class="p">(</span><span class="k">pack</span> <span class="p">(</span><span class="k">dup</span> <span class="s">&quot;ld &quot;</span> <span class="ss">10</span><span class="p">)</span> <span class="ss">rlist</span><span class="p">))</span>

<span class="c1">; the comparison callback function receives pointers to integers</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">cmp</span> <span class="ss">a</span> <span class="ss">b</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">-</span> <span class="p">(</span><span class="k">get-int</span> <span class="ss">a</span><span class="p">)</span> <span class="p">(</span><span class="k">get-int</span> <span class="ss">b</span><span class="p">)))</span>

<span class="c1">; generate a C callable address for cmp</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">func</span> <span class="p">(</span><span class="k">callback</span> <span class="o">&#39;</span><span class="ss">cmp</span> <span class="s">&quot;int&quot;</span> <span class="s">&quot;void*&quot;</span> <span class="s">&quot;void*&quot;</span><span class="p">))</span>

<span class="c1">; sort the carray</span>
<span class="p">(</span><span class="nv">qsort</span> <span class="ss">carray</span> <span class="ss">10</span> <span class="ss">4</span> <span class="ss">func</span><span class="p">)</span>

<span class="c1">; unpack the sorted array into a LISP list</span>
<span class="p">(</span><span class="k">unpack</span> <span class="p">(</span><span class="k">dup</span> <span class="s">&quot;ld&quot;</span> <span class="ss">10</span><span class="p">)</span> <span class="ss">carray</span><span class="p">)</span>  <span class="err">→</span>  <span class="p">(</span><span class="nv">0</span> <span class="ss">1</span> <span class="ss">2</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">3</span> <span class="ss">3</span> <span class="ss">3</span> <span class="ss">4</span> <span class="ss">4</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>As type specifiers the same string tags can be used as in the
<a href="#import">import</a> function. All pointer types are passed as numbers
in and out of the <span class="monospaced">callback</span> function. The functions
<a href="#get-char">get-char</a>, <a href="#get-int">get-int</a>,
<a href="#get-long">get-long</a> and <a href="#get-string">get-string</a> can be used to
extract numbers of different precision from parameters. Use
<a href="#pack">pack</a> and <a href="#unpack">unpack</a> to extract data from binary
buffers and structures.</p></div>
<div class="paragraph"><p>Note that newLISP as already a fast built-in <a href="#sort">sort</a> function.</p></div>
<div class="paragraph"><p><a id="case"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_case_span"><span class="big red">case</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (case <em>exp-switch</em> (<em>exp-1</em> <em>body-1</em>) [(<em>exp-2</em> <em>body-2</em>) &#8230; ])</p></div>
<div class="paragraph"><p>The result of evaluating <em>exp-switch</em> is compared to each of the
<em>unevaluated</em> expressions <em>exp-1, exp-2,</em> —. If a match is found, the
corresponding expressions in <em>body</em> are evaluated. The result of the
last body expression is returned as the result for the entire <span class="monospaced">case</span>
expression.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">translate</span> <span class="ss">n</span><span class="p">)</span>
  <span class="p">(</span><span class="k">case</span> <span class="ss">n</span>
    <span class="p">(</span><span class="nv">1</span> <span class="s">&quot;one&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">2</span> <span class="s">&quot;two&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">3</span> <span class="s">&quot;three&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">4</span> <span class="s">&quot;four&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="k">true</span> <span class="s">&quot;Can&#39;t translate this&quot;</span><span class="p">)))</span>

<span class="p">(</span><span class="nv">translate</span> <span class="ss">3</span><span class="p">)</span>   <span class="err">→</span> <span class="s">&quot;three&quot;</span>
<span class="p">(</span><span class="nv">translate</span> <span class="ss">10</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;Can&#39;t translate this&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>The example shows how, if no match is found, the last expression in the
body of a <span class="monospaced">case</span> function can be evaluated.</p></div>
<div class="paragraph"><p><a id="catch"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_catch_span"><span class="big red">catch</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (catch <em>exp</em>)<br>
<strong>syntax:</strong> (catch <em>exp</em> <em>symbol</em>)</p></div>
<div class="paragraph"><p>In the first syntax, <span class="monospaced">catch</span> will return the result of the evaluation of
<em>exp</em> or the evaluated argument of a <a href="#throw">throw</a> executed during
the evaluation of <em>exp</em>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">catch</span> <span class="p">(</span><span class="k">dotimes</span> <span class="p">(</span><span class="nv">x</span> <span class="ss">1000</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">=</span> <span class="ss">x</span> <span class="ss">500</span><span class="p">)</span> <span class="p">(</span><span class="k">throw</span> <span class="ss">x</span><span class="p">))))</span>  <span class="err">→</span> <span class="ss">500</span>
</pre></div></div></div>
<div class="paragraph"><p>This form is useful for breaking out of iteration loops and for forcing
an early return from a function or expression block:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">foo</span> <span class="ss">x</span><span class="p">)</span>
   <span class="err">…</span>
  <span class="p">(</span><span class="k">if</span> <span class="ss">condition</span> <span class="p">(</span><span class="k">throw</span> <span class="ss">123</span><span class="p">))</span>
    <span class="err">…</span>
  <span class="ss">456</span><span class="p">)</span>

<span class="c1">;; if condition is true</span>

<span class="p">(</span><span class="k">catch</span> <span class="p">(</span><span class="nv">foo</span> <span class="ss">p</span><span class="p">))</span>  <span class="err">→</span> <span class="ss">123</span>

<span class="c1">;; if condition is not true</span>

<span class="p">(</span><span class="k">catch</span> <span class="p">(</span><span class="nv">foo</span> <span class="ss">p</span><span class="p">))</span>  <span class="err">→</span> <span class="ss">456</span>
</pre></div></div></div>
<div class="paragraph"><p>In the second syntax, <span class="monospaced">catch</span> evaluates the expression <em>exp</em>, stores the
result in <em>symbol</em>, and returns <span class="monospaced">true</span>. If an error occurs during
evaluation, <span class="monospaced">catch</span> returns <span class="monospaced">nil</span> and stores the error message in
<em>symbol</em>. This form can be useful when errors are expected as a normal
potential outcome of a function and are dealt with during program
execution.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">catch</span> <span class="p">(</span><span class="nv">func</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">)</span> <span class="o">&#39;</span><span class="ss">result</span><span class="p">)</span>  <span class="err">→</span> <span class="k">nil</span>
<span class="ss">result</span>
<span class="err">→</span> <span class="s">&quot;ERR: invalid function in function catch : (func 3 4)&quot;</span>

<span class="p">(</span><span class="k">constant</span> <span class="o">&#39;</span><span class="ss">func</span> <span class="ss">+</span><span class="p">)</span>          <span class="err">→</span> <span class="ss">+</span> <span class="k">&lt;</span><span class="ss">4068A6&gt;</span>
<span class="p">(</span><span class="k">catch</span> <span class="p">(</span><span class="nv">func</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">)</span> <span class="o">&#39;</span><span class="ss">result</span><span class="p">)</span>  <span class="err">→</span> <span class="k">true</span>
<span class="ss">result</span>                      <span class="err">→</span> <span class="ss">7</span>
</pre></div></div></div>
<div class="paragraph"><p>When a <a href="#throw">throw</a> is executed during the evaluation of <em>exp</em>,
<span class="monospaced">catch</span> will return <span class="monospaced">true</span>, and the <span class="monospaced">throw</span> argument will be stored in
<em>symbol</em>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">catch</span> <span class="p">(</span><span class="k">dotimes</span> <span class="p">(</span><span class="nv">x</span> <span class="ss">100</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">=</span> <span class="ss">x</span> <span class="ss">50</span><span class="p">)</span> <span class="p">(</span><span class="k">throw</span> <span class="s">&quot;fin&quot;</span><span class="p">))</span> <span class="o">&#39;</span><span class="ss">result</span><span class="p">)</span>  <span class="err">→</span> <span class="k">true</span>

<span class="ss">result</span>  <span class="err">→</span> <span class="s">&quot;fin&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>As well as being used for early returns from functions and for breaking
out of iteration loops (as in the first syntax), the second syntax of
<span class="monospaced">catch</span> can also be used to catch errors. The
<a href="#throw-error">throw-error</a> function may be used to throw
user-defined errors.</p></div>
<div class="paragraph"><p><a id="ceil"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_ceil_span"><span class="big red">ceil</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (ceil <em>number</em>)</p></div>
<div class="paragraph"><p>Returns the next highest integer above <em>number</em> as a floating point.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">ceil</span> <span class="k">-</span><span class="ss">1.5</span><span class="p">)</span>  <span class="err">→</span> <span class="k">-</span><span class="ss">1</span>
<span class="p">(</span><span class="k">ceil</span> <span class="ss">3.4</span><span class="p">)</span>   <span class="err">→</span> <span class="ss">4</span>
</pre></div></div></div>
<div class="paragraph"><p>See also the <a href="#floor">floor</a> function.</p></div>
<div class="paragraph"><p><a id="change-dir"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_change_dir_span"><span class="big red">change-dir</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (change-dir <em>str-path</em>)</p></div>
<div class="paragraph"><p>Changes the current directory to be the one given in <em>str-path</em>. If
successful, <span class="monospaced">true</span> is returned; otherwise <span class="monospaced">nil</span> is returned.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">change-dir</span> <span class="s">&quot;/etc&quot;</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Makes <span class="monospaced">/etc</span> the current directory.</p></div>
<div class="paragraph"><p><a id="char"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_char_a_href_utf8_capable_utf8_a_span"><span class="big red">char <a href="#utf8_capable">utf8</a></span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (char <em>str</em> [<em>int-index</em> [true]])<br>
<strong>syntax:</strong> (char <em>int</em>)</p></div>
<div class="paragraph"><p>Given a string argument, extracts the character at <em>int-index</em> from
<em>str</em>, returning either the ASCII value of that character or the Unicode
value on UTF-8 enabled versions of newLISP.</p></div>
<div class="paragraph"><p>If <em>int-index</em> is omitted, 0 (zero) is assumed. If <em>int-idx</em> is followed
by a boolean <span class="monospaced">true</span> value, than the index treats <em>str</em> as an 8-bit byte
array instead of an array of multi-byte UTF-8 characters.</p></div>
<div class="paragraph"><p>The empty string returns <span class="monospaced">nil</span>. Both <span class="monospaced">(char 0)</span> and <span class="monospaced">(char nil)</span> will
return <span class="monospaced">"\000"</span>.</p></div>
<div class="paragraph"><p>See <a href="#indexing">Indexing elements of strings and lists</a>.</p></div>
<div class="paragraph"><p>Given an integer argument, <span class="monospaced">char</span> returns a string containing the ASCII
character with value <em>int</em>.</p></div>
<div class="paragraph"><p>On UTF-8–enabled versions of newLISP, the value in <em>int</em> is taken as
Unicode and a UTF-8 character is returned.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">char</span> <span class="s">&quot;ABC&quot;</span><span class="p">)</span>          <span class="err">→</span> <span class="ss">65</span>  <span class="c1">; ASCII code for &quot;A&quot;</span>
<span class="p">(</span><span class="k">char</span> <span class="s">&quot;ABC&quot;</span> <span class="ss">1</span><span class="p">)</span>        <span class="err">→</span> <span class="ss">66</span>  <span class="c1">; ASCII code for &quot;B&quot;</span>
<span class="p">(</span><span class="k">char</span> <span class="s">&quot;ABC&quot;</span> <span class="k">-</span><span class="ss">1</span><span class="p">)</span>       <span class="err">→</span> <span class="ss">67</span>  <span class="c1">; ASCII code for &quot;C&quot;</span>
<span class="p">(</span><span class="k">char</span> <span class="s">&quot;B&quot;</span><span class="p">)</span>            <span class="err">→</span> <span class="ss">66</span>  <span class="c1">; ASCII code for &quot;B&quot;</span>
<span class="p">(</span><span class="k">char</span> <span class="s">&quot;Ω&quot;</span><span class="p">)</span>            <span class="err">→</span> <span class="ss">937</span> <span class="c1">; UTF-8 code for &quot;Ω&quot;</span>
<span class="p">(</span><span class="k">char</span> <span class="s">&quot;Ω&quot;</span> <span class="ss">1</span> <span class="k">true</span><span class="p">)</span>     <span class="err">→</span> <span class="ss">169</span> <span class="c1">; byte value at offset 1</span>

<span class="p">(</span><span class="k">char</span> <span class="ss">65</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;A&quot;</span>
<span class="p">(</span><span class="k">char</span> <span class="ss">66</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;B&quot;</span>

<span class="p">(</span><span class="k">char</span> <span class="p">(</span><span class="k">char</span> <span class="ss">65</span><span class="p">))</span>  <span class="err">→</span> <span class="ss">65</span>      <span class="c1">; two inverse applications</span>

<span class="p">(</span><span class="k">map</span> <span class="k">char</span> <span class="p">(</span><span class="k">sequence</span> <span class="ss">1</span> <span class="ss">255</span><span class="p">))</span>  <span class="c1">; returns current character set</span>

<span class="c1">; The Zen of UTF-8</span>
<span class="p">(</span><span class="k">char</span> <span class="p">(</span><span class="nv">&amp;</span> <span class="p">(</span><span class="k">char</span> <span class="s">&quot;生&quot;</span><span class="p">)</span> <span class="p">(</span><span class="k">char</span> <span class="s">&quot;死&quot;</span><span class="p">)))</span> <span class="err">→</span> <span class="err">愛</span> <span class="c1">; by @kosh_bot</span>
</pre></div></div></div>
<div class="paragraph"><p><a id="chop"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_chop_a_href_utf8_capable_utf8_a_span"><span class="big red">chop <a href="#utf8_capable">utf8</a></span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (chop <em>str</em> [<em>int-chars</em>])<br>
<strong>syntax:</strong> (chop <em>list</em> [<em>int-elements</em>])</p></div>
<div class="paragraph"><p>If the first argument evaluates to a string, <span class="monospaced">chop</span> returns a copy of
<em>str</em> with the last <em>int-char</em> characters omitted. If the <em>int-char</em>
argument is absent, one character is omitted. <span class="monospaced">chop</span> does not alter
<em>str</em>.</p></div>
<div class="paragraph"><p>If the first argument evaluates to a list, a copy of <em>list</em> is returned
with <em>int-elements</em> omitted (same as for strings).</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">str</span> <span class="s">&quot;newLISP&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;newLISP&quot;</span>

<span class="p">(</span><span class="k">chop</span> <span class="ss">str</span><span class="p">)</span>    <span class="err">→</span> <span class="s">&quot;newLIS&quot;</span>
<span class="p">(</span><span class="k">chop</span> <span class="ss">str</span> <span class="ss">2</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;newLI&quot;</span>

<span class="ss">str</span>  <span class="err">→</span> <span class="s">&quot;newLISP&quot;</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">lst</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="p">(</span><span class="nv">c</span> <span class="ss">d</span><span class="p">)</span> <span class="ss">e</span><span class="p">))</span>

<span class="p">(</span><span class="k">chop</span> <span class="ss">lst</span><span class="p">)</span>    <span class="err">→</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="p">(</span><span class="nv">c</span> <span class="ss">d</span><span class="p">))</span>
<span class="p">(</span><span class="k">chop</span> <span class="ss">lst</span> <span class="ss">2</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">b</span><span class="p">)</span>

<span class="ss">lst</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="p">(</span><span class="nv">c</span> <span class="ss">d</span><span class="p">)</span> <span class="ss">e</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p><a id="clean"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_clean_span"><span class="big red">clean</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (clean <em>exp-predicate</em> <em>list</em>)</p></div>
<div class="paragraph"><p>The predicate <em>exp-predicate</em> is applied to each element of <em>list</em>. In
the returned list, all elements for which <em>exp-predicate</em> is <span class="monospaced">true</span> are
eliminated.</p></div>
<div class="paragraph"><p><span class="monospaced">clean</span> works like <a href="#filter">filter</a> with a negated predicate.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">clean</span> <span class="ss">symbol?</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">d</span> <span class="ss">4</span> <span class="ss">f</span> <span class="ss">g</span> <span class="ss">5</span> <span class="ss">h</span><span class="p">))</span>   <span class="err">→</span> <span class="p">(</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">4</span> <span class="ss">5</span><span class="p">)</span>

<span class="p">(</span><span class="k">filter</span> <span class="ss">symbol?</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">d</span> <span class="ss">4</span> <span class="ss">f</span> <span class="ss">g</span> <span class="ss">5</span> <span class="ss">h</span><span class="p">))</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">d</span> <span class="ss">f</span> <span class="ss">g</span> <span class="ss">h</span><span class="p">)</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">big?</span> <span class="ss">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">&gt;</span> <span class="ss">x</span> <span class="ss">5</span><span class="p">))</span>        <span class="err">→</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">&gt;</span> <span class="ss">x</span> <span class="ss">5</span><span class="p">))</span>

<span class="p">(</span><span class="k">clean</span> <span class="ss">big?</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1</span> <span class="ss">10</span> <span class="ss">3</span> <span class="ss">6</span> <span class="ss">4</span> <span class="ss">5</span> <span class="ss">11</span><span class="p">))</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">1</span> <span class="ss">3</span> <span class="ss">4</span> <span class="ss">5</span><span class="p">)</span>

<span class="p">(</span><span class="k">clean</span> <span class="ss">&lt;=</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">3</span> <span class="ss">4</span> <span class="k">-</span><span class="ss">6</span> <span class="ss">0</span> <span class="ss">2</span> <span class="k">-</span><span class="ss">3</span> <span class="ss">0</span><span class="p">))</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">3</span> <span class="ss">4</span> <span class="ss">2</span><span class="p">)</span>

<span class="p">(</span><span class="k">clean</span> <span class="p">(</span><span class="k">curry</span> <span class="k">match</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">*</span><span class="p">))</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">a</span> <span class="ss">10</span><span class="p">)</span> <span class="p">(</span><span class="nv">b</span> <span class="ss">5</span><span class="p">)</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">3</span><span class="p">)</span> <span class="p">(</span><span class="nv">c</span> <span class="ss">8</span><span class="p">)</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">9</span><span class="p">)))</span>
<span class="err">→</span>  <span class="p">((</span><span class="nv">b</span> <span class="ss">5</span><span class="p">)</span> <span class="p">(</span><span class="nv">c</span> <span class="ss">8</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p>The predicate may be a built-in predicate or a user-defined function or
lambda expression.</p></div>
<div class="paragraph"><p>For cleaning numbers from one list using numbers from another, use
<a href="#difference">difference</a> or <a href="#intersect">intersect</a> (with the
list mode option).</p></div>
<div class="paragraph"><p>See also the related function <a href="#index">index</a>, which returns the
indices of the remaining elements, and <a href="#filter">filter</a>, which
returns all elements for which a predicate returns true.</p></div>
<div class="paragraph"><p><a id="close"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_close_span"><span class="big red">close</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (close <em>int-file</em>)</p></div>
<div class="paragraph"><p>Closes the file specified by the file handle in <em>int-file</em>. The handle
would have been obtained from a previous <a href="#open">open</a> operation. If
successful, <span class="monospaced">close</span> returns <span class="monospaced">true</span>; otherwise <span class="monospaced">nil</span> is returned.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">close</span> <span class="p">(</span><span class="k">device</span><span class="p">))</span>  <span class="err">→</span> <span class="k">true</span>
<span class="p">(</span><span class="k">close</span> <span class="ss">7</span><span class="p">)</span>         <span class="err">→</span> <span class="k">true</span>
<span class="p">(</span><span class="k">close</span> <span class="ss">aHandle</span><span class="p">)</span>   <span class="err">→</span> <span class="k">true</span>
</pre></div></div></div>
<div class="paragraph"><p>Note that using <span class="monospaced">close</span> on <a href="#device">device</a> automatically resets it
to 0 (zero, the screen device).</p></div>
<div class="paragraph"><p><a id="command-event"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_command_event_span"><span class="big red">command-event</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (command-event <em>sym-event-handler</em> | <em>func-event-handler</em>)</p></div>
<div class="paragraph"><p>Specifies a user defined function for pre-processing the newLISP
command-line before it gets evaluated. This can be used to write
customized interactive newLISP shells and to transform HTTP requests
when running in server mode.</p></div>
<div class="paragraph"><p><span class="monospaced">command-event</span> takes either a symbol of a user-defined function or a
lambda function. The event-handler function must return a string or the
command-line will be passed untranslated to newLISP.</p></div>
<div class="paragraph"><p>To only force a prompt, the function should return the empty string
<span class="monospaced">""</span>.</p></div>
<div class="paragraph"><p>The following example makes the newLISP shell work like a normal Unix
shell when the command starts with a letter. But starting the line with
an open parenthesis or a space initiates a newLISP evaluation.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">command-event</span> <span class="p">(</span><span class="k">fn</span> <span class="p">(</span><span class="nv">s</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="k">starts-with</span> <span class="ss">s</span> <span class="s">&quot;[a-zA-Z]&quot;</span> <span class="ss">0</span><span class="p">)</span> <span class="p">(</span><span class="k">append</span> <span class="s">&quot;!&quot;</span> <span class="ss">s</span><span class="p">)</span> <span class="ss">s</span><span class="p">)))</span>
</pre></div></div></div>
<div class="paragraph"><p>See also the related <a href="#prompt-event">prompt-event</a> which can be used
for further customizing interactive mode by modifying the newLISP
prompt.</p></div>
<div class="paragraph"><p>The following program can be used either stand-alone or included in
newLISP&#8217;s <span class="monospaced">init.lsp</span> startup file:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="cp">#!/usr/bin/newlisp</span>

<span class="c1">; set the prompt to the current directory name</span>
<span class="p">(</span><span class="k">prompt-event</span> <span class="p">(</span><span class="k">fn</span> <span class="p">(</span><span class="nv">ctx</span><span class="p">)</span> <span class="p">(</span><span class="k">append</span> <span class="p">(</span><span class="k">real-path</span><span class="p">)</span> <span class="s">&quot;&gt; &quot;</span><span class="p">)))</span>

<span class="c1">; pre-process the command-line</span>
<span class="p">(</span><span class="k">command-event</span> <span class="p">(</span><span class="k">fn</span> <span class="p">(</span><span class="nv">s</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if</span>
        <span class="p">(</span><span class="k">starts-with</span> <span class="ss">s</span> <span class="s">&quot;cd&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="k">string</span> <span class="s">&quot; &quot;</span> <span class="p">(</span><span class="k">true</span><span class="ss">?</span> <span class="p">(</span><span class="k">change-dir</span> <span class="p">(</span><span class="k">last</span> <span class="p">(</span><span class="k">parse</span> <span class="ss">s</span> <span class="s">&quot; &quot;</span><span class="p">)))))</span>

        <span class="p">(</span><span class="k">starts-with</span> <span class="ss">s</span> <span class="s">&quot;[a-zA-Z]&quot;</span> <span class="ss">0</span><span class="p">)</span>
        <span class="p">(</span><span class="k">append</span> <span class="s">&quot;!&quot;</span> <span class="ss">s</span><span class="p">)</span>

        <span class="k">true</span> <span class="ss">s</span><span class="p">)))</span>
</pre></div></div></div>
<div class="paragraph"><p>In the definition of the command-line translation function the Unix
command <span class="monospaced">cd</span> gets a special treatment, to make sure that the directory
is changed for newLISP process too. This way when shelling out with <span class="monospaced">!</span>
and coming back, newLISP will maintain the changed directory.</p></div>
<div class="paragraph"><p>Command lines for newLISP must start either with a space or an opening
parenthesis. Unix commands must start at the beginning of the line.</p></div>
<div class="paragraph"><p>When newLISP is running in server mode either using the <span class="monospaced">-c</span> or <span class="monospaced">-http</span>
option, it receives HTTP requests similar to the following:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>GET /index.html</pre>
</div></div>
<div class="paragraph"><p>Or if a query is involved:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>GET /index.cgi?userid=joe&amp;password=secret</pre>
</div></div>
<div class="paragraph"><p>A function specified by <span class="monospaced">command-event</span> could filter and transform these
request lines, e.g.: discovering all queries trying to perform CGI using
a file ending in <span class="monospaced">.exe</span>. Such a request would be translated into a
request for an error page:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">;; httpd-conf.lsp</span>
<span class="c1">;;</span>
<span class="c1">;; filter and translate HTTP requests for newLISP</span>
<span class="c1">;; -c or -http server modes</span>
<span class="c1">;; reject query commands using CGI with .exe files</span>

<span class="p">(</span><span class="k">command-event</span> <span class="p">(</span><span class="k">fn</span> <span class="p">(</span><span class="nv">s</span><span class="p">)</span>
    <span class="p">(</span><span class="k">local</span> <span class="p">(</span><span class="nv">request</span><span class="p">)</span>
        <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="k">find</span> <span class="s">&quot;?&quot;</span> <span class="ss">s</span><span class="p">)</span> <span class="c1">; is this a query</span>
            <span class="p">(</span><span class="k">begin</span>
                <span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">request</span> <span class="p">(</span><span class="k">first</span> <span class="p">(</span><span class="k">parse</span> <span class="ss">s</span> <span class="s">&quot;?&quot;</span><span class="p">)))</span>
                <span class="c1">; discover illegal extension in queries</span>
                <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="k">ends-with</span> <span class="ss">request</span> <span class="s">&quot;.exe&quot;</span><span class="p">)</span>
                    <span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">request</span> <span class="s">&quot;GET /errorpage.html&quot;</span><span class="p">)</span>
                    <span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">request</span> <span class="ss">s</span><span class="p">)))</span>
            <span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">request</span> <span class="ss">s</span><span class="p">))</span>
        <span class="ss">request</span><span class="p">)</span>
<span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p>When starting the server mode with
<span class="monospaced">newlisp httpd-conf.lsp -c -d80 -w ./httpdoc</span> newLISP will load the
definition for <span class="monospaced">command-event</span> for filtering incoming requests, and the
query:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>GET /cmd.exe?dir</pre>
</div></div>
<div class="paragraph"><p>Would be translated into:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>GET /errorpage.html</pre>
</div></div>
<div class="paragraph"><p>The example shows a technique frequently used in the past by spammers on
Win32 based, bad configured web servers to gain control over servers.</p></div>
<div class="paragraph"><p><span class="monospaced">httpd-conf.lsp</span> files can easily be debugged loading the file into an
interactive newLISP session and entering the HTTP requests manually.
newLISP will translate the command line and dispatch it to the built-in
web server. The server output will appear in the shell window.</p></div>
<div class="paragraph"><p>Note, that the command line length as well as the line length in HTTP
headers is limited to 512 characters for newLISP.</p></div>
<div class="paragraph"><p><a id="cond"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_cond_span"><span class="big red">cond</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (cond (<em>exp-condition-1</em> <em>body-1</em>) [(<em>exp-condition-2</em> <em>body-2</em>) &#8230; ])</p></div>
<div class="paragraph"><p>Like <span class="monospaced">if</span>, <span class="monospaced">cond</span> conditionally evaluates the expressions within its
body. The <em>exp-condition_s are evaluated in turn, until some
_exp-condition-i</em> is found that evaluates to anything other than <span class="monospaced">nil</span>
or an empty list <span class="monospaced">()</span>. The result of evaluating <em>body-i</em> is then
returned as the result of the entire <em>cond-expression</em>. If all
conditions evaluate to <span class="monospaced">nil</span> or an empty list, <em>cond</em> returns the value
of the last <em>cond-expression</em>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">classify</span> <span class="ss">x</span><span class="p">)</span>
  <span class="p">(</span><span class="k">cond</span>
    <span class="p">((</span><span class="nv">&lt;</span> <span class="ss">x</span> <span class="ss">0</span><span class="p">)</span> <span class="s">&quot;negative&quot;</span><span class="p">)</span>
    <span class="p">((</span><span class="nv">&lt;</span> <span class="ss">x</span> <span class="ss">10</span><span class="p">)</span> <span class="s">&quot;small&quot;</span><span class="p">)</span>
    <span class="p">((</span><span class="nv">&lt;</span> <span class="ss">x</span> <span class="ss">20</span><span class="p">)</span> <span class="s">&quot;medium&quot;</span><span class="p">)</span>
    <span class="p">((</span><span class="nv">&gt;=</span> <span class="ss">x</span> <span class="ss">30</span><span class="p">)</span> <span class="s">&quot;big&quot;</span><span class="p">)))</span>

<span class="p">(</span><span class="nv">classify</span> <span class="ss">15</span><span class="p">)</span>   <span class="err">→</span> <span class="s">&quot;medium&quot;</span>
<span class="p">(</span><span class="nv">classify</span> <span class="ss">22</span><span class="p">)</span>   <span class="err">→</span> <span class="s">&quot;nil&quot;</span>
<span class="p">(</span><span class="nv">classify</span> <span class="ss">100</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;big&quot;</span>
<span class="p">(</span><span class="nv">classify</span> <span class="k">-</span><span class="ss">10</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;negative&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>When a <em>body-n</em> is missing, the value of the last <em>cond-expression</em>
evaluated is returned. If no condition evaluates to <span class="monospaced">true</span>, the value of
the last conditional expression is returned (i.e., <span class="monospaced">nil</span> or an empty
list).</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">cond</span> <span class="p">((</span><span class="nv">+</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">)))</span>  <span class="err">→</span> <span class="ss">7</span>
</pre></div></div></div>
<div class="paragraph"><p>When used with multiple arguments, the function <a href="#if">if</a> behaves
like <span class="monospaced">cond</span>, except it does not need extra parentheses to enclose the
condition-body pair of expressions.</p></div>
<div class="paragraph"><p><a id="cons"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_cons_span"><span class="big red">cons</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (cons <em>exp-1</em> <em>exp-2</em>)</p></div>
<div class="paragraph"><p>If <em>exp-2</em> evaluates to a list, then a list is returned with the result
of evaluating <em>exp-1</em> inserted as the first element. If <em>exp-2_evaluates
to anything other than a list, the results of evaluating _exp-1</em> and
<em>exp-2</em> are returned in a list. Note that there is no <em>dotted pair</em> in
newLISP: _cons_ing two atoms constructs a list, not a dotted pair.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">cons</span> <span class="o">&#39;</span><span class="ss">a</span> <span class="o">&#39;</span><span class="ss">b</span><span class="p">)</span>            <span class="err">→</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">b</span><span class="p">)</span>
<span class="p">(</span><span class="k">cons</span> <span class="o">&#39;</span><span class="ss">a</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">b</span> <span class="ss">c</span><span class="p">))</span>        <span class="err">→</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span><span class="p">)</span>
<span class="p">(</span><span class="k">cons</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">)</span> <span class="p">(</span><span class="nv">*</span> <span class="ss">5</span> <span class="ss">5</span><span class="p">))</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">7</span> <span class="ss">25</span><span class="p">)</span>
<span class="p">(</span><span class="k">cons</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1</span> <span class="ss">2</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">3</span> <span class="ss">4</span><span class="p">))</span>    <span class="err">→</span> <span class="p">((</span><span class="nv">1</span> <span class="ss">2</span><span class="p">)</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">)</span>
<span class="p">(</span><span class="k">cons</span> <span class="k">nil</span> <span class="ss">1</span><span class="p">)</span>            <span class="err">→</span> <span class="p">(</span><span class="k">nil</span> <span class="ss">1</span><span class="p">)</span>
<span class="p">(</span><span class="k">cons</span> <span class="ss">1</span> <span class="k">nil</span><span class="p">)</span>            <span class="err">→</span> <span class="p">(</span><span class="nv">1</span> <span class="k">nil</span><span class="p">)</span>
<span class="p">(</span><span class="k">cons</span> <span class="ss">1</span><span class="p">)</span>                <span class="err">→</span> <span class="p">(</span><span class="nv">1</span><span class="p">)</span>
<span class="p">(</span><span class="k">cons</span><span class="p">)</span>          <span class="err">→</span> <span class="p">()</span>
</pre></div></div></div>
<div class="paragraph"><p>Unlike other Lisps that return <span class="monospaced">(s)</span> as the result of the expression
<span class="monospaced">(cons 's nil)</span>, newLISP&#8217;s <span class="monospaced">cons</span> returns <span class="monospaced">(s nil)</span>. In newLISP, <span class="monospaced">nil</span>
is a Boolean value and is not equivalent to an empty list, and a newLISP
cell holds only one value.</p></div>
<div class="paragraph"><p><span class="monospaced">cons</span> behaves like the inverse operation of <a href="#first">first</a> and
<a href="#rest">rest</a> (or <a href="#first">first</a> and <a href="#last">last</a> if the list
is a pair):</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">cons</span> <span class="p">(</span><span class="k">first</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span><span class="p">))</span> <span class="p">(</span><span class="k">rest</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span><span class="p">)))</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span><span class="p">)</span>

<span class="p">(</span><span class="k">cons</span> <span class="p">(</span><span class="k">first</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">x</span> <span class="ss">y</span><span class="p">))</span> <span class="p">(</span><span class="k">last</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">x</span> <span class="ss">y</span><span class="p">)))</span>      <span class="err">→</span> <span class="p">(</span><span class="nv">x</span> <span class="ss">y</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p><a id="constant"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_constant_a_href_destructive_a_span"><span class="big red">constant <a href="#destructive">!</a></span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (constant <em>sym-1</em> <em>exp-1</em> [<em>sym-2</em> <em>exp-2</em>] &#8230;)</p></div>
<div class="paragraph"><p>Identical to <a href="#set">set</a> in functionality, <span class="monospaced">constant</span> further
protects the symbols from subsequent modification. A symbol set with
<span class="monospaced">constant</span> can only be modified using the <span class="monospaced">constant</span> function again.
When an attempt is made to modify the contents of a symbol protected
with <span class="monospaced">constant</span>, newLISP generates an error message. Only symbols from
the current context can be used with <span class="monospaced">constant</span>. This prevents the
overwriting of symbols that have been protected in their home context.
The last <em>exp-n</em> initializer is always optional.</p></div>
<div class="paragraph"><p>Symbols initialized with <a href="#set">set</a>, <a href="#define">define</a>, or
<a href="#define-macro">define-macro</a> can still be protected by using the
<span class="monospaced">constant</span> function:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">constant</span> <span class="o">&#39;</span><span class="ss">aVar</span> <span class="ss">123</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">123</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">aVar</span> <span class="ss">999</span><span class="p">)</span>
<span class="ss">ERR</span><span class="o">:</span> <span class="ss">symbol</span> <span class="ss">is</span> <span class="ss">protected</span> <span class="ss">in</span> <span class="ss">function</span> <span class="k">set</span><span class="o">:</span> <span class="ss">aVar</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">double</span> <span class="ss">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">x</span> <span class="ss">x</span><span class="p">))</span>

<span class="p">(</span><span class="k">constant</span> <span class="o">&#39;</span><span class="ss">double</span><span class="p">)</span>

<span class="c1">;; equivalent to</span>

<span class="p">(</span><span class="k">constant</span> <span class="o">&#39;</span><span class="ss">double</span> <span class="p">(</span><span class="k">fn</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">x</span> <span class="ss">x</span><span class="p">)))</span>
</pre></div></div></div>
<div class="paragraph"><p>The first example defines a constant, <span class="monospaced">aVar</span>, which can only be changed
by using another <span class="monospaced">constant</span> statement. The second example protects
<span class="monospaced">double</span> from being changed (except by <span class="monospaced">constant</span>). Because a function
definition in newLISP is equivalent to an assignment of a lambda
function, both steps can be collapsed into one, as shown in the last
statement line. This could be an important technique for avoiding
protection errors when a file is loaded multiple times.</p></div>
<div class="paragraph"><p>The last value to be assigned can be omitted. <span class="monospaced">constant</span> returns the
contents of the last symbol set and protected.</p></div>
<div class="paragraph"><p>Built-in functions can be assigned to symbols or to the names of other
built-in functions, effectively redefining them as different functions.
There is no performance loss when renaming functions.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">constant</span> <span class="o">&#39;</span><span class="ss">squareroot</span> <span class="k">sqrt</span><span class="p">)</span>  <span class="err">→</span> <span class="k">sqrt</span> <span class="k">&lt;</span><span class="ss">406C2E&gt;</span>
<span class="p">(</span><span class="k">constant</span> <span class="o">&#39;</span><span class="ss">+</span> <span class="k">add</span><span class="p">)</span>            <span class="err">→</span> <span class="k">add</span> <span class="k">&lt;</span><span class="ss">4068A6&gt;</span>
</pre></div></div></div>
<div class="paragraph"><p><span class="monospaced">squareroot</span> will behave like <span class="monospaced">sqrt</span>. The <span class="monospaced">+</span> (plus sign) is redefined
to use the mixed type floating point mode of <span class="monospaced">add</span>. The hexadecimal
number displayed in the result is the binary address of the built-in
function and varies on different platforms and OSes.</p></div>
<div class="paragraph"><p><a id="context"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_context_span"><span class="big red">context</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (context [<em>sym-context</em>])<br>
<strong>syntax:</strong> (context <em>sym-context</em> <em>str | sym</em> [<em>exp-value</em>])</p></div>
<div class="paragraph"><p>In the first syntax, <span class="monospaced">context</span> is used to switch to a different context
namespace. Subsequent <a href="#load">load</a>s of newLISP source or functions
like <a href="#eval-string">eval-string</a> and <a href="#sym">sym</a> will put newly
created symbols and function definitions in the new context.</p></div>
<div class="paragraph"><p>If the context still needs to be created, the symbol for the new context
should be specified. When no argument is passed to <span class="monospaced">context</span>, then the
symbol for the current context is returned.</p></div>
<div class="paragraph"><p>Because contexts evaluate to themselves, a quote is not necessary to
switch to a different context if that context already exists.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">context</span> <span class="o">&#39;</span><span class="ss">GRAPH</span><span class="p">)</span>          <span class="c1">; create / switch context GRAPH</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">foo-draw</span> <span class="ss">x</span> <span class="ss">y</span> <span class="ss">z</span><span class="p">)</span>  <span class="c1">; function resides in GRAPH</span>
  <span class="p">(</span><span class="err">…</span><span class="p">))</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">var</span> <span class="ss">12345</span><span class="p">)</span>
<span class="p">(</span><span class="k">symbols</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">foo-draw</span> <span class="ss">var</span><span class="p">)</span>  <span class="c1">; GRAPH has now two symbols</span>

<span class="p">(</span><span class="k">context</span> <span class="k">MAIN</span><span class="p">)</span>               <span class="c1">; switch back to MAIN (quote not required)</span>

<span class="p">(</span><span class="k">print</span> <span class="ss">GRAPH</span><span class="o">:</span><span class="ss">var</span><span class="p">)</span> <span class="err">→</span> <span class="ss">12345</span>    <span class="c1">; contents of symbol in GRAPH</span>

<span class="p">(</span><span class="nv">GRAPH</span><span class="o">:</span><span class="ss">foo-draw</span> <span class="ss">10</span> <span class="ss">20</span> <span class="ss">30</span><span class="p">)</span>    <span class="c1">; execute function in GRAPH</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">GRAPH</span><span class="o">:</span><span class="ss">var</span> <span class="ss">6789</span><span class="p">)</span>        <span class="c1">; assign to a symbol in GRAPH</span>
</pre></div></div></div>
<div class="paragraph"><p>If a context symbol is referred to before the context exists, the
context will be created implicitly.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">person</span><span class="o">:</span><span class="ss">age</span> <span class="ss">0</span><span class="p">)</span>       <span class="c1">; no need to create context first</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">person</span><span class="o">:</span><span class="k">address</span> <span class="s">&quot;&quot;</span><span class="p">)</span>  <span class="c1">; useful for quickly defining data structures</span>
</pre></div></div></div>
<div class="paragraph"><p>Contexts can be copied:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">new</span> <span class="ss">person</span> <span class="o">&#39;</span><span class="ss">JohnDoe</span><span class="p">)</span>  <span class="err">→</span>  <span class="ss">JohnDoe</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">JohnDoe</span><span class="o">:</span><span class="ss">age</span> <span class="ss">99</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Contexts can be referred to by a variable:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">human</span> <span class="ss">JohnDoe</span><span class="p">)</span>

<span class="ss">human</span><span class="o">:</span><span class="ss">age</span>  <span class="err">→</span> <span class="ss">99</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">human</span><span class="o">:</span><span class="k">address</span> <span class="s">&quot;1 Main Street&quot;</span><span class="p">)</span>

<span class="ss">JohnDoe</span><span class="o">:</span><span class="k">address</span>  <span class="err">→</span> <span class="s">&quot;1 Main Street&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>An evaluated context (no quote) can be given as an argument:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="ss">&gt;</span> <span class="p">(</span><span class="k">context</span> <span class="o">&#39;</span><span class="ss">FOO</span><span class="p">)</span>
<span class="ss">FOO</span>
<span class="ss">FOO&gt;</span> <span class="p">(</span><span class="k">context</span> <span class="k">MAIN</span><span class="p">)</span>
<span class="k">MAIN</span>
<span class="ss">&gt;</span> <span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">old</span> <span class="ss">FOO</span><span class="p">)</span>
<span class="ss">FOO</span>
<span class="ss">&gt;</span> <span class="p">(</span><span class="k">context</span> <span class="o">&#39;</span><span class="ss">BAR</span><span class="p">)</span>
<span class="ss">BAR</span>
<span class="ss">BAR&gt;</span> <span class="p">(</span><span class="k">context</span> <span class="k">MAIN</span><span class="o">:</span><span class="ss">old</span><span class="p">)</span>
<span class="ss">FOO</span>
<span class="ss">FOO&gt;</span>
</pre></div></div></div>
<div class="paragraph"><p>If an identifier with the same symbol already exists, it is redefined to
be a context.</p></div>
<div class="paragraph"><p>Symbols within the current context are referred to simply by their
names, as are built-in functions and special symbols like <span class="monospaced">nil</span> and
<span class="monospaced">true</span>. Symbols outside the current context are referenced by prefixing
the symbol name with the context name and a <span class="monospaced">:</span> (colon). To quote a
symbol in a different context, prefix the context name with a <span class="monospaced">'</span>
(single quote).</p></div>
<div class="paragraph"><p>Within a given context, symbols may be created with the same name as
built-in functions or context symbols in MAIN. This overwrites the
symbols in MAIN when they are prefixed with a context:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">context</span> <span class="o">&#39;</span><span class="ss">CTX</span><span class="p">)</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">CTX</span><span class="o">:</span><span class="k">new</span> <span class="ss">var</span><span class="p">)</span>
    <span class="p">(</span><span class="err">…</span><span class="p">))</span>

<span class="p">(</span><span class="k">context</span> <span class="o">&#39;</span><span class="k">MAIN</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p><span class="monospaced">CTX:new</span> will overwrite new in MAIN.</p></div>
<div class="paragraph"><p>In the second syntax, <span class="monospaced">context</span> can be used to create symbols in a
namespace. Note that this should not be used for creating hashes or
dictionaries. For a shorter, more convenient method to use namespaces as
hash-like dictionaries, see the chapter <a href="#hash">Hash functions and
dictionaries</a>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">;; create a symbol and store data in it</span>
<span class="p">(</span><span class="k">context</span> <span class="o">&#39;</span><span class="ss">Ctx</span> <span class="s">&quot;abc&quot;</span> <span class="ss">123</span><span class="p">)</span>   <span class="err">→</span> <span class="ss">123</span>
<span class="p">(</span><span class="k">context</span> <span class="o">&#39;</span><span class="ss">Ctx</span> <span class="o">&#39;</span><span class="ss">xyz</span> <span class="ss">999</span><span class="p">)</span>    <span class="err">→</span> <span class="ss">999</span>

<span class="c1">;; retrieve contents from  symbol</span>
<span class="p">(</span><span class="k">context</span> <span class="o">&#39;</span><span class="ss">Ctx</span> <span class="s">&quot;abc&quot;</span><span class="p">)</span>       <span class="err">→</span> <span class="ss">123</span>
<span class="p">(</span><span class="k">context</span> <span class="o">&#39;</span><span class="ss">Ctx</span> <span class="o">&#39;</span><span class="ss">xyz</span><span class="p">)</span>        <span class="err">→</span> <span class="ss">999</span>
<span class="ss">Ctx</span><span class="o">:</span><span class="ss">abc</span>                    <span class="err">→</span> <span class="ss">123</span>
<span class="ss">Ctx</span><span class="o">:</span><span class="ss">xyz</span>                    <span class="err">→</span> <span class="ss">999</span>
</pre></div></div></div>
<div class="paragraph"><p>The first three statements create a symbol and store a value of any data
type inside. The first statement also creates the context named <span class="monospaced">Ctx</span>.
When a symbol is specified for the name, the name is taken from the
symbol and creates a symbol with the same name in the context <span class="monospaced">Ctx</span>.</p></div>
<div class="paragraph"><p>Symbols can contain spaces or any other special characters not typically
allowed in newLISP symbols being used as variable names. This second
syntax of <span class="monospaced">context</span> only creates the new symbol and returns the value
contained in it. It does not switch to the new namespace.</p></div>
<div class="paragraph"><p><a id="context?"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_context_span_2"><span class="big red">context?</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (context? <em>exp</em>)<br>
<strong>syntax:</strong> (context? <em>exp</em> <em>str-sym</em>)</p></div>
<div class="paragraph"><p>In the first syntax, <em>context?</em> is a predicate that returns <span class="monospaced">true</span> only
if <em>exp</em> evaluates to a context; otherwise, it returns <span class="monospaced">nil</span>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">context</span><span class="ss">?</span> <span class="k">MAIN</span><span class="p">)</span>  <span class="err">→</span> <span class="k">true</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">x</span> <span class="ss">123</span><span class="p">)</span>
<span class="p">(</span><span class="k">context</span><span class="ss">?</span> <span class="ss">x</span><span class="p">)</span>     <span class="err">→</span> <span class="k">nil</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">FOO</span><span class="o">:</span><span class="ss">q</span> <span class="s">&quot;hola&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;hola&quot;</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">ctx</span> <span class="ss">FOO</span><span class="p">)</span>
<span class="p">(</span><span class="k">context</span><span class="ss">?</span> <span class="ss">ctx</span><span class="p">)</span>       <span class="err">→</span> <span class="k">true</span>  <span class="c1">; ctx contains context foo</span>
</pre></div></div></div>
<div class="paragraph"><p>The second syntax checks for the existence of a symbol in a context. The
symbol is specified by its name string in <em>str-sym</em>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">context</span><span class="ss">?</span> <span class="ss">FOO</span> <span class="s">&quot;q&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="k">true</span>
<span class="p">(</span><span class="k">context</span><span class="ss">?</span> <span class="ss">FOO</span> <span class="s">&quot;p&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="k">nil</span>
</pre></div></div></div>
<div class="paragraph"><p>Use <a href="#context">context</a> to change and create namespaces and to create
hash symbols in contexts.</p></div>
<div class="paragraph"><p><a id="copy"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_copy_span"><span class="big red">copy</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (copy <em>exp</em>)</p></div>
<div class="paragraph"><p>Make a copy from evaluating expression in <em>exp</em>. Some built-in functions
are <a href="#destructice">destructive</a>, changing the original contents of a
list, array or string they are working on. With <span class="monospaced">copy</span> their behavior
can be made non-destructive.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">aList</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span> <span class="ss">d</span> <span class="ss">e</span> <span class="ss">f</span><span class="p">))</span>

<span class="p">(</span><span class="k">replace</span> <span class="o">&#39;</span><span class="ss">c</span> <span class="p">(</span><span class="k">copy</span> <span class="ss">aList</span><span class="p">))</span> <span class="err">→</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">d</span> <span class="ss">e</span> <span class="ss">f</span><span class="p">)</span>

<span class="ss">aList</span> <span class="err">→</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span> <span class="ss">d</span> <span class="ss">e</span> <span class="ss">f</span><span class="p">)</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">str</span> <span class="s">&quot;newLISP&quot;</span><span class="p">)</span> <span class="err">→</span> <span class="s">&quot;newLISP&quot;</span>

<span class="p">(</span><span class="k">rotate</span> <span class="p">(</span><span class="k">copy</span> <span class="ss">str</span><span class="p">))</span> <span class="err">→</span> <span class="s">&quot;PnewLIS&quot;</span>

<span class="ss">str</span> <span class="err">→</span> <span class="s">&quot;newLISP&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>Using <span class="monospaced">copy</span> the functions <a href="#replace">replace</a> and
<a href="#rotate">rotate</a> are prevented from changing the data. A modified
version of the data is returned.</p></div>
<div class="paragraph"><p><a id="copy-file"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_copy_file_span"><span class="big red">copy-file</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (copy-file <em>str-from-name</em> <em>str-to-name</em>)</p></div>
<div class="paragraph"><p>Copies a file from a path-filename given in <em>str-from-name</em> to a
path-filename given in <em>str-to-name</em>. Returns <span class="monospaced">true</span> if the copy was
successful or <span class="monospaced">nil</span>, if the copy was unsuccessful.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">copy-file</span> <span class="s">&quot;/home/me/newlisp/data.lsp&quot;</span> <span class="s">&quot;/tmp/data.lsp&quot;</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p><a id="corr"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_corr_span"><span class="big red">corr</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (corr <em>list-vector-X</em> <em>list-vector-Y</em>)</p></div>
<div class="paragraph"><p>Calculates the <em>Pearson</em> product-moment correlation coefficient as a
measure of the linear relationship between the two variables in
<em>list-vector-X</em> and <em>list-vector-Y</em>. Both lists must be of same length.</p></div>
<div class="paragraph"><p><span class="monospaced">corr</span> returns a list containing the following values:</p></div>
<table class="tableblock frame-all grid-all"
style="
width:30%;
">
<col style="width:9%;">
<col style="width:90%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" >name </th>
<th class="tableblock halign-left valign-top" >description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">r</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Correlation coefficient</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">b0</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Regression coefficient offset</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">b1</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Regression coefficient slope</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">t</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">t - statistic for significance testing</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">df</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Degrees of freedom for t</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">p</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Two tailed probability of t under the null hyothesis</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">study-time</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">90</span> <span class="ss">100</span> <span class="ss">130</span> <span class="ss">150</span> <span class="ss">180</span> <span class="ss">200</span> <span class="ss">220</span> <span class="ss">300</span> <span class="ss">350</span> <span class="ss">400</span><span class="p">))</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">test-errors</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">25</span> <span class="ss">28</span> <span class="ss">20</span> <span class="ss">20</span> <span class="ss">15</span> <span class="ss">12</span> <span class="ss">13</span> <span class="ss">10</span> <span class="ss">8</span> <span class="ss">6</span><span class="p">))</span>

<span class="p">(</span><span class="nv">corr</span> <span class="ss">study-time</span> <span class="ss">test-errors</span><span class="p">)</span> <span class="err">→</span> <span class="p">(</span><span class="k">-</span><span class="ss">0.926</span> <span class="ss">29.241</span> <span class="k">-</span><span class="ss">0.064</span> <span class="k">-</span><span class="ss">6.944</span> <span class="ss">8</span> <span class="ss">0.0001190</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The negative correlation of <span class="monospaced">-0.926</span> between study time and test errors
is highly signficant with a two-tailed <span class="monospaced">p</span> of about <span class="monospaced">0.0001</span> under the
null hypothesis.</p></div>
<div class="paragraph"><p>The regression coefficients <span class="monospaced">b0 = 29.241</span> and <span class="monospaced">b1 = -0.064</span> can be used
to estimate values of the Y variable (test errors) from values in X
(study time) using the equation <span class="monospaced">Y = b0 + b1 * X</span>.</p></div>
<div class="paragraph"><p><a id="cos"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_cos_span"><span class="big red">cos</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (cos <em>num-radians</em>)</p></div>
<div class="paragraph"><p>Calculates the cosine of <em>num-radians</em> and returns the result.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">cos</span> <span class="ss">1</span><span class="p">)</span>                     <span class="err">→</span> <span class="ss">0.5403023059</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">pi</span> <span class="p">(</span><span class="k">mul</span> <span class="ss">2</span> <span class="p">(</span><span class="k">acos</span> <span class="ss">0</span><span class="p">)))</span>  <span class="err">→</span> <span class="ss">3.141592654</span>
<span class="p">(</span><span class="k">cos</span> <span class="ss">pi</span><span class="p">)</span>                    <span class="err">→</span> <span class="k">-</span><span class="ss">1</span>
</pre></div></div></div>
<div class="paragraph"><p><a id="cosh"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_cosh_span"><span class="big red">cosh</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (cosh <em>num-radians</em>)</p></div>
<div class="paragraph"><p>Calculates the hyperbolic cosine of <em>num-radians</em>. The hyperbolic cosine
is defined mathematically as: <em>(exp (x) + exp (-x)) / 2</em>. An overflow to
<span class="monospaced">inf</span> may occur if <em>num-radians</em> is too large.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">cosh</span> <span class="ss">1</span><span class="p">)</span>     <span class="err">→</span> <span class="ss">1.543080635</span>
<span class="p">(</span><span class="k">cosh</span> <span class="ss">10</span><span class="p">)</span>    <span class="err">→</span> <span class="ss">11013.23292</span>
<span class="p">(</span><span class="k">cosh</span> <span class="ss">1000</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">inf</span>
<span class="p">(</span><span class="nv">=</span> <span class="p">(</span><span class="k">cosh</span> <span class="ss">1</span><span class="p">)</span> <span class="p">(</span><span class="k">div</span> <span class="p">(</span><span class="k">add</span> <span class="p">(</span><span class="k">exp</span> <span class="ss">1</span><span class="p">)</span> <span class="p">(</span><span class="k">exp</span> <span class="k">-</span><span class="ss">1</span><span class="p">))</span> <span class="ss">2</span><span class="p">))</span>  <span class="err">→</span> <span class="k">true</span>
</pre></div></div></div>
<div class="paragraph"><p><a id="count"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_count_span"><span class="big red">count</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (count <em>list-1</em> <em>list-2</em>)</p></div>
<div class="paragraph"><p>Counts elements of <em>list-1</em> in <em>list-2</em> and returns a list of those
counts.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">count</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">3</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">3</span> <span class="ss">2</span> <span class="ss">1</span> <span class="ss">4</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">1</span> <span class="ss">1</span> <span class="ss">2</span> <span class="ss">2</span><span class="p">))</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">3</span> <span class="ss">4</span> <span class="ss">2</span><span class="p">)</span>
<span class="p">(</span><span class="k">count</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">z</span> <span class="ss">a</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">z</span> <span class="ss">d</span> <span class="ss">z</span> <span class="ss">b</span> <span class="ss">a</span> <span class="ss">z</span> <span class="ss">y</span> <span class="ss">a</span><span class="p">))</span>        <span class="err">→</span> <span class="p">(</span><span class="nv">3</span> <span class="ss">2</span><span class="p">)</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">lst</span> <span class="p">(</span><span class="k">explode</span> <span class="p">(</span><span class="k">read-</span><span class="ss">file</span> <span class="s">&quot;myFile.txt&quot;</span><span class="p">)))</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">letter-counts</span> <span class="p">(</span><span class="k">count</span> <span class="p">(</span><span class="k">unique</span> <span class="ss">lst</span><span class="p">)</span> <span class="ss">lst</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p>The second example counts all occurrences of different letters in
<span class="monospaced">myFile.txt</span>.</p></div>
<div class="paragraph"><p>The first list in <span class="monospaced">count</span>, which specifies the items to be counted in
the second list, should be unique. For items that are not unique, only
the first instance will carry a count; all other instances will display
<span class="monospaced">0</span> (zero).</p></div>
<div class="paragraph"><p><a id="cpymem"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_cpymem_span"><span class="big red">cpymem</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (cpymem <em>int-from-address</em> <em>int-to-address</em> <em>int-bytes</em>)</p></div>
<div class="paragraph"><p>Copies <em>int-bytes</em> of memory from <em>int-from-address</em> to
<em>int-to-address</em>. This function can be used for direct memory
writing/reading or for hacking newLISP internals (e.g., type bits in
newLISP cells, or building functions with binary executable code on the
fly).</p></div>
<div class="paragraph"><p>Note that this function should only be used when familiar with newLISP
internals. <span class="monospaced">cpymem</span> can crash the system or make it unstable if used
incorrectly.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">cpymem</span> <span class="p">(</span><span class="k">pack</span> <span class="s">&quot;c c&quot;</span> <span class="ss">0</span> <span class="ss">32</span><span class="p">)</span> <span class="p">(</span><span class="k">last</span> <span class="p">(</span><span class="k">dump</span> <span class="o">&#39;</span><span class="k">sym</span><span class="p">))</span> <span class="ss">2</span><span class="p">)</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">s</span> <span class="s">&quot;0123456789&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">cpymem</span> <span class="s">&quot;xxx&quot;</span> <span class="p">(</span><span class="nv">+</span> <span class="p">(</span><span class="k">address</span> <span class="ss">s</span><span class="p">)</span> <span class="ss">5</span><span class="p">)</span> <span class="ss">3</span><span class="p">)</span>

<span class="ss">s</span>  <span class="err">→</span> <span class="s">&quot;01234xxx89&quot;</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The first example would remove the protection bit in symbol <span class="monospaced">sym</span>. The
second example copies a string directly into a string variable.</p></div>
<div class="paragraph"><p>The following example creates a new function from scratch, runs a piece
of binary code, and adds up two numbers. This assembly language snippet
shows the x86 (Intel CPU) code to add up two numbers and return the
result:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre> <span class="err">55</span>       <span class="nf">push</span> <span class="nb">ebp</span>
 <span class="err">8</span><span class="nf">B</span> <span class="nv">EC</span>    <span class="nv">mov</span>  <span class="nb">ebp</span><span class="p">,</span> <span class="nb">esp</span>
 <span class="err">8</span><span class="nf">B</span> <span class="mi">45</span> <span class="mi">08</span> <span class="nv">mov</span>  <span class="nb">eax</span><span class="p">,</span> <span class="p">[</span><span class="nb">ebp</span><span class="o">+</span><span class="mi">08</span><span class="p">]</span>
 <span class="err">03</span> <span class="err">45</span> <span class="err">0</span><span class="nf">C</span> <span class="nv">add</span>  <span class="nb">eax</span><span class="p">,</span> <span class="p">[</span><span class="nb">ebp</span><span class="o">+</span><span class="mi">0</span><span class="nv">c</span><span class="p">]</span>
 <span class="err">5</span><span class="nf">D</span>       <span class="nv">pop</span>  <span class="nb">ebp</span>
 <span class="nf">C3</span>       <span class="nv">ret</span>

 <span class="c1">; for Win32/stdcall change last line</span>
 <span class="nf">C2</span> <span class="mi">08</span> <span class="mi">00</span> <span class="nv">ret</span>
</pre></div></div></div>
<div class="paragraph"><p>The binary representation is attached to a new function created in
newLISP:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">foo-code</span> <span class="p">(</span><span class="k">append</span>
     <span class="p">(</span><span class="k">pack</span> <span class="s">&quot;bbbbbbbbbb&quot;</span> <span class="ss">0x55</span> <span class="ss">0x8B</span> <span class="ss">0xEC</span> <span class="ss">0x8B</span> <span class="ss">0x45</span> <span class="ss">0x08</span> <span class="ss">0x03</span> <span class="ss">0x45</span> <span class="ss">0x0C</span> <span class="ss">0x5D</span><span class="p">)</span>
     <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">=</span> <span class="k">ostype</span> <span class="s">&quot;Win32&quot;</span><span class="p">)</span> <span class="p">(</span><span class="k">pack</span> <span class="s">&quot;bbb&quot;</span> <span class="ss">0xC2</span> <span class="ss">0x08</span> <span class="ss">0x00</span><span class="p">)</span> <span class="p">(</span><span class="k">pack</span> <span class="s">&quot;b&quot;</span> <span class="ss">0xC3</span><span class="p">))))</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">foo</span> <span class="k">print</span><span class="p">)</span>
<span class="p">(</span><span class="k">cpymem</span> <span class="p">(</span><span class="k">pack</span> <span class="s">&quot;ld&quot;</span> <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">=</span> <span class="k">ostype</span> <span class="s">&quot;Win32&quot;</span><span class="p">)</span> <span class="ss">2312</span> <span class="ss">1288</span><span class="p">))</span> <span class="p">(</span><span class="k">first</span> <span class="p">(</span><span class="k">dump</span> <span class="ss">foo</span><span class="p">))</span> <span class="ss">4</span><span class="p">)</span>
<span class="p">(</span><span class="k">cpymem</span> <span class="p">(</span><span class="k">pack</span> <span class="s">&quot;ld&quot;</span> <span class="p">(</span><span class="k">address</span> <span class="ss">foo-code</span><span class="p">))</span> <span class="p">(</span><span class="nv">+</span> <span class="p">(</span><span class="k">first</span> <span class="p">(</span><span class="k">dump</span> <span class="ss">foo</span><span class="p">))</span> <span class="ss">12</span><span class="p">)</span> <span class="ss">4</span><span class="p">)</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">foo-name</span> <span class="s">&quot;foo&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">cpymem</span> <span class="p">(</span><span class="k">pack</span> <span class="s">&quot;ld&quot;</span> <span class="ss">foo-name</span><span class="p">)</span> <span class="p">(</span><span class="nv">+</span> <span class="p">(</span><span class="k">first</span> <span class="p">(</span><span class="k">dump</span> <span class="ss">foo</span><span class="p">))</span> <span class="ss">8</span><span class="p">)</span> <span class="ss">4</span><span class="p">)</span>

<span class="p">(</span><span class="nv">foo</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">)</span>  <span class="err">→</span>  <span class="ss">7</span>
</pre></div></div></div>
<div class="paragraph"><p>The last example will not work on all hardware platforms and OSs.</p></div>
<div class="paragraph"><p>Use the <a href="#dump">dump</a> function to retrieve binary addresses and the
contents from newLISP cells.</p></div>
<div class="paragraph"><p><a id="crc32"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_crc32_span"><span class="big red">crc32</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (crc32 <em>str-data</em>)</p></div>
<div class="paragraph"><p>Calculates a running 32-bit CRC (Circular Redundancy Check) sum from the
buffer in <em>str-data</em>, starting with a CRC of <span class="monospaced">0xffffffff</span> for the first
byte. <span class="monospaced">crc32</span> uses an algorithm published by
<a href="http://www.w3.org">www.w3.org</a>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">crc32</span> <span class="s">&quot;abcdefghijklmnopqrstuvwxyz&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">1277644989</span>
</pre></div></div></div>
<div class="paragraph"><p><span class="monospaced">crc32</span> is often used to verify data integrity in unsafe data
transmissions.</p></div>
<div class="paragraph"><p><a id="crit-chi2"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_crit_chi2_span"><span class="big red">crit-chi2</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (crit-chi2 <em>num-probability</em> <em>int-df</em>)</p></div>
<div class="paragraph"><p>Calculates the critical minimum <em>Chi²</em> for a given confidence
probability <em>num-probability</em> under the null hypothesis and the degrees
of freedom in <em>int-df</em> for testing the significance of a statistical
null hypothesis.</p></div>
<div class="paragraph"><p>Note that versions prior to 10.2.0 took <em>(1.0 - p)</em> for the probability
instead of <em>p</em>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">crit-chi2</span> <span class="ss">0.01</span> <span class="ss">4</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">13.27670443</span>
</pre></div></div></div>
<div class="paragraph"><p>See also the inverse function <a href="#prob-chi2">prob-chi2</a>.</p></div>
<div class="paragraph"><p><a id="crit-f"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_crit_f_span"><span class="big red">crit-f</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (crit-f <em>num-probability</em> <em>int-df1</em> <em>int-df2</em>)</p></div>
<div class="paragraph"><p>Calculates the critical minimum <em>F</em> for a given confidence probability
<em>num-probability</em> under the null hypothesis and the degrees of freedmom
given in <em>int-df1</em> and <em>int-df2</em> for testing the significance of a
statistical null hypothesis using the <em>F-test</em>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="nv">crit-f</span> <span class="ss">0.05</span> <span class="ss">10</span> <span class="ss">12</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">2.753386727</span>
</pre></div></div></div>
<div class="paragraph"><p>See also the inverse function <a href="#prob-f">prob-f</a>.</p></div>
<div class="paragraph"><p><a id="crit-t"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_crit_t_span"><span class="big red">crit-t</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (crit-t <em>num-probability</em> <em>int-df</em>)</p></div>
<div class="paragraph"><p>Calculates the critical minimum <em>Student&#8217;s t</em> for a given confidence
probability <em>num-probability</em> under the null hypothesis and the degrees
of freedom in <em>int-df</em> for testing the significance of a statistical
null hypothesis.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="nv">crit-t</span> <span class="ss">0.05</span> <span class="ss">14</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">1.761310142</span>
</pre></div></div></div>
<div class="paragraph"><p>See also the inverse function <a href="#prob-t">prob-t</a>.</p></div>
<div class="paragraph"><p><a id="crit-z"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_crit_z_span"><span class="big red">crit-z</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (crit-z <em>num-probability</em>)</p></div>
<div class="paragraph"><p>Calculates the critical normal distributed Z value of a given cumulated
probability <em>num-probability</em> for testing of statistical significance
and confidence intervals.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">crit-z</span> <span class="ss">0.999</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">3.090232372</span>
</pre></div></div></div>
<div class="paragraph"><p>See also the inverse function <a href="#prob-z">prob-z</a>.</p></div>
<div class="paragraph"><p><a id="current-line"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_current_line_span"><span class="big red">current-line</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (current-line)</p></div>
<div class="paragraph"><p>Retrieves the contents of the last <a href="#read-line">read-line</a> operation.
<span class="monospaced">current-line</span>'s contents are also implicitly used when
<a href="#write-line">write-line</a> is called without a string parameter.</p></div>
<div class="paragraph"><p>The following source shows the typical code pattern for creating a Unix
command-line filter:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="cp">#!/usr/bin/newlisp</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">inFile</span> <span class="p">(</span><span class="k">open</span> <span class="p">(</span><span class="k">main-args</span> <span class="ss">2</span><span class="p">)</span> <span class="s">&quot;read&quot;</span><span class="p">))</span>
<span class="p">(</span><span class="k">while</span> <span class="p">(</span><span class="k">read-</span><span class="ss">line</span> <span class="ss">inFile</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="k">starts-with</span> <span class="p">(</span><span class="k">current-line</span><span class="p">)</span> <span class="s">&quot;;;&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="k">write-</span><span class="ss">line</span><span class="p">)))</span>
<span class="p">(</span><span class="k">exit</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The program is invoked:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="ss">./filter</span> <span class="ss">myfile.lsp</span>
</pre></div></div></div>
<div class="paragraph"><p>This displays all comment lines starting with <span class="monospaced">;;</span> from a file given as
a command-line argument when invoking the script <span class="monospaced">filter</span>.</p></div>
<div class="paragraph"><p><a id="curry"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_curry_span"><span class="big red">curry</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (curry <em>func</em> <em>exp</em>)</p></div>
<div class="paragraph"><p>Transforms <em>func</em> from a function <em>f(x, y)</em> that takes two arguments
into a function <em>fx(y)</em> that takes a single argument. <span class="monospaced">curry</span> works like
a macro in that it does not evaluate its arguments. Instead, they are
evaluated during the application of <em>func</em>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">f</span> <span class="p">(</span><span class="k">curry</span> <span class="ss">+</span> <span class="ss">10</span><span class="p">))</span>  <span class="err">→</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="k">$</span><span class="ss">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">10</span> <span class="k">$</span><span class="ss">x</span><span class="p">))</span>

<span class="p">(</span><span class="nv">f</span> <span class="ss">7</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">17</span>

<span class="p">(</span><span class="k">filter</span> <span class="p">(</span><span class="k">curry</span> <span class="k">match</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">*</span><span class="p">))</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">a</span> <span class="ss">10</span><span class="p">)</span> <span class="p">(</span><span class="nv">b</span> <span class="ss">5</span><span class="p">)</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">3</span><span class="p">)</span> <span class="p">(</span><span class="nv">c</span> <span class="ss">8</span><span class="p">)</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">9</span><span class="p">)))</span>
<span class="err">→</span>  <span class="p">((</span><span class="nv">a</span> <span class="ss">10</span><span class="p">)</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">3</span><span class="p">)</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">9</span><span class="p">))</span>

<span class="p">(</span><span class="k">clean</span> <span class="p">(</span><span class="k">curry</span> <span class="k">match</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">*</span><span class="p">))</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">a</span> <span class="ss">10</span><span class="p">)</span> <span class="p">(</span><span class="nv">b</span> <span class="ss">5</span><span class="p">)</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">3</span><span class="p">)</span> <span class="p">(</span><span class="nv">c</span> <span class="ss">8</span><span class="p">)</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">9</span><span class="p">)))</span>
<span class="err">→</span>  <span class="p">((</span><span class="nv">b</span> <span class="ss">5</span><span class="p">)</span> <span class="p">(</span><span class="nv">c</span> <span class="ss">8</span><span class="p">))</span>

<span class="p">(</span><span class="k">map</span> <span class="p">(</span><span class="k">curry</span> <span class="k">list</span> <span class="o">&#39;</span><span class="ss">x</span><span class="p">)</span> <span class="p">(</span><span class="k">sequence</span> <span class="ss">1</span> <span class="ss">5</span><span class="p">))</span>
<span class="err">→</span>  <span class="p">((</span><span class="nv">x</span> <span class="ss">1</span><span class="p">)</span> <span class="p">(</span><span class="nv">x</span> <span class="ss">2</span><span class="p">)</span> <span class="p">(</span><span class="nv">x</span> <span class="ss">3</span><span class="p">)</span> <span class="p">(</span><span class="nv">x</span> <span class="ss">4</span><span class="p">)</span> <span class="p">(</span><span class="nv">x</span> <span class="ss">5</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p><span class="monospaced">curry</span> can be used on all functions taking two arguments.</p></div>
<div class="paragraph"><p><a id="date"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_date_a_href_utf8_capable_utf8_a_span"><span class="big red">date <a href="#utf8_capable">utf8</a></span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (date)<br>
<strong>syntax:</strong> (date <em>int-secs</em> [<em>int-offset</em>])<br>
<strong>syntax:</strong> (date <em>int-secs</em> <em>int-offset</em> <em>str-format</em>)</p></div>
<div class="paragraph"><p>The first syntax returns the local time zone&#8217;s current date and time as
a string representation. If <em>int-secs</em> is out of range, <span class="monospaced">nil</span> is
returned.</p></div>
<div class="paragraph"><p>In the second syntax, <span class="monospaced">date</span> translates the number of seconds in
<em>int-secs</em> into its date/time string representation for the local time
zone. The number in <em>int-secs</em> is usually retrieved from the system
using <a href="#date-value">date-value</a>. Optionally, a time-zone offset (in
minutes) can be specified in <em>int-offset</em>, which is added or subtracted
before conversion of <em>int-sec</em> to a string. If <em>int-secs</em> is out of
range or an invalid <em>str-format</em> is specified, an empty string <span class="monospaced">""</span> is
returned.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">date</span><span class="p">)</span>                   <span class="err">→</span> <span class="s">&quot;Fri Oct 29 09:56:58 2004&quot;</span>

<span class="p">(</span><span class="k">date</span> <span class="p">(</span><span class="k">date-value</span><span class="p">))</span>      <span class="err">→</span> <span class="s">&quot;Sat May 20 11:37:15 2006&quot;</span>
<span class="p">(</span><span class="k">date</span> <span class="p">(</span><span class="k">date-value</span><span class="p">)</span> <span class="ss">300</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;Sat May 20 16:37:19 2006&quot;</span>  <span class="c1">; 5 hours offset</span>
<span class="p">(</span><span class="k">date</span> <span class="ss">0</span><span class="p">)</span>                 <span class="err">→</span> <span class="s">&quot;Wed Dec 31 16:00:00 1969&quot;</span>
<span class="p">(</span><span class="k">date</span> <span class="ss">0</span> <span class="p">(</span><span class="k">now</span> <span class="ss">0</span> <span class="k">-</span><span class="ss">2</span><span class="p">))</span>      <span class="err">→</span> <span class="s">&quot;Thu Jan  1 00:00:00 1970&quot;</span>  <span class="c1">; Unix epoch</span>
</pre></div></div></div>
<div class="paragraph"><p>The way the date and time are presented in a string depends on the
underlying operating system.</p></div>
<div class="paragraph"><p>The second example would show 1-1-1970 0:0 when in the Greenwich time
zone, but it displays a time lag of 8 hours when in Pacific Standard
Time (PST). <span class="monospaced">date</span> assumes the <em>int-secs</em> given are in Coordinated
Universal Time (UTC; formerly Greenwich Mean Time (GMT)) and converts it
according to the local time-zone.</p></div>
<div class="paragraph"><p>The third syntax makes the date string fully customizable by using a
format specified in <em>str-format</em>. This allows the day and month names to
be translated into results appropriate for the current locale:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set-locale</span> <span class="s">&quot;german&quot;</span><span class="p">)</span> <span class="err">→</span> <span class="s">&quot;de_DE&quot;</span>

<span class="c1">; on Linux - no leading 0 on day with %-d</span>
<span class="p">(</span><span class="k">date</span> <span class="p">(</span><span class="k">date-value</span><span class="p">)</span> <span class="ss">0</span> <span class="s">&quot;%A %-d. %B %Y&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;Montag  7. März 2005&quot;</span>

<span class="p">(</span><span class="k">set-locale</span> <span class="s">&quot;C&quot;</span><span class="p">)</span>  <span class="c1">; default POSIX</span>

<span class="p">(</span><span class="k">date</span> <span class="p">(</span><span class="k">date-value</span><span class="p">)</span> <span class="ss">0</span> <span class="s">&quot;%A %B %d %Y&quot;</span><span class="p">)</span>    <span class="err">→</span> <span class="s">&quot;Monday March 07 2005&quot;</span>

<span class="c1">; suppressing leading 0 on Win32 using #</span>
<span class="p">(</span><span class="k">date</span> <span class="p">(</span><span class="k">date-value</span><span class="p">)</span> <span class="ss">0</span> <span class="s">&quot;%a %#d %b %Y&quot;</span><span class="p">)</span>   <span class="err">→</span> <span class="s">&quot;Mon 7 Mar 2005&quot;</span>

<span class="p">(</span><span class="k">set-locale</span> <span class="s">&quot;german&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">date</span> <span class="p">(</span><span class="k">date-value</span><span class="p">)</span> <span class="ss">0</span> <span class="s">&quot;%x&quot;</span><span class="p">)</span> <span class="err">→</span> <span class="s">&quot;07.03.2005&quot;</span>   <span class="c1">; day month year</span>

<span class="p">(</span><span class="k">set-locale</span> <span class="s">&quot;C&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">date</span> <span class="p">(</span><span class="k">date-value</span><span class="p">)</span> <span class="ss">0</span> <span class="s">&quot;%x&quot;</span><span class="p">)</span> <span class="err">→</span> <span class="s">&quot;03/07/05&quot;</span>     <span class="c1">; month day year</span>
</pre></div></div></div>
<div class="paragraph"><p>The following table summarizes all format specifiers available on both
Win32 and Linux/Unix platforms. More format options are available on
Linux/Unix. For details, consult the manual page for the C function
<span class="monospaced">strftime()</span> of the individual platform&#8217;s C library.</p></div>
<table class="tableblock frame-all grid-all"
style="
width:75%;
">
<col style="width:9%;">
<col style="width:90%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" >format </th>
<th class="tableblock halign-left valign-top" >description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">%a</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">abbreviated weekday name according to the current locale</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">%A</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">full weekday name according to the current locale</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">%b</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">abbreviated month name according to the current locale</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">%B</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">full month name according to the current locale</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">%c</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">preferred date and time representation for the current locale</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">%d</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">day of the month as a decimal number (range 01–31)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">%H</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">hour as a decimal number using a 24-hour clock (range 00–23)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">%I</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">hour as a decimal number using a 12-hour clock (range 01–12)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">%j</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">day of the year as a decimal number (range 001–366)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">%m</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">month as a decimal number (range 01–12)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">%M</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">minute as a decimal number</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">%p</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">either <em>am</em> or <em>pm</em> according to the given time value or the
corresponding strings for the current locale</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">%S</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">second as a decimal number 0–61 (60 and 61 to account for
occasional leap seconds)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">%U</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">week number of the current year as a decimal number, starting with
the first Sunday as the first day of the first week</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">%w</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">day of the week as a decimal, Sunday being 0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">%W</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">week number of the current year as a decimal number, starting with
the first Monday as the first day of the first week</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">%x</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">preferred date representation for the current locale without the
time</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">%X</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">preferred time representation for the current locale without the
date</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">%y</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">year as a decimal number without a century (range 00–99)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">%Y</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">year as a decimal number including the century</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">%z</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">time zone or name or abbreviation (same as %Z on Win32, different
on Unix)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">%Z</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">time zone or name or abbreviation (same as %z on Win32, different
on Unix)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">%%</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">a literal <em>%</em> character</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>Leading zeroes in the display of decimal day numbers can be suppressed
using <span class="monospaced">"%-d"</span> on Linux and FreeBSD and using <span class="monospaced">"%e"</span> on OpenBSD,
SunOS/Solaris and Mac OS X. On Win32 use <span class="monospaced">"%#d"</span>.</p></div>
<div class="paragraph"><p>See also <a href="#date-value">date-value</a>, <a href="#date-list">date-list</a>,
<a href="#date-parse">date-parse</a>, <a href="#time-of-day">time-of-day</a>,
<a href="#time">time</a>, and <a href="#now">now</a>.</p></div>
<div class="paragraph"><p><a id="date-list"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_date_list_span"><span class="big red">date-list</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (date-list <em>int-seconds</em> [<em>int-index</em>])</p></div>
<div class="paragraph"><p>Returns a list of year, month, date, hours, minutes, seconds, day of
year and day of week from a time value given in seconds after January
1st, 1970 00:00:00. The date and time values aren given as UTC, which
may differ from the local timezone.</p></div>
<div class="paragraph"><p>The week-day value ranges from 1 to 7 for Monday thru Sunday.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">date-list</span> <span class="ss">1282479244</span><span class="p">)</span>      <span class="err">→</span> <span class="p">(</span><span class="nv">2010</span> <span class="ss">8</span> <span class="ss">22</span> <span class="ss">12</span> <span class="ss">14</span> <span class="ss">4</span> <span class="ss">234</span> <span class="ss">1</span><span class="p">)</span>
<span class="p">(</span><span class="k">date-list</span> <span class="ss">1282479244</span> <span class="ss">0</span><span class="p">)</span>    <span class="err">→</span> <span class="ss">2010</span> <span class="c1">; year</span>
<span class="p">(</span><span class="k">date-list</span> <span class="ss">1282479244</span> <span class="k">-</span><span class="ss">2</span><span class="p">)</span>   <span class="err">→</span> <span class="ss">234</span>  <span class="c1">; day of year</span>

<span class="p">(</span><span class="k">apply</span> <span class="k">date-value</span> <span class="p">(</span><span class="k">date-list</span> <span class="ss">1282479244</span><span class="p">))</span> <span class="err">→</span> <span class="ss">1282479244</span>

<span class="p">(</span><span class="k">date-list</span> <span class="ss">0</span><span class="p">)</span>   <span class="err">→</span> <span class="p">(</span><span class="nv">1970</span> <span class="ss">1</span> <span class="ss">1</span> <span class="ss">0</span> <span class="ss">0</span> <span class="ss">0</span> <span class="ss">1</span> <span class="ss">4</span><span class="p">)</span> <span class="c1">; Thursday 1st, Jan 1900</span>
</pre></div></div></div>
<div class="paragraph"><p>A second optional <em>int-index</em> parameter can be used to return a specific
member of the list.</p></div>
<div class="paragraph"><p><span class="monospaced">date-list</span> is the inverse operation of <a href="#date-value">date-value</a>.</p></div>
<div class="paragraph"><p><a id="date-parse"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_date_parse_span"><span class="big red">date-parse</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (date-parse <em>str-date</em> <em>str-format</em>)</p></div>
<div class="paragraph"><p>Parses a date from a text string in <em>str-date</em> using a format as defined
in <em>str-format</em>, which uses the same formatting rules found in
<a href="#date">date</a>. The function <span class="monospaced">date-parse</span> returns the number of UTC
seconds passed since January 1st, 1970 UTC starting with 0 and up to
2147472000 for a date of January 19th, 2038. For dates before January
1st 1970, negative values are returned down to a value of -2147472000
for December 14th, 1901.</p></div>
<div class="paragraph"><p>This function is not available on Win32 platforms. The function was
named <span class="monospaced">parse-date</span> in previous versions. The old form is deprecated.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">date-parse</span> <span class="s">&quot;2007.1.3&quot;</span> <span class="s">&quot;%Y.%m.%d&quot;</span><span class="p">)</span>    <span class="err">→</span> <span class="ss">1167782400</span>
<span class="p">(</span><span class="k">date-parse</span> <span class="s">&quot;January 10, 07&quot;</span> <span class="s">&quot;%B %d, %y&quot;</span><span class="p">)</span>    <span class="err">→</span> <span class="ss">1168387200</span>

<span class="c1">; output of date-parse as input value to date-list produces the same date</span>

<span class="p">(</span><span class="k">date-list</span> <span class="p">(</span><span class="k">date-parse</span> <span class="s">&quot;2010.10.18 7:00&quot;</span> <span class="s">&quot;%Y.%m.%d %H:%M&quot;</span><span class="p">))</span>
<span class="err">→</span> <span class="p">(</span><span class="nv">2010</span> <span class="ss">10</span> <span class="ss">18</span> <span class="ss">7</span> <span class="ss">0</span> <span class="ss">0</span> <span class="ss">290</span> <span class="ss">1</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>See the <a href="#date">date</a> function for all possible format descriptors.</p></div>
<div class="paragraph"><p><a id="date-value"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_date_value_span"><span class="big red">date-value</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (date-value <em>int-year</em> <em>int-month</em> <em>int-day</em> [<em>int-hour</em> <em>int-min</em> <em>int-sec</em>])<br>
<strong>syntax:</strong> (date-value)</p></div>
<div class="paragraph"><p>In the first syntax, <span class="monospaced">date-value</span> returns the time in seconds since
1970-1-1 00:00:00 for a given date and time. The parameters for the
hour, minutes, and seconds are optional. The time is assumed to be
Coordinated Universal Time (UTC), not adjusted for the current time
zone.</p></div>
<div class="paragraph"><p>In the second syntax, <span class="monospaced">date-value</span> returns the time value in seconds for
the current time.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">date-value</span> <span class="ss">2002</span> <span class="ss">2</span> <span class="ss">28</span><span class="p">)</span>       <span class="err">→</span> <span class="ss">1014854400</span>
<span class="p">(</span><span class="k">date-value</span> <span class="ss">1970</span> <span class="ss">1</span> <span class="ss">1</span> <span class="ss">0</span> <span class="ss">0</span> <span class="ss">0</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">0</span>

<span class="p">(</span><span class="k">date</span> <span class="p">(</span><span class="k">apply</span> <span class="k">date-value</span> <span class="p">(</span><span class="k">now</span><span class="p">)))</span>  <span class="err">→</span> <span class="s">&quot;Wed May 24 10:02:47 2006&quot;</span>
<span class="p">(</span><span class="k">date</span> <span class="p">(</span><span class="k">date-value</span><span class="p">))</span>              <span class="err">→</span> <span class="s">&quot;Wed May 24 10:02:47 2006&quot;</span>
<span class="p">(</span><span class="k">date</span><span class="p">)</span>                           <span class="err">→</span> <span class="s">&quot;Wed May 24 10:02:47 2006&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>The function <a href="#date-list">date-list</a> can be used to transform a
<span class="monospaced">date-value</span> back into a list:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">date-list</span> <span class="ss">1014854400</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">2002</span> <span class="ss">2</span> <span class="ss">28</span> <span class="ss">0</span> <span class="ss">0</span> <span class="ss">0</span><span class="p">)</span>
<span class="p">(</span><span class="k">apply</span> <span class="k">date-value</span> <span class="p">(</span><span class="k">date-list</span> <span class="ss">1014854400</span><span class="p">))</span> <span class="err">→</span> <span class="ss">1014854400</span>
</pre></div></div></div>
<div class="paragraph"><p>See also <a href="#date">date</a>, <a href="#date-list">date-list</a>,
<a href="#date-parse">date-parse</a>, <a href="#time-of-day">time-of-day</a>,
<a href="#time">time</a>, and <a href="#now">now</a>.</p></div>
<div class="paragraph"><p><a id="debug"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_debug_span"><span class="big red">debug</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (debug <em>func</em>)</p></div>
<div class="paragraph"><p>Calls <a href="#trace">trace</a> and begins evaluating the user-defined function
in <em>func</em>. <span class="monospaced">debug</span> is a shortcut for executing <span class="monospaced">(trace true)</span>, then
entering the function to be debugged.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">;; instead of doing</span>
<span class="p">(</span><span class="k">trace</span> <span class="k">true</span><span class="p">)</span>
<span class="p">(</span><span class="nv">my-func</span> <span class="ss">a</span> <span class="ss">b</span> <span class="ss">c</span><span class="p">)</span>
<span class="p">(</span><span class="k">trace</span> <span class="k">nil</span><span class="p">)</span>

<span class="c1">;; use debug as a shortcut</span>
<span class="p">(</span><span class="k">debug</span> <span class="p">(</span><span class="nv">my-func</span> <span class="ss">a</span> <span class="ss">b</span> <span class="ss">c</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p>When in <span class="monospaced">debug</span> or <a href="#trace">trace</a> mode, error messages will be
printed. The function causing the exception will return either <span class="monospaced">0</span> or
<span class="monospaced">nil</span> and processing will continue. This way, variables and the current
state of the program can still be inspected while debugging.</p></div>
<div class="paragraph"><p>See also the <a href="#trace">trace</a> function.</p></div>
<div class="paragraph"><p><a id="dec"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_dec_a_href_destructive_a_span"><span class="big red">dec <a href="#destructive">!</a></span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (dec <em>place</em> [<em>num</em>])</p></div>
<div class="paragraph"><p>The number in <em>place</em> is decremented by <span class="monospaced">1.0</span> or the optional number
<em>num</em> and returned. <span class="monospaced">dec</span> performs float arithmetic and converts integer
numbers passed into floating point type.</p></div>
<div class="paragraph"><p><em>place</em> is either a symbol or a place in a list structure holding a
number, or a number returned by an expression.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="ss">x</span> <span class="ss">10</span><span class="p">)</span>    <span class="err">→</span> <span class="ss">10</span>
<span class="p">(</span><span class="k">dec</span> <span class="ss">x</span><span class="p">)</span>       <span class="err">→</span> <span class="ss">9</span>
<span class="ss">x</span>             <span class="err">→</span> <span class="ss">9</span>
<span class="p">(</span><span class="k">dec</span> <span class="ss">x</span> <span class="ss">0.25</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">8.75</span>
<span class="ss">x</span>             <span class="err">→</span> <span class="ss">8.75</span>
</pre></div></div></div>
<div class="paragraph"><p>If the symbol for <em>place</em> contains <span class="monospaced">nil</span>, it is treated as if containing
<span class="monospaced">0.0</span>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="ss">z</span>             <span class="err">→</span> <span class="k">nil</span>
<span class="p">(</span><span class="k">dec</span> <span class="ss">z</span><span class="p">)</span>       <span class="err">→</span> <span class="k">-</span><span class="ss">1</span>

<span class="p">(</span><span class="k">set</span> <span class="ss">z</span> <span class="k">nil</span><span class="p">)</span>
<span class="p">(</span><span class="k">dec</span> <span class="ss">z</span> <span class="ss">0.01</span><span class="p">)</span>  <span class="err">→</span> <span class="k">-</span><span class="ss">0.01</span>
</pre></div></div></div>
<div class="paragraph"><p>Places in a list structure or a number returned by another expression
can be updated too:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">l</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">))</span>

<span class="p">(</span><span class="k">dec</span> <span class="p">(</span><span class="nv">l</span> <span class="ss">3</span><span class="p">)</span> <span class="ss">0.1</span><span class="p">)</span> <span class="err">→</span> <span class="ss">3.9</span>

<span class="p">(</span><span class="k">dec</span> <span class="p">(</span><span class="k">first</span> <span class="ss">l</span><span class="p">))</span> <span class="err">→</span> <span class="ss">0</span>

<span class="ss">l</span> <span class="err">→</span> <span class="p">(</span><span class="nv">0</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">3.9</span><span class="p">)</span>

<span class="p">(</span><span class="k">dec</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">))</span> <span class="err">→</span> <span class="ss">6</span>
</pre></div></div></div>
<div class="paragraph"><p>Use the <a href="#deci">--</a> function to decrement in integer mode. Use the
<a href="#inc">inc</a> function to increment numbers floating point mode.</p></div>
<div class="paragraph"><p><a id="def-new"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_def_new_span"><span class="big red">def-new</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (def-new <em>sym-source</em> [<em>sym-target</em>])</p></div>
<div class="paragraph"><p>This function works similarly to <a href="#new">new</a>, but it only creates a
copy of one symbol and its contents from the symbol in <em>sym-source</em>.
When <em>sym-target</em> is not given, a symbol with the same name is created
in the current context. All symbols referenced inside <em>sym-source</em> will
be translated into symbol references into the current context, which
must not be MAIN.</p></div>
<div class="paragraph"><p>If an argument is present in <em>sym-target</em>, the copy will be made into a
symbol and context as referenced by the symbol in <em>sym-target</em>. In
addition to allowing renaming of the function while copying, this also
enables the copy to be placed in a different context. All symbol
references in <em>sym-source</em> with the same context as <em>sym-source</em> will be
translated into symbol references of the target context.</p></div>
<div class="paragraph"><p><span class="monospaced">def-new</span> returns the symbol created:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="ss">&gt;</span> <span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">foo</span><span class="o">:</span><span class="ss">var</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">foo</span><span class="o">:</span><span class="ss">x</span> <span class="ss">foo</span><span class="o">:</span><span class="ss">y</span><span class="p">))</span>
<span class="p">(</span><span class="nv">foo</span><span class="o">:</span><span class="ss">x</span> <span class="ss">foo</span><span class="o">:</span><span class="ss">y</span><span class="p">)</span>

<span class="ss">&gt;</span> <span class="p">(</span><span class="k">def-new</span> <span class="o">&#39;</span><span class="ss">foo</span><span class="o">:</span><span class="ss">var</span> <span class="o">&#39;</span><span class="ss">ct</span><span class="o">:</span><span class="ss">myvar</span><span class="p">)</span>
<span class="ss">ct</span><span class="o">:</span><span class="ss">myvar</span>

<span class="ss">&gt;</span> <span class="ss">ct</span><span class="o">:</span><span class="ss">myvar</span>
<span class="p">(</span><span class="nv">ct</span><span class="o">:</span><span class="ss">x</span> <span class="ss">ct</span><span class="o">:</span><span class="ss">y</span><span class="p">)</span>

<span class="ss">&gt;</span> <span class="p">(</span><span class="k">context</span> <span class="o">&#39;</span><span class="ss">K</span><span class="p">)</span>

<span class="ss">K&gt;</span> <span class="p">(</span><span class="k">def-new</span> <span class="o">&#39;</span><span class="ss">foo</span><span class="o">:</span><span class="ss">var</span><span class="p">)</span>
<span class="ss">var</span>

<span class="ss">K&gt;</span> <span class="ss">var</span>
<span class="p">(</span><span class="nv">x</span> <span class="ss">y</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The following example shows how a statically scoped function can be
created by moving it its own namespace:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="ss">&gt;</span> <span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">temp</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">x</span> <span class="ss">x</span><span class="p">)))</span>
<span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">x</span> <span class="ss">x</span><span class="p">))</span>
<span class="ss">&gt;</span> <span class="p">(</span><span class="k">def-new</span> <span class="o">&#39;</span><span class="ss">temp</span> <span class="o">&#39;</span><span class="ss">double</span><span class="o">:</span><span class="ss">double</span><span class="p">)</span>
<span class="ss">double</span><span class="o">:</span><span class="ss">double</span>
<span class="ss">&gt;</span> <span class="p">(</span><span class="nv">double</span> <span class="ss">10</span><span class="p">)</span>
<span class="ss">20</span>
<span class="ss">&gt;</span> <span class="ss">double</span><span class="o">:</span><span class="ss">double</span>
<span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">double</span><span class="o">:</span><span class="ss">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">double</span><span class="o">:</span><span class="ss">x</span> <span class="ss">double</span><span class="o">:</span><span class="ss">x</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p>The following definition of <span class="monospaced">def-static</span> can be used to create functions
living in their own lexically protected name-space:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">def-static</span> <span class="ss">s</span> <span class="ss">body</span><span class="p">)</span>
      <span class="p">(</span><span class="k">def-new</span> <span class="o">&#39;</span><span class="ss">body</span> <span class="p">(</span><span class="k">sym</span> <span class="ss">s</span> <span class="ss">s</span><span class="p">)))</span>

<span class="p">(</span><span class="nv">def-static</span> <span class="o">&#39;</span><span class="ss">acc</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span>
          <span class="p">(</span><span class="k">inc</span> <span class="ss">sum</span> <span class="ss">x</span><span class="p">)))</span>

<span class="ss">&gt;</span> <span class="p">(</span><span class="nv">acc</span> <span class="ss">1</span><span class="p">)</span>
<span class="ss">1</span>
<span class="ss">&gt;</span> <span class="p">(</span><span class="nv">acc</span> <span class="ss">1</span><span class="p">)</span>
<span class="ss">2</span>
<span class="ss">&gt;</span> <span class="p">(</span><span class="nv">acc</span> <span class="ss">8</span><span class="p">)</span>
<span class="ss">10</span>
<span class="ss">&gt;</span>
</pre></div></div></div>
<div class="paragraph"><p>The function <span class="monospaced">def-new</span> can also be used to configure contexts or context
objects in a more granular fashion than is possible with <a href="#new">new</a>,
which copies a whole context.</p></div>
<div class="paragraph"><p><a id="default"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_default_span"><span class="big red">default</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (default <em>context</em>)</p></div>
<div class="paragraph"><p>Return the contents of the default functor in <em>context</em>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">define</span> <span class="ss">Foo</span><span class="o">:</span><span class="ss">Foo</span> <span class="ss">123</span><span class="p">)</span>

<span class="p">(</span><span class="k">default</span> <span class="ss">Foo</span><span class="p">)</span> <span class="err">→</span> <span class="ss">123</span>

<span class="p">(</span><span class="k">setf</span> <span class="p">(</span><span class="k">default</span> <span class="ss">Foo</span><span class="p">)</span> <span class="ss">456</span><span class="p">)</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">ctx</span> <span class="ss">Foo</span><span class="p">)</span>

<span class="p">(</span><span class="k">default</span> <span class="ss">ctx</span><span class="p">)</span> <span class="err">→</span> <span class="ss">456</span>
<span class="ss">Foo</span><span class="o">:</span><span class="ss">Foo</span>       <span class="err">→</span> <span class="ss">456</span>
</pre></div></div></div>
<div class="paragraph"><p>In many situations newLISP defaults automatically to the default functor
when seeing a context name. In circumstances where this is not the case,
the <span class="monospaced">default</span> function can be used.</p></div>
<div class="paragraph"><p><a id="define"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_define_a_href_destructive_a_span"><span class="big red">define <a href="#destructive">!</a></span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (define (<em>sym-name</em> [<em>sym-param-1</em> &#8230; ]) [<em>body-1</em> &#8230; ])<br>
<strong>syntax:</strong> (define (<em>sym-name</em> [(<em>sym-param-1</em> <em>exp-default</em>) &#8230; ]) [<em>body-1</em> &#8230; ])<br>
<strong>syntax:</strong> (define <em>sym-name</em> <em>exp</em>)</p></div>
<div class="paragraph"><p>Defines the new function <em>sym-name</em>, with optional parameters
<em>sym-param-1_—. <span class="monospaced">define</span> is equivalent to assigning a lambda expression
to _sym-name</em>. When calling a defined function, all arguments are
evaluated and assigned to the variables in <em>sym-param-1_—, then the
_body-1—</em> expressions are evaluated. When a function is defined, the
lambda expression bound to <em>sym-name</em> is returned.</p></div>
<div class="paragraph"><p>All parameters defined are optional. When a user-defined function is
called without arguments, those parameters assume the value <span class="monospaced">nil</span>. If
those parameters have a default value specified in <em>exp-default</em>, they
assume that value.</p></div>
<div class="paragraph"><p>The return value of <span class="monospaced">define</span> is the assigned <em>lambda</em> expression. When
calling a user-defined function, the return value is the last expression
evaluated in the function body.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">area</span> <span class="ss">x</span> <span class="ss">y</span><span class="p">)</span> <span class="p">(</span><span class="nv">*</span> <span class="ss">x</span> <span class="ss">y</span><span class="p">))</span>  <span class="err">→</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span> <span class="ss">y</span><span class="p">)</span> <span class="p">(</span><span class="nv">*</span> <span class="ss">x</span> <span class="ss">y</span><span class="p">))</span>
<span class="p">(</span><span class="nv">area</span> <span class="ss">2</span> <span class="ss">3</span><span class="p">)</span>                   <span class="err">→</span> <span class="ss">6</span>
</pre></div></div></div>
<div class="paragraph"><p>As an alternative, <span class="monospaced">area</span> could be defined as a function without using
<span class="monospaced">define</span>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">area</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span> <span class="ss">y</span><span class="p">)</span> <span class="p">(</span><span class="nv">*</span> <span class="ss">x</span> <span class="ss">y</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p><em>lambda</em> or <em>fn</em> expressions may be used by themselves as <em>anonymous</em>
functions without being defined as a symbol:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">((</span><span class="k">lambda</span> <span class="p">(</span> <span class="ss">x</span> <span class="ss">y</span><span class="p">)</span> <span class="p">(</span><span class="nv">*</span> <span class="ss">x</span> <span class="ss">y</span><span class="p">))</span> <span class="ss">2</span> <span class="ss">3</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">6</span>
<span class="p">((</span><span class="k">fn</span> <span class="p">(</span> <span class="ss">x</span> <span class="ss">y</span><span class="p">)</span> <span class="p">(</span><span class="nv">*</span> <span class="ss">x</span> <span class="ss">y</span><span class="p">))</span> <span class="ss">2</span> <span class="ss">3</span><span class="p">)</span>      <span class="err">→</span> <span class="ss">6</span>
</pre></div></div></div>
<div class="paragraph"><p><span class="monospaced">fn</span> is just a shorter form of writing <span class="monospaced">lambda</span>.</p></div>
<div class="paragraph"><p>Parameters can have default values specified:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">foo</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">1</span><span class="p">)</span> <span class="p">(</span><span class="nv">b</span> <span class="ss">2</span><span class="p">))</span>
  <span class="p">(</span><span class="k">list</span> <span class="ss">a</span> <span class="ss">b</span><span class="p">))</span>

<span class="p">(</span><span class="nv">foo</span><span class="p">)</span>      <span class="err">→</span> <span class="p">(</span><span class="nv">1</span> <span class="ss">2</span><span class="p">)</span>
<span class="p">(</span><span class="nv">foo</span> <span class="ss">3</span><span class="p">)</span>    <span class="err">→</span> <span class="p">(</span><span class="nv">3</span> <span class="ss">2</span><span class="p">)</span>
<span class="p">(</span><span class="nv">foo</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">3</span> <span class="ss">4</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Expressions in <em>exp-default</em> are evaluated in the function&#8217;s current
environment.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">foo</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">10</span><span class="p">)</span> <span class="p">(</span><span class="nv">b</span> <span class="p">(</span><span class="k">div</span> <span class="ss">a</span> <span class="ss">2</span><span class="p">)))</span>
  <span class="p">(</span><span class="k">list</span> <span class="ss">a</span> <span class="ss">b</span><span class="p">))</span>

<span class="p">(</span><span class="nv">foo</span><span class="p">)</span>      <span class="err">→</span> <span class="p">(</span><span class="nv">10</span> <span class="ss">5</span><span class="p">)</span>
<span class="p">(</span><span class="nv">foo</span> <span class="ss">30</span><span class="p">)</span>   <span class="err">→</span> <span class="p">(</span><span class="nv">30</span> <span class="ss">15</span><span class="p">)</span>
<span class="p">(</span><span class="nv">foo</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">3</span> <span class="ss">4</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The second version of <span class="monospaced">define</span> works like the <a href="#set">set</a> function.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">define</span> <span class="ss">x</span> <span class="ss">123</span><span class="p">)</span>  <span class="err">→</span>   <span class="ss">123</span>
<span class="c1">;; is equivalent to</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">x</span> <span class="ss">123</span><span class="p">)</span>    <span class="err">→</span>   <span class="ss">123</span>

<span class="p">(</span><span class="k">define</span> <span class="ss">area</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span> <span class="ss">x</span> <span class="ss">y</span><span class="p">)</span> <span class="p">(</span><span class="nv">*</span> <span class="ss">x</span> <span class="ss">y</span><span class="p">)))</span>
<span class="c1">;; is equivalent to</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">area</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span> <span class="ss">x</span> <span class="ss">y</span><span class="p">)</span> <span class="p">(</span><span class="nv">*</span> <span class="ss">x</span> <span class="ss">y</span><span class="p">)))</span>
<span class="c1">;; is equivalent to</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">area</span> <span class="ss">x</span> <span class="ss">y</span><span class="p">)</span> <span class="p">(</span><span class="nv">*</span> <span class="ss">x</span> <span class="ss">y</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p>Trying to redefine a protected symbol will cause an error message.</p></div>
<div class="paragraph"><p><a id="define-macro"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_define_macro_span"><span class="big red">define-macro</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (define-macro (<em>sym-name</em> [<em>sym-param-1</em> &#8230; ]) <em>body</em>)<br>
<strong>syntax:</strong> (define-macro (<em>sym-name</em> [(<em>sym-param-1</em> <em>exp-default</em>) &#8230; ]) <em>body</em>)</p></div>
<div class="paragraph"><p>Functions defined using <span class="monospaced">define-macro</span> are called _fexpr_s in other
LISPs as they don&#8217;t do variable expansion. In newLISP they are still
called macros, because they are written with the same purpose of
creating special syntax forms with non-standard evaluation patterns of
arguments. Functions created using <span class="monospaced">define-macro</span> can be combined with
template expansion using <a href="#expand">expand</a> or <a href="#letex">letex</a>.</p></div>
<div class="paragraph"><p>Defines the new fexpr <em>sym-name</em>, with optional arguments <em>sym-param-1</em>.
<span class="monospaced">define-macro</span> is equivalent to assigning a lambda-macro expression to a
symbol. When a <span class="monospaced">define-macro</span> function is called, unevaluated arguments
are assigned to the variables in <em>sym-param-1 &#8230;</em>. Then the <em>body</em>
expressions are evaluated. When evaluating the <span class="monospaced">define-macro</span> function,
the lambda-macro expression is returned.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">define-macro</span> <span class="p">(</span><span class="nv">my-setq</span> <span class="ss">p1</span> <span class="ss">p2</span><span class="p">)</span> <span class="p">(</span><span class="k">set</span> <span class="ss">p1</span> <span class="p">(</span><span class="k">eval</span> <span class="ss">p2</span><span class="p">)))</span>
<span class="err">→</span> <span class="p">(</span><span class="k">lambda-macro</span> <span class="p">(</span><span class="nv">p1</span> <span class="ss">p2</span><span class="p">)</span> <span class="p">(</span><span class="k">set</span> <span class="ss">p1</span> <span class="p">(</span><span class="k">eval</span> <span class="ss">p2</span><span class="p">)))</span>

<span class="p">(</span><span class="nv">my-setq</span> <span class="ss">x</span> <span class="ss">123</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">123</span>
<span class="ss">x</span>                <span class="err">→</span> <span class="ss">123</span>
</pre></div></div></div>
<div class="paragraph"><p>New functions can be created to behave like built-in functions that
delay the evaluation of certain arguments. Because fexprs can access the
arguments inside a parameter list, they can be used to create
flow-control functions like those already built-in to newLISP.</p></div>
<div class="paragraph"><p>All parameters defined are optional. When a macro is called without
arguments, those parameters assume the value <span class="monospaced">nil</span>. If those parameters
have a default value specified in <em>exp-default</em>, they assume that
default value.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">define-macro</span> <span class="p">(</span><span class="nv">foo</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">1</span><span class="p">)</span> <span class="p">(</span><span class="nv">b</span> <span class="ss">2</span><span class="p">))</span>
  <span class="p">(</span><span class="k">list</span> <span class="ss">a</span> <span class="ss">b</span><span class="p">))</span>

<span class="p">(</span><span class="nv">foo</span><span class="p">)</span>      <span class="err">→</span> <span class="p">(</span><span class="nv">1</span> <span class="ss">2</span><span class="p">)</span>
<span class="p">(</span><span class="nv">foo</span> <span class="ss">3</span><span class="p">)</span>    <span class="err">→</span> <span class="p">(</span><span class="nv">3</span> <span class="ss">2</span><span class="p">)</span>
<span class="p">(</span><span class="nv">foo</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">3</span> <span class="ss">4</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Expressions in <em>exp-default</em> are evaluated in the function&#8217;s current
environment.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">define-macro</span> <span class="p">(</span><span class="nv">foo</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">10</span><span class="p">)</span> <span class="p">(</span><span class="nv">b</span> <span class="p">(</span><span class="k">div</span> <span class="ss">a</span> <span class="ss">2</span><span class="p">)))</span>
  <span class="p">(</span><span class="k">list</span> <span class="ss">a</span> <span class="ss">b</span><span class="p">))</span>

<span class="p">(</span><span class="nv">foo</span><span class="p">)</span>      <span class="err">→</span> <span class="p">(</span><span class="nv">10</span> <span class="ss">5</span><span class="p">)</span>
<span class="p">(</span><span class="nv">foo</span> <span class="ss">30</span><span class="p">)</span>   <span class="err">→</span> <span class="p">(</span><span class="nv">30</span> <span class="ss">15</span><span class="p">)</span>
<span class="p">(</span><span class="nv">foo</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">3</span> <span class="ss">4</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Note that in <em>fexprs</em>, the danger exists of passing a parameter with the
same variable name as used in the <span class="monospaced">define-macro</span> definition. In this
case, the <em>fexpr&#8217;s</em> internal variable would end up receiving <span class="monospaced">nil</span>
instead of the intended value:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">;; not a good definition!</span>

<span class="p">(</span><span class="k">define-macro</span> <span class="p">(</span><span class="nv">my-setq</span> <span class="ss">x</span> <span class="ss">y</span><span class="p">)</span> <span class="p">(</span><span class="k">set</span> <span class="ss">x</span> <span class="p">(</span><span class="k">eval</span> <span class="ss">y</span><span class="p">)))</span>

<span class="c1">;; symbol name clash for x</span>

<span class="p">(</span><span class="nv">my-setq</span> <span class="ss">x</span> <span class="ss">123</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">123</span>
<span class="ss">x</span>                <span class="err">→</span> <span class="k">nil</span>
</pre></div></div></div>
<div class="paragraph"><p>There are several methods that can be used to avoid this problem, known
as <em>variable capture</em>, by writing <em>hygienic</em> `define-macro`s:</p></div>
<div class="ulist"><ul>
<li>
<p>
Put the definition into its own lexically closed namespace context. If
the function has the same name as the context, it can be called by using
the context name alone. A function with this characteristic is called a
<a href="#default_function"><em>default function</em></a>. This is the preferred method
in newLISP to write `define-macro`s.
</p>
</li>
<li>
<p>
Use <a href="#args">args</a> to access arguments passed by the function.
</p>
</li>
</ul></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">;; a define-macro as a lexically isolated function</span>
<span class="c1">;; avoiding variable capture in passed parameters</span>

<span class="p">(</span><span class="k">context</span> <span class="o">&#39;</span><span class="ss">my-setq</span><span class="p">)</span>

<span class="p">(</span><span class="k">define-macro</span> <span class="p">(</span><span class="nv">my-setq</span><span class="o">:</span><span class="ss">my-setq</span> <span class="ss">x</span> <span class="ss">y</span><span class="p">)</span> <span class="p">(</span><span class="k">set</span> <span class="ss">x</span> <span class="p">(</span><span class="k">eval</span> <span class="ss">y</span><span class="p">)))</span>

<span class="p">(</span><span class="k">context</span> <span class="k">MAIN</span><span class="p">)</span>

<span class="p">(</span><span class="nv">my-setq</span> <span class="ss">x</span> <span class="ss">123</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">123</span>  <span class="c1">; no symbol clash</span>
</pre></div></div></div>
<div class="paragraph"><p>The definition in the example is lexically isolated, and no variable
capture can occur. Instead of the function being called using
<span class="monospaced">(my-setq:my-setq …)</span>, it can be called with just <span class="monospaced">(my-setq …)</span> because
it is a <a href="#default_function"><em>default function</em></a>.</p></div>
<div class="paragraph"><p>The second possibility is to refer to passed parameters using
<a href="#args">args</a>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">;; avoid variable capture in macros using the args function</span>

<span class="p">(</span><span class="k">define-macro</span> <span class="p">(</span><span class="nv">my-setq</span><span class="p">)</span> <span class="p">(</span><span class="k">set</span> <span class="p">(</span><span class="k">args</span> <span class="ss">0</span><span class="p">)</span> <span class="p">(</span><span class="k">eval</span> <span class="p">(</span><span class="k">args</span> <span class="ss">1</span><span class="p">))))</span>
</pre></div></div></div>
<div class="paragraph"><p><a id="delete"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_delete_span"><span class="big red">delete</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (delete <em>symbol</em> [<em>bool</em>])<br>
<strong>syntax:</strong> (delete <em>sym-context</em> [<em>bool</em>])</p></div>
<div class="paragraph"><p>Deletes a symbol <em>symbol</em>, or a context in <em>sym-context</em> with all
contained symbols from newLISP&#8217;s symbol table. References to the symbol
will be changed to <span class="monospaced">nil</span>.</p></div>
<div class="paragraph"><p>When the expression in <em>bool</em> evaluates to <span class="monospaced">true</span>, symbols are only
deleted when they are not referenced.</p></div>
<div class="paragraph"><p>When the expression in <em>bool</em> evaluates to <span class="monospaced">nil</span>, symbols will be
deleted without any reference checking. Note that this mode should only
be used, if no references to the symbol exist outside it&#8217;s namespace. If
external references exist, this mode can lead to system crashes, as the
external reference is not set to <span class="monospaced">nil</span> when using this mode. This mode
can be used to delete namespace hashes and to delete namespaces in
object systems, where variables are strictly treated as private.</p></div>
<div class="paragraph"><p>Protected symbols of built-in functions and special symbols like <span class="monospaced">nil</span>
and <span class="monospaced">true</span> cannot be deleted.</p></div>
<div class="paragraph"><p><span class="monospaced">delete</span> returns <span class="monospaced">true</span> if the symbol was deleted successfully or <span class="monospaced">nil</span>
if the symbol was not deleted.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">lst</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">aVar</span> <span class="ss">c</span> <span class="ss">d</span><span class="p">))</span>

<span class="p">(</span><span class="k">delete</span> <span class="o">&#39;</span><span class="ss">aVar</span><span class="p">)</span>  <span class="c1">; aVar deleted, references marked nil</span>

<span class="ss">lst</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="k">nil</span> <span class="ss">c</span> <span class="ss">d</span><span class="p">)</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">lst</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">aVar</span> <span class="ss">c</span> <span class="ss">d</span><span class="p">))</span>

<span class="p">(</span><span class="k">delete</span> <span class="o">&#39;</span><span class="ss">aVar</span> <span class="k">true</span><span class="p">)</span>
<span class="err">→</span> <span class="k">nil</span> <span class="c1">; protect aVar if referenced</span>

<span class="ss">lst</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">aVar</span> <span class="ss">c</span> <span class="ss">d</span><span class="p">)</span>

<span class="c1">;; delete all symbols in a context</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">foo</span><span class="o">:</span><span class="ss">x</span> <span class="ss">123</span><span class="p">)</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">foo</span><span class="o">:</span><span class="ss">y</span> <span class="s">&quot;hello&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">delete</span> <span class="o">&#39;</span><span class="ss">foo</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">foo</span><span class="o">:</span><span class="ss">x,</span> <span class="ss">foo</span><span class="o">:</span><span class="ss">y</span> <span class="ss">deleted</span>
</pre></div></div></div>
<div class="paragraph"><p>In the last example only the symbols inside context <span class="monospaced">foo</span> will be
deleted but not the context symbol <span class="monospaced">foo</span> itself. It will be converted to
a normal unprotected symbol and contain <span class="monospaced">nil</span>.</p></div>
<div class="paragraph"><p>Note that deleting a symbol that is part of an expression which is
currently executing can crash the system or have other unforeseen
effects.</p></div>
<div class="paragraph"><p><a id="delete-file"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_delete_file_span"><span class="big red">delete-file</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (delete-file <em>str-file-name</em>)</p></div>
<div class="paragraph"><p>Deletes a file given in <em>str-file-name</em>. Returns <span class="monospaced">true</span> if the file was
deleted successfully.</p></div>
<div class="paragraph"><p>On failure the function returns <span class="monospaced">nil</span>. For error information, use
<a href="#sys-error">sys-error</a> when used on files. When used on URLs
<a href="#net-error">net-error</a> gives more error information.</p></div>
<div class="paragraph"><p>The file name can be given as a URL.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">delete-file</span> <span class="s">&quot;junk&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">delete-file</span> <span class="s">&quot;http://asite.com/example.html&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">delete-file</span> <span class="s">&quot;file://aFile.txt&quot;</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The first example deletes the file <span class="monospaced">junk</span> in the current directory. The
second example shows how to use a URL to specify the file. In this form,
additional parameters can be given. See <a href="#delete-url">delete-url</a> for
details.</p></div>
<div class="paragraph"><p><a id="delete-url"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_delete_url_span"><span class="big red">delete-url</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (delete-file <em>str-url</em>)</p></div>
<div class="paragraph"><p>This function deletes the file on a remote HTTP server specified in
<em>str-url</em>. The HTTP <span class="monospaced">DELETE</span> protocol must be enabled on the target web
server, or an error message string may be returned. The target file must
also have access permissions set accordingly. Additional parameters such
as timeout and custom headers are available exactly as in the
<a href="#get-url">get-url</a> function.</p></div>
<div class="paragraph"><p>If <em>str-url</em> starts with <span class="monospaced">file://</span> a file on the local file system is
deleted.</p></div>
<div class="paragraph"><p>This feature is also available when the <a href="#delete-file">delete-file</a>
function is used and a URL is specified for the filename.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">delete-url</span> <span class="s">&quot;http://www.aserver.com/somefile.txt&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">delete-url</span> <span class="s">&quot;http://site.org:8080/page.html&quot;</span> <span class="ss">5000</span><span class="p">)</span>

<span class="c1">; delete on the local file system</span>
<span class="p">(</span><span class="k">delete-url</span> <span class="s">&quot;file:///home/joe/somefile.txt&quot;</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The second example configures a timeout option of five seconds. Other
options such as special HTTP protocol headers can be specified, as well.
See the <a href="#get-url">get-url</a> function for details.</p></div>
<div class="paragraph"><p><a id="destroy"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_destroy_span"><span class="big red">destroy</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (destroy <em>int-pid</em>)<br>
<strong>syntax:</strong> (destroy <em>int-pid</em> <em>int-signal</em>)</p></div>
<div class="paragraph"><p>Destroys a process with process id in <em>int-pid</em> and returns <span class="monospaced">true</span> on
success or <span class="monospaced">nil</span> on failure. The process id is normally obtained from a
previous call to <a href="#fork">fork</a> on Mac OS X and other Unix or
<a href="#process">process</a> on all platforms. On Unix, <span class="monospaced">destroy</span> works like
the system utility <em>kill</em> using the SIGKILL signal.</p></div>
<div class="paragraph"><p>CAUTION! If <em>int-pid</em> is <span class="monospaced">0</span> the signal is sent to all processes whose
group ID is equal to the process group ID of the sender. If <em>int-pid</em> is
<span class="monospaced">-1</span> all processes with the current user id will be killed, if newLISP
is started with super user privileges, all processes except system
processes are destroyed.</p></div>
<div class="paragraph"><p>When specifying <em>int-signal</em>, <span class="monospaced">destroy</span> works like a Unix <span class="monospaced">kill</span> command
sending the specified Unix signal to the process in <em>int-pid</em>. This
second syntax is not available on Win32.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">pid</span> <span class="p">(</span><span class="k">process</span> <span class="s">&quot;/usr/bin/bc&quot;</span> <span class="ss">bcin</span> <span class="ss">bcout</span><span class="p">))</span>
<span class="p">(</span><span class="k">destroy</span> <span class="ss">pid</span><span class="p">)</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">pid</span> <span class="p">(</span><span class="k">fork</span> <span class="p">(</span><span class="k">dotimes</span> <span class="p">(</span><span class="nv">i</span> <span class="ss">1000</span><span class="p">)</span> <span class="p">(</span><span class="k">println</span> <span class="ss">i</span><span class="p">)</span> <span class="p">(</span><span class="k">sleep</span> <span class="ss">10</span><span class="p">))))</span>
<span class="p">(</span><span class="k">sleep</span> <span class="ss">100</span><span class="p">)</span> <span class="p">(</span><span class="k">destroy</span> <span class="ss">pid</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p><a id="det"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_det_span"><span class="big red">det</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (det <em>matrix</em> [<em>float-pivot</em>])</p></div>
<div class="paragraph"><p>Returns the determinant of a square matrix. A matrix can either be a
nested list or an <a href="#array">array</a>.</p></div>
<div class="paragraph"><p>Optionally <span class="monospaced">0.0</span> or a very small value can be specified in
<em>float-pivot</em>. This value substitutes pivot elements in the
LU-decomposition algorithm, which result in zero when the algorithm
deals with a singular matrix.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">A</span> <span class="o">&#39;</span><span class="p">((</span><span class="k">-</span><span class="ss">1</span> <span class="ss">1</span> <span class="ss">1</span><span class="p">)</span> <span class="p">(</span><span class="nv">1</span> <span class="ss">4</span> <span class="k">-</span><span class="ss">5</span><span class="p">)</span> <span class="p">(</span><span class="nv">1</span> <span class="k">-</span><span class="ss">2</span> <span class="ss">0</span><span class="p">)))</span>
<span class="p">(</span><span class="k">det</span> <span class="ss">A</span><span class="p">)</span>  <span class="err">→</span> <span class="k">-</span><span class="ss">1</span>

<span class="c1">; treatment of singular matrices</span>
<span class="p">(</span><span class="k">det</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">2</span> <span class="k">-</span><span class="ss">1</span><span class="p">)</span> <span class="p">(</span><span class="nv">4</span> <span class="k">-</span><span class="ss">2</span><span class="p">)))</span>        <span class="err">→</span> <span class="k">nil</span>
<span class="p">(</span><span class="k">det</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">2</span> <span class="k">-</span><span class="ss">1</span><span class="p">)</span> <span class="p">(</span><span class="nv">4</span> <span class="k">-</span><span class="ss">2</span><span class="p">))</span> <span class="ss">0</span><span class="p">)</span>      <span class="err">→</span> <span class="k">-</span><span class="ss">0</span>
<span class="p">(</span><span class="k">det</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">2</span> <span class="k">-</span><span class="ss">1</span><span class="p">)</span> <span class="p">(</span><span class="nv">4</span> <span class="k">-</span><span class="ss">2</span><span class="p">))</span> <span class="ss">1e-20</span><span class="p">)</span>  <span class="err">→</span> <span class="k">-</span><span class="ss">4e-20</span>
</pre></div></div></div>
<div class="paragraph"><p>If the matrix is singular and <em>float-pivot</em> is not specified, <span class="monospaced">nil</span> is
returned.</p></div>
<div class="paragraph"><p>See also the other matrix operations <a href="#invert">invert</a>,
<a href="#mat">mat</a>, <a href="#multiply">multiply</a> and <a href="#transpose">transpose</a>.</p></div>
<div class="paragraph"><p><a id="device"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_device_span"><span class="big red">device</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (device [<em>int-handle</em>])</p></div>
<div class="paragraph"><p><em>int-handle</em> is an I/O device number, which is set to 0 (zero) for the
default STD I/O pair of handles, 0 for <em>stdin</em> and 1 for <em>stdout</em>.
<em>int-handle</em> may also be a file handle previously obtained using
<a href="#open">open</a>. In this case both, input and output are channeled
through this handle. When no argument is supplied, the current I/O
device number is returned.</p></div>
<div class="paragraph"><p>The I/O channel specified by <span class="monospaced">device</span> is used internally by the
functions <a href="#print">print</a> and <a href="#read-line">read-line</a>. When the
current I/O device is 0 or 1, <a href="#print">print</a> sends output to the
console window and <a href="#read-line">read-line</a> accepts input from the
keyboard. If the current I/O device has been set by opening a file, then
<a href="#print">print</a> and <a href="#read-line">read-line</a> work on that file.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">device</span> <span class="p">(</span><span class="k">open</span> <span class="s">&quot;myfile&quot;</span> <span class="s">&quot;write&quot;</span><span class="p">))</span>  <span class="err">→</span> <span class="ss">5</span>
<span class="p">(</span><span class="k">print</span> <span class="s">&quot;This goes in myfile&quot;</span><span class="p">)</span>     <span class="err">→</span> <span class="s">&quot;This goes in myfile&quot;</span>
<span class="p">(</span><span class="k">close</span> <span class="p">(</span><span class="k">device</span><span class="p">))</span>                  <span class="err">→</span> <span class="k">true</span>
</pre></div></div></div>
<div class="paragraph"><p>Note that using <a href="#close">close</a> on <span class="monospaced">device</span> automatically resets
<span class="monospaced">device</span> to 0 (zero).</p></div>
<div class="paragraph"><p><a id="difference"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_difference_span"><span class="big red">difference</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (difference <em>list-A</em> <em>list-B</em>)<br>
<strong>syntax:</strong> (difference <em>list-A</em> <em>list-B</em> <em>bool</em>)</p></div>
<div class="paragraph"><p>In the first syntax, <span class="monospaced">difference</span> returns the <em>set</em> difference between
<em>list-A</em> and <em>list-B</em>. The resulting list only has elements occurring in
<em>list-A</em>, but not in <em>list-B</em>. All elements in the resulting list are
unique, but <em>list-A</em> and <em>list-B</em> need not be unique. Elements in the
lists can be any type of Lisp expression.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">difference</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">2</span> <span class="ss">5</span> <span class="ss">6</span> <span class="ss">0</span> <span class="ss">3</span> <span class="ss">5</span> <span class="ss">0</span> <span class="ss">2</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">3</span> <span class="ss">2</span> <span class="ss">1</span><span class="p">))</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">5</span> <span class="ss">6</span> <span class="ss">0</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>In the second syntax, <span class="monospaced">difference</span> works in <em>list</em> mode. <em>bool</em>
specifies <span class="monospaced">true</span> or an expression not evaluating to <span class="monospaced">nil</span>. In the
resulting list, all elements of <em>list-B</em> are eliminated in <em>list-A</em>, but
duplicates of other elements in <em>list-A</em> are left.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">difference</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">2</span> <span class="ss">5</span> <span class="ss">6</span> <span class="ss">0</span> <span class="ss">3</span> <span class="ss">5</span> <span class="ss">0</span> <span class="ss">2</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">3</span> <span class="ss">2</span> <span class="ss">1</span><span class="p">)</span> <span class="k">true</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">5</span> <span class="ss">6</span> <span class="ss">0</span> <span class="ss">5</span> <span class="ss">0</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>See also the set functions <a href="#intersect">intersect</a>,
<a href="#unique">unique</a> and <a href="#union">union</a>.</p></div>
<div class="paragraph"><p><a id="directory"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_directory_span"><span class="big red">directory</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (directory [<em>str-path</em>])<br>
<strong>syntax:</strong> (directory <em>str-path</em> <em>str-pattern</em> [<em>int-regex-option</em>])</p></div>
<div class="paragraph"><p>A list of directory entry names is returned for the directory path given
in <em>str-path</em>. On failure, <span class="monospaced">nil</span> is returned. When <em>str-path</em> is
omitted, the list of entries in the current directory is returned.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">directory</span> <span class="s">&quot;/bin&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">directory</span> <span class="s">&quot;c:/&quot;</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The first example returns the directory of <span class="monospaced">/bin</span>, the second line
returns a list of directory entries in the root directory of drive C:.
Note that on Win32 systems, a forward slash (<span class="monospaced">/</span>) can be included in
path names. When used, a backslash (<span class="monospaced">\</span>) must be preceded by a second
backslash.</p></div>
<div class="paragraph"><p>In the second syntax, <span class="monospaced">directory</span> can take a regular expression pattern
in <em>str-pattern</em>. Only filenames matching the pattern will be returned
in the list of directory entries. In <em>int-regex-options</em>, special
regular expression options can be specified; see <a href="#regex">regex</a> for
details.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">directory</span> <span class="s">&quot;.&quot;</span> <span class="s">&quot;\\.c&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="s">&quot;foo.c&quot;</span> <span class="s">&quot;bar.c&quot;</span><span class="p">)</span>
<span class="c1">;; or using braces as string pattern delimiters</span>
<span class="p">(</span><span class="k">directory</span> <span class="s">&quot;.&quot;</span> <span class="s">{\.c}</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="s">&quot;foo.c&quot;</span> <span class="s">&quot;bar.c&quot;</span><span class="p">)</span>

<span class="c1">; show only hidden files (starting with dot)</span>
<span class="p">(</span><span class="k">directory</span> <span class="s">&quot;.&quot;</span> <span class="s">&quot;^[.]&quot;</span><span class="p">)</span>   <span class="err">→</span> <span class="p">(</span><span class="s">&quot;.&quot;</span> <span class="s">&quot;..&quot;</span> <span class="s">&quot;.profile&quot;</span> <span class="s">&quot;.rnd&quot;</span> <span class="s">&quot;.ssh&quot;</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The regular expression forces <span class="monospaced">directory</span> to return only file names
containing the string <span class="monospaced">".c"</span>.</p></div>
<div class="paragraph"><p>Other functions that use regular expressions are <a href="#find">find</a>,
<a href="#find-all">find-all</a>, <a href="#parse">parse</a>, <a href="#regex">regex</a>,
<a href="#replace">replace</a>, and <a href="#search">search</a>.</p></div>
<div class="paragraph"><p><a id="directory?"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_directory_span_2"><span class="big red">directory?</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (directory? <em>str-path</em>)</p></div>
<div class="paragraph"><p>Checks if <em>str-path</em> is a directory. Returns <span class="monospaced">true</span> or <span class="monospaced">nil</span> depending
on the outcome.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">directory</span><span class="ss">?</span> <span class="s">&quot;/etc&quot;</span><span class="p">)</span>             <span class="err">→</span> <span class="k">true</span>
<span class="p">(</span><span class="k">directory</span><span class="ss">?</span> <span class="s">&quot;/usr/bin/emacs/&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="k">nil</span>
</pre></div></div></div>
<div class="paragraph"><p><a id="div"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_div_span"><span class="big red">div</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (div <em>num-1</em> <em>num-2</em> [<em>num-3</em> &#8230; ])<br>
<strong>syntax:</strong> (div <em>num-1</em>)</p></div>
<div class="paragraph"><p>Successively divides <em>num-1</em> by the number in <em>num-2—</em>. <span class="monospaced">div</span> can
perform mixed-type arithmetic, but it always returns floating point
numbers. Any floating point calculation with <span class="monospaced">NaN</span> also returns <span class="monospaced">NaN</span>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">div</span> <span class="ss">10</span> <span class="ss">3</span><span class="p">)</span>                 <span class="err">→</span> <span class="ss">3.333333333</span>
<span class="p">(</span><span class="k">div</span> <span class="ss">120</span> <span class="p">(</span><span class="k">sub</span> <span class="ss">9.0</span> <span class="ss">6</span><span class="p">)</span> <span class="ss">100</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">0.4</span>

<span class="p">(</span><span class="k">div</span> <span class="ss">10</span><span class="p">)</span>                   <span class="err">→</span> <span class="ss">0.1</span>
</pre></div></div></div>
<div class="paragraph"><p>When <em>num-1</em> is the only argument, <span class="monospaced">div</span> calculates the inverse of
<em>num-1</em>.</p></div>
<div class="paragraph"><p><a id="do-until"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_do_until_span"><span class="big red">do-until</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (do-until <em>exp-condition</em> [<em>body</em>])</p></div>
<div class="paragraph"><p>The expressions in <em>body</em> are evaluated before <em>exp-condition</em> is
evaluated. If the evaluation of <em>exp-condition</em> is not <span class="monospaced">nil</span>, then the
<span class="monospaced">do-until</span> expression is finished; otherwise, the expressions in <em>body</em>
get evaluated again. Note that <span class="monospaced">do-until</span> evaluates the conditional
expression <em>after</em> evaluating the body expressions, whereas
<a href="#until">until</a> checks the condition <em>before</em> evaluating the body.
The return value of the <span class="monospaced">do-until</span> expression is the last evaluation of
the <em>body</em> expression. If <em>body</em> is empty, the last result of
<em>exp-condition</em> is returned.</p></div>
<div class="paragraph"><p><span class="monospaced">do-until</span> also updates the system iterator symbol <span class="monospaced">$idx</span>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">x</span> <span class="ss">1</span><span class="p">)</span>
<span class="p">(</span><span class="k">do-until</span> <span class="p">(</span><span class="nv">&gt;</span> <span class="ss">x</span> <span class="ss">0</span><span class="p">)</span> <span class="p">(</span><span class="k">inc</span> <span class="ss">x</span><span class="p">))</span>
<span class="ss">x</span>  <span class="err">→</span> <span class="ss">2</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">x</span> <span class="ss">1</span><span class="p">)</span>
<span class="p">(</span><span class="k">until</span> <span class="p">(</span><span class="nv">&gt;</span> <span class="ss">x</span> <span class="ss">0</span><span class="p">)</span> <span class="p">(</span><span class="k">inc</span> <span class="ss">x</span><span class="p">))</span>
<span class="ss">x</span>  <span class="err">→</span> <span class="ss">1</span>
</pre></div></div></div>
<div class="paragraph"><p>While <span class="monospaced">do-until</span> goes through the loop at least once, <a href="#until">until</a>
never enters the loop.</p></div>
<div class="paragraph"><p>See also the functions <a href="#while">while</a> and <a href="#do-while">do-while</a>.</p></div>
<div class="paragraph"><p><a id="do-while"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_do_while_span"><span class="big red">do-while</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (do-while <em>exp-condition body</em>)</p></div>
<div class="paragraph"><p>The expressions in <em>body</em> are evaluated before <em>exp-condition</em> is
evaluated. If the evaluation of <em>exp-condition</em> is <span class="monospaced">nil</span>, then the
<span class="monospaced">do-while</span> expression is finished; otherwise the expressions in <em>body</em>
get evaluated again. Note that <span class="monospaced">do-while</span> evaluates the conditional
expression <em>after</em> evaluating the body expressions, whereas
<a href="#while">while</a> checks the condition <em>before</em> evaluating the body.
The return value of the <span class="monospaced">do-while</span> expression is the last evaluation of
the <em>body</em> expression.</p></div>
<div class="paragraph"><p><span class="monospaced">do-while</span> also updates the system iterator symbol <span class="monospaced">$idx</span>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">x</span> <span class="ss">10</span><span class="p">)</span>
<span class="p">(</span><span class="k">do-while</span> <span class="p">(</span><span class="nv">&lt;</span> <span class="ss">x</span> <span class="ss">10</span><span class="p">)</span> <span class="p">(</span><span class="k">inc</span> <span class="ss">x</span><span class="p">))</span>
<span class="ss">x</span>  <span class="err">→</span> <span class="ss">11</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">x</span> <span class="ss">10</span><span class="p">)</span>
<span class="p">(</span><span class="k">while</span> <span class="p">(</span><span class="nv">&lt;</span> <span class="ss">x</span> <span class="ss">10</span><span class="p">)</span> <span class="p">(</span><span class="k">inc</span> <span class="ss">x</span><span class="p">))</span>
<span class="ss">x</span>  <span class="err">→</span> <span class="ss">10</span>
</pre></div></div></div>
<div class="paragraph"><p>While <span class="monospaced">do-while</span> goes through the loop at least once, <a href="#while">while</a>
never enters the loop.</p></div>
<div class="paragraph"><p>See also the functions <a href="#until">until</a> and <a href="#do-until">do-until</a>.</p></div>
<div class="paragraph"><p><a id="doargs"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_doargs_span"><span class="big red">doargs</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (doargs (<em>sym</em> [<em>exp-break</em>])<em>body</em>)</p></div>
<div class="paragraph"><p>Iterates through all members of the argument list inside a user-defined
function or macro. This function or macro can be defined using
<a href="#define">define</a>, <a href="#define-macro">define-macro</a>,
<a href="#lambda">lambda</a>, or <a href="#lambda-macro">lambda-macro</a>. The variable
in <em>sym</em> is set sequentially to all members in the argument list until
the list is exhausted or an optional break expression (defined in
<em>exp-break</em>) evaluates to <span class="monospaced">true</span> or a logical true value. The <span class="monospaced">doargs</span>
expression always returns the result of the last evaluation.</p></div>
<div class="paragraph"><p><span class="monospaced">doargs</span> also updates the system iterator symbol <span class="monospaced">$idx</span>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">foo</span><span class="p">)</span>
    <span class="p">(</span><span class="k">doargs</span> <span class="p">(</span><span class="nv">i</span><span class="p">)</span> <span class="p">(</span><span class="k">println</span> <span class="ss">i</span><span class="p">)))</span>

<span class="ss">&gt;</span> <span class="p">(</span><span class="nv">foo</span> <span class="ss">1</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">)</span>
<span class="ss">1</span>
<span class="ss">2</span>
<span class="ss">3</span>
<span class="ss">4</span>
</pre></div></div></div>
<div class="paragraph"><p>The optional break expression causes <span class="monospaced">doargs</span> to interrupt processing of
the arguments:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">define-macro</span> <span class="p">(</span><span class="nv">foo</span><span class="p">)</span>
    <span class="p">(</span><span class="k">doargs</span> <span class="p">(</span><span class="nv">i</span> <span class="p">(</span><span class="nv">=</span> <span class="ss">i</span> <span class="o">&#39;</span><span class="ss">x</span><span class="p">))</span>
        <span class="p">(</span><span class="k">println</span> <span class="ss">i</span><span class="p">)))</span>

<span class="ss">&gt;</span> <span class="p">(</span><span class="nv">foo</span> <span class="ss">a</span> <span class="ss">b</span> <span class="ss">x</span> <span class="ss">c</span> <span class="ss">d</span> <span class="ss">e</span><span class="p">)</span>
<span class="ss">a</span>
<span class="ss">b</span>
<span class="k">true</span>
</pre></div></div></div>
<div class="paragraph"><p>Use the <a href="#args">args</a> function to access the entire argument list at
once.</p></div>
<div class="paragraph"><p><a id="dolist"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_dolist_span"><span class="big red">dolist</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (dolist (<em>sym</em> <em>list</em> [<em>exp-break</em>])<em>body</em>)</p></div>
<div class="paragraph"><p>The expressions in <em>body</em> are evaluated for each element in <em>list</em>. The
variable in <em>sym</em> is set to each of the elements before evaluation of
the body expressions. The variable used as loop index is local and
behaves according to the rules of dynamic scoping.</p></div>
<div class="paragraph"><p>Optionally, a condition for early loop exit may be defined in
<em>exp-break</em>. If the break expression evaluates to any non-<span class="monospaced">nil</span> value,
the <span class="monospaced">dolist</span> loop returns with the value of <em>exp-break</em>. The break
condition is tested before evaluating <em>body.</em></p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">x</span> <span class="ss">123</span><span class="p">)</span>
<span class="p">(</span><span class="k">dolist</span> <span class="p">(</span><span class="nv">x</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span> <span class="ss">d</span> <span class="ss">e</span> <span class="ss">f</span> <span class="ss">g</span><span class="p">))</span>  <span class="c1">; prints: abcdefg</span>
    <span class="p">(</span><span class="k">print</span> <span class="ss">x</span><span class="p">))</span>  <span class="err">→</span> <span class="ss">g</span>          <span class="c1">; return value</span>

<span class="p">(</span><span class="k">dolist</span> <span class="p">(</span><span class="nv">x</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span> <span class="ss">d</span> <span class="ss">e</span> <span class="ss">f</span> <span class="ss">g</span><span class="p">)</span> <span class="p">(</span><span class="nv">=</span> <span class="ss">x</span> <span class="o">&#39;</span><span class="ss">e</span><span class="p">))</span>  <span class="c1">; prints: abcd</span>
    <span class="p">(</span><span class="k">print</span> <span class="ss">x</span><span class="p">))</span>

<span class="c1">;; x is local in dolist</span>
<span class="c1">;; x has still its old value outside the loop</span>

<span class="ss">x</span>  <span class="err">→</span> <span class="ss">123</span>  <span class="c1">; x has still its old value</span>
</pre></div></div></div>
<div class="paragraph"><p>This example prints <span class="monospaced">abcdefg</span> in the console window. After the execution
of <span class="monospaced">dolist</span>, the value for <span class="monospaced">x</span> remains unchanged because the <span class="monospaced">x</span> in
<span class="monospaced">dolist</span> has local scope. The return value of <span class="monospaced">dolist</span> is the result of
the last evaluated expression.</p></div>
<div class="paragraph"><p>The internal system variable <span class="monospaced">$idx</span> keeps track of the current offset
into the list passed to <span class="monospaced">dolist</span>, and it can be accessed during its
execution:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">dolist</span> <span class="p">(</span><span class="nv">x</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">d</span> <span class="ss">e</span> <span class="ss">f</span> <span class="ss">g</span><span class="p">))</span>
  <span class="p">(</span><span class="k">println</span> <span class="k">$</span><span class="ss">idx</span> <span class="s">&quot;:&quot;</span> <span class="ss">x</span><span class="p">))</span>  <span class="err">→</span> <span class="ss">g</span>

<span class="ss">0</span><span class="o">:</span><span class="ss">a</span>
<span class="ss">1</span><span class="o">:</span><span class="ss">b</span>
<span class="ss">2</span><span class="o">:</span><span class="ss">d</span>
<span class="ss">3</span><span class="o">:</span><span class="ss">e</span>
<span class="ss">4</span><span class="o">:</span><span class="ss">f</span>
<span class="ss">5</span><span class="o">:</span><span class="ss">g</span>
</pre></div></div></div>
<div class="paragraph"><p>The console output is shown in boldface. <span class="monospaced">$idx</span> is protected and cannot
be changed by the user.</p></div>
<div class="paragraph"><p><a id="dostring"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_dostring_a_href_utf8_capable_utf8_a_span"><span class="big red">dostring <a href="#utf8_capable">utf8</a></span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (dostring (<em>sym</em> <em>string</em> [<em>exp-break</em>]) <em>body</em>)</p></div>
<div class="paragraph"><p>The expressions in <em>body</em> are evaluated for each character in <em>string</em>.
The variable in <em>sym</em> is set to each ASCII or UTF-8 integer value of the
characters before evaluation of the body expressions. The variable used
as loop index is local and behaves according to the rules of dynamic
scoping.</p></div>
<div class="paragraph"><p>Optionally, a condition for early loop exit may be defined in
<em>exp-break</em>. If the break expression evaluates to any non-<span class="monospaced">nil</span> value,
the <span class="monospaced">dolist</span> loop returns with the value of <em>exp-break</em>. The break
condition is tested before evaluating <em>body.</em></p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">; ASCII example</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">str</span> <span class="s">&quot;abcdefg&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">dostring</span> <span class="p">(</span><span class="nv">c</span> <span class="ss">str</span><span class="p">)</span> <span class="p">(</span><span class="k">println</span> <span class="ss">c</span> <span class="s">&quot; - &quot;</span> <span class="p">(</span><span class="k">char</span> <span class="ss">c</span><span class="p">)))</span>

<span class="ss">97</span> <span class="ss">-</span> <span class="ss">a</span>
<span class="ss">98</span> <span class="ss">-</span> <span class="ss">b</span>
<span class="ss">99</span> <span class="ss">-</span> <span class="ss">c</span>
<span class="ss">100</span> <span class="ss">-</span> <span class="ss">d</span>
<span class="ss">101</span> <span class="ss">-</span> <span class="ss">e</span>
<span class="ss">102</span> <span class="ss">-</span> <span class="ss">f</span>
<span class="ss">103</span> <span class="ss">-</span> <span class="ss">g</span>

<span class="c1">; UTF8 example</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">utf8str</span> <span class="s">&quot;我能吞下玻璃而不伤身体。&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">dostring</span> <span class="p">(</span><span class="nv">c</span> <span class="ss">utf8str</span><span class="p">)</span> <span class="p">(</span><span class="k">println</span> <span class="ss">c</span> <span class="s">&quot; - &quot;</span> <span class="p">(</span><span class="k">char</span> <span class="ss">c</span><span class="p">)))</span>

<span class="ss">25105</span> <span class="ss">-</span> <span class="err">我</span>
<span class="ss">33021</span> <span class="ss">-</span> <span class="err">能</span>
<span class="ss">21534</span> <span class="ss">-</span> <span class="err">吞</span>
 <span class="ss">...</span>
<span class="ss">20307</span> <span class="ss">-</span> <span class="err">体</span>
<span class="ss">12290</span> <span class="ss">-</span> <span class="err">。</span>
</pre></div></div></div>
<div class="paragraph"><p>This example prints the value of each character in the console window.
In UTF-8 enabled versions of newLISP, individual characters may be
longer than one byte and the number in the loop variable may exceed 255.
The return value of <span class="monospaced">dostring</span> is the result of the last evaluated
expression.</p></div>
<div class="paragraph"><p>The internal system variable <span class="monospaced">$idx</span> keeps track of the current offset
into the string passed to <span class="monospaced">dostring</span>, and it can be accessed during its
execution.</p></div>
<div class="paragraph"><p><a id="dotimes"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_dotimes_span"><span class="big red">dotimes</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (dotimes (<em>sym-var</em> <em>int-count</em> [<em>exp-break</em>]) <em>body</em>)</p></div>
<div class="paragraph"><p>The expressions in <em>body</em> are evaluated <em>int</em> times. The variable in
<em>sym</em> is set from 0 (zero) to (<em>int</em> - 1) each time before evaluating
the body expression(s). The variable used as the loop index is local to
the <span class="monospaced">dotimes</span> expression and behaves according the rules of dynamic
scoping. The loop index is of integer type. <span class="monospaced">dotimes</span> returns the result
of the last expression evaluated in <em>body</em>. After evaluation of the
<span class="monospaced">dotimes</span> statement <em>sym</em> assumes its previous value.</p></div>
<div class="paragraph"><p>Optionally, a condition for early loop exit may be defined in
<em>exp-break</em>. If the break expression evaluates to any non-<span class="monospaced">nil</span> value,
the <span class="monospaced">dotimes</span> loop returns with the value of <em>exp-break</em>. The break
condition is tested before evaluating <em>body</em>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">dotimes</span> <span class="p">(</span><span class="nv">x</span> <span class="ss">10</span><span class="p">)</span>
  <span class="p">(</span><span class="k">print</span> <span class="ss">x</span><span class="p">))</span>  <span class="err">→</span> <span class="ss">9</span>  <span class="c1">; return value</span>
</pre></div></div></div>
<div class="paragraph"><p>This prints <span class="monospaced">0123456789</span> to the console window.</p></div>
<div class="paragraph"><p><a id="dotree"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_dotree_span"><span class="big red">dotree</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (dotree (<em>sym</em> <em>sym-context</em> [<em>bool</em>]) <em>body</em>)</p></div>
<div class="paragraph"><p>The expressions in <em>body</em> are evaluated for all symbols in
<em>sym-context</em>. The symbols are accessed in a sorted order. Before each
evaluation of the body expression(s), the variable in <em>sym</em> is set to
the next symbol from <em>sym-context</em>. The variable used as the loop index
is local to the <span class="monospaced">dotree</span> expression and behaves according the rules of
dynamic scoping.</p></div>
<div class="paragraph"><p>When the optional <em>bool</em> expression evaluates to not <span class="monospaced">nil</span>, only symbols
starting with an underscore character <span class="monospaced">_</span> are accessed. Symbol names
starting with an <span class="monospaced">_</span> underscore are used for <a href="#hash">hash keys</a> and
symbols created by <a href="#bayes-train">bayes-train</a>.</p></div>
<div class="paragraph"><p><span class="monospaced">dotree</span> also updates the system iterator symbol <span class="monospaced">$idx</span>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">;; faster and less memory overhead</span>
<span class="p">(</span><span class="k">dotree</span> <span class="p">(</span><span class="nv">s</span> <span class="ss">SomeCTX</span><span class="p">)</span> <span class="p">(</span><span class="k">print</span> <span class="ss">s</span> <span class="s">&quot; &quot;</span><span class="p">))</span>

<span class="c1">;; slower and higher memory usage</span>
<span class="p">(</span><span class="k">dolist</span> <span class="p">(</span><span class="nv">s</span> <span class="p">(</span><span class="k">symbols</span> <span class="ss">SomeCTX</span><span class="p">))</span> <span class="p">(</span><span class="k">print</span> <span class="ss">s</span> <span class="s">&quot; &quot;</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p>This example prints the names of all symbols inside SomeCTX to the
console window.</p></div>
<div class="paragraph"><p><a id="dump"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_dump_span"><span class="big red">dump</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (dump [<em>exp</em>])</p></div>
<div class="paragraph"><p>Shows the binary contents of a newLISP cell. Without an argument, this
function outputs a listing of all Lisp cells to the console. When <em>exp</em>
is given, it is evaluated and the contents of a Lisp cell are returned
in a list.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">dump</span> <span class="o">&#39;</span><span class="ss">a</span><span class="p">)</span>   <span class="err">→</span> <span class="p">(</span><span class="nv">9586996</span> <span class="ss">5</span> <span class="ss">9578692</span> <span class="ss">9578692</span> <span class="ss">9759280</span><span class="p">)</span>

<span class="p">(</span><span class="k">dump</span> <span class="ss">999</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">9586996</span> <span class="ss">130</span> <span class="ss">9578692</span> <span class="ss">9578692</span> <span class="ss">999</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The list contains the following memory addresses and information:</p></div>
<table class="tableblock frame-all grid-all"
style="
width:40%;
">
<col style="width:9%;">
<col style="width:90%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" >offset </th>
<th class="tableblock halign-left valign-top" >description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">memory address of the newLISP cell</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">cell&#8594;type: major/minor type, see newlisp.h for details</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">cell&#8594;next: linked list ptr</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">cell&#8594;aux:<br>
 string length+1 or <br>
 low (little endian) or high (big endian) word of 64-bit integer or<br>
 low word of IEEE 754 double float</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">cell&#8594;contents:<br>
 string/symbol address or<br>
 high (little endian) or low (big endian) word of 64-bit integer or<br>
 high word of IEEE 754 double float</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>This function is valuable for changing type bits in cells or hacking
other parts of newLISP internals. See the function <a href="#cpymem">cpymem</a>
for a comprehensive example.</p></div>
<div class="paragraph"><p><a id="dup"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_dup_span"><span class="big red">dup</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (dup <em>exp</em> <em>int-n</em> [<em>bool</em>])<br>
<strong>syntax:</strong> (dup <em>exp</em>)</p></div>
<div class="paragraph"><p>If the expression in <em>exp</em> evaluates to a string, it will be replicated
<em>int-n</em> times within a string and returned. When specifying an
expression evaluating to anything other than <span class="monospaced">nil</span> in <em>bool</em>, the string
will not be concatenated but replicated in a list like any other data
type.</p></div>
<div class="paragraph"><p>If <em>exp</em> contains any data type other than string, the returned list
will contain <em>int-n</em> evaluations of <em>exp</em>.</p></div>
<div class="paragraph"><p>Without the repetition parameter, <span class="monospaced">dup</span> assumes 2.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">dup</span> <span class="s">&quot;A&quot;</span> <span class="ss">6</span><span class="p">)</span>       <span class="err">→</span> <span class="s">&quot;AAAAAA&quot;</span>
<span class="p">(</span><span class="k">dup</span> <span class="s">&quot;A&quot;</span> <span class="ss">6</span> <span class="k">true</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="s">&quot;A&quot;</span> <span class="s">&quot;A&quot;</span> <span class="s">&quot;A&quot;</span> <span class="s">&quot;A&quot;</span> <span class="s">&quot;A&quot;</span> <span class="s">&quot;A&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">dup</span> <span class="s">&quot;A&quot;</span> <span class="ss">0</span><span class="p">)</span>       <span class="err">→</span> <span class="s">&quot;&quot;</span>
<span class="p">(</span><span class="k">dup</span> <span class="s">&quot;AB&quot;</span> <span class="ss">5</span><span class="p">)</span>      <span class="err">→</span> <span class="s">&quot;ABABABABAB&quot;</span>
<span class="p">(</span><span class="k">dup</span> <span class="ss">9</span> <span class="ss">7</span><span class="p">)</span>         <span class="err">→</span> <span class="p">(</span><span class="nv">9</span> <span class="ss">9</span> <span class="ss">9</span> <span class="ss">9</span> <span class="ss">9</span> <span class="ss">9</span> <span class="ss">9</span><span class="p">)</span>
<span class="p">(</span><span class="k">dup</span> <span class="ss">9</span> <span class="ss">0</span><span class="p">)</span>         <span class="err">→</span> <span class="p">()</span>
<span class="p">(</span><span class="k">dup</span> <span class="o">&#39;</span><span class="ss">x</span> <span class="ss">8</span><span class="p">)</span>        <span class="err">→</span> <span class="p">(</span><span class="nv">x</span> <span class="ss">x</span> <span class="ss">x</span> <span class="ss">x</span> <span class="ss">x</span> <span class="ss">x</span> <span class="ss">x</span> <span class="ss">x</span><span class="p">)</span>
<span class="p">(</span><span class="k">dup</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1</span> <span class="ss">2</span><span class="p">)</span> <span class="ss">3</span><span class="p">)</span>    <span class="err">→</span> <span class="p">((</span><span class="nv">1</span> <span class="ss">2</span><span class="p">)</span> <span class="p">(</span><span class="nv">1</span> <span class="ss">2</span><span class="p">)</span> <span class="p">(</span><span class="nv">1</span> <span class="ss">2</span><span class="p">))</span>
<span class="p">(</span><span class="k">dup</span> <span class="s">&quot;\000&quot;</span> <span class="ss">4</span><span class="p">)</span>    <span class="err">→</span> <span class="s">&quot;\000\000\000\000&quot;</span>

<span class="p">(</span><span class="k">dup</span> <span class="s">&quot;*&quot;</span><span class="p">)</span>         <span class="err">→</span> <span class="s">&quot;**&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>The last example shows handling of binary information, creating a string
filled with four binary zeroes.</p></div>
<div class="paragraph"><p>See also the functions <a href="#sequence">sequence</a> and
<a href="#series">series</a>.</p></div>
<div class="paragraph"><p><a id="empty?"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_empty_span"><span class="big red">empty?</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (empty? <em>exp</em>)<br>
<strong>syntax:</strong> (empty? <em>str</em>)</p></div>
<div class="paragraph"><p><em>exp</em> is tested for an empty list (or <em>str</em> for an empty string).
Depending on whether the argument contains elements, <span class="monospaced">true</span> or <span class="monospaced">nil</span> is
returned.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">var</span> <span class="o">&#39;</span><span class="p">())</span>
<span class="p">(</span><span class="nv">empty?</span> <span class="ss">var</span><span class="p">)</span>         <span class="err">→</span> <span class="k">true</span>
<span class="p">(</span><span class="nv">empty?</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">))</span>  <span class="err">→</span> <span class="k">nil</span>
<span class="p">(</span><span class="nv">empty?</span> <span class="s">&quot;hello&quot;</span><span class="p">)</span>     <span class="err">→</span> <span class="k">nil</span>
<span class="p">(</span><span class="nv">empty?</span> <span class="s">&quot;&quot;</span><span class="p">)</span>          <span class="err">→</span> <span class="k">true</span>
</pre></div></div></div>
<div class="paragraph"><p>The first example checks a list, while the second two examples check a
string.</p></div>
<div class="paragraph"><p><a id="encrypt"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_encrypt_span"><span class="big red">encrypt</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (encrypt <em>str-source</em> <em>str-pad</em>)</p></div>
<div class="paragraph"><p>Performs a one-time–pad encryption of <em>str-source</em> using the encryption
pad in <em>str-pad</em>. The longer <em>str-pad</em> is and the more random the bytes
are, the safer the encryption. If the pad is as long as the source text,
is fully random, and is used only once, then one-time–pad encryption is
virtually impossible to break, since the encryption seems to contain
only random data. To retrieve the original, the same function and pad
are applied again to the encrypted text:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">secret</span>
  <span class="p">(</span><span class="k">encrypt</span> <span class="s">&quot;A secret message&quot;</span> <span class="s">&quot;my secret key&quot;</span><span class="p">))</span>
<span class="err">→</span> <span class="s">&quot;,YS\022\006\017\023\017TM\014\022\n\012\030E&quot;</span>

<span class="p">(</span><span class="k">encrypt</span> <span class="ss">secret</span> <span class="s">&quot;my secret key&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;A secret message&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>The second example encrypts a whole file:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">write-</span><span class="ss">file</span> <span class="s">&quot;myfile.enc&quot;</span>
  <span class="p">(</span><span class="k">encrypt</span> <span class="p">(</span><span class="k">read-</span><span class="ss">file</span> <span class="s">&quot;myfile&quot;</span><span class="p">)</span> <span class="s">&quot;29kH67*&quot;</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p><a id="ends-with"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_ends_with_span"><span class="big red">ends-with</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (ends-with <em>str-data</em> <em>str-key</em> [<em>num-option</em>])<br>
<strong>syntax:</strong> (ends-with <em>list</em> <em>exp</em>)</p></div>
<div class="paragraph"><p>In the first syntax, <span class="monospaced">ends-with</span> tests the string in <em>str-data</em> to see
if it ends with the string specified in <em>str-key</em>. It returns <span class="monospaced">true</span> or
<span class="monospaced">nil</span> depending on the outcome.</p></div>
<div class="paragraph"><p>If a regular expression <em>option</em> number is specified, <em>str-key</em> contains
a regular expression pattern. See <a href="#regex">regex</a> for valid numbers
for <em>option</em>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">ends-with</span> <span class="s">&quot;newLISP&quot;</span> <span class="s">&quot;LISP&quot;</span><span class="p">)</span>         <span class="err">→</span> <span class="k">true</span>
<span class="p">(</span><span class="k">ends-with</span> <span class="s">&quot;newLISP&quot;</span> <span class="s">&quot;lisp&quot;</span><span class="p">)</span>         <span class="err">→</span> <span class="k">nil</span>
<span class="c1">;; use regular expressions</span>
<span class="p">(</span><span class="k">ends-with</span> <span class="s">&quot;newLISP&quot;</span> <span class="s">&quot;lisp|york&quot;</span> <span class="ss">1</span><span class="p">)</span>  <span class="err">→</span> <span class="k">true</span>
</pre></div></div></div>
<div class="paragraph"><p>In the second syntax, <span class="monospaced">ends-with</span> checks if a list ends with the list
element in <em>exp</em>. <span class="monospaced">true</span> or <span class="monospaced">nil</span> is returned depending on outcome.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">ends-with</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">4</span> <span class="ss">5</span><span class="p">)</span> <span class="ss">5</span><span class="p">)</span>             <span class="err">→</span> <span class="k">true</span>
<span class="p">(</span><span class="k">ends-with</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span> <span class="ss">d</span> <span class="ss">e</span><span class="p">)</span> <span class="o">&#39;</span><span class="ss">b</span><span class="p">)</span>            <span class="err">→</span> <span class="k">nil</span>
<span class="p">(</span><span class="k">ends-with</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">))</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">+</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">))</span>  <span class="err">→</span> <span class="k">true</span>
</pre></div></div></div>
<div class="paragraph"><p>The last example shows that <em>exp</em> could be a list by itself.</p></div>
<div class="paragraph"><p>See also the <a href="#starts-with">starts-with</a> function.</p></div>
<div class="paragraph"><p><a id="env"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_env_span"><span class="big red">env</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (env)<br>
<strong>syntax:</strong> (env <em>var-str</em>)<br>
<strong>syntax:</strong> (env <em>var-str</em> <em>value-str</em>)</p></div>
<div class="paragraph"><p>In the first syntax (without arguments), the operating system&#8217;s
environment is retrieved as an association list in which each entry is a
key-value pair of environment variable and value.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">env</span><span class="p">)</span>
<span class="err">→</span> <span class="p">((</span><span class="s">&quot;PATH&quot;</span> <span class="s">&quot;/bin:/usr/bin:/sbin&quot;</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;TERM&quot;</span> <span class="s">&quot;xterm-color&quot;</span><span class="p">)</span> <span class="ss">...</span> <span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p>In the second syntax, the name of an environment variable is given in
<em>var-str</em>. <span class="monospaced">env</span> returns the value of the variable or <span class="monospaced">nil</span> if the
variable does not exist in the environment.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">env</span> <span class="s">&quot;PATH&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;/bin:/usr/bin:/usr/local/bin&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>The third syntax (variable name in <em>var-str</em> and value pair in
<em>value-str</em>) sets or creates an environment variable. If <em>value-str</em> is
the empty string <span class="monospaced">""</span>, then the variable is completely removed from the
environment except when running on Solaris, where the variable stays
with an empty string.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">env</span> <span class="s">&quot;NEWLISPBIN&quot;</span> <span class="s">&quot;/usr/bin/&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="k">true</span>
<span class="p">(</span><span class="k">env</span> <span class="s">&quot;NEWLISPBIN&quot;</span><span class="p">)</span>              <span class="err">→</span> <span class="s">&quot;/usr/bin/&quot;</span>
<span class="p">(</span><span class="k">env</span> <span class="s">&quot;NEWLISPBIN&quot;</span> <span class="s">&quot;&quot;</span><span class="p">)</span>           <span class="err">→</span> <span class="k">true</span>
<span class="p">(</span><span class="k">env</span> <span class="s">&quot;NEWLISPBIN&quot;</span><span class="p">)</span>              <span class="err">→</span> <span class="k">nil</span>
</pre></div></div></div>
<div class="paragraph"><p><a id="erf"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_erf_span"><span class="big red">erf</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (erf <em>num</em>)</p></div>
<div class="paragraph"><p><span class="monospaced">erf</span> calculates the error function of a number in <em>num</em>. The error
function is defined as:</p></div>
<div class="paragraph"><p><strong><em>erf (x) = 2/sqrt(pi) * integral from 0 to x of exp(-t^2) dt</em></strong></p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">map</span> <span class="k">erf</span> <span class="p">(</span><span class="k">sequence</span> <span class="ss">0.0</span> <span class="ss">6.0</span> <span class="ss">0.5</span><span class="p">))</span>
<span class="err">→</span>
<span class="p">(</span><span class="nv">0</span> <span class="ss">0.5204998778</span> <span class="ss">0.8427007929</span> <span class="ss">0.9661051465</span> <span class="ss">0.995322265</span> <span class="ss">0.999593048</span>
 <span class="ss">0.9999779095</span> <span class="ss">0.9999992569</span> <span class="ss">0.9999999846</span> <span class="ss">0.9999999998</span> <span class="ss">1</span> <span class="ss">1</span> <span class="ss">1</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p><a id="error-event"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_error_event_span"><span class="big red">error-event</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (error-event <em>sym-event-handler | func-event-handler</em>)</p></div>
<div class="paragraph"><p><em>sym-event-handler</em> contains a user-defined function for handling
errors. Whenever an error occurs, the system performs a
<a href="#reset">reset</a> and executes the user-defined error handler. The
error handler can use the built-in function <a href="#last-error">last-error</a>
to retrieve the number and text of the error. The event handler is
specified as either a quoted symbol or a lambda function.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">my-handler</span><span class="p">)</span>
  <span class="p">(</span><span class="k">print</span> <span class="s">&quot;error # &quot;</span> <span class="p">(</span><span class="k">first</span> <span class="p">(</span><span class="k">last-error</span><span class="p">))</span> <span class="s">&quot; has occurred\n&quot;</span><span class="p">)</span> <span class="p">)</span>

<span class="p">(</span><span class="k">error-event</span> <span class="o">&#39;</span><span class="ss">my-handler</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">my-handler</span>

<span class="c1">;; specify a function directly</span>

<span class="p">(</span><span class="k">error-event</span> <span class="ss">my-handler</span><span class="p">)</span>  <span class="err">→</span> <span class="k">$error-event</span>

<span class="p">(</span><span class="k">error-event</span>
  <span class="p">(</span><span class="k">fn</span> <span class="p">()</span> <span class="p">(</span><span class="k">print</span> <span class="s">&quot;error # &quot;</span> <span class="p">(</span><span class="k">first</span> <span class="p">(</span><span class="k">last-error</span><span class="p">))</span> <span class="s">&quot; has occurred\n&quot;</span><span class="p">)))</span>

<span class="p">(</span><span class="k">error-event</span> <span class="k">exit</span><span class="p">)</span>  <span class="err">→</span> <span class="k">$error-event</span>
</pre></div></div></div>
<div class="paragraph"><p>For a different way of handling errors, see the <a href="#catch">catch</a>
function. Use <a href="#throw-error">throw-error</a> to throw user-defined
errors.</p></div>
<div class="paragraph"><p><a id="eval"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_eval_span"><span class="big red">eval</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (eval <em>exp</em>)</p></div>
<div class="paragraph"><p><em>eval</em> evaluates the result of evaluating <em>exp</em> in the current variable
environment.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">expr</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">+</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">))</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">)</span>
<span class="p">(</span><span class="k">eval</span> <span class="ss">expr</span><span class="p">)</span>           <span class="err">→</span> <span class="ss">7</span>
<span class="p">(</span><span class="k">eval</span> <span class="p">(</span><span class="k">list</span> <span class="ss">+</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">))</span>   <span class="err">→</span> <span class="ss">7</span>
<span class="p">(</span><span class="k">eval</span> <span class="o">&#39;&#39;</span><span class="ss">x</span><span class="p">)</span>            <span class="err">→</span> <span class="ss">x</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">y</span> <span class="ss">123</span><span class="p">)</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">x</span> <span class="o">&#39;</span><span class="ss">y</span><span class="p">)</span>
<span class="ss">x</span>            <span class="err">→</span> <span class="ss">y</span>
<span class="p">(</span><span class="k">eval</span> <span class="ss">x</span><span class="p">)</span>     <span class="err">→</span> <span class="ss">123</span>
</pre></div></div></div>
<div class="paragraph"><p>As usual, evaluation of variables happens in the current variable
environment:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">; eval in global (top level) environment</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">x</span> <span class="ss">3</span> <span class="o">&#39;</span><span class="ss">y</span> <span class="ss">4</span><span class="p">)</span>
<span class="p">(</span><span class="k">eval</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">+</span> <span class="ss">x</span> <span class="ss">y</span><span class="p">))</span>          <span class="err">→</span> <span class="ss">7</span>

<span class="c1">; eval in local environment</span>
<span class="p">(</span><span class="k">let</span> <span class="p">(</span> <span class="p">(</span><span class="nv">x</span> <span class="ss">33</span><span class="p">)</span> <span class="p">(</span><span class="nv">y</span> <span class="ss">44</span><span class="p">)</span> <span class="p">)</span>
    <span class="p">(</span><span class="k">eval</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">+</span> <span class="ss">x</span> <span class="ss">y</span><span class="p">)))</span>     <span class="err">→</span> <span class="ss">77</span>

<span class="c1">; old environment after leaving local let environment</span>
<span class="p">(</span><span class="k">eval</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">+</span> <span class="ss">x</span> <span class="ss">y</span><span class="p">))</span>          <span class="err">→</span> <span class="ss">7</span>
</pre></div></div></div>
<div class="paragraph"><p>newLISP passes all arguments by value. Using a quoted symbol,
expressions can be passed by reference through the symbol. <span class="monospaced">eval</span> can be
used to access the original contents of the symbol:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">change-list</span> <span class="ss">aList</span><span class="p">)</span> <span class="p">(</span><span class="k">push</span> <span class="ss">999</span> <span class="p">(</span><span class="k">eval</span> <span class="ss">aList</span><span class="p">)))</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">data</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">4</span> <span class="ss">5</span><span class="p">))</span>

<span class="p">(</span><span class="nv">change-list</span> <span class="o">&#39;</span><span class="ss">data</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">999</span> <span class="ss">1</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">4</span> <span class="ss">5</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>In the example, the parameter <span class="monospaced">'data ` is quoted, so `push</span> can work on
the original list.</p></div>
<div class="paragraph"><p>There is a safer method to pass arguments by reference in newLISP by
enclosing the data inside context objects. See the chapter
<a href="#pass_big">Passing data by reference</a>. Passing references into user
defined function using namespace ids avoids <em>variable capture</em> of the
passed symbol, in case the symbol passed is the same used as a parameter
in the function.</p></div>
<div class="paragraph"><p><a id="eval-string"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_eval_string_span"><span class="big red">eval-string</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (eval-string <em>str-source</em> [<em>sym-context</em> [<em>exp-error</em> [<em>int-offset</em>]]])</p></div>
<div class="paragraph"><p>The string in <em>str-source</em> is compiled into newLISP&#8217;s internal format
and then evaluated. The evaluation result is returned. If the string
contains more than one expression, the result of the last evaluation is
returned.</p></div>
<div class="paragraph"><p>An optional second argument can be used to specify the context to which
the string should be parsed and translated.</p></div>
<div class="paragraph"><p>If an error occurs while parsing and evaluating <em>str-source</em> then
<em>exp-error</em> will be evaluated and the result returned.</p></div>
<div class="paragraph"><p><em>int-offset</em> specifies an optional offset into <em>str-source</em>, where to
start evaluation.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">eval-string</span> <span class="s">&quot;(+ 3 4)&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">7</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">X</span> <span class="ss">123</span><span class="p">)</span>             <span class="err">→</span> <span class="ss">123</span>
<span class="p">(</span><span class="k">eval-string</span> <span class="s">&quot;X&quot;</span><span class="p">)</span>        <span class="err">→</span> <span class="ss">123</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">repl</span><span class="p">)</span> <span class="c1">; read print eval loop</span>
  <span class="p">(</span><span class="k">while</span> <span class="k">true</span>
    <span class="p">(</span><span class="k">println</span> <span class="s">&quot;=&gt; &quot;</span> <span class="p">(</span><span class="k">eval-string</span> <span class="p">(</span><span class="k">read-</span><span class="ss">line</span><span class="p">)</span> <span class="k">MAIN</span> <span class="p">(</span><span class="k">last-error</span><span class="p">)))</span>
  <span class="p">)</span>
<span class="p">)</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">a</span> <span class="ss">10</span><span class="p">)</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">b</span> <span class="ss">20</span><span class="p">)</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">foo</span><span class="o">:</span><span class="ss">a</span> <span class="ss">11</span><span class="p">)</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">foo</span><span class="o">:</span><span class="ss">b</span> <span class="ss">22</span><span class="p">)</span>

<span class="p">(</span><span class="k">eval-string</span> <span class="s">&quot;(+ a b)&quot;</span><span class="p">)</span>       <span class="err">→</span> <span class="ss">30</span>
<span class="p">(</span><span class="k">eval-string</span> <span class="s">&quot;(+ a b)&quot;</span> <span class="o">&#39;</span><span class="ss">foo</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">33</span>
</pre></div></div></div>
<div class="paragraph"><p>The second example shows a simple newLISP interpreter eval loop.</p></div>
<div class="paragraph"><p>The last example shows how to specify a target context for translation.
The symbols <span class="monospaced">a</span> and <span class="monospaced">b</span> now refer to symbols and their values in context
<span class="monospaced">foo</span> instead of <span class="monospaced">MAIN</span>.</p></div>
<div class="paragraph"><p>See also the function <a href="#read-expr">read-expr</a> which translates a
string without evaluating it.</p></div>
<div class="paragraph"><p><a id="even?"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_even_span"><span class="big red">even?</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (even? <em>int-number</em>)</p></div>
<div class="paragraph"><p>Checks if an integer number is <em>even divisable</em> by <span class="monospaced">2</span>, without
remainder. When a floating point number is passed for <em>int-number</em>, it
will be converted to an integer by cutting off its fractional part.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="nv">even?</span> <span class="ss">123</span><span class="p">)</span>  <span class="err">→</span> <span class="k">nil</span>
<span class="p">(</span><span class="nv">even?</span> <span class="ss">8</span><span class="p">)</span>    <span class="err">→</span> <span class="k">true</span>
<span class="p">(</span><span class="nv">even?</span> <span class="ss">8.7</span><span class="p">)</span>  <span class="err">→</span> <span class="k">true</span>
</pre></div></div></div>
<div class="paragraph"><p>Use <a href="#oddp">odd?</a> to check if an integer is not divisable by <span class="monospaced">2</span>.</p></div>
<div class="paragraph"><p><a id="exec"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_exec_span"><span class="big red">exec</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (exec <em>str-process</em>)<br>
<strong>syntax:</strong> (exec <em>str-process</em> [<em>str-stdin</em>])</p></div>
<div class="paragraph"><p>In the first form, <span class="monospaced">exec</span> launches a process described in <em>str-process</em>
and returns all standard output as a list of strings (one for each line
in standard out (STDOUT)). <span class="monospaced">exec</span> returns <span class="monospaced">nil</span> if the process could not
be launched. If the process could be launched but only returns and error
and no valid output, the empty list will be returned.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">exec</span> <span class="s">&quot;ls *.c&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="s">&quot;newlisp.c&quot;</span> <span class="s">&quot;nl-math.c&quot;</span> <span class="s">&quot;nl-string.c&quot;</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The example starts a process and performs the shell command <span class="monospaced">ls</span>,
capturing the output in an array of strings.</p></div>
<div class="paragraph"><p>In the second form, <span class="monospaced">exec</span> creates a process pipe, starts the process in
<em>str-process</em>, and receives from <em>str-stdin</em> standard input for this
process. The return value is <span class="monospaced">true</span> if the process was successfully
launched; otherwise it is <span class="monospaced">nil</span>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">exec</span> <span class="s">&quot;cgiProc&quot;</span> <span class="ss">query</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>In this example, cgiProc could be a cgi processor (e.g., Perl or
newLISP) that receives and processes standard input supplied by a string
contained in the variable query.</p></div>
<div class="paragraph"><p><a id="exists"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_exists_span"><span class="big red">exists</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (exists <em>func-condition</em> <em>list</em>)</p></div>
<div class="paragraph"><p>Successively applies <em>func-condition</em> to the elements of <em>list</em> and
returns the first element that meets the condition in <em>func-condition</em>.
If no element meets the condition, <span class="monospaced">nil</span> is returned.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">exists</span> <span class="k">string</span><span class="ss">?</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">2</span> <span class="ss">3</span> <span class="ss">4</span> <span class="ss">6</span> <span class="s">&quot;hello&quot;</span> <span class="ss">7</span><span class="p">))</span>       <span class="err">→</span> <span class="s">&quot;hello&quot;</span>

<span class="p">(</span><span class="k">exists</span> <span class="k">string</span><span class="ss">?</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">3</span> <span class="ss">4</span> <span class="ss">2</span> <span class="k">-</span><span class="ss">7</span> <span class="ss">3</span> <span class="ss">0</span><span class="p">))</span>            <span class="err">→</span> <span class="k">nil</span>

<span class="p">(</span><span class="k">exists</span> <span class="ss">zero?</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">3</span> <span class="ss">4</span> <span class="ss">2</span> <span class="k">-</span><span class="ss">7</span> <span class="ss">3</span> <span class="ss">0</span><span class="p">))</span>              <span class="err">→</span> <span class="ss">0</span> <span class="c1">; check for 0 or 0.0</span>

<span class="p">(</span><span class="k">exists</span> <span class="ss">&lt;</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">3</span> <span class="ss">4</span> <span class="ss">2</span> <span class="k">-</span><span class="ss">7</span> <span class="ss">3</span> <span class="ss">0</span><span class="p">))</span>                  <span class="err">→</span> <span class="k">-</span><span class="ss">7</span> <span class="c1">; check for negative</span>

<span class="p">(</span><span class="k">exists</span> <span class="p">(</span><span class="k">fn</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">&gt;</span> <span class="ss">x</span> <span class="ss">3</span><span class="p">))</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">3</span> <span class="ss">4</span> <span class="ss">2</span> <span class="k">-</span><span class="ss">7</span> <span class="ss">3</span> <span class="ss">0</span><span class="p">))</span>   <span class="err">→</span> <span class="ss">4</span>

<span class="p">(</span><span class="k">exists</span> <span class="p">(</span><span class="k">fn</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">=</span> <span class="ss">x</span> <span class="ss">10</span><span class="p">))</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">3</span> <span class="ss">4</span> <span class="ss">2</span> <span class="k">-</span><span class="ss">7</span> <span class="ss">3</span> <span class="ss">0</span><span class="p">))</span>  <span class="err">→</span> <span class="k">nil</span>
</pre></div></div></div>
<div class="paragraph"><p>If <em>func-condition</em> is <span class="monospaced">nil?</span>, the result <span class="monospaced">nil</span> is ambiguous. In this
case <a href="#index">index</a> or <a href="#find">find</a> are the better method when
looking for <span class="monospaced">nil</span>.</p></div>
<div class="paragraph"><p>Use the <a href="#for-all">for-all</a> function to check if a condition is met
for all elements in a list.</p></div>
<div class="paragraph"><p><a id="exit"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_exit_span"><span class="big red">exit</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (exit [<em>int</em>])</p></div>
<div class="paragraph"><p>Exits newLISP. An optional exit code, <em>int</em>, may be supplied. This code
can be tested by the host operating system. When newLISP is run in
<a href="#daemon">daemon server mode</a> using <span class="monospaced">-d</span> as a command-line option,
only the network connection is closed, while newLISP stays resident,
listening for a new connection.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">exit</span> <span class="ss">5</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p><a id="exp"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_exp_span"><span class="big red">exp</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (exp <em>num</em>)</p></div>
<div class="paragraph"><p>The expression in <em>num</em> is evaluated, and the exponential function is
calculated based on the result. <span class="monospaced">exp</span> is the inverse function of
<a href="#log">log</a>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">exp</span> <span class="ss">1</span><span class="p">)</span>        <span class="err">→</span> <span class="ss">2.718281828</span>
<span class="p">(</span><span class="k">exp</span> <span class="p">(</span><span class="k">log</span> <span class="ss">1</span><span class="p">))</span>  <span class="err">→</span> <span class="ss">1</span>
</pre></div></div></div>
<div class="paragraph"><p><a id="expand"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_expand_span"><span class="big red">expand</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (expand <em>exp</em> <em>sym-1</em> [<em>sym-2</em> &#8230; ])<br>
<strong>syntax:</strong> (expand <em>exp</em> <em>list-assoc</em> [<em>bool</em>])<br>
<strong>syntax:</strong> (expand <em>exp</em>)</p></div>
<div class="paragraph"><p>In the first syntax, one symbol in <em>sym</em> (or more in <em>sym-2</em> through
<em>sym-n</em>) is looked up in a simple or nested expression <em>exp</em>. They are
then expanded to the current binding of the symbol and the expanded
expression is returned. The original list remains unchanged.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">x</span> <span class="ss">2</span> <span class="o">&#39;</span><span class="ss">a</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">d</span> <span class="ss">e</span><span class="p">))</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">foo</span> <span class="o">&#39;</span><span class="ss">a</span><span class="p">)</span>
<span class="p">(</span><span class="k">expand</span> <span class="ss">foo</span> <span class="o">&#39;</span><span class="ss">a</span><span class="p">)</span>               <span class="err">→</span> <span class="p">(</span><span class="nv">d</span> <span class="ss">e</span><span class="p">)</span>
<span class="p">(</span><span class="k">expand</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">x</span> <span class="ss">b</span><span class="p">)</span> <span class="o">&#39;</span><span class="ss">x</span><span class="p">)</span>           <span class="err">→</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">2</span> <span class="ss">b</span><span class="p">)</span>
<span class="p">(</span><span class="k">expand</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">x</span> <span class="p">(</span><span class="nv">b</span> <span class="ss">c</span> <span class="ss">x</span><span class="p">))</span> <span class="o">&#39;</span><span class="ss">x</span><span class="p">)</span>     <span class="err">→</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">2</span> <span class="p">(</span><span class="nv">b</span> <span class="ss">c</span> <span class="ss">2</span><span class="p">))</span>
<span class="p">(</span><span class="k">expand</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">x</span> <span class="p">(</span><span class="nv">b</span> <span class="ss">c</span> <span class="ss">x</span><span class="p">))</span> <span class="o">&#39;</span><span class="ss">x</span> <span class="o">&#39;</span><span class="ss">a</span><span class="p">)</span>  <span class="err">→</span> <span class="p">((</span><span class="nv">d</span> <span class="ss">e</span><span class="p">)</span> <span class="ss">2</span> <span class="p">(</span><span class="nv">b</span> <span class="ss">c</span> <span class="ss">2</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p><span class="monospaced">expand</span> is useful when composing lambda expressions or doing variable
expansion inside macros.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">raise-to</span> <span class="ss">power</span><span class="p">)</span>
  <span class="p">(</span><span class="k">expand</span> <span class="p">(</span><span class="k">fn</span> <span class="p">(</span><span class="nv">base</span><span class="p">)</span> <span class="p">(</span><span class="k">pow</span> <span class="ss">base</span> <span class="ss">power</span><span class="p">))</span> <span class="o">&#39;</span><span class="ss">power</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="ss">square</span> <span class="p">(</span><span class="nv">raise-to</span> <span class="ss">2</span><span class="p">))</span>
<span class="p">(</span><span class="k">define</span> <span class="ss">cube</span> <span class="p">(</span><span class="nv">raise-to</span> <span class="ss">3</span><span class="p">))</span>

<span class="p">(</span><span class="nv">square</span> <span class="ss">5</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">25</span>
<span class="p">(</span><span class="nv">cube</span> <span class="ss">5</span><span class="p">)</span>    <span class="err">→</span> <span class="ss">125</span>
</pre></div></div></div>
<div class="paragraph"><p>If more than one symbol is present, <span class="monospaced">expand</span> will work in an incremental
fashion:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">a</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">b</span> <span class="ss">c</span><span class="p">))</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">b</span> <span class="ss">1</span><span class="p">)</span>

<span class="p">(</span><span class="k">expand</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span><span class="p">)</span> <span class="o">&#39;</span><span class="ss">a</span> <span class="o">&#39;</span><span class="ss">b</span><span class="p">)</span>  <span class="err">→</span> <span class="p">((</span><span class="nv">1</span> <span class="ss">c</span><span class="p">)</span> <span class="ss">1</span> <span class="ss">c</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Like the <a href="#apply">apply</a> function, <span class="monospaced">expand</span> <em>reduces</em> its argument
list.</p></div>
<div class="paragraph"><p><strong>syntax:</strong> (expand <em>exp</em> <em>list-assoc</em> [<em>bool</em>])</p></div>
<div class="paragraph"><p>The second syntax of <span class="monospaced">expand</span> allows expansion bindings to be specified
on the fly, without performing a <a href="#set">set</a> on the participating
variables:</p></div>
<div class="paragraph"><p>If the <em>bool</em> evaluates to <span class="monospaced">true</span>, the value parts in the association
list are evaluated.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">expand</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">a</span> <span class="ss">1</span><span class="p">)</span> <span class="p">(</span><span class="nv">b</span> <span class="ss">2</span><span class="p">)))</span>                <span class="err">→</span> <span class="p">(</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">c</span><span class="p">)</span>
<span class="p">(</span><span class="k">expand</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">a</span> <span class="ss">1</span><span class="p">)</span> <span class="p">(</span><span class="nv">b</span> <span class="ss">2</span><span class="p">)</span> <span class="p">(</span><span class="nv">c</span> <span class="p">(</span><span class="nv">x</span> <span class="ss">y</span> <span class="ss">z</span><span class="p">))))</span>    <span class="err">→</span> <span class="p">(</span><span class="nv">1</span> <span class="ss">2</span> <span class="p">(</span><span class="nv">x</span> <span class="ss">y</span> <span class="ss">z</span><span class="p">))</span>
<span class="p">(</span><span class="k">expand</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">a</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">1</span> <span class="ss">2</span><span class="p">))</span> <span class="p">(</span><span class="nv">b</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">))))</span>      <span class="err">→</span> <span class="p">((</span><span class="nv">+</span> <span class="ss">1</span> <span class="ss">2</span><span class="p">)</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">))</span>
<span class="p">(</span><span class="k">expand</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">a</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">1</span> <span class="ss">2</span><span class="p">))</span> <span class="p">(</span><span class="nv">b</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">)))</span> <span class="k">true</span><span class="p">)</span> <span class="err">→</span> <span class="p">(</span><span class="nv">3</span> <span class="ss">7</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Note that the contents of the variables in the association list will not
change. This is different from the <a href="#letex">letex</a> function, where
variables are set by evaluating and assigning their association parts.</p></div>
<div class="paragraph"><p>This form of <span class="monospaced">expand</span> is frequently used in logic programming, together
with the <a href="#unify">unify</a> function.</p></div>
<div class="paragraph"><p><strong>syntax:</strong> (expand <em>exp</em>)</p></div>
<div class="paragraph"><p>A third syntax is used to expand only the contents of variables starting
with an uppercase character. This PROLOG mode may also be used in the
context of logic programming. As in the first syntax of <span class="monospaced">expand</span>,
symbols must be preset. Only uppercase variables and those bound to
anything other than <span class="monospaced">nil</span> will be expanded:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">A</span> <span class="ss">1</span> <span class="o">&#39;</span><span class="ss">Bvar</span> <span class="ss">2</span> <span class="o">&#39;</span><span class="ss">C</span> <span class="k">nil</span> <span class="o">&#39;</span><span class="ss">d</span> <span class="ss">5</span> <span class="o">&#39;</span><span class="ss">e</span> <span class="ss">6</span><span class="p">)</span>
<span class="p">(</span><span class="k">expand</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">A</span> <span class="p">(</span><span class="nv">Bvar</span><span class="p">)</span> <span class="ss">C</span> <span class="ss">d</span> <span class="ss">e</span> <span class="ss">f</span><span class="p">))</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">1</span> <span class="p">(</span><span class="nv">2</span><span class="p">)</span> <span class="ss">C</span> <span class="ss">d</span> <span class="ss">e</span> <span class="ss">f</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Only the symbols <span class="monospaced">A</span> and <span class="monospaced">Bvar</span> are expanded because they have
capitalized names and non-<span class="monospaced">nil</span> contents.</p></div>
<div class="paragraph"><p>The <em>currying</em> function in the example demonstrating the first syntax of
<span class="monospaced">expand</span> can now be written even more simply using an uppercase
variable:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">raise-to</span> <span class="ss">Power</span><span class="p">)</span>
  <span class="p">(</span><span class="k">expand</span> <span class="p">(</span><span class="k">fn</span> <span class="p">(</span><span class="nv">base</span><span class="p">)</span> <span class="p">(</span><span class="k">pow</span> <span class="ss">base</span> <span class="ss">Power</span><span class="p">))))</span>

<span class="ss">&gt;</span> <span class="p">(</span><span class="k">define</span> <span class="ss">cube</span> <span class="p">(</span><span class="nv">raise-to</span> <span class="ss">3</span><span class="p">))</span>
<span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">base</span><span class="p">)</span> <span class="p">(</span><span class="k">pow</span> <span class="ss">base</span> <span class="ss">3</span><span class="p">))</span>

<span class="ss">&gt;</span> <span class="p">(</span><span class="nv">cube</span> <span class="ss">4</span><span class="p">)</span>
<span class="ss">64</span>

<span class="ss">&gt;</span> <span class="ss">_</span>
</pre></div></div></div>
<div class="paragraph"><p>See the <a href="#letex">letex</a> function, which also provides an expansion
mechanism, and the function <a href="#unify">unify</a>, which is frequently used
together with <span class="monospaced">expand</span>.</p></div>
<div class="paragraph"><p><a id="explode"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_explode_a_href_utf8_capable_utf8_a_span"><span class="big red">explode <a href="#utf8_capable">utf8</a></span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (explode <em>str</em> [<em>int-chunk</em> [<em>bool</em>]])<br>
<strong>syntax:</strong> (explode <em>list</em> [<em>int-chunk</em> [<em>bool</em>]])</p></div>
<div class="paragraph"><p>In the first syntax, <span class="monospaced">explode</span> transforms the string (<em>str</em>) into a list
of single-character strings. Optionally, a chunk size can be specified
in <em>int-chunk</em> to break the string into multi-character chunks. When
specifying a value for <em>bool</em> other than <span class="monospaced">nil</span>, the last chunk will be
omitted if it does not have the full length specified in <em>int-chunk</em>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">explode</span> <span class="s">&quot;newLISP&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="s">&quot;n&quot;</span> <span class="s">&quot;e&quot;</span> <span class="s">&quot;w&quot;</span> <span class="s">&quot;L&quot;</span> <span class="s">&quot;I&quot;</span> <span class="s">&quot;S&quot;</span> <span class="s">&quot;P&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">join</span> <span class="p">(</span><span class="k">explode</span> <span class="s">&quot;keep it together&quot;</span><span class="p">))</span>  <span class="err">→</span> <span class="s">&quot;keep it together&quot;</span>

<span class="p">(</span><span class="k">explode</span> <span class="s">&quot;newLISP&quot;</span> <span class="ss">2</span><span class="p">)</span>    <span class="err">→</span> <span class="p">(</span><span class="s">&quot;ne&quot;</span> <span class="s">&quot;wL&quot;</span> <span class="s">&quot;IS&quot;</span> <span class="s">&quot;P&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">explode</span> <span class="s">&quot;newLISP&quot;</span> <span class="ss">3</span><span class="p">)</span>    <span class="err">→</span> <span class="p">(</span><span class="s">&quot;new&quot;</span> <span class="s">&quot;LIS&quot;</span> <span class="s">&quot;P&quot;</span><span class="p">)</span>

<span class="c1">; omit last chunk if too short</span>
<span class="p">(</span><span class="k">explode</span> <span class="s">&quot;newLISP&quot;</span> <span class="ss">3</span> <span class="k">true</span><span class="p">)</span>    <span class="err">→</span> <span class="p">(</span><span class="s">&quot;new&quot;</span> <span class="s">&quot;LIS&quot;</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Only on non UTF8– enabled versions, <span class="monospaced">explode</span> also works on binary
content:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">explode</span> <span class="s">&quot;\000\001\002\003&quot;</span><span class="p">)</span>
<span class="err">→</span> <span class="p">(</span><span class="s">&quot;\000&quot;</span> <span class="s">&quot;\001&quot;</span> <span class="s">&quot;\002&quot;</span> <span class="s">&quot;\003&quot;</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>When called in UTF-8–enabled versions of newLISP, <span class="monospaced">explode</span> will work on
character boundaries rather than byte boundaries. In UTF-8–encoded
strings, characters may contain more than one byte. Processing will stop
when a zero byte character is found.</p></div>
<div class="paragraph"><p>To explode binary contents on UTF-8–enabled versions of newLISP use
<a href="#unpack">unpack</a> as shown in the following example:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">str</span> <span class="s">&quot;\001\002\003\004&quot;</span><span class="p">)</span> <span class="err">→</span> <span class="s">&quot;\001\002\003\004&quot;</span>

<span class="p">(</span><span class="k">unpack</span> <span class="p">(</span><span class="k">dup</span> <span class="s">&quot;c&quot;</span> <span class="p">(</span><span class="k">length</span> <span class="ss">str</span><span class="p">))</span> <span class="ss">str</span><span class="p">)</span> <span class="err">→</span> <span class="p">(</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">)</span>
<span class="p">(</span><span class="k">unpack</span> <span class="p">(</span><span class="k">dup</span> <span class="s">&quot;s&quot;</span> <span class="p">(</span><span class="k">length</span> <span class="ss">str</span><span class="p">))</span> <span class="ss">str</span><span class="p">)</span> <span class="err">→</span> <span class="p">(</span><span class="s">&quot;\001&quot;</span> <span class="s">&quot;\002&quot;</span> <span class="s">&quot;\003&quot;</span> <span class="s">&quot;\004&quot;</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>In the second syntax, <span class="monospaced">explode</span> explodes a list (<em>list</em>) into sublists
of chunk size <em>int-chunk</em>, which is 1 (one) by default.</p></div>
<div class="paragraph"><p>The following shows an example of the last chunk being omitted when the
value for <em>bool</em> is other than <span class="monospaced">nil</span>, and the chunk does not have the
full length specified in <em>int-chunk</em>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">explode</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span> <span class="ss">d</span> <span class="ss">e</span> <span class="ss">f</span> <span class="ss">g</span> <span class="ss">h</span><span class="p">))</span>    <span class="err">→</span> <span class="p">((</span><span class="nv">a</span><span class="p">)</span> <span class="p">(</span><span class="nv">b</span><span class="p">)</span> <span class="p">(</span><span class="nv">c</span><span class="p">)</span> <span class="p">(</span><span class="nv">d</span><span class="p">)</span> <span class="p">(</span><span class="nv">e</span><span class="p">)</span> <span class="p">(</span><span class="nv">f</span><span class="p">)</span> <span class="p">(</span><span class="nv">g</span><span class="p">)</span> <span class="p">(</span><span class="nv">h</span><span class="p">))</span>
<span class="p">(</span><span class="k">explode</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span> <span class="ss">d</span> <span class="ss">e</span> <span class="ss">f</span> <span class="ss">g</span><span class="p">)</span> <span class="ss">2</span><span class="p">)</span>  <span class="err">→</span> <span class="p">((</span><span class="nv">a</span> <span class="ss">b</span><span class="p">)</span> <span class="p">(</span><span class="nv">c</span> <span class="ss">d</span><span class="p">)</span> <span class="p">(</span><span class="nv">e</span> <span class="ss">f</span><span class="p">)</span> <span class="p">(</span><span class="nv">g</span><span class="p">))</span>

<span class="c1">; omit last chunk if too short</span>
<span class="p">(</span><span class="k">explode</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span> <span class="ss">d</span> <span class="ss">e</span> <span class="ss">f</span> <span class="ss">g</span><span class="p">)</span> <span class="ss">2</span> <span class="k">true</span><span class="p">)</span>  <span class="err">→</span> <span class="p">((</span><span class="nv">a</span> <span class="ss">b</span><span class="p">)</span> <span class="p">(</span><span class="nv">c</span> <span class="ss">d</span><span class="p">)</span> <span class="p">(</span><span class="nv">e</span> <span class="ss">f</span><span class="p">))</span>

<span class="p">(</span><span class="k">transpose</span> <span class="p">(</span><span class="k">explode</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span> <span class="ss">d</span> <span class="ss">e</span> <span class="ss">f</span> <span class="ss">g</span> <span class="ss">h</span><span class="p">)</span> <span class="ss">2</span><span class="p">))</span>
<span class="err">→</span> <span class="p">((</span><span class="nv">a</span> <span class="ss">c</span> <span class="ss">e</span> <span class="ss">g</span><span class="p">)</span> <span class="p">(</span><span class="nv">b</span> <span class="ss">d</span> <span class="ss">f</span> <span class="ss">h</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p>The <a href="#join">join</a> and <a href="#append">append</a> functions are inverse
operations of <span class="monospaced">explode</span>.</p></div>
<div class="paragraph"><p><a id="extend"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_extend_a_href_destructive_a_span"><span class="big red">extend <a href="#destructive">!</a></span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (extend <em>list-1</em> [<em>list-2</em> &#8230; ])<br>
<strong>syntax:</strong> (extend <em>string-1</em> [<em>string-2</em> &#8230; ])</p></div>
<div class="paragraph"><p>The list in <em>list-1</em> is extended by appending <em>list-2</em>. More than one
list may be appended.</p></div>
<div class="paragraph"><p>The string in <em>string-1</em> is extended by appending <em>string-2</em>. More than
one string may be appended. The string can contain binary <span class="monospaced">0</span> (zero)
characters.</p></div>
<div class="paragraph"><p>The first parameter can be an un-initialized variable.</p></div>
<div class="paragraph"><p>The extended list or string is returned.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">; extending lists</span>

<span class="p">(</span><span class="k">extend</span> <span class="ss">lst</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">c</span> <span class="ss">d</span><span class="p">))</span> <span class="err">→</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span> <span class="ss">d</span><span class="p">)</span>
<span class="p">(</span><span class="k">extend</span> <span class="ss">lst</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">e</span> <span class="ss">f</span> <span class="ss">g</span><span class="p">))</span> <span class="err">→</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span> <span class="ss">d</span> <span class="ss">e</span> <span class="ss">f</span><span class="p">)</span>
<span class="ss">lst</span> <span class="err">→</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span> <span class="ss">d</span> <span class="ss">e</span> <span class="ss">f</span> <span class="ss">g</span><span class="p">)</span>

<span class="c1">; extending strings</span>

<span class="p">(</span><span class="k">extend</span> <span class="ss">str</span> <span class="s">&quot;ab&quot;</span> <span class="s">&quot;cd&quot;</span><span class="p">)</span> <span class="err">→</span> <span class="s">&quot;abcd&quot;</span>
<span class="p">(</span><span class="k">extend</span> <span class="ss">str</span> <span class="s">&quot;efg&quot;</span><span class="p">)</span> <span class="err">→</span> <span class="s">&quot;abcdefg&quot;</span>
<span class="ss">str</span> <span class="err">→</span> <span class="s">&quot;abcdefg&quot;</span>

<span class="c1">; extending in place</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">L</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="s">&quot;CD&quot;</span> <span class="p">(</span><span class="nv">e</span> <span class="ss">f</span><span class="p">)))</span>
<span class="p">(</span><span class="k">extend</span> <span class="p">(</span><span class="nv">L</span> <span class="ss">2</span><span class="p">)</span> <span class="s">&quot;E&quot;</span><span class="p">)</span>
<span class="ss">L</span> <span class="err">→</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="s">&quot;CDE&quot;</span> <span class="p">(</span><span class="nv">e</span> <span class="ss">f</span><span class="p">))</span>

<span class="p">(</span><span class="k">extend</span> <span class="p">(</span><span class="nv">L</span> <span class="ss">3</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">g</span><span class="p">))</span>
<span class="ss">L</span> <span class="err">→</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="s">&quot;CDE&quot;</span> <span class="p">(</span><span class="nv">e</span> <span class="ss">f</span> <span class="ss">g</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p>For a non-destructive list or string extension see <a href="#append">append</a>.</p></div>
<div class="paragraph"><p><a id="factor"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_factor_span"><span class="big red">factor</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (factor <em>int</em>)</p></div>
<div class="paragraph"><p>Factors the number in <em>int</em> into its prime components. When floating
point numbers are passed, they are truncated to their integer part
first.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">factor</span> <span class="ss">123456789123456789</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">3</span> <span class="ss">3</span> <span class="ss">7</span> <span class="ss">11</span> <span class="ss">13</span> <span class="ss">19</span> <span class="ss">3607</span> <span class="ss">3803</span> <span class="ss">52579</span><span class="p">)</span>

<span class="c1">;; check correctness of factoring</span>
<span class="p">(</span><span class="nv">=</span> <span class="p">(</span><span class="k">apply</span> <span class="ss">*</span> <span class="p">(</span><span class="k">factor</span> <span class="ss">123456789123456789</span><span class="p">))</span> <span class="ss">123456789123456789</span><span class="p">)</span>
<span class="err">→</span> <span class="k">true</span>

<span class="c1">;; factor the biggest integer</span>
<span class="p">(</span><span class="k">factor</span> <span class="ss">9223372036854775807</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">7</span> <span class="ss">7</span> <span class="ss">73</span> <span class="ss">127</span> <span class="ss">337</span> <span class="ss">92737</span> <span class="ss">649657</span><span class="p">)</span>

<span class="c1">;; primes.lsp - return all primes in a list, up to n</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">primes</span> <span class="ss">n</span> <span class="ss">,</span> <span class="ss">p</span><span class="p">)</span>
  <span class="p">(</span><span class="k">dotimes</span> <span class="p">(</span><span class="nv">e</span> <span class="ss">n</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">=</span> <span class="p">(</span><span class="k">length</span> <span class="p">(</span><span class="k">factor</span> <span class="ss">e</span><span class="p">))</span> <span class="ss">1</span><span class="p">)</span>
      <span class="p">(</span><span class="k">push</span> <span class="ss">e</span> <span class="ss">p</span> <span class="k">-</span><span class="ss">1</span><span class="p">)))</span> <span class="ss">p</span><span class="p">)</span>

<span class="p">(</span><span class="nv">primes</span> <span class="ss">20</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">2</span> <span class="ss">3</span> <span class="ss">5</span> <span class="ss">7</span> <span class="ss">11</span> <span class="ss">13</span> <span class="ss">17</span> <span class="ss">19</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p><span class="monospaced">factor</span> returns <span class="monospaced">nil</span> for numbers smaller than <span class="monospaced">2</span>. For numbers larger
than 9,223,372,036,854,775,807 (the largest 64-bit integer) converted
from floating point numbers, the largest integer is factored.</p></div>
<div class="paragraph"><p><a id="fft"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_fft_span"><span class="big red">fft</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (fft <em>list-num</em>)</p></div>
<div class="paragraph"><p>Calculates the discrete Fourier transform on the list of complex numbers
in <em>list-num</em> using the FFT method (Fast Fourier Transform). Each
complex number is specified by its real part followed by its imaginary
part. If only real numbers are used, the imaginary part is set to <span class="monospaced">0.0</span>
(zero). When the number of elements in <em>list-num</em> is not a power of 2,
<span class="monospaced">fft</span> increases the number of elements by padding the list with zeroes.
When the imaginary part of a complex number is <span class="monospaced">0</span>, simple numbers can
be used instead.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">ifft</span> <span class="p">(</span><span class="k">fft</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">1</span> <span class="ss">0</span><span class="p">)</span> <span class="p">(</span><span class="nv">2</span> <span class="ss">0</span><span class="p">)</span> <span class="p">(</span><span class="nv">3</span> <span class="ss">0</span><span class="p">)</span> <span class="p">(</span><span class="nv">4</span> <span class="ss">0</span><span class="p">))))</span>
<span class="err">→</span> <span class="p">((</span><span class="nv">1</span> <span class="ss">0</span><span class="p">)</span> <span class="p">(</span><span class="nv">2</span> <span class="ss">0</span><span class="p">)</span> <span class="p">(</span><span class="nv">3</span> <span class="ss">0</span><span class="p">)</span> <span class="p">(</span><span class="nv">4</span> <span class="ss">0</span><span class="p">))</span>

<span class="c1">;; when imaginary part is 0, plain numbers work, too</span>
<span class="c1">;; complex numbers can be intermixed</span>

<span class="p">(</span><span class="k">fft</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">))</span>      <span class="err">→</span> <span class="p">((</span><span class="nv">10</span> <span class="ss">0</span><span class="p">)</span> <span class="p">(</span><span class="k">-</span><span class="ss">2</span> <span class="k">-</span><span class="ss">2</span><span class="p">)</span> <span class="p">(</span><span class="k">-</span><span class="ss">2</span> <span class="ss">0</span><span class="p">)</span> <span class="p">(</span><span class="k">-</span><span class="ss">2</span> <span class="ss">2</span><span class="p">))</span>
<span class="p">(</span><span class="k">fft</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1</span> <span class="ss">2</span> <span class="p">(</span><span class="nv">3</span> <span class="ss">0</span><span class="p">)</span> <span class="ss">4</span><span class="p">))</span>  <span class="err">→</span> <span class="p">((</span><span class="nv">10</span> <span class="ss">0</span><span class="p">)</span> <span class="p">(</span><span class="k">-</span><span class="ss">2</span> <span class="k">-</span><span class="ss">2</span><span class="p">)</span> <span class="p">(</span><span class="k">-</span><span class="ss">2</span> <span class="ss">0</span><span class="p">)</span> <span class="p">(</span><span class="k">-</span><span class="ss">2</span> <span class="ss">2</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p>The inverse operation of <span class="monospaced">fft</span> is the <a href="#ifft">ifft</a> function.</p></div>
<div class="paragraph"><p><a id="file-info"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_file_info_span"><span class="big red">file-info</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (file-info <em>str-name</em> [<em>int-index</em> [<em>bool-flag</em>]])</p></div>
<div class="paragraph"><p>Returns a list of information about the file or directory in <em>str_name</em>.
The optional index specifies the list member to return. When no
<em>bool-flag</em> is specified or when <em>bool-flag</em> evaluates to <span class="monospaced">nil</span>
information about the link is returned if the file is a link to an
original file. If <em>bool-flag</em> evaluates to anything else than <span class="monospaced">nil</span>,
information about the original file referenced by the link is returned.</p></div>
<table class="tableblock frame-all grid-all"
style="
width:25%;
">
<col style="width:20%;">
<col style="width:80%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" >offset </th>
<th class="tableblock halign-left valign-top" >contents</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">size</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">mode (differs with <span class="monospaced">true</span> flag)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">device mode</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">user ID</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">group ID</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">access time</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">modification time</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">status change time</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>Depending on <em>bool-flag</em> set, the function reports on either the link
(no flag or <span class="monospaced">nil</span> flag) or on the original linked file (<span class="monospaced">true</span> flag).</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">file-info</span> <span class="s">&quot;.bashrc&quot;</span><span class="p">)</span>
<span class="err">→</span> <span class="p">(</span><span class="nv">124</span> <span class="ss">33188</span> <span class="ss">0</span> <span class="ss">500</span> <span class="ss">0</span> <span class="ss">920951022</span> <span class="ss">920951022</span> <span class="ss">920953074</span><span class="p">)</span>

<span class="p">(</span><span class="k">file-info</span> <span class="s">&quot;.bashrc&quot;</span> <span class="ss">0</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">124</span>

<span class="p">(</span><span class="k">date</span> <span class="p">(</span><span class="k">file-info</span> <span class="s">&quot;/etc&quot;</span> <span class="k">-</span><span class="ss">1</span><span class="p">))</span>  <span class="err">→</span> <span class="s">&quot;Mon Mar 8 18:23:17 2005&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>In the second example, the last status change date for the directory
<em>/etc</em> is retrieved.</p></div>
<div class="paragraph"><p><span class="monospaced">file-info</span> gives file statistics (size) for a linked file, not the
link, except for the <em>mode</em> field.</p></div>
<div class="paragraph"><p><a id="file?"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_file_span"><span class="big red">file?</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (file? <em>str-path-name</em> [<em>bool</em>])</p></div>
<div class="paragraph"><p>Checks for the existence of a file in <em>str-name</em>. Returns <span class="monospaced">true</span> if the
file exists; otherwise, it returns <span class="monospaced">nil</span>. This function will also return
<span class="monospaced">true</span> for directories. If the optional <em>bool</em> value is <span class="monospaced">true</span>,
<em>str-path-name</em> is returned. The existence of a file does not imply
anything about its read or write permissions. A file may exist while not
having the permissions to read from or write to it by the current user.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">file?</span> <span class="s">&quot;afile&quot;</span><span class="p">)</span> <span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">fileNo</span> <span class="p">(</span><span class="k">open</span> <span class="s">&quot;afile&quot;</span> <span class="s">&quot;read&quot;</span><span class="p">)))</span>

<span class="p">(</span><span class="nv">file?</span> <span class="s">&quot;/usr/bin/newlisp&quot;</span> <span class="k">true</span><span class="p">)</span> <span class="err">→</span> <span class="s">&quot;/usr/bin/newlisp&quot;</span>
<span class="p">(</span><span class="nv">file?</span> <span class="s">&quot;/usr/bin/foo&quot;</span> <span class="k">true</span><span class="p">)</span>     <span class="err">→</span> <span class="k">nil</span>
</pre></div></div></div>
<div class="paragraph"><p><a id="filter"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_filter_span"><span class="big red">filter</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (filter <em>exp-predicate</em> <em>exp-list</em>)</p></div>
<div class="paragraph"><p>The predicate <em>exp-predicate</em> is applied to each element of the list
<em>exp-list</em>. A list is returned containing the elements for which
<em>exp-predicate</em> is true. <span class="monospaced">filter</span> works like <a href="#clean">clean</a>, but
with a negated predicate.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">filter</span> <span class="ss">symbol?</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">d</span> <span class="ss">4</span> <span class="ss">f</span> <span class="ss">g</span> <span class="ss">5</span> <span class="ss">h</span><span class="p">))</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">d</span> <span class="ss">f</span> <span class="ss">g</span> <span class="ss">h</span><span class="p">)</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">big?</span> <span class="ss">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">&gt;</span> <span class="ss">x</span> <span class="ss">5</span><span class="p">))</span>  <span class="err">→</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">&gt;</span> <span class="ss">x</span> <span class="ss">5</span><span class="p">))</span>

<span class="p">(</span><span class="k">filter</span> <span class="ss">big?</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1</span> <span class="ss">10</span> <span class="ss">3</span> <span class="ss">6</span> <span class="ss">4</span> <span class="ss">5</span> <span class="ss">11</span><span class="p">))</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">10</span> <span class="ss">6</span> <span class="ss">11</span><span class="p">)</span>

<span class="c1">; filter with comparison functor</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">L</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">a</span> <span class="ss">10</span> <span class="ss">2</span> <span class="ss">7</span><span class="p">)</span> <span class="p">(</span><span class="nv">b</span> <span class="ss">5</span><span class="p">)</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">8</span> <span class="ss">3</span><span class="p">)</span> <span class="p">(</span><span class="nv">c</span> <span class="ss">8</span><span class="p">)</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">9</span><span class="p">)))</span>

<span class="p">(</span><span class="k">filter</span> <span class="p">(</span><span class="k">curry</span> <span class="k">match</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">*</span><span class="p">))</span> <span class="ss">L</span><span class="p">)</span>   <span class="err">→</span> <span class="p">((</span><span class="nv">a</span> <span class="ss">10</span> <span class="ss">2</span> <span class="ss">7</span><span class="p">)</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">8</span> <span class="ss">3</span><span class="p">)</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">9</span><span class="p">))</span>

<span class="p">(</span><span class="k">filter</span> <span class="p">(</span><span class="k">curry</span> <span class="k">match</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">?</span> <span class="ss">?</span><span class="p">))</span> <span class="ss">L</span><span class="p">)</span>   <span class="err">→</span> <span class="p">((</span><span class="nv">b</span> <span class="ss">5</span><span class="p">)</span> <span class="p">(</span><span class="nv">c</span> <span class="ss">8</span><span class="p">)</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">9</span><span class="p">))</span>

<span class="p">(</span><span class="k">filter</span> <span class="p">(</span><span class="k">curry</span> <span class="k">match</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">*</span> <span class="ss">8</span> <span class="ss">*</span><span class="p">))</span> <span class="ss">L</span><span class="p">)</span> <span class="err">→</span> <span class="p">((</span><span class="nv">a</span> <span class="ss">8</span> <span class="ss">3</span><span class="p">)</span> <span class="p">(</span><span class="nv">c</span> <span class="ss">8</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p>The predicate may be a built-in predicate, a user-defined function, or a
lambda expression.</p></div>
<div class="paragraph"><p>For filtering a list of elements with the elements from another list,
use the <a href="#difference">difference</a> function or
<a href="#intersect">intersect</a> (with the <em>list</em> option).</p></div>
<div class="paragraph"><p>See also the related function <a href="#index">index</a>, which returns the
indices of the filtered elements and <a href="#clean">clean</a>, which returns
all elements of a list for which a predicate is false.</p></div>
<div class="paragraph"><p><a id="find"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_find_span"><span class="big red">find</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (find <em>exp-key</em> <em>list</em> [<em>func-compare</em> | <em>int-regex-option</em>])<br>
<strong>syntax:</strong> (find <em>str-key</em> <em>str-data</em> [<em>int-regex-option</em> [<em>int-offset</em>]])</p></div>
</div>
<div class="sect3">
<h4 id="_find_an_expression_in_a_list">Find an expression in a list</h4>
<div class="paragraph"><p>If the second argument evaluates to a <em>list</em>, then <span class="monospaced">find</span> returns the
index position (offset) of the element derived from evaluating
<em>exp-key</em>.</p></div>
<div class="paragraph"><p>Optionally, an operator or user-defined function can be specified in
<em>func-compare</em>. If the <em>exp-key</em> is a string, a regular expression
option can be specified with the <em>int-regex-option</em> parameter.</p></div>
<div class="paragraph"><p>When using regular expressions or comparison functors the system
variable <span class="monospaced">$0</span> is set to the last element found.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">; find an expression in a list</span>
<span class="p">(</span><span class="k">find</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1</span> <span class="ss">2</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">1</span> <span class="ss">4</span><span class="p">)</span> <span class="ss">5</span> <span class="ss">6</span> <span class="p">(</span><span class="nv">1</span> <span class="ss">2</span><span class="p">)</span> <span class="p">(</span><span class="nv">8</span> <span class="ss">9</span><span class="p">)))</span>  <span class="err">→</span> <span class="ss">3</span>

<span class="p">(</span><span class="k">find</span> <span class="s">&quot;world&quot;</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;hello&quot;</span> <span class="s">&quot;world&quot;</span><span class="p">))</span>       <span class="err">→</span> <span class="ss">1</span>
<span class="p">(</span><span class="k">find</span> <span class="s">&quot;hi&quot;</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;hello&quot;</span> <span class="s">&quot;world&quot;</span><span class="p">))</span>          <span class="err">→</span> <span class="k">nil</span>

<span class="p">(</span><span class="k">find</span> <span class="s">&quot;newlisp&quot;</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;Perl&quot;</span> <span class="s">&quot;Python&quot;</span> <span class="s">&quot;newLISP&quot;</span><span class="p">)</span> <span class="ss">1</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">2</span>

<span class="c1">; use the comparison functor</span>
<span class="p">(</span><span class="k">find</span> <span class="ss">3</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">8</span> <span class="ss">4</span> <span class="ss">3</span>  <span class="ss">7</span> <span class="ss">2</span> <span class="ss">6</span><span class="p">)</span> <span class="ss">&gt;</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">4</span>
<span class="k">$</span><span class="ss">0</span> <span class="err">→</span> <span class="ss">2</span>

<span class="p">(</span><span class="k">find</span> <span class="s">&quot;newlisp&quot;</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;Perl&quot;</span> <span class="s">&quot;Python&quot;</span> <span class="s">&quot;newLISP&quot;</span><span class="p">)</span>
                 <span class="p">(</span><span class="k">fn</span> <span class="p">(</span><span class="nv">x</span> <span class="ss">y</span><span class="p">)</span> <span class="p">(</span><span class="k">regex</span> <span class="ss">x</span> <span class="ss">y</span> <span class="ss">1</span><span class="p">)))</span> <span class="err">→</span> <span class="ss">2</span>
<span class="k">$</span><span class="ss">0</span> <span class="err">→</span> <span class="s">&quot;newLISP&quot;</span>

<span class="p">(</span><span class="k">find</span> <span class="ss">5</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">l</span> <span class="ss">3</span><span class="p">)</span> <span class="p">(</span><span class="nv">k</span> <span class="ss">5</span><span class="p">)</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">10</span><span class="p">)</span> <span class="p">(</span><span class="nv">z</span> <span class="ss">22</span><span class="p">))</span>
         <span class="p">(</span><span class="k">fn</span> <span class="p">(</span><span class="nv">x</span> <span class="ss">y</span><span class="p">)</span> <span class="p">(</span><span class="nv">=</span> <span class="ss">x</span> <span class="p">(</span><span class="k">last</span> <span class="ss">y</span><span class="p">))))</span>  <span class="err">→</span> <span class="ss">1</span>
<span class="k">$</span><span class="ss">0</span> <span class="err">→</span> <span class="p">(</span><span class="nv">k</span> <span class="ss">5</span><span class="p">)</span>

<span class="p">(</span><span class="k">find</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">?</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">l</span> <span class="ss">3</span><span class="p">)</span> <span class="p">(</span><span class="nv">k</span> <span class="ss">5</span><span class="p">)</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">10</span><span class="p">)</span> <span class="p">(</span><span class="nv">z</span> <span class="ss">22</span><span class="p">))</span> <span class="k">match</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">2</span>
<span class="k">$</span><span class="ss">0</span> <span class="err">→</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">10</span><span class="p">)</span>

<span class="p">(</span><span class="k">find</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">X</span> <span class="ss">X</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">a</span> <span class="ss">b</span><span class="p">)</span> <span class="p">(</span><span class="nv">c</span> <span class="ss">d</span><span class="p">)</span> <span class="p">(</span><span class="nv">e</span> <span class="ss">e</span><span class="p">)</span> <span class="p">(</span><span class="nv">f</span> <span class="ss">g</span><span class="p">))</span> <span class="k">unify</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">2</span>
<span class="k">$</span><span class="ss">0</span> <span class="err">→</span> <span class="p">(</span><span class="nv">e</span> <span class="ss">e</span><span class="p">)</span>

<span class="c1">; define the comparison functor first for better readability</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">has-it-as-last</span> <span class="ss">x</span> <span class="ss">y</span><span class="p">)</span> <span class="p">(</span><span class="nv">=</span> <span class="ss">x</span> <span class="p">(</span><span class="k">last</span> <span class="ss">y</span><span class="p">)))</span>

<span class="p">(</span><span class="k">find</span> <span class="ss">22</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">l</span> <span class="ss">3</span><span class="p">)</span> <span class="p">(</span><span class="nv">k</span> <span class="ss">5</span><span class="p">)</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">10</span><span class="p">)</span> <span class="p">(</span><span class="nv">z</span> <span class="ss">22</span><span class="p">))</span> <span class="ss">has-it-as-last</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">3</span>
<span class="k">$</span><span class="ss">0</span> <span class="err">→</span> <span class="p">(</span><span class="nv">z</span> <span class="ss">22</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Using <a href="#match">match</a> and <a href="#unify">unify</a>, list searches can be
formulated which are as powerful as regular expression searches are for
strings.</p></div>
</div>
<div class="sect3">
<h4 id="_find_a_string_in_a_string">Find a string in a string</h4>
<div class="paragraph"><p>If the second argument, <em>str-data</em>, evaluates to a string, then the
offset position of the string <em>str-key</em> (found in the first argument,
<em>str-data</em>) is returned. In this case, <span class="monospaced">find</span> also works on binary
<em>str-data</em>. The offset position returned is always based on counting
single byte characters even when running the UTF-8 enabled version of
newLISP.</p></div>
<div class="paragraph"><p>The presence of a third parameter specifies a search using the regular
expression pattern specified in <em>str-pattern</em>, as well as an option
number specified in <em>int-regex-option</em> (i.e., 1 (one) for
case-insensitive search or <span class="monospaced">0</span> (zero) for no special options). If
<em>int-regex-option</em> is specified an optional <em>int-offset</em> argument can be
specified too to start the search not at the beginning but at the offset
given. In any case the position returned by <span class="monospaced">find</span> is calculated
relative to the beginning of the string.</p></div>
<div class="paragraph"><p>To specify <em>int-offset</em> in a simple string search without regular
expressions, specify <span class="monospaced">nil</span> for <em>int-regex-option</em>.</p></div>
<div class="paragraph"><p>In newLISP, regular expressions are standard Perl Compatible Regular
Expression (PCRE) searches. Found expressions or subexpressions are
returned in the system variables <span class="monospaced">$0</span>, <span class="monospaced">$1</span>, <span class="monospaced">$2</span>, etc., which can be
used like any other symbol. As an alternative, the contents of these
variables can also be accessed by using <span class="monospaced">($ 0)</span>, <span class="monospaced">($ 1)</span>, <span class="monospaced">($ 2)</span>, etc.
This method allows indexed access (i.e., <span class="monospaced">($ i)</span>, where <span class="monospaced">i</span> is an
integer).</p></div>
<div class="paragraph"><p>See <a href="#regex">regex</a> for the meaning of the option numbers and more
information on regular expression searching.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">; simple string search</span>
<span class="p">(</span><span class="k">find</span> <span class="s">&quot;world&quot;</span> <span class="s">&quot;Hello world&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">6</span>
<span class="p">(</span><span class="k">find</span> <span class="s">&quot;WORLD&quot;</span> <span class="s">&quot;Hello woRLd&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="k">nil</span>

<span class="c1">; case-insensitive regex</span>

<span class="p">(</span><span class="k">find</span> <span class="s">&quot;WorlD&quot;</span> <span class="s">&quot;Hello woRLd&quot;</span> <span class="ss">1</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">6</span>

<span class="p">(</span><span class="k">find</span> <span class="s">&quot;hi&quot;</span> <span class="s">&quot;hello world&quot;</span><span class="p">)</span>       <span class="err">→</span> <span class="k">nil</span>
<span class="p">(</span><span class="k">find</span> <span class="s">&quot;Hello&quot;</span> <span class="s">&quot;Hello world&quot;</span><span class="p">)</span>    <span class="err">→</span> <span class="ss">0</span>

<span class="c1">; regex with default options</span>

<span class="p">(</span><span class="k">find</span> <span class="s">&quot;cat|dog&quot;</span> <span class="s">&quot;I have a cat&quot;</span> <span class="ss">0</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">9</span>
<span class="k">$</span><span class="ss">0</span>                                 <span class="err">→</span> <span class="s">&quot;cat&quot;</span>
<span class="p">(</span><span class="k">find</span> <span class="s">&quot;cat|dog&quot;</span> <span class="s">&quot;my dog&quot;</span> <span class="ss">0</span><span class="p">)</span>        <span class="err">→</span> <span class="ss">3</span>
<span class="k">$</span><span class="ss">0</span>                                 <span class="err">→</span> <span class="s">&quot;dog&quot;</span>
<span class="p">(</span><span class="k">find</span> <span class="s">&quot;cat|dog&quot;</span> <span class="s">&quot;MY DOG&quot;</span> <span class="ss">1</span><span class="p">)</span>        <span class="err">→</span> <span class="ss">3</span>
<span class="k">$</span><span class="ss">0</span>                                 <span class="err">→</span> <span class="s">&quot;DOG&quot;</span>

<span class="c1">; use an optional offset</span>
<span class="p">(</span><span class="k">find</span> <span class="s">&quot;cat|dog&quot;</span> <span class="s">&quot;I have a cat and a dog&quot;</span> <span class="ss">0</span><span class="p">)</span>    <span class="err">→</span> <span class="ss">9</span>
<span class="p">(</span><span class="k">find</span> <span class="s">&quot;cat|dog&quot;</span> <span class="s">&quot;I have a cat and a dog&quot;</span> <span class="ss">0</span> <span class="ss">12</span><span class="p">)</span> <span class="err">→</span> <span class="ss">19</span>

<span class="c1">;; find with subexpressions in regular expression</span>
<span class="c1">;; and access with system variables</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">str</span>  <span class="s">&quot;http://nuevatec.com:80&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">find</span> <span class="s">&quot;http://(.*):(.*)&quot;</span> <span class="ss">str</span> <span class="ss">0</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">0</span>

<span class="k">$</span><span class="ss">0</span>  <span class="err">→</span> <span class="s">&quot;http://nuevatec.com:80&quot;</span>
<span class="k">$</span><span class="ss">1</span>  <span class="err">→</span> <span class="s">&quot;nuevatec.com&quot;</span>
<span class="k">$</span><span class="ss">2</span>  <span class="err">→</span> <span class="s">&quot;80&quot;</span>

<span class="c1">;; system variables as an indexed expression (since 8.0.5)</span>
<span class="p">(</span><span class="nv">$</span> <span class="ss">0</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;http://nuevatec.com:80&quot;</span>
<span class="p">(</span><span class="nv">$</span> <span class="ss">1</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;nuevatec.com&quot;</span>
<span class="p">(</span><span class="nv">$</span> <span class="ss">2</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;80&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>For other functions using regular expressions, see
<a href="#directory">directory</a>, <a href="#find-all">find-all</a>,
<a href="#parse">parse</a>, <a href="#regex">regex</a>, <a href="#replace">replace</a>, and
<a href="#search">search</a>.</p></div>
<div class="paragraph"><p>To find expressions in nested or multidimensional lists, use the
<a href="#ref">ref</a> and <a href="#ref-all">ref-all</a> functions.</p></div>
<div class="paragraph"><p><a id="find-all"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_find_all_span"><span class="big red">find-all</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (find-all <em>str-regex-pattern</em> <em>str-text</em> [<em>exp</em> [<em>int-regex-option</em>]])<br>
<strong>syntax:</strong> (find-all <em>list-match-pattern</em> <em>list-lists</em> [<em>exp</em>])<br>
<strong>syntax:</strong> (find-all <em>exp-key</em> <em>list</em> <em>exp</em> <em>func-compare</em>)</p></div>
<div class="paragraph"><p>In the first syntax, <span class="monospaced">find-all</span> finds all occurrences of
<em>str-regex-pattern</em> in the text <em>str-text</em>, returning a list containing
all matching strings. The empty list <span class="monospaced">()</span> is returned if no matches are
found.</p></div>
<div class="paragraph"><p>Optionally, an expression can be specified to process the found string
or regular subexpressions before placing them into the returned list. An
additional option, <em>int-option</em>, specifies special regular expression
options (see <a href="#regex">regex</a> for further details).</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">find-all</span> <span class="s">{\d+}</span> <span class="s">&quot;lkjhkljh34ghfdhgfd678gfdhfgd9&quot;</span><span class="p">)</span>
<span class="err">→</span> <span class="p">(</span><span class="s">&quot;34&quot;</span> <span class="s">&quot;678&quot;</span> <span class="s">&quot;9&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">find-all</span> <span class="s">{(new)(lisp)}</span> <span class="s">&quot;newLISPisNEWLISP&quot;</span> <span class="p">(</span><span class="k">append</span> <span class="k">$</span><span class="ss">2</span> <span class="k">$</span><span class="ss">1</span><span class="p">)</span> <span class="ss">1</span><span class="p">)</span>
<span class="err">→</span> <span class="p">(</span><span class="s">&quot;LISPnew&quot;</span> <span class="s">&quot;LISPNEW&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">unique</span> <span class="p">(</span><span class="k">sort</span>
    <span class="p">(</span><span class="k">find-all</span> <span class="s">{[a-zA-Z]+}</span>
        <span class="p">(</span><span class="k">replace</span> <span class="s">&quot;&lt;[^&gt;]+&gt;&quot;</span> <span class="p">(</span><span class="k">get-url</span> <span class="s">&quot;http://newlisp.org&quot;</span><span class="p">)</span> <span class="s">&quot;&quot;</span> <span class="ss">0</span><span class="p">)</span> <span class="p">)</span>
<span class="p">))</span>
<span class="err">→</span> <span class="p">(</span><span class="s">&quot;A&quot;</span> <span class="s">&quot;ACC&quot;</span> <span class="s">&quot;AI&quot;</span> <span class="s">&quot;API&quot;</span> <span class="s">&quot;About&quot;</span> <span class="s">&quot;All&quot;</span> <span class="s">&quot;Amazing&quot;</span> <span class="s">&quot;Apps&quot;</span>
<span class="ss">...</span>
<span class="s">&quot;where&quot;</span> <span class="s">&quot;whole&quot;</span> <span class="s">&quot;width&quot;</span> <span class="s">&quot;wiki&quot;</span> <span class="s">&quot;will&quot;</span> <span class="s">&quot;with&quot;</span> <span class="s">&quot;work&quot;</span> <span class="s">&quot;written&quot;</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The first example discovers all numbers in a text. The second example
shows how an optional expression in <em>exp</em> can work on subexpressions
found by the regular expression pattern in <em>str-pattern</em>. The last
example retrieves a web page, cleans out all HTML tags, and then
collects all words into a unique and sorted list.</p></div>
<div class="paragraph"><p>Note that <span class="monospaced">find-all</span> with strings always performs a regular expression
search, even if the option in <em>int-option</em> is omitted.</p></div>
<div class="paragraph"><p>In the second syntax, <span class="monospaced">find-all</span> searches for all list
<a href="#match">match</a> patterns <em>list-match-pattern</em> in <em>list-lists</em>. As in
<span class="monospaced">find-all</span> for strings, an expression can be specified in <em>exp</em> to
process further the matched sublist:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">find-all</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">?</span> <span class="ss">2</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">a</span> <span class="ss">1</span><span class="p">)</span> <span class="p">(</span><span class="nv">b</span> <span class="ss">2</span><span class="p">)</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">2</span><span class="p">)</span> <span class="p">(</span><span class="nv">c</span> <span class="ss">4</span><span class="p">)))</span> <span class="err">→</span> <span class="p">((</span><span class="nv">b</span> <span class="ss">2</span><span class="p">)</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">2</span><span class="p">))</span>

<span class="p">(</span><span class="k">find-all</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">?</span> <span class="ss">2</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">a</span> <span class="ss">1</span><span class="p">)</span> <span class="p">(</span><span class="nv">b</span> <span class="ss">2</span><span class="p">)</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">2</span><span class="p">)</span> <span class="p">(</span><span class="nv">c</span> <span class="ss">4</span><span class="p">))</span> <span class="p">(</span><span class="k">first</span> <span class="k">$</span><span class="ss">it</span><span class="p">))</span> <span class="err">→</span> <span class="p">(</span><span class="nv">b</span> <span class="ss">a</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p><span class="monospaced">find-all</span> for list matches always uses <a href="#match">match</a> to compare
when searching for sublists and always needs a list for the pattern
expression.</p></div>
<div class="paragraph"><p>In the third syntax, <span class="monospaced">find-all</span> can specify a built-in or user-defined
function used for comparing list elements with the key expression in
<em>exp-key</em>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">find-all</span> <span class="ss">5</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">2</span> <span class="ss">7</span> <span class="ss">4</span> <span class="ss">5</span> <span class="ss">9</span> <span class="ss">2</span> <span class="ss">4</span> <span class="ss">9</span> <span class="ss">7</span> <span class="ss">4</span> <span class="ss">8</span><span class="p">)</span> <span class="k">$</span><span class="ss">it</span> <span class="ss">&lt;</span><span class="p">)</span> <span class="err">→</span> <span class="p">(</span><span class="nv">7</span> <span class="ss">9</span> <span class="ss">9</span> <span class="ss">7</span> <span class="ss">8</span><span class="p">)</span>

<span class="c1">; process the found element available in $it</span>

<span class="p">(</span><span class="k">find-all</span> <span class="ss">5</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">2</span> <span class="ss">7</span> <span class="ss">4</span> <span class="ss">5</span> <span class="ss">9</span> <span class="ss">2</span> <span class="ss">4</span> <span class="ss">9</span> <span class="ss">7</span> <span class="ss">4</span> <span class="ss">8</span><span class="p">)</span> <span class="p">(</span><span class="nv">*</span> <span class="ss">3</span> <span class="k">$</span><span class="ss">it</span><span class="p">)</span> <span class="ss">&lt;</span><span class="p">)</span> <span class="err">→</span> <span class="p">(</span><span class="nv">21</span> <span class="ss">27</span> <span class="ss">27</span> <span class="ss">21</span> <span class="ss">24</span><span class="p">)</span>
<span class="c1">; same as</span>
<span class="p">(</span><span class="k">find-all</span> <span class="ss">5</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">2</span> <span class="ss">7</span> <span class="ss">4</span> <span class="ss">5</span> <span class="ss">9</span> <span class="ss">2</span> <span class="ss">4</span> <span class="ss">9</span> <span class="ss">7</span> <span class="ss">4</span> <span class="ss">8</span><span class="p">)</span> <span class="p">(</span><span class="nv">*</span> <span class="ss">3</span> <span class="k">$</span><span class="ss">it</span><span class="p">)</span> <span class="p">(</span><span class="k">fn</span> <span class="p">(</span><span class="nv">x</span> <span class="ss">y</span><span class="p">)</span> <span class="p">(</span><span class="nv">&lt;</span> <span class="ss">x</span> <span class="ss">y</span><span class="p">)))</span> <span class="err">→</span> <span class="p">(</span><span class="nv">21</span> <span class="ss">27</span> <span class="ss">27</span> <span class="ss">21</span> <span class="ss">24</span><span class="p">)</span>

<span class="p">(</span><span class="k">find-all</span> <span class="ss">5</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">2</span> <span class="ss">7</span> <span class="ss">4</span> <span class="ss">5</span> <span class="ss">9</span> <span class="ss">2</span> <span class="ss">4</span> <span class="ss">9</span> <span class="ss">7</span> <span class="ss">4</span> <span class="ss">8</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;abcdefghijk&quot;</span> <span class="k">$</span><span class="ss">it</span><span class="p">)</span> <span class="ss">&lt;</span><span class="p">)</span> <span class="err">→</span> <span class="p">(</span><span class="s">&quot;h&quot;</span> <span class="s">&quot;j&quot;</span> <span class="s">&quot;j&quot;</span> <span class="s">&quot;h&quot;</span> <span class="s">&quot;i&quot;</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Any type of expression can be searched for or can be contained in the
list. <span class="monospaced">find-all</span> in this syntax works similar to <a href="#filter">filter</a>
but with the added benefit of being able to define a processing
expression for the found element.</p></div>
<div class="paragraph"><p><a id="first"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_first_a_href_utf8_capable_utf8_a_span"><span class="big red">first <a href="#utf8_capable">utf8</a></span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (first <em>list</em>)<br>
<strong>syntax:</strong> (first <em>array</em>)<br>
<strong>syntax:</strong> (first <em>str</em>)</p></div>
<div class="paragraph"><p>Returns the first element of a list or the first character of a string.
The operand is not changed. This function is equivalent to <em>car</em> or
<em>head</em> in other Lisp dialects.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">first</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">4</span> <span class="ss">5</span><span class="p">))</span>       <span class="err">→</span> <span class="ss">1</span>
<span class="p">(</span><span class="k">first</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">a</span> <span class="ss">b</span><span class="p">)</span> <span class="ss">c</span> <span class="ss">d</span><span class="p">))</span>       <span class="err">→</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">b</span><span class="p">)</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">aList</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span> <span class="ss">d</span> <span class="ss">e</span><span class="p">))</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span> <span class="ss">d</span> <span class="ss">e</span><span class="p">)</span>
<span class="p">(</span><span class="k">first</span> <span class="ss">aList</span><span class="p">)</span>              <span class="err">→</span> <span class="ss">a</span>
<span class="ss">aList</span>                      <span class="err">→</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span> <span class="ss">d</span> <span class="ss">e</span><span class="p">)</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">A</span> <span class="p">(</span><span class="k">array</span> <span class="ss">3</span> <span class="ss">2</span> <span class="p">(</span><span class="k">sequence</span> <span class="ss">1</span> <span class="ss">6</span><span class="p">)))</span>
<span class="err">→</span>  <span class="p">((</span><span class="nv">1</span> <span class="ss">2</span><span class="p">)</span> <span class="p">(</span><span class="nv">3</span> <span class="ss">4</span><span class="p">)</span> <span class="p">(</span><span class="nv">5</span> <span class="ss">6</span><span class="p">))</span>
<span class="p">(</span><span class="k">first</span> <span class="ss">A</span><span class="p">)</span>                  <span class="err">→</span> <span class="p">(</span><span class="nv">1</span> <span class="ss">2</span><span class="p">)</span>

<span class="p">(</span><span class="k">first</span> <span class="o">&#39;</span><span class="p">())</span>                <span class="err">→</span> <span class="ss">ERR</span><span class="o">:</span> <span class="k">list</span> <span class="ss">is</span> <span class="ss">empty</span>
</pre></div></div></div>
<div class="paragraph"><p>In the third syntax, the first character is returned from the string in
<em>str</em> as a string.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">first</span> <span class="s">&quot;newLISP&quot;</span><span class="p">)</span>         <span class="err">→</span> <span class="s">&quot;n&quot;</span>
<span class="p">(</span><span class="k">first</span> <span class="p">(</span><span class="k">rest</span> <span class="s">&quot;newLISP&quot;</span><span class="p">))</span>  <span class="err">→</span> <span class="s">&quot;e&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>Note that <a href="#first">first</a> works on character boundaries rather than
byte boundaries when the UTF-8–enabled version of newLISP is used. See
also the functions <a href="#last">last</a> and <a href="#rest">rest</a>.</p></div>
<div class="paragraph"><p><a id="flat"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_flat_span"><span class="big red">flat</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (flat <em>list</em>)</p></div>
<div class="paragraph"><p>Returns a flattened list from a list:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">lst</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="p">(</span><span class="nv">b</span> <span class="p">(</span><span class="nv">c</span> <span class="ss">d</span><span class="p">))))</span>
<span class="p">(</span><span class="k">flat</span> <span class="ss">lst</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span> <span class="ss">d</span><span class="p">)</span>

<span class="p">(</span><span class="k">map</span> <span class="p">(</span><span class="k">fn</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="k">ref</span> <span class="ss">x</span> <span class="ss">lst</span><span class="p">))</span> <span class="p">(</span><span class="k">flat</span> <span class="ss">lst</span><span class="p">))</span>
<span class="err">→</span> <span class="p">((</span><span class="nv">0</span><span class="p">)</span> <span class="p">(</span><span class="nv">1</span> <span class="ss">0</span><span class="p">)</span> <span class="p">(</span><span class="nv">1</span> <span class="ss">1</span> <span class="ss">0</span><span class="p">)</span> <span class="p">(</span><span class="nv">1</span> <span class="ss">1</span> <span class="ss">1</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p><span class="monospaced">flat</span> can be used to iterate through nested lists.</p></div>
<div class="paragraph"><p><a id="float"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_float_span"><span class="big red">float</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (float <em>exp</em> [<em>exp-default</em>])</p></div>
<div class="paragraph"><p>If the expression in <em>exp</em> evaluates to a number or a string, the
argument is converted to a float and returned. If <em>exp</em> cannot be
converted to a float then <span class="monospaced">nil</span> or, if specified, the evaluation of
<em>exp-default</em> will be returned. This function is mostly used to convert
strings from user input or when reading and parsing text. The string
must start with a digit or the <span class="monospaced">+</span> (plus sign), <span class="monospaced">-</span> (minus sign), or <span class="monospaced">.</span>
(period). If <em>exp</em> is invalid, <span class="monospaced">float</span> returns <span class="monospaced">nil</span> as a default value.</p></div>
<div class="paragraph"><p>Floats with exponents larger than 1e308 or smaller than -1e308 are
converted to +INF or -INF, respectively. The display of +INF and -INF
differs on different platforms and compilers.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">float</span> <span class="s">&quot;1.23&quot;</span><span class="p">)</span>       <span class="err">→</span> <span class="ss">1.23</span>
<span class="p">(</span><span class="k">float</span> <span class="s">&quot; 1.23&quot;</span><span class="p">)</span>      <span class="err">→</span> <span class="ss">1.23</span>
<span class="p">(</span><span class="k">float</span> <span class="s">&quot;.5&quot;</span><span class="p">)</span>         <span class="err">→</span> <span class="ss">0.50</span>
<span class="p">(</span><span class="k">float</span> <span class="s">&quot;-1.23&quot;</span><span class="p">)</span>      <span class="err">→</span> <span class="k">-</span><span class="ss">1.23</span>
<span class="p">(</span><span class="k">float</span> <span class="s">&quot;-.5&quot;</span><span class="p">)</span>        <span class="err">→</span> <span class="k">nil</span>
<span class="p">(</span><span class="k">float</span> <span class="s">&quot;#1.23&quot;</span><span class="p">)</span>      <span class="err">→</span> <span class="k">nil</span>
<span class="p">(</span><span class="k">float</span> <span class="s">&quot;#1.23&quot;</span> <span class="ss">0.0</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">0</span>

<span class="p">(</span><span class="k">float</span><span class="ss">?</span> <span class="ss">123</span><span class="p">)</span>          <span class="err">→</span> <span class="k">nil</span>
<span class="p">(</span><span class="k">float</span><span class="ss">?</span> <span class="p">(</span><span class="k">float</span> <span class="ss">123</span><span class="p">))</span>  <span class="err">→</span> <span class="k">true</span>

<span class="p">(</span><span class="k">float</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span><span class="p">))</span>    <span class="err">→</span> <span class="k">nil</span>
<span class="p">(</span><span class="k">float</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span><span class="p">)</span> <span class="ss">0</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">0</span>
<span class="p">(</span><span class="k">float</span> <span class="k">nil</span> <span class="ss">0</span><span class="p">)</span>       <span class="err">→</span> <span class="ss">0</span>

<span class="p">(</span><span class="k">float</span> <span class="s">&quot;abc&quot;</span> <span class="s">&quot;not a number&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;not a number&quot;</span>
<span class="p">(</span><span class="k">float</span> <span class="s">&quot;1e500&quot;</span><span class="p">)</span>               <span class="err">→</span> <span class="ss">inf</span>
<span class="p">(</span><span class="k">float</span> <span class="s">&quot;-1e500&quot;</span><span class="p">)</span>              <span class="err">→</span> <span class="k">-</span><span class="ss">inf</span>

<span class="p">(</span><span class="k">print</span> <span class="s">&quot;Enter a float num:&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">f-num</span> <span class="p">(</span><span class="k">float</span> <span class="p">(</span><span class="k">read-</span><span class="ss">line</span><span class="p">)))</span>
</pre></div></div></div>
<div class="paragraph"><p>Use the <a href="#int">int</a> function to parse integer numbers.</p></div>
<div class="paragraph"><p><a id="float?"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_float_span_2"><span class="big red">float?</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (float? <em>exp</em>)</p></div>
<div class="paragraph"><p><span class="monospaced">true</span> is returned only if <em>exp</em> evaluates to a floating point number;
otherwise, <span class="monospaced">nil</span> is returned.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">num</span> <span class="ss">1.23</span><span class="p">)</span>
<span class="p">(</span><span class="k">float</span><span class="ss">?</span> <span class="ss">num</span><span class="p">)</span>  <span class="err">→</span> <span class="k">true</span>
</pre></div></div></div>
<div class="paragraph"><p><a id="floor"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_floor_span"><span class="big red">floor</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (floor <em>number</em>)</p></div>
<div class="paragraph"><p>Returns the next lowest integer below <em>number</em> as a floating point.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">floor</span> <span class="k">-</span><span class="ss">1.5</span><span class="p">)</span>  <span class="err">→</span> <span class="k">-</span><span class="ss">2</span>
<span class="p">(</span><span class="k">floor</span> <span class="ss">3.4</span><span class="p">)</span>   <span class="err">→</span> <span class="ss">3</span>
</pre></div></div></div>
<div class="paragraph"><p>See also the <a href="#ceil">ceil</a> function.</p></div>
<div class="paragraph"><p><a id="flt"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_flt_span"><span class="big red">flt</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (flt <em>number</em>)</p></div>
<div class="paragraph"><p>Converts <em>number</em> to a 32-bit float represented by an integer. This
function is used when passing 32-bit floats to library routines. newLISP
floating point numbers are 64-bit and are passed as 64-bit floats when
calling imported C library routines.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">flt</span> <span class="ss">1.23</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">1067282596</span>

<span class="c1">;; pass 32-bit float to C-function: foo(float value)</span>
<span class="p">(</span><span class="k">import</span> <span class="s">&quot;mylib.so&quot;</span> <span class="s">&quot;foo&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="nv">foo</span> <span class="p">(</span><span class="k">flt</span> <span class="ss">1.23</span><span class="p">))</span>

<span class="p">(</span><span class="k">get-int</span> <span class="p">(</span><span class="k">pack</span> <span class="s">&quot;f&quot;</span> <span class="ss">1.23</span><span class="p">))</span>  <span class="err">→</span> <span class="ss">1067282596</span>

<span class="p">(</span><span class="k">unpack</span> <span class="s">&quot;f&quot;</span> <span class="p">(</span><span class="k">pack</span> <span class="s">&quot;ld&quot;</span> <span class="p">(</span><span class="k">flt</span> <span class="ss">1.2345</span><span class="p">)))</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">1.234500051</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The last two statements illustrate the inner workings of <span class="monospaced">flt</span>.</p></div>
<div class="paragraph"><p>Use the <a href="#import">import</a> function to import libraries.</p></div>
<div class="paragraph"><p><a id="fn"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_fn_span"><span class="big red">fn</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (fn (<em>list-parameters</em>) <em>exp-body</em>)</p></div>
<div class="paragraph"><p><span class="monospaced">fn</span> is used to define anonymous functions, which are frequently used in
<a href="#map">map</a>, <a href="#sort">sort</a>, and many other functions where
functions can be used as arguments.</p></div>
<div class="paragraph"><p>Using an anonymous function eliminates the need to define a new function
with <a href="#define">define</a>. Instead, a function is defined on the fly:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">map</span> <span class="p">(</span><span class="k">fn</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">x</span> <span class="ss">x</span><span class="p">))</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">4</span> <span class="ss">5</span><span class="p">))</span> <span class="err">→</span> <span class="p">(</span><span class="nv">2</span> <span class="ss">4</span> <span class="ss">6</span> <span class="ss">8</span> <span class="ss">10</span><span class="p">)</span>

<span class="p">(</span><span class="k">sort</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;..&quot;</span> <span class="s">&quot;...&quot;</span> <span class="s">&quot;.&quot;</span> <span class="s">&quot;.....&quot;</span><span class="p">)</span> <span class="p">(</span><span class="k">fn</span> <span class="p">(</span><span class="nv">x</span> <span class="ss">y</span><span class="p">)</span> <span class="p">(</span><span class="nv">&gt;</span> <span class="p">(</span><span class="k">length</span> <span class="ss">x</span><span class="p">)</span> <span class="p">(</span><span class="k">length</span> <span class="ss">y</span><span class="p">))))</span>
<span class="err">→</span> <span class="p">(</span><span class="s">&quot;.....&quot;</span> <span class="s">&quot;...&quot;</span> <span class="s">&quot;..&quot;</span> <span class="s">&quot;.&quot;</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The example defines the function <em>fn(x)</em>, which takes an integer (<em>x</em>)
and doubles it. The function is <em>mapped</em> onto a list of arguments using
<a href="#map">map</a>. The second example shows strings being sorted by length.</p></div>
<div class="paragraph"><p>The <a href="#lambda">lambda</a> function (the longer, traditional form) can be
used in place of <span class="monospaced">fn</span>.</p></div>
<div class="paragraph"><p><a id="for"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_for_span"><span class="big red">for</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (for (<em>sym</em> <em>num-from</em> <em>num-to</em> [<em>num-step</em> [<em>exp-break</em>]]) <em>body</em>)</p></div>
<div class="paragraph"><p>Repeatedly evaluates the expressions in <em>body</em> for a range of values
specified in <em>num-from</em> and <em>num-to</em>, inclusive. A step size may be
specified with <em>num-step</em>. If no step size is specified, <span class="monospaced">1</span> is assumed.</p></div>
<div class="paragraph"><p>Optionally, a condition for early loop exit may be defined in
<em>exp-break</em>. If the break expression evaluates to any non-<span class="monospaced">nil</span> value,
the <span class="monospaced">for</span> loop returns with the value of <em>exp-break</em>. The break
condition is tested before evaluating <em>body</em>. If a break condition is
defined, <em>num-step</em> must be defined, too.</p></div>
<div class="paragraph"><p>The symbol <em>sym</em> is local in dynamic scope to the <span class="monospaced">for</span> expression. It
takes on each value successively in the specified range as an integer
value if no step size is specified, or as a floating point value when a
step size is present. After evaluation of the <span class="monospaced">for</span> statement <em>sym</em>
assumes its previous value.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="ss">&gt;</span> <span class="p">(</span><span class="k">for</span> <span class="p">(</span><span class="nv">x</span> <span class="ss">1</span> <span class="ss">10</span> <span class="ss">2</span><span class="p">)</span> <span class="p">(</span><span class="k">println</span> <span class="ss">x</span><span class="p">))</span>
<span class="ss">1</span>
<span class="ss">3</span>
<span class="ss">5</span>
<span class="ss">7</span>
<span class="ss">9</span>

<span class="ss">&gt;</span> <span class="p">(</span><span class="k">for</span> <span class="p">(</span><span class="nv">x</span> <span class="ss">8</span> <span class="ss">6</span> <span class="ss">0.5</span><span class="p">)</span> <span class="p">(</span><span class="k">println</span> <span class="ss">x</span><span class="p">))</span>
<span class="ss">8</span>
<span class="ss">7.5</span>
<span class="ss">7</span>
<span class="ss">6.5</span>
<span class="ss">6</span>

<span class="ss">&gt;</span> <span class="p">(</span><span class="k">for</span> <span class="p">(</span><span class="nv">x</span> <span class="ss">1</span> <span class="ss">100</span> <span class="ss">2</span> <span class="p">(</span><span class="nv">&gt;</span> <span class="p">(</span><span class="nv">*</span> <span class="ss">x</span> <span class="ss">x</span><span class="p">)</span> <span class="ss">30</span><span class="p">))</span> <span class="p">(</span><span class="k">println</span> <span class="ss">x</span><span class="p">))</span>
<span class="ss">1</span>
<span class="ss">3</span>
<span class="ss">5</span>
<span class="k">true</span>
<span class="ss">&gt;</span> <span class="ss">_</span>
</pre></div></div></div>
<div class="paragraph"><p>The second example uses a range of numbers from highest to lowest. Note
that the step size is always a positive number. In the third example, a
break condition is tested.</p></div>
<div class="paragraph"><p>Use the <a href="#sequence">sequence</a> function to make a sequence of numbers.</p></div>
<div class="paragraph"><p><a id="for-all"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_for_all_span"><span class="big red">for-all</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (for-all <em>func-condition</em> <em>list</em>)</p></div>
<div class="paragraph"><p>Applies the function in <em>func-condition</em> to all elements in <em>list</em>. If
all elements meet the condition in <em>func-condition</em>, the result is
<span class="monospaced">true</span>; otherwise, <span class="monospaced">nil</span> is returned.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">for-all</span> <span class="ss">number?</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">2</span> <span class="ss">3</span> <span class="ss">4</span> <span class="ss">6</span> <span class="ss">7</span><span class="p">))</span>                 <span class="err">→</span> <span class="k">true</span>

<span class="p">(</span><span class="k">for-all</span> <span class="ss">number?</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">2</span> <span class="ss">3</span> <span class="ss">4</span> <span class="ss">6</span> <span class="s">&quot;hello&quot;</span> <span class="ss">7</span><span class="p">))</span>         <span class="err">→</span> <span class="k">nil</span>

<span class="p">(</span><span class="k">for-all</span> <span class="p">(</span><span class="k">fn</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">=</span> <span class="ss">x</span> <span class="ss">10</span><span class="p">))</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">10</span> <span class="ss">10</span> <span class="ss">10</span> <span class="ss">10</span> <span class="ss">10</span><span class="p">))</span>  <span class="err">→</span> <span class="k">true</span>
</pre></div></div></div>
<div class="paragraph"><p>Use the <a href="#exists">exists</a> function to check if at least one element
in a list meets a condition.</p></div>
<div class="paragraph"><p><a id="fork"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_fork_span"><span class="big red">fork</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (fork <em>exp</em>)</p></div>
<div class="paragraph"><p>The expression in <em>exp</em> is launched as a newLISP child process-thread of
the platforms OS. The new process inherits the entire address space, but
runs independently so symbol or variable contents changed in the child
process will not affect the parent process or vice versa. The child
process ends when the evaluation of <em>exp</em> finishes.</p></div>
<div class="paragraph"><p>On success, <span class="monospaced">fork</span> returns with the child process ID; on failure, <span class="monospaced">nil</span>
is returned. See also the <a href="#wait-pid">wait-pid</a> function, which waits
for a child process to finish.</p></div>
<div class="paragraph"><p>This function is only available on Linux/Unix versions of newLISP and is
based on the <span class="monospaced">fork()</span> implementation of the underlying OS.</p></div>
<div class="paragraph"><p>A much simpler automated method to launch processes and collect results
is available with <a href="#spawn">spawn</a> and the <a href="#cilk">Cilk API</a>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="ss">&gt;</span> <span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">x</span> <span class="ss">0</span><span class="p">)</span>
<span class="ss">0</span>
<span class="ss">&gt;</span> <span class="p">(</span><span class="k">fork</span> <span class="p">(</span><span class="k">while</span> <span class="p">(</span><span class="nv">&lt;</span> <span class="ss">x</span> <span class="ss">20</span><span class="p">)</span> <span class="p">(</span><span class="k">println</span> <span class="p">(</span><span class="k">inc</span> <span class="ss">x</span><span class="p">))</span> <span class="p">(</span><span class="k">sleep</span> <span class="ss">1000</span><span class="p">)))</span>
<span class="ss">176</span>

<span class="ss">&gt;</span> <span class="ss">1</span>
<span class="ss">2</span>
<span class="ss">3</span>
<span class="ss">4</span>
<span class="ss">5</span>
<span class="ss">6</span>
</pre></div></div></div>
<div class="paragraph"><p>The example illustrates how the child process-thread inherits the symbol
space and how it is independent of the parent process. The <span class="monospaced">fork</span>
statement returns immediately with the process ID <span class="monospaced">176</span>. The child
process increments the variable <span class="monospaced">x</span> by one each second and prints it to
standard out (boldface). In the parent process, commands can still be
entered. Type <span class="monospaced">x</span> to see that the symbol <span class="monospaced">x</span> still has the value <span class="monospaced">0</span>
(zero) in the parent process. Although statements entered will mix with
the display of the child process output, they will be correctly input to
the parent process.</p></div>
<div class="paragraph"><p>The second example illustrates how <a href="#pipe">pipe</a> can be used to
communicate between processes.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="cp">#!/usr/bin/newlisp</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="k">count-</span><span class="ss">down-proc</span> <span class="ss">x</span> <span class="ss">channel</span><span class="p">)</span>
  <span class="p">(</span><span class="k">while</span> <span class="p">(</span><span class="nv">!=</span> <span class="ss">x</span> <span class="ss">0</span><span class="p">)</span>
      <span class="p">(</span><span class="k">write-</span><span class="ss">line</span> <span class="ss">channel</span> <span class="p">(</span><span class="k">string</span> <span class="ss">x</span><span class="p">))</span>
      <span class="p">(</span><span class="k">dec</span> <span class="ss">x</span><span class="p">)))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">observer-proc</span> <span class="ss">channel</span><span class="p">)</span>
  <span class="p">(</span><span class="k">do-until</span> <span class="p">(</span><span class="nv">=</span> <span class="ss">i</span> <span class="s">&quot;1&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="k">println</span> <span class="s">&quot;process &quot;</span> <span class="p">(</span><span class="k">setq</span> <span class="ss">i</span> <span class="p">(</span><span class="k">read-</span><span class="ss">line</span> <span class="ss">channel</span><span class="p">)))))</span>

<span class="p">(</span><span class="k">map</span> <span class="k">set</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">in</span> <span class="ss">out</span><span class="p">)</span> <span class="p">(</span><span class="k">pipe</span><span class="p">))</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">observer</span> <span class="p">(</span><span class="k">fork</span> <span class="p">(</span><span class="nv">observer-proc</span> <span class="ss">in</span><span class="p">)))</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">counter</span> <span class="p">(</span><span class="k">fork</span> <span class="p">(</span><span class="k">count-</span><span class="ss">down-proc</span> <span class="ss">5</span> <span class="ss">out</span><span class="p">)))</span>

<span class="c1">; avoid zombies</span>
<span class="p">(</span><span class="k">wait-pid</span> <span class="ss">observer</span><span class="p">)</span>
<span class="p">(</span><span class="k">wait-pid</span> <span class="ss">counter</span><span class="p">)</span>

<span class="p">(</span><span class="k">exit</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The following output is generated by observer-proc</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>process 5
process 4
process 3
process 2
process 1</pre>
</div></div>
<div class="paragraph"><p>The <span class="monospaced">count-down-proc</span> writes numbers to the communication pipe, where
they are picked up by the <span class="monospaced">observer-process</span> and displayed.</p></div>
<div class="paragraph"><p>A forked process can either exit by itself or it can be destroyed using
the <a href="#destroy">destroy</a> function.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="k">fork-destroy-</span><span class="ss">demo</span><span class="p">)</span>
    <span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">pid</span> <span class="p">(</span><span class="k">fork</span> <span class="p">(</span><span class="k">dotimes</span> <span class="p">(</span><span class="nv">i</span> <span class="ss">1000</span><span class="p">)</span> <span class="p">(</span><span class="k">println</span> <span class="ss">i</span><span class="p">)</span> <span class="p">(</span><span class="k">sleep</span> <span class="ss">10</span><span class="p">))))</span>
    <span class="p">(</span><span class="k">sleep</span> <span class="ss">50</span><span class="p">)</span>
    <span class="p">(</span><span class="k">destroy</span> <span class="ss">pid</span><span class="p">)</span>
<span class="p">)</span>

<span class="ss">&gt;</span> <span class="p">(</span><span class="k">fork-destroy-</span><span class="ss">demo</span><span class="p">)</span>
<span class="ss">0</span>
<span class="ss">1</span>
<span class="ss">2</span>
<span class="ss">3</span>
<span class="ss">4</span>
<span class="k">true</span>
<span class="ss">&gt;</span>
</pre></div></div></div>
<div class="paragraph"><p>The process started by <span class="monospaced">fork-destroy-demo</span> will not finish but is
destroyed 50 milli-seconds after start by a call to
<a href="#destroy">destroy</a>.</p></div>
<div class="paragraph"><p>Use the <a href="#semaphore">semaphore</a> function for synchronizing processes
and <a href="#share">share</a> for sharing memory between processes.</p></div>
<div class="paragraph"><p>See <a href="#spawn">spawn</a> for a much simpler and automated way to
synchronize processes and collect results.</p></div>
<div class="paragraph"><p><a id="format"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_format_span"><span class="big red">format</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (format <em>str-format exp-data-1</em> [<em>exp-data-2</em> &#8230; ])<br>
<strong>syntax:</strong> (format <em>str-format</em> <em>list-data</em>)</p></div>
<div class="paragraph"><p>Constructs a formatted string from <em>exp-data-1</em> using the format
specified in the evaluation of <em>str-format</em>. The format specified is
identical to the format used for the <span class="monospaced">printf()</span> function in the ANSI C
language. Two or more <em>exp-data</em> arguments can be specified for more
than one format specifier in <em>str-format</em>.</p></div>
<div class="paragraph"><p>In an alternative syntax, the data to be formatted can be passed inside
a list in <em>list-data</em>.</p></div>
<div class="paragraph"><p><span class="monospaced">format</span> checks for a valid format string, matching data type, and the
correct number of arguments. Wrong formats or data types result in error
messages. <a href="#int">int</a>, <a href="#float">float</a>, or <a href="#string">string</a>
can be used to ensure correct data types and to avoid error messages.</p></div>
<div class="paragraph"><p>The format string has the following general format:</p></div>
<div class="paragraph"><p><strong>"%w.pf"</strong></p></div>
<div class="paragraph"><p>The <span class="monospaced">%</span> (percent sign) starts a format specification. To display a <span class="monospaced">%</span>
inside a format string, double it: <span class="monospaced">%%</span></p></div>
<div class="paragraph"><p>The <span class="monospaced">w</span> represents the width field. Data is right-aligned, except when
preceded by a minus sign, in which case it is left-aligned. If preceded
by a <span class="monospaced">+</span> (plus sign), positive numbers are displayed with a <span class="monospaced">+</span>. When
preceded by a <span class="monospaced">0</span> (zero), the unused space is filled with leading
zeroes. The width field is optional and serves all data types.</p></div>
<div class="paragraph"><p>The <span class="monospaced">p</span> represents the precision number of decimals (floating point
only) or strings and is separated from the width field by a period.
Precision is optional. When using the precision field on strings, the
number of characters displayed is limited to the number in <span class="monospaced">p</span>.</p></div>
<div class="paragraph"><p>The <span class="monospaced">f</span> represents a type flag and is essential; it cannot be omitted.</p></div>
<div class="paragraph"><p>Below are the types in <span class="monospaced">f</span>:</p></div>
<table class="tableblock frame-all grid-all"
style="
width:30%;
">
<col style="width:9%;">
<col style="width:90%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" >format </th>
<th class="tableblock halign-left valign-top" >description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">s</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">text string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">c</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">character (value 1 - 255)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">d</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">decimal (32-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">u</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">unsigned decimal (32-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">hexadecimal lowercase</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">X</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">hexadecimal uppercase</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">o</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">octal (32-bits) (not supported on all compilers)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">f</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">floating point</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">e</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">scientific floating point</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">E</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">scientific floating point</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">g</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">general floating point</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>Formatting 64-bit numbers using 32-bit format specifiers will truncate
and format the lower 32 bits of the number.</p></div>
<div class="paragraph"><p>For 64-bit numbers use the following format strings on Unix-like
operating systems:</p></div>
<table class="tableblock frame-all grid-all"
style="
width:20%;
">
<col style="width:9%;">
<col style="width:90%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" >format </th>
<th class="tableblock halign-left valign-top" >description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">lld</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">decimal (64-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">llu</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">unsigned decimal (64-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">llx</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">hexadecimal (64-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">llX</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">hexadecimal uppercase(64-bit)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>For 64-bit numbers (since version 8.9.7) use the following format
strings on Tru64 Unix:</p></div>
<table class="tableblock frame-all grid-all"
style="
width:20%;
">
<col style="width:9%;">
<col style="width:90%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" >format </th>
<th class="tableblock halign-left valign-top" >description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">ld</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">decimal (64-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">lu</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">unsigned decimal (64-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">lx</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">hexadecimal (64-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">lX</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">hexadecimal uppercase(64-bit)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>On Win32 platforms the following characters apply for 64 bit numbers:</p></div>
<table class="tableblock frame-all grid-all"
style="
width:20%;
">
<col style="width:9%;">
<col style="width:90%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" >format </th>
<th class="tableblock halign-left valign-top" >description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">I64d</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">decimal (64-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">I64u</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">unsigned decimal (64-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">I64x</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">hexadecimal (64-bit)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">I64X</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">hexadecimal uppercase(64-bit)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>Other text may occur between, before, or after the format specs.</p></div>
<div class="paragraph"><p>Note that on Tru64 Unix the format character <span class="monospaced">i</span> can be used instead of
<span class="monospaced">d</span>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">format</span> <span class="s">&quot;&gt;&gt;&gt;%6.2f&lt;&lt;&lt;&quot;</span> <span class="ss">1.2345</span><span class="p">)</span>     <span class="err">→</span> <span class="s">&quot;&gt;&gt;&gt;  1.23&lt;&lt;&lt;&quot;</span>
<span class="p">(</span><span class="k">format</span> <span class="s">&quot;&gt;&gt;&gt;%-6.2f&lt;&lt;&lt;&quot;</span> <span class="ss">1.2345</span><span class="p">)</span>    <span class="err">→</span> <span class="s">&quot;&gt;&gt;&gt;1.23  &lt;&lt;&lt;&quot;</span>
<span class="p">(</span><span class="k">format</span> <span class="s">&quot;&gt;&gt;&gt;%+6.2f&lt;&lt;&lt;&quot;</span> <span class="ss">1.2345</span><span class="p">)</span>    <span class="err">→</span> <span class="s">&quot;&gt;&gt;&gt; +1.23&lt;&lt;&lt;&quot;</span>
<span class="p">(</span><span class="k">format</span> <span class="s">&quot;&gt;&gt;&gt;%+6.2f&lt;&lt;&lt;&quot;</span> <span class="k">-</span><span class="ss">1.2345</span><span class="p">)</span>   <span class="err">→</span> <span class="s">&quot;&gt;&gt;&gt; -1.23&lt;&lt;&lt;&quot;</span>
<span class="p">(</span><span class="k">format</span> <span class="s">&quot;&gt;&gt;&gt;%-+6.2f&lt;&lt;&lt;&quot;</span> <span class="k">-</span><span class="ss">1.2345</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;&gt;&gt;&gt;-1.23 &lt;&lt;&lt;&quot;</span>

<span class="p">(</span><span class="k">format</span> <span class="s">&quot;%e&quot;</span> <span class="ss">123456789</span><span class="p">)</span>        <span class="err">→</span> <span class="s">&quot;1.234568e+08&quot;</span>
<span class="p">(</span><span class="k">format</span> <span class="s">&quot;%12.10E&quot;</span> <span class="ss">123456789</span><span class="p">)</span>   <span class="err">→</span> <span class="s">&quot;1.2345678900E+08&quot;</span>

<span class="p">(</span><span class="k">format</span> <span class="s">&quot;%10g&quot;</span> <span class="ss">1.23</span><span class="p">)</span>   <span class="err">→</span> <span class="s">&quot;      1.23&quot;</span>
<span class="p">(</span><span class="k">format</span> <span class="s">&quot;%10g&quot;</span> <span class="ss">1.234</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;     1.234&quot;</span>

<span class="p">(</span><span class="k">format</span> <span class="s">&quot;Result = %05d&quot;</span> <span class="ss">2</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;Result = 00002&quot;</span>

<span class="p">(</span><span class="k">format</span> <span class="s">&quot;%-15s&quot;</span> <span class="s">&quot;hello&quot;</span><span class="p">)</span>        <span class="err">→</span> <span class="s">&quot;hello          &quot;</span>
<span class="p">(</span><span class="k">format</span> <span class="s">&quot;%15s %d&quot;</span> <span class="s">&quot;hello&quot;</span> <span class="ss">123</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;          hello 123&quot;</span>
<span class="p">(</span><span class="k">format</span> <span class="s">&quot;%5.2s&quot;</span> <span class="s">&quot;hello&quot;</span><span class="p">)</span>        <span class="err">→</span> <span class="s">&quot;   he&quot;</span>
<span class="p">(</span><span class="k">format</span> <span class="s">&quot;%-5.2s&quot;</span> <span class="s">&quot;hello&quot;</span><span class="p">)</span>       <span class="err">→</span> <span class="s">&quot;he   &quot;</span>

<span class="p">(</span><span class="k">format</span> <span class="s">&quot;%o&quot;</span> <span class="ss">80</span><span class="p">)</span>    <span class="err">→</span> <span class="s">&quot;120&quot;</span>

<span class="p">(</span><span class="k">format</span> <span class="s">&quot;%x %X&quot;</span> <span class="k">-</span><span class="ss">1</span> <span class="k">-</span><span class="ss">1</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;ffffffff FFFFFFFF&quot;</span>

<span class="c1">; 64 bit numbers on Windows</span>
<span class="p">(</span><span class="k">format</span> <span class="s">&quot;%I64X&quot;</span> <span class="ss">123456789012345678</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;1B69B4BA630F34E&quot;</span>

<span class="c1">; 64 bit numbers on Unix (except TRU64)</span>
<span class="p">(</span><span class="k">format</span> <span class="s">&quot;%llX&quot;</span> <span class="ss">123456789012345678</span><span class="p">)</span>   <span class="err">→</span> <span class="s">&quot;1B69B4BA630F34E&quot;</span>

<span class="p">(</span><span class="k">format</span> <span class="s">&quot;%c&quot;</span> <span class="ss">65</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;A&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>The data to be formatted can be passed inside a list:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">L</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;hello&quot;</span> <span class="ss">123</span><span class="p">))</span>
<span class="p">(</span><span class="k">format</span> <span class="s">&quot;%15s %d&quot;</span> <span class="ss">L</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;          hello 123&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>If the format string requires it, newLISP&#8217;s <span class="monospaced">format</span> will automatically
convert integers into floating points or floating points into integers:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">format</span> <span class="s">&quot;%f&quot;</span> <span class="ss">123</span><span class="p">)</span>      <span class="err">→</span> <span class="ss">123.000000</span>

<span class="p">(</span><span class="k">format</span> <span class="s">&quot;%d&quot;</span> <span class="ss">123.456</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">123</span>
</pre></div></div></div>
<div class="paragraph"><p><a id="fv"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_fv_span"><span class="big red">fv</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (fv <em>num-rate</em> <em>num-nper</em> <em>num-pmt</em> <em>num-pv</em> [<em>int-type</em>])</p></div>
<div class="paragraph"><p>Calculates the future value of a loan with constant payment <em>num-pmt</em>
and constant interest rate <em>num-rate</em> after <em>num-nper</em> period of time
and a beginning principal value of <em>num-pv</em>. If payment is at the end of
the period, <em>int-type</em> is <span class="monospaced">0</span> (zero) or <em>int-type</em> is omitted; for
payment at the beginning of each period, <em>int-type</em> is 1.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">fv</span> <span class="p">(</span><span class="k">div</span> <span class="ss">0.07</span> <span class="ss">12</span><span class="p">)</span> <span class="ss">240</span> <span class="ss">775.30</span> <span class="k">-</span><span class="ss">100000</span><span class="p">)</span>  <span class="err">→</span> <span class="k">-</span><span class="ss">0.5544645052</span>
</pre></div></div></div>
<div class="paragraph"><p>The example illustrates how a loan of $100,000 is paid down to a
residual of $0.55 after 240 monthly payments at a yearly interest rate
of 7 percent.</p></div>
<div class="paragraph"><p>See also the functions <a href="#irr">irr</a>, <a href="#nper">nper</a>, <a href="#npv">npv</a>,
<a href="#pmt">pmt</a>, and <a href="#pv">pv</a>.</p></div>
<div class="paragraph"><p><a id="gammai"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_gammai_span"><span class="big red">gammai</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (gammai <em>num-a</em> <em>num-b</em>)</p></div>
<div class="paragraph"><p>Calculates the incomplete Gamma function of values <em>a</em> and <em>b</em> in
<em>num-a</em> and <em>num-b</em>, respectively.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">gammai</span> <span class="ss">4</span> <span class="ss">5</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">0.7349740847</span>
</pre></div></div></div>
<div class="paragraph"><p>The incomplete Gamma function is used to derive the probability of Chi²
to exceed a given value for a degree of freedom, df, as follows:</p></div>
<div class="quoteblock">
<div class="content">
<div class="paragraph"><p><em>*Q(Chi²|df) = Q(df/2, Chi²/2) = gammai(df/2, Chi²/2)*</em></p></div>
</div>
<div class="attribution">
</div></div>
<div class="paragraph"><p>See also the <a href="#prob-chi2">prob-chi2</a> function.</p></div>
<div class="paragraph"><p><a id="gammaln"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_gammaln_span"><span class="big red">gammaln</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (gammaln <em>num-x</em>)</p></div>
<div class="paragraph"><p>Calculates the log Gamma function of the value <em>x</em> in <em>num-x</em>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">exp</span> <span class="p">(</span><span class="k">gammaln</span> <span class="ss">6</span><span class="p">))</span>  <span class="err">→</span> <span class="ss">120</span>
</pre></div></div></div>
<div class="paragraph"><p>The example uses the equality of <em>n! = gamma(n + 1)</em> to calculate the
factorial value of 5.</p></div>
<div class="paragraph"><p>The log Gamma function is also related to the Beta function, which can
be derived from it:</p></div>
<div class="quoteblock">
<div class="content">
<div class="paragraph"><p><em>*Beta(z,w) = Exp(Gammaln(z) + Gammaln(w) - Gammaln(z+w))*</em></p></div>
</div>
<div class="attribution">
</div></div>
<div class="paragraph"><p><a id="gcd"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_gcd_span"><span class="big red">gcd</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (gcd <em>int-1</em> [<em>int-2</em> &#8230; ])</p></div>
<div class="paragraph"><p>Calculates the greatest common divisor of a group of integers. The
greatest common divisor of two integers that are not both zero is the
largest integer that divides both numbers. <span class="monospaced">gcd</span> will calculate the
greatest common divisor for the first two integers in <em>int-i</em> and then
further reduce the argument list by calculating the greatest common
divisor of the result and the next argument in the parameter list.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">gcd</span> <span class="ss">0</span><span class="p">)</span>        <span class="err">→</span> <span class="ss">0</span>
<span class="p">(</span><span class="k">gcd</span> <span class="ss">0</span> <span class="ss">0</span><span class="p">)</span>      <span class="err">→</span> <span class="ss">0</span>
<span class="p">(</span><span class="k">gcd</span> <span class="ss">10</span><span class="p">)</span>       <span class="err">→</span> <span class="ss">10</span>
<span class="p">(</span><span class="k">gcd</span> <span class="ss">12</span> <span class="ss">36</span><span class="p">)</span>    <span class="err">→</span> <span class="ss">12</span>
<span class="p">(</span><span class="k">gcd</span> <span class="ss">15</span> <span class="ss">36</span> <span class="ss">6</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">3</span>
</pre></div></div></div>
<div class="paragraph"><p>See <a href="http://en.wikipedia.org/wiki/Greatest_common_divisor">Wikipedia</a> for
details and theory about gcd numbers in mathematics.</p></div>
<div class="paragraph"><p><a id="get-char"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_get_char_span"><span class="big red">get-char</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (get-char <em>int-address</em>)</p></div>
<div class="paragraph"><p>Gets an 8-bit character from an address specified in <em>int-address</em>. This
function is useful when using imported shared library functions with
<a href="#import">import</a>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="kt">char</span> <span class="o">*</span> <span class="nf">foo</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
        <span class="p">{</span>
        <span class="kt">char</span> <span class="o">*</span> <span class="n">result</span><span class="p">;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s">&quot;ABCDEFG&quot;</span><span class="p">;</span>
        <span class="k">return</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>
        <span class="p">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Consider the above C function from a shared library, which returns a
character pointer (address to a string).</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">import</span> <span class="s">&quot;mylib.so&quot;</span> <span class="s">&quot;foo&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">print</span> <span class="p">(</span><span class="k">get-char</span> <span class="p">(</span><span class="nv">foo</span><span class="p">)</span> <span class="p">))</span>       <span class="err">→</span>  <span class="ss">65</span> <span class="c1">; ASCII &quot;A&quot;</span>
<span class="p">(</span><span class="k">print</span> <span class="p">(</span><span class="k">get-char</span> <span class="p">(</span><span class="nv">+</span> <span class="p">(</span><span class="nv">foo</span><span class="p">)</span> <span class="ss">1</span><span class="p">)))</span>  <span class="err">→</span>  <span class="ss">66</span> <span class="c1">; ASCII &quot;B&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>Note that it is unsafe to use the <span class="monospaced">get-char</span> function with an incorrect
address in <em>int-address</em>. Doing so could result in the system crashing
or becoming unstable.</p></div>
<div class="paragraph"><p>See also the <a href="#address">address</a>, <a href="#get-int">get-int</a>,
<a href="#get-long">get-long</a>, <a href="#get-float">get-float</a>,
<a href="#get-string">get-string</a>, <a href="#pack">pack</a>, and <a href="#unpack">unpack</a>
functions.</p></div>
<div class="paragraph"><p><a id="get-float"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_get_float_span"><span class="big red">get-float</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (get-float <em>int-address</em>)</p></div>
<div class="paragraph"><p>Gets a 64-bit double float from an address specified in <em>int-address</em>.
This function is helpful when using imported shared library functions
(with <span class="monospaced">import</span>) that return an address pointer to a double float or a
pointer to a structure containing double floats.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="kt">double</span> <span class="kt">float</span> <span class="o">*</span> <span class="nf">foo</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
        <span class="p">{</span>
        <span class="kt">double</span> <span class="kt">float</span> <span class="o">*</span> <span class="n">result</span><span class="p">;</span>
        <span class="err">…</span>
        <span class="o">*</span><span class="n">result</span> <span class="o">=</span> <span class="mf">123.456</span><span class="p">;</span>
        <span class="k">return</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>
        <span class="p">}</span>
</pre></div></div></div>
<div class="paragraph"><p>The previous C function is compiled into a shared library.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">import</span> <span class="s">&quot;mylib.so&quot;</span> <span class="s">&quot;foo&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">get-float</span> <span class="p">(</span><span class="nv">foo</span><span class="p">))</span>  <span class="err">→</span> <span class="ss">123.456</span>
</pre></div></div></div>
<div class="paragraph"><p><span class="monospaced">foo</span> is imported and returns a pointer to a double float when called.
Note that <span class="monospaced">get-float</span> is unsafe when used with an incorrect address in
<em>int-address</em> and may result in the system crashing or becoming
unstable.</p></div>
<div class="paragraph"><p>See also the <a href="#address">address</a>, <a href="#get-int">get-int</a>,
<a href="#get-long">get-long</a>, <a href="#get-char">get-char</a>,
<a href="#get-string">get-string</a>, <a href="#pack">pack</a>, and <a href="#unpack">unpack</a>
functions.</p></div>
<div class="paragraph"><p><a id="get-int"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_get_int_span"><span class="big red">get-int</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (get-int <em>int-address</em>)</p></div>
<div class="paragraph"><p>Gets a 32-bit integer from the address specified in <em>int-address</em>. This
function is handy when using imported shared library functions with
<span class="monospaced">import</span>, a function returning an address pointer to an integer, or a
pointer to a structure containing integers.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="kt">int</span> <span class="o">*</span> <span class="nf">foo</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
        <span class="p">{</span>
        <span class="kt">int</span> <span class="o">*</span> <span class="n">result</span><span class="p">;</span>
        <span class="err">…</span>
        <span class="o">*</span><span class="n">result</span> <span class="o">=</span> <span class="mi">123</span><span class="p">;</span>
        <span class="k">return</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>
        <span class="p">}</span>

<span class="kt">int</span> <span class="n">foo</span><span class="o">-</span><span class="n">b</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
        <span class="p">{</span>
        <span class="kt">int</span> <span class="n">result</span><span class="p">;</span>
        <span class="err">…</span>
        <span class="n">result</span> <span class="o">=</span> <span class="mi">456</span><span class="p">;</span>
        <span class="k">return</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>
        <span class="p">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Consider the C function <span class="monospaced">foo</span> (from a shared library), which returns an
integer pointer (address of an integer).</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">import</span> <span class="s">&quot;mylib.so&quot;</span> <span class="s">&quot;foo&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">get-int</span> <span class="p">(</span><span class="nv">foo</span><span class="p">))</span>  <span class="err">→</span> <span class="ss">123</span>
<span class="p">(</span><span class="nv">foo-b</span><span class="p">)</span>          <span class="err">→</span> <span class="ss">456</span>
</pre></div></div></div>
<div class="paragraph"><p>Note that using <span class="monospaced">get-int</span> with an incorrect address in <em>int-address</em> is
unsafe and could result in the system crashing or becoming unstable.</p></div>
<div class="paragraph"><p>See also the <a href="#address">address</a>, <a href="#get-char">get-char</a>,
<a href="#get-float">get-float</a>, <a href="#get-long">get-long</a>,
<a href="#get-string">get-string</a>, <a href="#pack">pack</a>, and <a href="#unpack">unpack</a>
functions.</p></div>
<div class="paragraph"><p><a id="get-long"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_get_long_span"><span class="big red">get-long</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (get-long <em>int-address</em>)</p></div>
<div class="paragraph"><p>Gets a 64-bit integer from the address specified in <em>int-address</em>. This
function is handy when using <span class="monospaced">import</span> to import shared library
functions, a function returning an address pointer to a long integer, or
a pointer to a structure containing long integers.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="kt">long</span> <span class="kt">long</span> <span class="kt">int</span> <span class="o">*</span> <span class="nf">foo</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
        <span class="p">{</span>
        <span class="kt">int</span> <span class="o">*</span> <span class="n">result</span><span class="p">;</span>
        <span class="err">…</span>
        <span class="o">*</span><span class="n">result</span> <span class="o">=</span> <span class="mi">123</span><span class="p">;</span>
        <span class="k">return</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>
        <span class="p">}</span>

<span class="kt">long</span> <span class="kt">long</span> <span class="kt">int</span> <span class="n">foo</span><span class="o">-</span><span class="n">b</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
        <span class="p">{</span>
        <span class="kt">int</span> <span class="n">result</span><span class="p">;</span>
        <span class="err">…</span>
        <span class="n">result</span> <span class="o">=</span> <span class="mi">456</span><span class="p">;</span>
        <span class="k">return</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>
        <span class="p">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Consider the C function <span class="monospaced">foo</span> (from a shared library), which returns an
integer pointer (address of an integer).</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">import</span> <span class="s">&quot;mylib.so&quot;</span> <span class="s">&quot;foo&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">get-int</span> <span class="p">(</span><span class="nv">foo</span><span class="p">))</span>  <span class="err">→</span> <span class="ss">123</span>
<span class="p">(</span><span class="nv">foo-b</span><span class="p">)</span>          <span class="err">→</span> <span class="ss">456</span>
</pre></div></div></div>
<div class="paragraph"><p>Note that using <span class="monospaced">get-long</span> with an incorrect address in <em>int-address</em> is
unsafe and could result in the system crashing or becoming unstable.</p></div>
<div class="paragraph"><p>See also the <a href="#address">address</a>, <a href="#get-char">get-char</a>,
<a href="#get-float">get-float</a>, <a href="#get-int">get-int</a>,
<a href="#get-string">get-string</a>, <a href="#pack">pack</a>, and <a href="#unpack">unpack</a>
functions.</p></div>
<div class="paragraph"><p><a id="get-string"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_get_string_span"><span class="big red">get-string</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (get-string <em>int-address</em>)</p></div>
<div class="paragraph"><p>Gets a character string from the address specified in <em>int-address</em>.
This function is helpful when using imported shared library functions
with <a href="#import">import</a>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="kt">char</span> <span class="o">*</span> <span class="nf">foo</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
        <span class="p">{</span>
        <span class="kt">char</span> <span class="o">*</span> <span class="n">result</span><span class="p">;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="s">&quot;ABCDEFG&quot;</span><span class="p">;</span>
        <span class="k">return</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>
        <span class="p">}</span>
</pre></div></div></div>
<div class="paragraph"><p>Consider the above C function from a shared library, which returns a
character pointer (address to a string).</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">import</span> <span class="s">&quot;mylib.so&quot;</span> <span class="s">&quot;foo&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">print</span> <span class="p">(</span><span class="k">get-string</span> <span class="p">(</span><span class="nv">foo</span><span class="p">)))</span>  <span class="err">→</span> <span class="s">&quot;ABCDEFG&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>When a string is passed as an argument, <span class="monospaced">get-string</span> will take its
address as the argument. Because <span class="monospaced">get-string</span> always breaks off at the
first first <span class="monospaced">\000</span> (null character) it encounters, it can be used to
retrieve a string from a buffer:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">buff</span> <span class="s">&quot;ABC\000\000\000DEF&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;ABC\000\000\000DEF&quot;</span>

<span class="p">(</span><span class="k">length</span> <span class="ss">buff</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">9</span>

<span class="p">(</span><span class="k">get-string</span> <span class="ss">buff</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;ABC&quot;</span>

<span class="p">(</span><span class="k">length</span> <span class="p">(</span><span class="k">get-string</span> <span class="ss">buff</span><span class="p">))</span>  <span class="err">→</span> <span class="ss">3</span>

<span class="c1">; get a string from offset into a buffer</span>
<span class="p">(</span><span class="k">get-string</span> <span class="p">(</span><span class="nv">+</span> <span class="p">(</span><span class="k">address</span> <span class="ss">buff</span><span class="p">)</span> <span class="ss">6</span><span class="p">))</span> <span class="err">→</span> <span class="s">&quot;DEF&quot;</span>

<span class="c1">; use unpack to get the whole buffer</span>
<span class="p">(</span><span class="k">unpack</span> <span class="s">&quot;s9&quot;</span> <span class="ss">buff</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="s">&quot;ABC\000\000\000DEF&quot;</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>See also the <a href="#get-char">get-char</a>, <a href="#get-int">get-int</a>,
<a href="#get-float">get-float</a>, <a href="#pack">pack</a>, and <a href="#unpack">unpack</a>
functions.</p></div>
<div class="paragraph"><p>Note that <span class="monospaced">get-string</span> can crash the system or make it unstable if the
wrong address is specified.</p></div>
<div class="paragraph"><p><a id="get-url"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_get_url_span"><span class="big red">get-url</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (get-url <em>str-url</em> [<em>str-option</em>] [<em>int-timeout</em> [<em>str-header</em>]])</p></div>
<div class="paragraph"><p>Reads a web page or file specified by the URL in <em>str-url</em> using the
HTTP GET protocol. Both <span class="monospaced">http://</span> and <span class="monospaced">file://</span> URLs are handled.
<span class="monospaced">"header"</span> can be specified in the optional argument <em>str-option</em> to
retrieve only the header. The option <span class="monospaced">"list"</span> causes header and page
information to be returned as separate strings in a list.</p></div>
<div class="paragraph"><p>A <span class="monospaced">"debug"</span> option can be specified either alone or after the <span class="monospaced">"header"</span>
or <span class="monospaced">"list"</span> option separated by one character, i.e. <span class="monospaced">"header debug"</span> or
<span class="monospaced">"list debug"</span>. Including "debug" outputs all outgoing information to
the console window.</p></div>
<div class="paragraph"><p>The optional argument <em>int-timeout</em> can specify a value in milliseconds.
If no data is available from the host after the specified timeout,
<span class="monospaced">get-url</span> returns the string <span class="monospaced">ERR: timeout</span>. When other error conditions
occur, <span class="monospaced">get-url</span> returns a string starting with <span class="monospaced">ERR:</span> and the
description of the error.</p></div>
<div class="paragraph"><p><span class="monospaced">get-url</span> handles redirection if it detects a <span class="monospaced">Location:</span> spec in the
received header and automatically does a second request. <span class="monospaced">get-url</span> also
understands the <span class="monospaced">Transfer-Encoding: chunked</span> format and will unpack data
into an unchunked format.</p></div>
<div class="paragraph"><p><span class="monospaced">get-url</span> requests are also understood by newLISP server nodes.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">get-url</span> <span class="s">&quot;http://www.nuevatec.com&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">get-url</span> <span class="s">&quot;http://www.nuevatec.com&quot;</span> <span class="ss">3000</span><span class="p">)</span>
<span class="p">(</span><span class="k">get-url</span> <span class="s">&quot;http://www.nuevatec.com&quot;</span> <span class="s">&quot;header&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">get-url</span> <span class="s">&quot;http://www.nuevatec.com&quot;</span> <span class="s">&quot;header&quot;</span> <span class="ss">5000</span><span class="p">)</span>
<span class="p">(</span><span class="k">get-url</span> <span class="s">&quot;http://www.nuevatec.com&quot;</span> <span class="s">&quot;list&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">get-url</span> <span class="s">&quot;file:///home/db/data.txt&quot;</span><span class="p">)</span> <span class="c1">; access local file system</span>

<span class="p">(</span><span class="k">env</span> <span class="s">&quot;HTTP_PROXY&quot;</span> <span class="s">&quot;http://ourproxy:8080&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">get-url</span> <span class="s">&quot;http://www.nuevatec.com/newlisp/&quot;</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The index page from the site specified in <em>str-url</em> is returned as a
string. In the third line, only the HTTP header is returned in a string.
Lines 2 and 4 show a timeout value being used.</p></div>
<div class="paragraph"><p>The second example shows usage of a <span class="monospaced">file://</span> URL to access
<span class="monospaced">/home/db/data.txt</span> on the local file system.</p></div>
<div class="paragraph"><p>The third example illustrates the use of a proxy server. The proxy
server&#8217;s URL must be in the operating system&#8217;s environment. As shown in
the example, this can be added using the <a href="#env">env</a> function.</p></div>
<div class="paragraph"><p>The <em>int-timeout</em> can be followed by an optional custom header in
<em>str-header</em>:</p></div>
</div>
<div class="sect3">
<h4 id="_custom_header">Custom header</h4>
<div class="paragraph"><p>The custom header may contain options for browser cookies or other
directives to the server. When no <em>str-header</em> is specified, newLISP
sends certain header information by default. After the following
request:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">get-url</span> <span class="s">&quot;http://somehost.com&quot;</span> <span class="ss">5000</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>newLISP will configure and send the request and header below:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>GET / HTTP/1.1
Host: somehost.com
User-Agent: newLISP v8800
Connection: close</pre>
</div></div>
<div class="paragraph"><p>As an alternative, the <em>str-header</em> option could be used:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">get-url</span> <span class="s">&quot;http://somehost.com&quot;</span> <span class="ss">5000</span>
    <span class="s">&quot;User-Agent: Mozilla/4.0\r\nCookie: name=fred\r\n&quot;</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>newLISP will now send the following request and header:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>GET / HTTP/1.1
Host: somehost.com
User-Agent: Mozilla/4.o
Cookie: name=fred
Connection: close</pre>
</div></div>
<div class="paragraph"><p>Note that when using a custom header, newLISP will only supply the <span class="monospaced">GET</span>
request line, as well as the <span class="monospaced">Host:</span> and <span class="monospaced">Connection:</span> header entries.
newLISP inserts all other entries supplied in the custom header between
the <span class="monospaced">Host:</span> and <span class="monospaced">Connection:</span> entries. Each entry must end with a
carriage return line-feed pair: <span class="monospaced">\r\n</span>.</p></div>
<div class="paragraph"><p>See an HTTP transactions reference for valid header entries.</p></div>
<div class="paragraph"><p>Custom headers can also be used in the <a href="#put-url">put-url</a> and
<a href="#post-url">post-url</a> functions.</p></div>
<div class="paragraph"><p><a id="global"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_global_span"><span class="big red">global</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (global <em>sym-1</em> [<em>sym-2</em> &#8230; ])</p></div>
<div class="paragraph"><p>One or more symbols in <em>sym-1</em> [<em>sym-2</em> &#8230; ] can be made globally
accessible from contexts other than MAIN. The statement has to be
executed in the MAIN context, and only symbols belonging to MAIN can be
made global. <span class="monospaced">global</span> returns the last symbol made global.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">global</span> <span class="o">&#39;</span><span class="ss">aVar</span> <span class="o">&#39;</span><span class="ss">x</span> <span class="o">&#39;</span><span class="ss">y</span> <span class="o">&#39;</span><span class="ss">z</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">z</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">foo</span> <span class="ss">x</span><span class="p">)</span>
  <span class="p">(</span><span class="err">…</span><span class="p">))</span>

<span class="p">(</span><span class="k">constant</span> <span class="p">(</span><span class="k">global</span> <span class="o">&#39;</span><span class="ss">foo</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p>The second example shows how <a href="#constant">constant</a> and <span class="monospaced">global</span> can
be combined into one statement, protecting and making a previous
function definition global.</p></div>
<div class="paragraph"><p><a id="global?"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_global_span_2"><span class="big red">global?</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (global? <em>sym</em>)</p></div>
<div class="paragraph"><p>Checks if symbol in <em>sym</em> is global. Built-in functions, context
symbols, and all symbols made global using the function
<a href="#global">global</a> are global:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">global</span><span class="ss">?</span> <span class="o">&#39;</span><span class="k">print</span><span class="p">)</span>   <span class="err">→</span> <span class="k">true</span>
<span class="p">(</span><span class="k">global</span> <span class="o">&#39;</span><span class="ss">var</span><span class="p">)</span>     <span class="err">→</span> <span class="ss">var</span>
<span class="p">(</span><span class="k">global</span><span class="ss">?</span> <span class="o">&#39;</span><span class="ss">var</span><span class="p">)</span>    <span class="err">→</span> <span class="k">true</span>

<span class="p">(</span><span class="k">constant</span> <span class="p">(</span><span class="k">global</span> <span class="o">&#39;</span><span class="ss">foo</span><span class="p">))</span>

<span class="p">(</span><span class="k">global</span><span class="ss">?</span> <span class="o">&#39;</span><span class="ss">foo</span><span class="p">)</span>    <span class="err">→</span> <span class="k">true</span>
</pre></div></div></div>
<div class="paragraph"><p><a id="if"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_if_span"><span class="big red">if</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (if <em>exp-condition</em> <em>exp-1</em> [<em>exp-2</em>])<br>
<strong>syntax:</strong> (if <em>exp-cond-1</em> <em>exp-1</em> <em>exp-cond-2</em> <em>exp-2</em> [ &#8230; ])</p></div>
<div class="paragraph"><p>If the value of <em>exp-condition</em> is neither <span class="monospaced">nil</span> nor an empty list, the
result of evaluating <em>exp-1</em> is returned; otherwise, the value of
<em>exp-2</em> is returned. If <em>exp-2</em> is absent, the value of <em>exp-condition</em>
is returned.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">x</span> <span class="ss">50</span><span class="p">)</span>                   <span class="err">→</span> <span class="ss">50</span>
<span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">&lt;</span> <span class="ss">x</span> <span class="ss">100</span><span class="p">)</span> <span class="s">&quot;small&quot;</span> <span class="s">&quot;big&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;small&quot;</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">x</span> <span class="ss">1000</span><span class="p">)</span>                 <span class="err">→</span> <span class="ss">1000</span>
<span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">&lt;</span> <span class="ss">x</span> <span class="ss">100</span><span class="p">)</span> <span class="s">&quot;small&quot;</span> <span class="s">&quot;big&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;big&quot;</span>
<span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">&gt;</span> <span class="ss">x</span> <span class="ss">2000</span><span class="p">)</span> <span class="s">&quot;big&quot;</span><span class="p">)</span>         <span class="err">→</span> <span class="k">nil</span>
</pre></div></div></div>
<div class="paragraph"><p>The second form of <span class="monospaced">if</span> works similarly to <a href="#cond">cond</a>, except it
does not take parentheses around the condition-body pair of expressions.
In this form, <span class="monospaced">if</span> can have an unlimited number of arguments.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">classify</span> <span class="ss">x</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if</span>
        <span class="p">(</span><span class="nv">&lt;</span> <span class="ss">x</span> <span class="ss">0</span><span class="p">)</span> <span class="s">&quot;negative&quot;</span>
        <span class="p">(</span><span class="nv">&lt;</span> <span class="ss">x</span> <span class="ss">10</span><span class="p">)</span> <span class="s">&quot;small&quot;</span>
        <span class="p">(</span><span class="nv">&lt;</span> <span class="ss">x</span> <span class="ss">20</span><span class="p">)</span> <span class="s">&quot;medium&quot;</span>
        <span class="p">(</span><span class="nv">&gt;=</span> <span class="ss">x</span> <span class="ss">30</span><span class="p">)</span> <span class="s">&quot;big&quot;</span>
        <span class="s">&quot;n/a&quot;</span><span class="p">))</span>

<span class="p">(</span><span class="nv">classify</span> <span class="ss">15</span><span class="p">)</span>   <span class="err">→</span> <span class="s">&quot;medium&quot;</span>
<span class="p">(</span><span class="nv">classify</span> <span class="ss">100</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;big&quot;</span>
<span class="p">(</span><span class="nv">classify</span> <span class="ss">22</span><span class="p">)</span>   <span class="err">→</span> <span class="s">&quot;n/a&quot;</span>
<span class="p">(</span><span class="nv">classify</span> <span class="k">-</span><span class="ss">10</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;negative&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>The last expression, <span class="monospaced">"n/a"</span>, is optional. When this option is omitted,
the evaluation of <span class="monospaced">(&gt;= x 30)</span> is returned, behaving exactly like a
traditional <a href="#cond">cond</a> but without requiring parentheses around
the condition-expression pairs.</p></div>
<div class="paragraph"><p>In any case, the whole <span class="monospaced">if</span> expression always returns the last
expression or condition evaluated.</p></div>
<div class="paragraph"><p>See also the <a href="#unless">unless</a> function.</p></div>
<div class="paragraph"><p><a id="ifft"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_ifft_span"><span class="big red">ifft</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (ifft <em>list-num</em>)</p></div>
<div class="paragraph"><p>Calculates the inverse discrete Fourier transform on a list of complex
numbers in <em>list-num</em> using the FFT method (Fast Fourier Transform).
Each complex number is specified by its real part, followed by its
imaginary part. In case only real numbers are used, the imaginary part
is set to <span class="monospaced">0.0</span> (zero). When the number of elements in <em>list-num</em> is not
an integer power of 2, <span class="monospaced">ifft</span> increases the number of elements by
padding the list with zeroes. When complex numbers are <span class="monospaced">0</span> in the
imaginary part, simple numbers can be used.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">ifft</span> <span class="p">(</span><span class="k">fft</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">1</span> <span class="ss">0</span><span class="p">)</span> <span class="p">(</span><span class="nv">2</span> <span class="ss">0</span><span class="p">)</span> <span class="p">(</span><span class="nv">3</span> <span class="ss">0</span><span class="p">)</span> <span class="p">(</span><span class="nv">4</span> <span class="ss">0</span><span class="p">))))</span>
<span class="err">→</span> <span class="p">((</span><span class="nv">1</span> <span class="ss">0</span><span class="p">)</span> <span class="p">(</span><span class="nv">2</span> <span class="ss">0</span><span class="p">)</span> <span class="p">(</span><span class="nv">3</span> <span class="ss">0</span><span class="p">)</span> <span class="p">(</span><span class="nv">4</span> <span class="ss">0</span><span class="p">))</span>

<span class="c1">;; when imaginary part is 0, plain numbers work too</span>

<span class="p">(</span><span class="k">ifft</span> <span class="p">(</span><span class="k">fft</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">)))</span>
<span class="err">→</span> <span class="p">((</span><span class="nv">1</span> <span class="ss">0</span><span class="p">)</span> <span class="p">(</span><span class="nv">2</span> <span class="ss">0</span><span class="p">)</span> <span class="p">(</span><span class="nv">3</span> <span class="ss">0</span><span class="p">)</span> <span class="p">(</span><span class="nv">4</span> <span class="ss">0</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p>The inverse operation of <span class="monospaced">ifft</span> is the <a href="#fft">fft</a> function.</p></div>
<div class="paragraph"><p><a id="import"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_import_span"><span class="big red">import</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (import <em>str-lib-name</em> <em>str-function-name</em> ["cdecl"])<br>
<strong>syntax:</strong> (import <em>str-lib-name</em> <em>str-function-name</em> <em>str-return-type</em> [<em>str-param-type</em> . . .])<br>
<strong>syntax:</strong> (import <em>str-lib-name</em>)</p></div>
<div class="paragraph"><p>Imports the function specified in <em>str-function-name</em> from a shared
library named in <em>str-lib-name</em>. Depending on the syntax used, string
labels for return and parameter types can be specified</p></div>
<div class="paragraph"><p>If the libary in <em>str-lib-name</em> is not in the system&#8217;s library path, the
full path name should be specified.</p></div>
<div class="paragraph"><p>A function can be imported only once. A repeated import of the same
function will simply return the same - already allocated - function
address.</p></div>
<div class="paragraph"><p>On <em>libffi</em> enabled versions - capable of the second extended syntax -
imported symbols are protected against change and can only be modified
using <a href="#constant">constant</a>.</p></div>
<div class="paragraph"><p>The third syntax - on OSX, Linux and other Unix only - allows loading
libraries without importing functions. This is necessary when other
libraries need access to functions they need internally.</p></div>
</div>
<div class="sect3">
<h4 id="_the_simple_span_class_monospaced_import_span_syntax">The simple <span class="monospaced">import</span> syntax</h4>
<div class="paragraph"><p>Most library functions can be imported using the simpler first syntax.
The API expects all function arguments to be passed on the stack in
either <em>cdecl</em> or <em>stdcall</em> conventions. On 32-bit platforms, integers,
pointers to strings and buffers sometimes floating point values can be
passed as parameters. On 64-bit platforms only integers can be passed
but no floating point values. As return values only 32-bit or 64-bit
values and pointers are allowed. No floating point numbers can be
returned. Strings must be retrieved with the
<a href="#get-string">get-string</a> helper function. Regardless of these
limitations, most modules included in the distribution use this simple
import API.</p></div>
<div class="paragraph"><p>If pointers are returned to strings or structures the following helper
functions can be used extract data: <a href="#get-char">get-char</a>,
<a href="#get-int">get-int</a>, <a href="#get-float">get-float</a>,
<a href="#get-string">get-string</a>, <a href="#unpack">unpack</a></p></div>
<div class="paragraph"><p>To pass pointers for data structures the following functions help to
pack data and calculate addresses: <a href="#address">address</a>,
<a href="#pack">pack</a>.</p></div>
<div class="paragraph"><p>To transform newLISP data types into the data types needed by the
imported function, use the functions <a href="#float">float</a> for 64-bit
double floats, <a href="#flt">flt</a> for 32-bit floats, and <a href="#int">int</a> for
32-bit integers. By default, newLISP passes floating point numbers as
64-bit double floats, integers as 32-bit integers, and strings as 32-bit
integers for string addresses (pointers in C). Floats can only be used
with 32-bit versions of newLISP and libraries. To use floating point
numbers in a 64-bit environment use the <a href="#extended_import">extended
<span class="monospaced">import</span> syntax</a>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">;; define LIBC platform independent</span>

<span class="p">(</span><span class="k">define</span> <span class="ss">LIBC</span> <span class="p">(</span><span class="k">lookup</span> <span class="k">ostype</span> <span class="o">&#39;</span><span class="p">(</span>
    <span class="p">(</span><span class="s">&quot;Win32&quot;</span> <span class="s">&quot;msvcrt.dll&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&quot;OSX&quot;</span> <span class="s">&quot;libc.dylib&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="nv">printf</span> <span class="s">&quot;%g %s %d %c\n&quot;</span> <span class="ss">1.23</span> <span class="s">&quot;hello&quot;</span> <span class="ss">999</span> <span class="ss">65</span><span class="p">)</span>
<span class="ss">1.23</span> <span class="ss">hello</span> <span class="ss">999</span> <span class="ss">A</span>
<span class="err">→</span> <span class="ss">17</span> <span class="c1">; return value</span>

<span class="c1">;; import Win32 DLLs in Win32 versions</span>

<span class="p">(</span><span class="k">import</span> <span class="s">&quot;kernel32.dll&quot;</span> <span class="s">&quot;GetTickCount&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">GetTickCount</span>
<span class="p">(</span><span class="k">import</span> <span class="s">&quot;user32.dll&quot;</span> <span class="s">&quot;MessageBoxA&quot;</span><span class="p">)</span>     <span class="err">→</span> <span class="ss">MessageBoxA</span>
<span class="p">(</span><span class="nv">GetTickCount</span><span class="p">)</span>                          <span class="err">→</span> <span class="ss">3328896</span>
</pre></div></div></div>
<div class="paragraph"><p>In the first example, the string "1.23 hello 999 A" is printed as a side
effect, and the value 17 (number of characters printed) is returned. Any
C function can be imported from any shared library in this way.</p></div>
<div class="paragraph"><p>The message box example pops up a Windows dialog box, which may be
hidden behind the console window. The console prompt does not return
until the <em>OK</em> button is pressed in the message box.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">;;this pops up a message box</span>

<span class="p">(</span><span class="nv">MessageBoxA</span> <span class="ss">0</span> <span class="s">&quot;This is the body&quot;</span> <span class="s">&quot;Caption&quot;</span> <span class="ss">1</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The other examples show several imports of Win32 DLL functions and the
details of passing values <em>by value</em> or <em>by reference</em>. Whenever strings
or numbers are passed by reference, space must be reserved beforehand.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">import</span> <span class="s">&quot;kernel32.dll&quot;</span> <span class="s">&quot;GetWindowsDirectoryA&quot;</span><span class="p">)</span>

<span class="c1">;; allocating space for a string return value</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">str</span> <span class="p">(</span><span class="k">dup</span> <span class="s">&quot;\000&quot;</span> <span class="ss">64</span><span class="p">))</span>  <span class="c1">; reserve space and initialize</span>

<span class="p">(</span><span class="nv">GetWindowsDirectoryA</span> <span class="ss">str</span> <span class="p">(</span><span class="k">length</span> <span class="ss">str</span><span class="p">))</span>

<span class="ss">str</span>  <span class="err">→</span> <span class="s">&quot;C:\\WINDOWS\000\000\000 ... &quot;</span>

<span class="c1">;; use trim or get-string to cut of binary zeros</span>
<span class="p">(</span><span class="k">get-string</span> <span class="ss">str</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;C:\\WINDOWS&quot;</span>
<span class="p">(</span><span class="k">trim</span> <span class="ss">str</span><span class="p">)</span>        <span class="err">→</span> <span class="s">&quot;C:\\WINDOWS&quot;</span>

<span class="p">(</span><span class="k">import</span> <span class="s">&quot;kernel32.dll&quot;</span> <span class="s">&quot;GetComputerNameA&quot;</span><span class="p">)</span>

<span class="c1">;; allocate memory and initialize to zeros</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">str</span> <span class="p">(</span><span class="k">dup</span> <span class="s">&quot;\000&quot;</span> <span class="ss">64</span><span class="p">))</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">len</span> <span class="p">(</span><span class="k">length</span> <span class="ss">str</span><span class="p">)</span>

<span class="c1">;; call the function</span>
<span class="c1">;; the length of the string is passed as address reference</span>
<span class="c1">;; string str is automatically past by address (C pointer)</span>
<span class="p">(</span><span class="nv">GetComputerNameA</span> <span class="ss">str</span> <span class="p">(</span><span class="k">address</span> <span class="ss">len</span><span class="p">))</span>

<span class="ss">str</span>  <span class="err">→</span> <span class="s">&quot;LUTZ-PC\000\000 ... &quot;</span>

<span class="p">(</span><span class="k">trim</span> <span class="ss">str</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;LUTZ-PC&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p><span class="monospaced">import</span> returns the address of the function, which can be used to
assign a different name to the imported function.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">imprime</span> <span class="p">(</span><span class="k">import</span> <span class="s">&quot;libc.so.6&quot;</span> <span class="s">&quot;printf&quot;</span><span class="p">))</span>
<span class="err">→</span> <span class="ss">printf@400862A0</span>

<span class="p">(</span><span class="nv">imprime</span> <span class="s">&quot;%s %d&quot;</span> <span class="s">&quot;hola&quot;</span> <span class="ss">123</span><span class="p">)</span>
<span class="err">→</span> <span class="s">&quot;hola 123&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>The Win32 and Cygwin versions of newLISP uses standard call <em>stdcall</em>
conventions to call DLL library routines by default. This is necessary
for calling DLLs that belong to the Win32 operating system. Most
third-party DLLs are compiled for C declaration <em>cdecl</em> calling
conventions and may need to specify the string <span class="monospaced">"cdecl"</span> as an
additional last argument when importing functions. newLISP compiled for
Mac OS X, Linux and other Unix systems uses the <em>cdecl</em> calling
conventions by default and ignores any additional string.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">;; force cdecl calling conventions on Win32</span>
<span class="p">(</span><span class="k">import</span> <span class="s">&quot;sqlite.dll&quot;</span> <span class="s">&quot;sqlite_open&quot;</span> <span class="s">&quot;cdecl&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">sqlite_open</span> <span class="k">&lt;</span><span class="ss">673D4888&gt;</span>
</pre></div></div></div>
<div class="paragraph"><p>Imported functions may take up to fourteen arguments. Note that floating
point arguments take up two spaces each (e.g., passing five floats takes
up ten of the fourteen parameters).</p></div>
</div>
<div class="sect3">
<h4 id="_the_extended_span_class_monospaced_import_span_syntax">The extended <span class="monospaced">import</span> syntax</h4>
<div class="paragraph"><p>The extended import API works with the second syntax. It is based on the
popular <span class="monospaced">libffi</span> library and is pre-installed on most OS platforms. The
API works with all atomic C data types for passed parameters and return
values. The extended API requires that parameter types are specified in
the <span class="monospaced">import</span> statement as string type labels. Programs written with
extended import API will run without change on 32-bit and 64-bit newLISP
and libraries. Integers, floating point values and strings can be
returned without using helper functions.</p></div>
<div class="paragraph"><p>The following types can be specified for the return value in
<em>str-return-type</em> and for function parameters in <em>str-param-type</em>:</p></div>
<table class="tableblock frame-all grid-all"
style="
width:75%;
">
<col style="width:14%;">
<col style="width:42%;">
<col style="width:42%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" >label </th>
<th class="tableblock halign-left valign-top" >C type for return value and arguments </th>
<th class="tableblock halign-left valign-top" >newLISP return and
argument type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">"void"</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">void (only as return type)</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">nil</span> is returned</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">"byte"</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">byte unsigned 8 bit</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">"char"</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">char signed 8 bit</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">"unsigned short int"</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">unsigned short int 16 bit</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">"short int"</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">short int signed 16 bit</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">"unsigned int"</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">unsigned int 32 bit</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">"int"</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">int signed 32 bit</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">"long"</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">long signed 32 or 64 bit depending on platform</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">"long long"</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">long long signed 64 bit</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">integer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">"float"</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">float 32 bit</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">IEEE-754 64 bit float cut to 32-bit precision</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">"double"</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">double 64 bit</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">IEEE-754 64 bit float</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">"char*"</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">char* 32 or 64 bit ptr depending on platform</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">displayable
string return (zero terminated)<br>
string buffer arg (no addr. since 10.4.2)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">"void*"</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">void* 32 or 64 bit ptr depending on platform</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">integer address
return<br>
either string buffer or integer address arg</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>The types <span class="monospaced">"char*"</span> and <span class="monospaced">"void*</span> can be interchanged and are treated
identical inside <span class="monospaced">libffi</span>. Depending on the type of arguments passed and
the type of return values, one or the other is used.</p></div>
<div class="paragraph"><p>Aggregate types can be composed using the <a href="#struct">struct</a> function.</p></div>
<div class="paragraph"><p>The following examples show how the extended <span class="monospaced">import</span> syntax can handle
return values of floating point values and strings:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">;; return a float value, LIBC was defined earlier</span>
<span class="c1">;             name   return   arg</span>
<span class="p">(</span><span class="k">import</span> <span class="ss">LIBC</span> <span class="s">&quot;atof&quot;</span> <span class="s">&quot;double&quot;</span> <span class="s">&quot;char*&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="nv">atof</span> <span class="s">&quot;3.141&quot;</span><span class="p">)</span> <span class="err">→</span> <span class="ss">3.141</span>

<span class="c1">;; return a copied string</span>
<span class="c1">;             name     return  arg-1   arg-2</span>
<span class="p">(</span><span class="k">import</span> <span class="ss">LIBC</span> <span class="s">&quot;strcpy&quot;</span> <span class="s">&quot;char*&quot;</span> <span class="s">&quot;char*&quot;</span> <span class="s">&quot;char*&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">from</span> <span class="s">&quot;Hello World&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">to</span> <span class="p">(</span><span class="k">dup</span> <span class="s">&quot;\000&quot;</span> <span class="p">(</span><span class="k">length</span> <span class="ss">from</span><span class="p">)))</span> <span class="c1">; reserve memory</span>
<span class="p">(</span><span class="nv">strcpy</span> <span class="ss">to</span> <span class="ss">from</span><span class="p">)</span> <span class="err">→</span> <span class="s">&quot;Hello World&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>The <span class="monospaced">char*</span> type takes a string buffer only. The <span class="monospaced">"void*</span> type can take
either a string buffer or a memory address number as input. When using
<span class="monospaced">"void*"</span> as a return type the address number of the result bufffer will
be returned. This is useful when returning pointers to data structures.
These pointers can then be used with <a href="#unpack">unpack</a> and
<a href="#struct">struct</a> for destructuring. In the following example the
return type is changed to <span class="monospaced">void*</span>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">import</span> <span class="ss">LIBC</span> <span class="s">&quot;strcpy&quot;</span> <span class="s">&quot;void*&quot;</span> <span class="s">&quot;char*&quot;</span> <span class="s">&quot;char*&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">from</span> <span class="s">&quot;Hello World&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">to</span> <span class="p">(</span><span class="k">dup</span> <span class="s">&quot;\000&quot;</span> <span class="p">(</span><span class="k">length</span> <span class="ss">from</span><span class="p">)))</span>

<span class="p">(</span><span class="nv">strcpy</span> <span class="ss">to</span> <span class="ss">from</span><span class="p">)</span>       <span class="err">→</span> <span class="ss">2449424</span>
<span class="p">(</span><span class="k">address</span> <span class="ss">to</span><span class="p">)</span>           <span class="err">→</span> <span class="ss">2449424</span>
<span class="p">(</span><span class="k">unpack</span> <span class="s">&quot;s11&quot;</span> <span class="ss">2449424</span><span class="p">)</span> <span class="err">→</span> <span class="s">&quot;Hello World&quot;</span>
<span class="p">(</span><span class="k">get-string</span> <span class="ss">2449424</span><span class="p">)</span>   <span class="err">→</span> <span class="s">&quot;Hello World&quot;</span>
<span class="ss">to</span>                     <span class="err">→</span> <span class="s">&quot;Hello World&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>A newLISP string is always passed by it&#8217;s address reference.</p></div>
<div class="paragraph"><p>For a more complex example see this
<a href="http://www.newlisp.org/syntax.cgi?code/opengl-demo-ffi-lsp.txt">OpenGL
demo</a>.</p></div>
</div>
<div class="sect3">
<h4 id="_memory_management">Memory management</h4>
<div class="paragraph"><p>Any allocation performed by imported foreign functions has to be
de-allocated manually if there&#8217;s no call in the imported API to do so.
See the <a href="http://www.newlisp.org/CodePatterns.html">Code Patterns in
newLISP</a> document for an example.</p></div>
<div class="paragraph"><p>In case of calling foreign functions with passing by reference, memory
for variables needs to be allocated beforehand by newLISP — see import
of <span class="monospaced">GetWindowsDirectoryA</span> above — and hence, memory needs not be
deallocated manually, because it is managed automatically by newLISP.</p></div>
<div class="paragraph"><p><a id="inc"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_inc_a_href_destructive_a_span"><span class="big red">inc <a href="#destructive">!</a></span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (inc <em>place</em> [<em>num</em>])</p></div>
<div class="paragraph"><p>Increments the number in <em>place</em> by <span class="monospaced">1.0</span> or by the optional number
<em>num</em> and returns the result. <span class="monospaced">inc</span> performs float arithmetic and
converts integer numbers passed into floating point type.</p></div>
<div class="paragraph"><p><em>place</em> is either a symbol or a place in a list structure holding a
number, or a number returned by an expression.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">x</span> <span class="ss">0</span><span class="p">)</span>    <span class="err">→</span> <span class="ss">0</span>
<span class="p">(</span><span class="k">inc</span> <span class="ss">x</span><span class="p">)</span>       <span class="err">→</span> <span class="ss">1</span>
<span class="ss">x</span>             <span class="err">→</span> <span class="ss">1</span>
<span class="p">(</span><span class="k">inc</span> <span class="ss">x</span> <span class="ss">0.25</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">1.25</span>
<span class="ss">x</span>             <span class="err">→</span> <span class="ss">1.25</span>
<span class="p">(</span><span class="k">inc</span> <span class="ss">x</span><span class="p">)</span>       <span class="err">→</span> <span class="ss">2.25</span>
</pre></div></div></div>
<div class="paragraph"><p>If a symbol for <em>place</em> contains <span class="monospaced">nil</span>, it is treated as if containing
<span class="monospaced">0.0</span>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="ss">z</span>             <span class="err">→</span> <span class="k">nil</span>
<span class="p">(</span><span class="k">inc</span> <span class="ss">z</span><span class="p">)</span>       <span class="err">→</span> <span class="ss">1</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">z</span> <span class="k">nil</span><span class="p">)</span>
<span class="p">(</span><span class="k">inc</span> <span class="ss">z</span> <span class="ss">0.01</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">0.01</span>
</pre></div></div></div>
<div class="paragraph"><p>Places in a list structure or a number returned by another expression
can be updated too:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">l</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">))</span>

<span class="p">(</span><span class="k">inc</span> <span class="p">(</span><span class="nv">l</span> <span class="ss">3</span><span class="p">)</span> <span class="ss">0.1</span><span class="p">)</span> <span class="err">→</span> <span class="ss">4.1</span>

<span class="p">(</span><span class="k">inc</span> <span class="p">(</span><span class="k">first</span> <span class="ss">l</span><span class="p">))</span> <span class="err">→</span> <span class="ss">2</span>

<span class="ss">l</span> <span class="err">→</span> <span class="p">(</span><span class="nv">2</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">4.1</span><span class="p">)</span>

<span class="p">(</span><span class="k">inc</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">))</span> <span class="err">→</span> <span class="ss">8</span>
</pre></div></div></div>
<div class="paragraph"><p>Use the <a href="#inci">++</a> function for incrementing numbers in integer
mode. Use <a href="#dec">dec</a> to decrement numbers in floating point mode.</p></div>
<div class="paragraph"><p><a id="index"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_index_span"><span class="big red">index</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (index <em>exp-predicate</em> <em>exp-list</em>)</p></div>
<div class="paragraph"><p>Applies the predicate <em>exp-predicate</em> to each element of the list
<em>exp-list</em> and returns a list containing the indices of the elements for
which <em>exp-predicate</em> is true.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">index</span> <span class="ss">symbol?</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">d</span> <span class="ss">4</span> <span class="ss">f</span> <span class="ss">g</span> <span class="ss">5</span> <span class="ss">h</span><span class="p">))</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">2</span> <span class="ss">4</span> <span class="ss">5</span> <span class="ss">7</span><span class="p">)</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">big?</span> <span class="ss">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">&gt;</span> <span class="ss">x</span> <span class="ss">5</span><span class="p">))</span>  <span class="err">→</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">&gt;</span> <span class="ss">x</span> <span class="ss">5</span><span class="p">))</span>

<span class="p">(</span><span class="k">index</span> <span class="ss">big?</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1</span> <span class="ss">10</span> <span class="ss">3</span> <span class="ss">6</span> <span class="ss">4</span> <span class="ss">5</span> <span class="ss">11</span><span class="p">))</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">1</span> <span class="ss">3</span> <span class="ss">6</span><span class="p">)</span>

<span class="p">(</span><span class="k">select</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1</span> <span class="ss">10</span> <span class="ss">3</span> <span class="ss">6</span> <span class="ss">4</span> <span class="ss">5</span> <span class="ss">11</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1</span> <span class="ss">3</span> <span class="ss">6</span><span class="p">))</span> <span class="err">→</span> <span class="p">(</span><span class="nv">1</span> <span class="ss">3</span> <span class="ss">6</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The predicate may be a built-in predicate, a user-defined function, or a
lambda expression.</p></div>
<div class="paragraph"><p>Use the <a href="#filter">filter</a> function to return the elements themselves.</p></div>
<div class="paragraph"><p><a id="inf?"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_inf_span"><span class="big red">inf?</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (inf? <em>float</em>)</p></div>
<div class="paragraph"><p>If the value in <em>float</em> is infinite the function returns <span class="monospaced">true</span> else
<span class="monospaced">nil</span>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="nv">inf?</span> <span class="p">(</span><span class="k">div</span> <span class="ss">1</span> <span class="ss">0</span><span class="p">))</span> <span class="err">→</span> <span class="k">true</span>

<span class="p">(</span><span class="k">div</span> <span class="ss">0</span> <span class="ss">0</span><span class="p">)</span> <span class="err">→</span> <span class="ss">NaN</span>
</pre></div></div></div>
<div class="paragraph"><p>Note that an integer division by zero e.g. <span class="monospaced">(/ 1 0)</span> will throw an
"division by zero" error and not yield infinity. See also
<a href="#NaNp">NaN?</a> to check if a floating point number is valid.</p></div>
<div class="paragraph"><p><a id="int"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_int_span"><span class="big red">int</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (int <em>exp</em> [<em>exp-default</em> [<em>int-base</em>]])</p></div>
<div class="paragraph"><p>If the expression in <em>exp</em> evaluates to a number or a string, the result
is converted to an integer and returned. If <em>exp</em> cannot be converted to
an integer, then <span class="monospaced">nil</span> or the evaluation of <em>exp-default</em> will be
returned. This function is mostly used when translating strings from
user input or from parsing text. If <em>exp</em> evaluates to a string, the
string must start with a digit; one or more spaces; or the <span class="monospaced">+</span> or <span class="monospaced">-</span>
sign. The string must begin with <em><span class="monospaced">0x</span></em> for hexadecimal strings or <em><span class="monospaced">0</span></em>
(zero) for octal strings. If <em>exp</em> is invalid, <span class="monospaced">int</span> returns <span class="monospaced">nil</span> as a
default value if not otherwise specified.</p></div>
<div class="paragraph"><p>A second optional parameter can be used to force the number base of
conversion to a specific value.</p></div>
<div class="paragraph"><p>Integers larger than 9,223,372,036,854,775,807 are truncated to
9,223,372,036,854,775,807. Integers smaller than
-9,223,372,036,854,775,808 are truncated to -9,223,372,036,854,775,808.</p></div>
<div class="paragraph"><p>When converting from a float (as in the second form of <span class="monospaced">int</span>), floating
point values larger or smaller than the integer maximum or minimum are
also truncated. A floating point expression evaluating to <span class="monospaced">NaN</span> is
converted to <span class="monospaced">0</span> (zero).</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">int</span> <span class="s">&quot;123&quot;</span><span class="p">)</span>          <span class="err">→</span> <span class="ss">123</span>
<span class="p">(</span><span class="k">int</span> <span class="s">&quot; 123&quot;</span><span class="p">)</span>         <span class="err">→</span> <span class="ss">123</span>
<span class="p">(</span><span class="k">int</span> <span class="s">&quot;a123&quot;</span> <span class="ss">0</span><span class="p">)</span>       <span class="err">→</span> <span class="ss">0</span>
<span class="p">(</span><span class="k">int</span> <span class="p">(</span><span class="k">trim</span> <span class="s">&quot; 123&quot;</span><span class="p">))</span>  <span class="err">→</span> <span class="ss">123</span>
<span class="p">(</span><span class="k">int</span> <span class="s">&quot;0xFF&quot;</span><span class="p">)</span>         <span class="err">→</span> <span class="ss">255</span>
<span class="p">(</span><span class="k">int</span> <span class="s">&quot;055&quot;</span><span class="p">)</span>          <span class="err">→</span> <span class="ss">45</span>
<span class="p">(</span><span class="k">int</span> <span class="s">&quot;1.567&quot;</span><span class="p">)</span>        <span class="err">→</span> <span class="ss">1</span>
<span class="p">(</span><span class="k">int</span> <span class="ss">1.567</span><span class="p">)</span>          <span class="err">→</span> <span class="ss">1</span>

<span class="p">(</span><span class="k">integer</span><span class="ss">?</span> <span class="ss">1.00</span><span class="p">)</span>        <span class="err">→</span> <span class="k">nil</span>
<span class="p">(</span><span class="k">integer</span><span class="ss">?</span> <span class="p">(</span><span class="k">int</span> <span class="ss">1.00</span><span class="p">))</span>  <span class="err">→</span> <span class="k">true</span>

<span class="p">(</span><span class="k">int</span> <span class="s">&quot;1111&quot;</span> <span class="ss">0</span> <span class="ss">2</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">15</span>   <span class="c1">; base 2 conversion</span>
<span class="p">(</span><span class="k">int</span> <span class="s">&quot;0FF&quot;</span> <span class="ss">0</span> <span class="ss">16</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">255</span>  <span class="c1">; base 16 conversion</span>

<span class="p">(</span><span class="k">int</span> <span class="o">&#39;</span><span class="ss">xyz</span><span class="p">)</span>     <span class="err">→</span> <span class="k">nil</span>
<span class="p">(</span><span class="k">int</span> <span class="o">&#39;</span><span class="ss">xyz</span> <span class="ss">0</span><span class="p">)</span>   <span class="err">→</span> <span class="ss">0</span>
<span class="p">(</span><span class="k">int</span> <span class="k">nil</span> <span class="ss">123</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">123</span>

<span class="p">(</span><span class="k">int</span> <span class="s">&quot;abc&quot;</span> <span class="p">(</span><span class="k">throw-error</span> <span class="s">&quot;not a number&quot;</span><span class="p">))</span>
<span class="err">→</span> <span class="ss">ERR</span><span class="o">:</span> <span class="ss">user</span> <span class="ss">error</span> <span class="o">:</span> <span class="k">not</span> <span class="ss">a</span> <span class="ss">number</span>

<span class="p">(</span><span class="k">print</span> <span class="s">&quot;Enter a num:&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">num</span> <span class="p">(</span><span class="k">int</span> <span class="p">(</span><span class="k">read-</span><span class="ss">line</span><span class="p">)))</span>

<span class="p">(</span><span class="k">int</span> <span class="p">(</span><span class="k">bits</span> <span class="ss">12345</span><span class="p">)</span> <span class="ss">0</span> <span class="ss">2</span><span class="p">)</span> <span class="err">→</span> <span class="ss">12345</span>
</pre></div></div></div>
<div class="paragraph"><p>The inverse function to <span class="monospaced">int</span> with base <span class="monospaced">2</span> is <a href="#bits">bits</a>.</p></div>
<div class="paragraph"><p>Use the <a href="#float">float</a> function to convert arguments to floating
point numbers.</p></div>
<div class="paragraph"><p><a id="integer?"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_integer_span"><span class="big red">integer?</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (integer? <em>exp</em>)</p></div>
<div class="paragraph"><p>Returns <span class="monospaced">true</span> only if the value of <em>exp</em> is an integer; otherwise, it
returns <span class="monospaced">nil</span>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">num</span> <span class="ss">123</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">123</span>
<span class="p">(</span><span class="k">integer</span><span class="ss">?</span> <span class="ss">num</span><span class="p">)</span>  <span class="err">→</span> <span class="k">true</span>
</pre></div></div></div>
<div class="paragraph"><p><a id="intersect"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_intersect_span"><span class="big red">intersect</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (intersect <em>list-A</em> <em>list-B</em>)<br>
<strong>syntax:</strong> (intersect <em>list-A</em> <em>list-B</em> <em>bool</em>)</p></div>
<div class="paragraph"><p>In the first syntax, <span class="monospaced">intersect</span> returns a list containing one copy of
each element found both in <em>list-A</em> and <em>list-B</em>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">intersect</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">3</span> <span class="ss">0</span> <span class="ss">1</span> <span class="ss">3</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">4</span> <span class="ss">2</span> <span class="ss">1</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1</span> <span class="ss">4</span> <span class="ss">2</span> <span class="ss">5</span><span class="p">))</span>
<span class="err">→</span> <span class="p">(</span><span class="nv">2</span> <span class="ss">4</span> <span class="ss">1</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>In the second syntax, <span class="monospaced">intersect</span> returns a list of all elements in
<em>list-A</em> that are also in <em>list-B</em>, without eliminating duplicates in
<em>list-A</em>. <em>bool</em> is an expression evaluating to <span class="monospaced">true</span> or any other
value not <span class="monospaced">nil</span>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">intersect</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">3</span> <span class="ss">0</span> <span class="ss">1</span> <span class="ss">3</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">4</span> <span class="ss">2</span> <span class="ss">1</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1</span> <span class="ss">4</span> <span class="ss">2</span> <span class="ss">5</span><span class="p">)</span> <span class="k">true</span><span class="p">)</span>
<span class="err">→</span> <span class="p">(</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">4</span> <span class="ss">2</span> <span class="ss">1</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>See also the set functions <a href="#difference">difference</a>,
<a href="#unique">unique</a> and <a href="#union">union</a>.</p></div>
<div class="paragraph"><p><a id="invert"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_invert_span"><span class="big red">invert</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (invert <em>matrix</em> [<em>float-pivot</em>])</p></div>
<div class="paragraph"><p>Returns the inversion of a two-dimensional matrix in <em>matrix</em>. The
matrix must be square, with the same number of rows and columns, and
<em>non-singular</em> (invertible). Matrix inversion can be used to solve
systems of linear equations (e.g., multiple regression in statistics).
newLISP uses LU-decomposition of the matrix to find the inverse.</p></div>
<div class="paragraph"><p>Optionally <span class="monospaced">0.0</span> or a very small value can be specified in
<em>float-pivot</em>. This value substitutes pivot elements in the
LU-decomposition algorithm, which result in zero when the algorithm
deals with a singular matrix.</p></div>
<div class="paragraph"><p>The dimensions of a matrix are defined by the number of rows times the
number of elements in the first row. For missing elements in
non-rectangular matrices, <span class="monospaced">0.0</span> (zero) is assumed. A matrix can either
be a nested list or an <a href="#array">array</a>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">A</span> <span class="o">&#39;</span><span class="p">((</span><span class="k">-</span><span class="ss">1</span> <span class="ss">1</span> <span class="ss">1</span><span class="p">)</span> <span class="p">(</span><span class="nv">1</span> <span class="ss">4</span> <span class="k">-</span><span class="ss">5</span><span class="p">)</span> <span class="p">(</span><span class="nv">1</span> <span class="k">-</span><span class="ss">2</span> <span class="ss">0</span><span class="p">)))</span>
<span class="p">(</span><span class="k">invert</span> <span class="ss">A</span><span class="p">)</span>  <span class="err">→</span> <span class="p">((</span><span class="nv">10</span> <span class="ss">2</span> <span class="ss">9</span><span class="p">)</span> <span class="p">(</span><span class="nv">5</span> <span class="ss">1</span> <span class="ss">4</span><span class="p">)</span> <span class="p">(</span><span class="nv">6</span> <span class="ss">1</span> <span class="ss">5</span><span class="p">))</span>
<span class="p">(</span><span class="k">invert</span> <span class="p">(</span><span class="k">invert</span> <span class="ss">A</span><span class="p">))</span> <span class="err">→</span> <span class="p">((</span><span class="k">-</span><span class="ss">1</span> <span class="ss">1</span> <span class="ss">1</span><span class="p">)</span> <span class="p">(</span><span class="nv">1</span> <span class="ss">4</span> <span class="k">-</span><span class="ss">5</span><span class="p">)</span> <span class="p">(</span><span class="nv">1</span> <span class="k">-</span><span class="ss">2</span> <span class="ss">0</span><span class="p">))</span>

<span class="c1">; solve Ax = b for x</span>
<span class="p">(</span><span class="k">multiply</span> <span class="p">(</span><span class="k">invert</span> <span class="ss">A</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">1</span><span class="p">)</span> <span class="p">(</span><span class="nv">2</span><span class="p">)</span> <span class="p">(</span><span class="nv">3</span><span class="p">)))</span> <span class="err">→</span> <span class="p">((</span><span class="nv">41</span><span class="p">)</span> <span class="p">(</span><span class="nv">19</span><span class="p">)</span> <span class="p">(</span><span class="nv">23</span><span class="p">))</span>

<span class="c1">; treatment of singular matrices</span>
<span class="p">(</span><span class="k">invert</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">2</span> <span class="k">-</span><span class="ss">1</span><span class="p">)</span> <span class="p">(</span><span class="nv">4</span> <span class="k">-</span><span class="ss">2</span><span class="p">)))</span>        <span class="err">→</span> <span class="k">nil</span>
<span class="p">(</span><span class="k">invert</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">2</span> <span class="k">-</span><span class="ss">1</span><span class="p">)</span> <span class="p">(</span><span class="nv">4</span> <span class="k">-</span><span class="ss">2</span><span class="p">))</span> <span class="ss">0.0</span><span class="p">)</span>    <span class="err">→</span> <span class="p">((</span><span class="nv">inf</span> <span class="k">-</span><span class="ss">inf</span><span class="p">)</span> <span class="p">(</span><span class="nv">inf</span> <span class="k">-</span><span class="ss">inf</span><span class="p">))</span>
<span class="p">(</span><span class="k">invert</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">2</span> <span class="k">-</span><span class="ss">1</span><span class="p">)</span> <span class="p">(</span><span class="nv">4</span> <span class="k">-</span><span class="ss">2</span><span class="p">))</span> <span class="ss">1e-20</span><span class="p">)</span>  <span class="err">→</span> <span class="p">((</span><span class="nv">5e+19</span> <span class="k">-</span><span class="ss">2.5e+19</span><span class="p">)</span> <span class="p">(</span><span class="nv">1e+20</span> <span class="k">-</span><span class="ss">5e+19</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p><span class="monospaced">invert</span> will return <span class="monospaced">nil</span> if the matrix is <em>singular</em> and cannot be
inverted, and <em>float-pivot</em> is not specified.</p></div>
<div class="paragraph"><p>All operations shown here on lists can be performed on arrays, as well.</p></div>
<div class="paragraph"><p>See also the matrix functions <a href="#det">det</a>, <a href="#mat">mat</a>,
<a href="#multiply">multiply</a> and <a href="#transpose">transpose</a>.</p></div>
<div class="paragraph"><p><a id="irr"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_irr_span"><span class="big red">irr</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (irr <em>list-amounts</em> [<em>list-times</em> [<em>num-guess</em>]])</p></div>
<div class="paragraph"><p>Calculates the internal rate of return of a cash flow per time period.
The internal rate of return is the interest rate that makes the present
value of a cash flow equal to <span class="monospaced">0.0</span> (zero). In-flowing (negative values)
and out-flowing (positive values) amounts are specified in
<em>list-amounts</em>. If no time periods are specified in <em>list-times</em>,
amounts in <em>list-amounts</em> correspond to consecutive time periods
increasing by 1 (1, 2, 3—). The algorithm used is iterative, with an
initial guess of 0.5 (50 percent). Optionally, a different initial guess
can be specified. The algorithm returns when a precision of 0.000001
(0.0001 percent) is reached. <span class="monospaced">nil</span> is returned if the algorithm cannot
converge after 50 iterations.</p></div>
<div class="paragraph"><p><em>irr</em> is often used to decide between different types of investments.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">irr</span> <span class="o">&#39;</span><span class="p">(</span><span class="k">-</span><span class="ss">1000</span> <span class="ss">500</span> <span class="ss">400</span> <span class="ss">300</span> <span class="ss">200</span> <span class="ss">100</span><span class="p">))</span>
<span class="err">→</span> <span class="ss">0.2027</span>

<span class="p">(</span><span class="k">npv</span> <span class="ss">0.2027</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">500</span> <span class="ss">400</span> <span class="ss">300</span> <span class="ss">200</span> <span class="ss">100</span><span class="p">))</span>
<span class="err">→</span> <span class="ss">1000.033848</span> <span class="c1">; ~ 1000</span>

<span class="p">(</span><span class="k">irr</span> <span class="o">&#39;</span><span class="p">(</span><span class="k">-</span><span class="ss">1000</span> <span class="ss">500</span> <span class="ss">400</span> <span class="ss">300</span> <span class="ss">200</span> <span class="ss">100</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">0</span> <span class="ss">3</span> <span class="ss">4</span> <span class="ss">5</span> <span class="ss">6</span> <span class="ss">7</span><span class="p">))</span>
<span class="err">→</span> <span class="ss">0.0998</span>

<span class="p">(</span><span class="k">irr</span> <span class="o">&#39;</span><span class="p">(</span><span class="k">-</span><span class="ss">5000</span> <span class="k">-</span><span class="ss">2000</span> <span class="ss">5000</span> <span class="ss">6000</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">0</span> <span class="ss">3</span> <span class="ss">12</span> <span class="ss">18</span><span class="p">))</span>
<span class="err">→</span> <span class="ss">0.0321</span>
</pre></div></div></div>
<div class="paragraph"><p>If an initial investment of 1,000 yields 500 after the first year, 400
after two years, and so on, finally reaching <span class="monospaced">0.0</span> (zero) after five
years, then that corresponds to a yearly return of about 20.2 percent.
The next line demonstrates the relation between <span class="monospaced">irr</span> and
<a href="#npv">npv</a>. Only 9.9 percent returns are necessary when making the
first withdrawal after three years.</p></div>
<div class="paragraph"><p>In the last example, securities were initially purchased for 5,000, then
for another 2,000 three months later. After a year, securities for 5,000
are sold. Selling the remaining securities after 18 months renders
6,000. The internal rate of return is 3.2 percent per month, or about 57
percent in 18 months.</p></div>
<div class="paragraph"><p>See also the <a href="#fv">fv</a>, <a href="#nper">nper</a>, <a href="#npv">npv</a>,
<a href="#pmt">pmt</a>, and <a href="#pv">pv</a> functions.</p></div>
<div class="paragraph"><p><a id="join"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_join_span"><span class="big red">join</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (join <em>list-of-strings</em> [<em>str-joint</em> [<em>bool-trail-joint</em>]])</p></div>
<div class="paragraph"><p>Concatenates the given list of strings in <em>list-of-strings</em>. If
<em>str-joint</em> is present, it is inserted between each string in the join.
If <em>bool-trail-joint</em> is <span class="monospaced">true</span> then a joint string is also appended to
the last string.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">lst</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;this&quot;</span> <span class="s">&quot;is&quot;</span> <span class="s">&quot;a&quot;</span> <span class="s">&quot;sentence&quot;</span><span class="p">))</span>

<span class="p">(</span><span class="k">join</span> <span class="ss">lst</span> <span class="s">&quot; &quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;this is a sentence&quot;</span>

<span class="p">(</span><span class="k">join</span> <span class="p">(</span><span class="k">map</span> <span class="k">string</span> <span class="p">(</span><span class="k">slice</span> <span class="p">(</span><span class="k">now</span><span class="p">)</span> <span class="ss">0</span> <span class="ss">3</span><span class="p">))</span> <span class="s">&quot;-&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;2003-11-26&quot;</span>

<span class="p">(</span><span class="k">join</span> <span class="p">(</span><span class="k">explode</span> <span class="s">&quot;keep it together&quot;</span><span class="p">))</span>  <span class="err">→</span> <span class="s">&quot;keep it together&quot;</span>

<span class="p">(</span><span class="k">join</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;A&quot;</span> <span class="s">&quot;B&quot;</span> <span class="s">&quot;C&quot;</span><span class="p">)</span> <span class="s">&quot;-&quot;</span><span class="p">)</span>         <span class="err">→</span> <span class="s">&quot;A-B-C&quot;</span>
<span class="p">(</span><span class="k">join</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;A&quot;</span> <span class="s">&quot;B&quot;</span> <span class="s">&quot;C&quot;</span><span class="p">)</span> <span class="s">&quot;-&quot;</span> <span class="k">true</span><span class="p">)</span>    <span class="err">→</span> <span class="s">&quot;A-B-C-&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>See also the <a href="#append">append</a>, <a href="#string">string</a>, and
<a href="#explode">explode</a> functions, which are the inverse of the <span class="monospaced">join</span>
operation.</p></div>
<div class="paragraph"><p><a id="lambda"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_lambda_span"><span class="big red">lambda</span></h4>
<div class="paragraph"><p>See the description of <a href="#fn">fn</a>, which is a shorter form of writing
<span class="monospaced">lambda</span>.</p></div>
<div class="paragraph"><p><a id="lambda-macro"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_lambda_macro_span"><span class="big red">lambda-macro</span></h4>
<div class="paragraph"><p>See the description of <a href="#define-macro">define-macro</a>.</p></div>
<div class="paragraph"><p><a id="lambda?"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_lambda_span_2"><span class="big red">lambda?</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (lambda? <em>exp</em>)</p></div>
<div class="paragraph"><p>Returns <span class="monospaced">true</span> only if the value of <em>exp</em> is a lambda expression;
otherwise, returns <span class="monospaced">nil</span>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">square</span> <span class="ss">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">*</span> <span class="ss">x</span> <span class="ss">x</span><span class="p">))</span> <span class="err">→</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">*</span> <span class="ss">x</span> <span class="ss">x</span><span class="p">))</span>

<span class="ss">square</span> <span class="err">→</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">*</span> <span class="ss">x</span> <span class="ss">x</span><span class="p">))</span>

<span class="p">(</span><span class="k">lambda</span><span class="ss">?</span> <span class="ss">square</span><span class="p">)</span>  <span class="err">→</span> <span class="k">true</span>
</pre></div></div></div>
<div class="paragraph"><p>See <a href="#define">define</a> and <a href="#define-macro">define-macro</a> for more
information about <em>lambda</em> expressions.</p></div>
<div class="paragraph"><p><a id="last"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_last_a_href_utf8_capable_utf8_a_span"><span class="big red">last <a href="#utf8_capable">utf8</a></span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (last <em>list</em>)<br>
<strong>syntax:</strong> (last <em>array</em>)<br>
<strong>syntax:</strong> (last <em>str</em>)</p></div>
<div class="paragraph"><p>Returns the last element of a list or a string.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">last</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">4</span> <span class="ss">5</span><span class="p">))</span>  <span class="err">→</span> <span class="ss">5</span>
<span class="p">(</span><span class="k">last</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="p">(</span><span class="nv">c</span> <span class="ss">d</span><span class="p">)))</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">c</span> <span class="ss">d</span><span class="p">)</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">A</span> <span class="p">(</span><span class="k">array</span> <span class="ss">3</span> <span class="ss">2</span> <span class="p">(</span><span class="k">sequence</span> <span class="ss">1</span> <span class="ss">6</span><span class="p">)))</span>
<span class="err">→</span> <span class="p">((</span><span class="nv">1</span> <span class="ss">2</span><span class="p">)</span> <span class="p">(</span><span class="nv">3</span> <span class="ss">4</span><span class="p">)</span> <span class="p">(</span><span class="nv">5</span> <span class="ss">6</span><span class="p">))</span>
<span class="p">(</span><span class="k">last</span> <span class="ss">A</span><span class="p">)</span>             <span class="err">→</span> <span class="p">(</span><span class="nv">5</span> <span class="ss">6</span><span class="p">)</span>

<span class="p">(</span><span class="k">last</span> <span class="o">&#39;</span><span class="p">())</span>           <span class="err">→</span> <span class="ss">ERR</span><span class="o">:</span> <span class="k">list</span> <span class="ss">is</span> <span class="ss">empty</span>
</pre></div></div></div>
<div class="paragraph"><p>In the second version the last character in the string <em>str</em> is returned
as a string.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">last</span> <span class="s">&quot;newLISP&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;P&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>Note that <a href="#last">last</a> works on character boundaries rather than
byte boundaries when the UTF-8–enabled version of newLISP is used. See
also <a href="#first">first</a>, <a href="#rest">rest</a> and <a href="#nth">nth</a>.</p></div>
<div class="paragraph"><p><a id="last-error"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_last_error_span"><span class="big red">last-error</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (last-error)<br>
<strong>syntax:</strong> (last-error <em>int-error</em>)</p></div>
<div class="paragraph"><p>Reports the last error generated by newLISP due to syntax errors or
exhaustion of some resource. For a summary of all possible errors see
the chapter <a href="#error_codes">Error codes</a> in the appendix.</p></div>
<div class="paragraph"><p>If no error has occurred since the newLISP session was started, <span class="monospaced">nil</span> is
returned.</p></div>
<div class="paragraph"><p>When <em>int-error</em> is specified, a list of the number and the error text
is returned.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">last-error</span><span class="p">)</span>  <span class="err">→</span> <span class="k">nil</span>

<span class="p">(</span><span class="nv">abc</span><span class="p">)</span>

<span class="ss">ERR</span><span class="o">:</span> <span class="ss">invalid</span> <span class="ss">function</span> <span class="o">:</span> <span class="p">(</span><span class="nv">abc</span><span class="p">)</span>

<span class="p">(</span><span class="k">last-error</span><span class="p">)</span> <span class="err">→</span> <span class="p">(</span><span class="nv">24</span> <span class="s">&quot;ERR: invalid function : (abc)&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">last-error</span> <span class="ss">24</span><span class="p">)</span> <span class="err">→</span> <span class="p">(</span><span class="nv">24</span> <span class="s">&quot;invalid function&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">last-error</span> <span class="ss">1</span><span class="p">)</span> <span class="err">→</span> <span class="p">(</span><span class="nv">1</span> <span class="s">&quot;not enough memory&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">last-error</span> <span class="ss">12345</span><span class="p">)</span> <span class="err">→</span> <span class="p">(</span><span class="nv">12345</span> <span class="s">&quot;Unknown error&quot;</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>For error numbers out of range the string <span class="monospaced">"Unknown error"</span> is given for
the error text.</p></div>
<div class="paragraph"><p>Errors can be trapped by <a href="#error-event">error-event</a> and userdefined
error handlers.</p></div>
<div class="paragraph"><p>See also <a href="#net-error">net-error</a> for errors generated by networking
conditions and <a href="#sys-error">sys-error</a> for errors generated by the
operating system.</p></div>
<div class="paragraph"><p><a id="legal?"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_legal_span"><span class="big red">legal?</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (legal? <em>str</em>)</p></div>
<div class="paragraph"><p>The token in <em>str</em> is verified as a legal newLISP symbol. Non-legal
symbols can be created using the <a href="#sym">sym</a> function (e.g. symbols
containing spaces, quotes, or other characters not normally allowed).
Non-legal symbols are created frequently when using them for associative
data access:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="nv">symbol?</span> <span class="p">(</span><span class="k">sym</span> <span class="s">&quot;one two&quot;</span><span class="p">))</span>  <span class="err">→</span> <span class="k">true</span>

<span class="p">(</span><span class="nv">legal?</span> <span class="s">&quot;one two&quot;</span><span class="p">)</span>         <span class="err">→</span> <span class="k">nil</span>  <span class="c1">; contains a space</span>

<span class="p">(</span><span class="k">set</span> <span class="p">(</span><span class="k">sym</span> <span class="s">&quot;one two&quot;</span><span class="p">)</span> <span class="ss">123</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">123</span>

<span class="p">(</span><span class="k">eval</span> <span class="p">(</span><span class="k">sym</span> <span class="s">&quot;one two&quot;</span><span class="p">))</span>     <span class="err">→</span> <span class="ss">123</span>
</pre></div></div></div>
<div class="paragraph"><p>The example shows that the string <span class="monospaced">"one two"</span> does not contain a legal
symbol although a symbol can be created from this string and treated
like a variable.</p></div>
<div class="paragraph"><p><a id="length"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_length_span"><span class="big red">length</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (length <em>exp</em>)</p></div>
<div class="paragraph"><p>Returns the number of elements in a list, the number of rows in an
array, or the number of bytes in a string.</p></div>
<div class="paragraph"><p><span class="monospaced">length</span> applied to a symbol returns the length of the symbol name.
Applied to a number, <span class="monospaced">length</span> returns the number of bytes needed in
memory to store that number: 4 or 8 for integers and 8 for floating
point numbers.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">length</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="p">(</span><span class="nv">c</span> <span class="ss">d</span><span class="p">)</span> <span class="ss">e</span><span class="p">))</span>         <span class="err">→</span> <span class="ss">4</span>
<span class="p">(</span><span class="k">length</span> <span class="o">&#39;</span><span class="p">())</span>                    <span class="err">→</span> <span class="ss">0</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">someList</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">q</span> <span class="ss">w</span> <span class="ss">e</span> <span class="ss">r</span> <span class="ss">t</span> <span class="ss">y</span><span class="p">))</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">q</span> <span class="ss">w</span> <span class="ss">e</span> <span class="ss">r</span> <span class="ss">t</span> <span class="ss">y</span><span class="p">)</span>
<span class="p">(</span><span class="k">length</span> <span class="ss">someList</span><span class="p">)</span>               <span class="err">→</span> <span class="ss">6</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">ary</span> <span class="p">(</span><span class="k">array</span> <span class="ss">2</span> <span class="ss">4</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">0</span><span class="p">)))</span>  <span class="err">→</span> <span class="p">((</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">)</span> <span class="p">(</span><span class="nv">5</span> <span class="ss">6</span> <span class="ss">7</span> <span class="ss">8</span><span class="p">))</span>
<span class="p">(</span><span class="k">length</span> <span class="ss">ary</span><span class="p">)</span>                 <span class="err">→</span> <span class="ss">2</span>

<span class="p">(</span><span class="k">length</span> <span class="s">&quot;Hello World&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">11</span>
<span class="p">(</span><span class="k">length</span> <span class="s">&quot;&quot;</span><span class="p">)</span>             <span class="err">→</span> <span class="ss">0</span>

<span class="p">(</span><span class="k">length</span> <span class="o">&#39;</span><span class="ss">someVar</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">7</span>
<span class="p">(</span><span class="k">length</span> <span class="ss">123</span><span class="p">)</span>       <span class="err">→</span> <span class="ss">8</span>
<span class="p">(</span><span class="k">length</span> <span class="ss">1.23</span><span class="p">)</span>      <span class="err">→</span> <span class="ss">8</span>

<span class="p">(</span><span class="k">length</span> <span class="p">(</span><span class="k">get-int</span> <span class="s">&quot;\000\000\000\001&quot;</span><span class="p">))</span> <span class="err">→</span> <span class="ss">4</span>
</pre></div></div></div>
<div class="paragraph"><p>Use <a href="#utf8len">utf8len</a> to calculate the number of UTF-8 characters
in a string.</p></div>
<div class="paragraph"><p><a id="let"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_let_span"><span class="big red">let</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (let ( (<em>sym1</em> [<em>exp-init1</em>]) [(<em>sym2</em> [<em>exp-init2</em>]) &#8230; ]) <em>body</em>)<br>
<strong>syntax:</strong> (let (<em>sym1</em> <em>exp-init1</em> [<em>sym2</em> <em>exp-init2</em> &#8230; ]) <em>body</em>)</p></div>
<div class="paragraph"><p>One or more variables <em>sym1</em>, <em>sym2</em>, &#8230; are declared locally and
initialized with expressions in <em>exp-init1</em>, <em>exp-init2</em>, etc. In the
fully parenthesized first syntax, initializers are optional and assumed
<span class="monospaced">nil</span> if missing.</p></div>
<div class="paragraph"><p>When the local variables are initialized, the initializer expressions
evaluate using symbol bindings as before the <span class="monospaced">let</span> statement. To
incrementally use symbol bindings as evaluated during the initialization
of locals in <span class="monospaced">let</span>, use <a href="#letn">letn</a>.</p></div>
<div class="paragraph"><p>One or more expressions in <em>exp-body</em> are evaluated using the local
definitions of <em>sym1</em>, <em>sym2</em> etc. <span class="monospaced">let</span> is useful for breaking up
complex expressions by defining local variables close to the place where
they are used. The second form omits the parentheses around the variable
expression pairs but functions identically.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">sum-sq</span> <span class="ss">a</span> <span class="ss">b</span><span class="p">)</span>
    <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">x</span> <span class="p">(</span><span class="nv">*</span> <span class="ss">a</span> <span class="ss">a</span><span class="p">))</span> <span class="p">(</span><span class="nv">y</span> <span class="p">(</span><span class="nv">*</span> <span class="ss">b</span> <span class="ss">b</span><span class="p">)))</span>
        <span class="p">(</span><span class="nv">+</span> <span class="ss">x</span> <span class="ss">y</span><span class="p">)))</span>

<span class="p">(</span><span class="nv">sum-sq</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">)</span> <span class="err">→</span> <span class="ss">25</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">sum-sq</span> <span class="ss">a</span> <span class="ss">b</span><span class="p">)</span>           <span class="c1">; alternative syntax</span>
    <span class="p">(</span><span class="k">let</span> <span class="p">(</span><span class="nv">x</span> <span class="p">(</span><span class="nv">*</span> <span class="ss">a</span> <span class="ss">a</span><span class="p">)</span> <span class="ss">y</span> <span class="p">(</span><span class="nv">*</span> <span class="ss">b</span> <span class="ss">b</span><span class="p">))</span>
        <span class="p">(</span><span class="nv">+</span> <span class="ss">x</span> <span class="ss">y</span><span class="p">)))</span>
</pre></div></div></div>
<div class="paragraph"><p>The variables <span class="monospaced">x</span> and <span class="monospaced">y</span> are initialized, then the expression <span class="monospaced">(+ x y)</span>
is evaluated. The let form is just an optimized version and syntactic
convenience for writing:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">((</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">sym1</span> <span class="nv">[sym2 ... ]</span><span class="p">)</span> <span class="k">exp-</span><span class="ss">body</span> <span class="p">)</span> <span class="k">exp-</span><span class="ss">init1</span> <span class="nv">[ exp-init2 ]</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>See also <a href="#letn">letn</a> for an incremental or nested form of <span class="monospaced">let</span> and
local for initializing to <span class="monospaced">nil</span>.</p></div>
<div class="paragraph"><p><a id="letex"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_letex_span"><span class="big red">letex</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (letex ( (<em>sym1</em> [<em>exp-init1</em>]) [(<em>sym2</em> [<em>exp-init2</em>]) &#8230; ]) <em>body</em>)<br>
<strong>syntax:</strong> (letex (<em>sym1</em> <em>exp-init1</em> [<em>sym2</em> <em>exp-init2</em> &#8230; ]) <em>body</em>)</p></div>
<div class="paragraph"><p>This function combines <a href="#let">let</a> and <a href="#expand">expand</a> to expand
local variables into an expression before evaluating it. In the fully
parenthesized first syntax initializers are optional and assumed <span class="monospaced">nil</span>
if missing.</p></div>
<div class="paragraph"><p>Both forms provide the same functionality, but in the second form the
parentheses around the initializers can be omitted:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">letex</span> <span class="p">(</span><span class="nv">x</span> <span class="ss">1</span> <span class="ss">y</span> <span class="ss">2</span> <span class="ss">z</span> <span class="ss">3</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">x</span> <span class="ss">y</span> <span class="ss">z</span><span class="p">))</span>    <span class="err">→</span> <span class="p">(</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">3</span><span class="p">)</span>

<span class="p">(</span><span class="k">letex</span> <span class="p">(</span> <span class="p">(</span><span class="nv">x</span> <span class="ss">1</span><span class="p">)</span> <span class="p">(</span><span class="nv">y</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span><span class="p">))</span> <span class="p">(</span><span class="nv">z</span> <span class="s">&quot;hello&quot;</span><span class="p">)</span> <span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">x</span> <span class="ss">y</span> <span class="ss">z</span><span class="p">))</span>

<span class="err">→</span> <span class="p">(</span><span class="nv">1</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span><span class="p">)</span> <span class="s">&quot;hello&quot;</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Before the expression <span class="monospaced">'(x y z)</span> gets evaluated, <span class="monospaced">x, y</span> and <span class="monospaced">z</span> are
literally replaced with the initializers from the <span class="monospaced">letex</span> initializer
list. The final expression which gets evaluated is <span class="monospaced">'(1 2 3)</span>.</p></div>
<div class="paragraph"><p>In the second example a function <span class="monospaced">make-adder</span> is defined for making
adder functions:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">make-adder</span> <span class="ss">n</span><span class="p">)</span>
    <span class="p">(</span><span class="k">letex</span> <span class="p">(</span><span class="nv">c</span> <span class="ss">n</span><span class="p">)</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">x</span> <span class="ss">c</span><span class="p">))))</span>

<span class="p">(</span><span class="k">define</span> <span class="ss">add3</span> <span class="p">(</span><span class="nv">make-adder</span> <span class="ss">3</span><span class="p">))</span> <span class="err">→</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">x</span> <span class="ss">3</span><span class="p">))</span>

<span class="p">(</span><span class="nv">add3</span> <span class="ss">10</span><span class="p">)</span> <span class="err">→</span> <span class="ss">13</span>
</pre></div></div></div>
<div class="paragraph"><p><span class="monospaced">letex</span> evaluates <span class="monospaced">n</span> to the constant <span class="monospaced">3</span> and replaces <span class="monospaced">c</span> with it in
the lambda expression.</p></div>
<div class="paragraph"><p><a id="letn"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_letn_span"><span class="big red">letn</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (letn ( (<em>sym1</em> [<em>exp-init1</em>]) [(<em>sym2</em> [<em>exp-init2</em>]) &#8230; ]) <em>body</em>)<br>
<strong>syntax:</strong> (letn (<em>sym1</em> <em>exp-init1</em> [<em>sym2</em> <em>exp-init2</em> &#8230; ]) <em>body</em>)</p></div>
<div class="paragraph"><p><span class="monospaced">letn</span> is like a <em>nested let</em> and works similarly to <a href="#let">let</a>, but
will incrementally use the new symbol bindings when evaluating the
initializer expressions as if several <a href="#let">let</a> were nested. In the
fully parenthesized first syntax, initializers are optional and assumed
<span class="monospaced">nil</span> if missing.</p></div>
<div class="paragraph"><p>The following comparison of <a href="#let">let</a> and <span class="monospaced">letn</span> show the
difference:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">x</span> <span class="ss">10</span><span class="p">)</span>
<span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">x</span> <span class="ss">1</span><span class="p">)</span> <span class="p">(</span><span class="nv">y</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">x</span> <span class="ss">1</span><span class="p">)))</span>
<span class="p">(</span><span class="k">list</span> <span class="ss">x</span> <span class="ss">y</span><span class="p">))</span>           <span class="err">→</span> <span class="p">(</span><span class="nv">1</span> <span class="ss">11</span><span class="p">)</span>

<span class="p">(</span><span class="k">letn</span> <span class="p">((</span><span class="nv">x</span> <span class="ss">1</span><span class="p">)</span> <span class="p">(</span><span class="nv">y</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">x</span> <span class="ss">1</span><span class="p">)))</span>
<span class="p">(</span><span class="k">list</span> <span class="ss">x</span> <span class="ss">y</span><span class="p">))</span>          <span class="err">→</span> <span class="p">(</span><span class="nv">1</span> <span class="ss">2</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>While in the first example using <a href="#let">let</a> the variable <span class="monospaced">y</span> is
calculated using the binding of <span class="monospaced">x</span> before the <a href="#let">let</a>
expression, in the second example using <span class="monospaced">letn</span> the variable <span class="monospaced">y</span> is
calculated using the new local binding of <span class="monospaced">x</span>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">letn</span>  <span class="p">(</span><span class="nv">x</span> <span class="ss">1</span> <span class="ss">y</span> <span class="ss">x</span><span class="p">)</span>
<span class="p">(</span><span class="nv">+</span> <span class="ss">x</span> <span class="ss">y</span><span class="p">))</span>             <span class="err">→</span>  <span class="ss">2</span>

<span class="c1">;; same as nested let&#39;s</span>

<span class="p">(</span><span class="k">let</span> <span class="p">(</span><span class="nv">x</span> <span class="ss">1</span><span class="p">)</span>
<span class="p">(</span><span class="k">let</span> <span class="p">(</span><span class="nv">y</span> <span class="ss">x</span><span class="p">)</span>
<span class="p">(</span><span class="nv">+</span> <span class="ss">x</span> <span class="ss">y</span><span class="p">)))</span>       <span class="err">→</span>  <span class="ss">2</span>
</pre></div></div></div>
<div class="paragraph"><p><span class="monospaced">letn</span> works like several <em>nested</em> <a href="#let">let</a>. The parentheses
around the initializer expressions can be omitted.</p></div>
<div class="paragraph"><p><a id="list"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_list_span"><span class="big red">list</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (list <em>exp-1</em> [<em>exp-2</em> &#8230; ])</p></div>
<div class="paragraph"><p>The <em>exp</em> are evaluated and the values used to construct a new list.
Note that arguments of array type are converted to lists.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">list</span> <span class="ss">1</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">4</span> <span class="ss">5</span><span class="p">)</span>                <span class="err">→</span> <span class="p">(</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">4</span> <span class="ss">5</span><span class="p">)</span>
<span class="p">(</span><span class="k">list</span> <span class="o">&#39;</span><span class="ss">a</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">b</span> <span class="ss">c</span><span class="p">)</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">()</span> <span class="o">&#39;</span><span class="ss">*</span><span class="p">)</span> <span class="err">→</span> <span class="p">(</span><span class="nv">a</span> <span class="p">(</span><span class="nv">b</span> <span class="ss">c</span><span class="p">)</span> <span class="ss">7</span> <span class="p">()</span> <span class="ss">*</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>See also <a href="#cons">cons</a> and <a href="#push">push</a> for other forms of
building lists.</p></div>
<div class="paragraph"><p><a id="list?"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_list_span_2"><span class="big red">list?</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (list? <em>exp</em>)</p></div>
<div class="paragraph"><p>Returns <span class="monospaced">true</span> only if the value of <em>exp</em> is a list; otherwise returns
<span class="monospaced">nil</span>. Note that lambda and lambda-macro expressions are also recognized
as special instances of a list expression.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">var</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">))</span>    <span class="err">→</span> <span class="p">(</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">)</span>
<span class="p">(</span><span class="k">list</span><span class="ss">?</span> <span class="ss">var</span><span class="p">)</span>              <span class="err">→</span> <span class="k">true</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">double</span> <span class="ss">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">x</span> <span class="ss">x</span><span class="p">))</span>

<span class="p">(</span><span class="k">list</span><span class="ss">?</span> <span class="ss">double</span><span class="p">)</span>           <span class="err">→</span> <span class="k">true</span>
</pre></div></div></div>
<div class="paragraph"><p><a id="load"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_load_span"><span class="big red">load</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (load <em>str-file-name-1</em> [<em>str-file-name-2</em> &#8230; ] [<em>sym-context</em>])</p></div>
<div class="paragraph"><p>Loads and translates newLISP from a source file specified in one or more
<em>str-file-name</em> and evaluates the expressions contained in the file(s).
When loading is successful, <span class="monospaced">load</span> returns the result of the last
expression in the last file evaluated. If a file cannot be loaded,
<span class="monospaced">load</span> throws an error.</p></div>
<div class="paragraph"><p>An optional <em>sym-context</em> can be specified, which becomes the context of
evaluation, unless such a context switch is already present in the file
being loaded. By default, files which do not contain
<a href="#context">context</a> switches will be loaded into the <span class="monospaced">MAIN</span> context.</p></div>
<div class="paragraph"><p>The <em>str-file-name</em> specs can contain URLs. Both <span class="monospaced">http://</span> and
` file://` URLs are supported.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">load</span> <span class="s">&quot;myfile.lsp&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">load</span> <span class="s">&quot;a-file.lsp&quot;</span> <span class="s">&quot;b-file.lsp&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">load</span> <span class="s">&quot;file.lsp&quot;</span> <span class="s">&quot;http://mysite.org/mypro&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">load</span> <span class="s">&quot;http://192.168.0.21:6000//home/test/program.lsp&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">load</span> <span class="s">&quot;a-file.lsp&quot;</span> <span class="s">&quot;b-file.lsp&quot;</span> <span class="o">&#39;</span><span class="ss">MyCTX</span><span class="p">)</span>

<span class="p">(</span><span class="k">load</span> <span class="s">&quot;file:///usr/share/newlisp/mysql.lsp&quot;</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>In case expressions evaluated during the <span class="monospaced">load</span> are changing the
<a href="#context">context</a>, this will not influence the programming module
doing the <span class="monospaced">load</span>.</p></div>
<div class="paragraph"><p>The current context after the <span class="monospaced">load</span> statement will always be the same
as before the <span class="monospaced">load</span>.</p></div>
<div class="paragraph"><p>Normal file specs and URLs can be mixed in the same load command.</p></div>
<div class="paragraph"><p><span class="monospaced">load</span> with <span class="monospaced">HTTP</span> URLs can also be used to load code remotely from
newLISP server nodes running on a Unix-like operating system. In this
mode, <span class="monospaced">load</span> will issue an HTTP GET request to the target URL. Note that
a double backslash is required when path names are specified relative to
the root directory. <span class="monospaced">load</span> in <span class="monospaced">HTTP</span> mode will observe a 60-second
timeout.</p></div>
<div class="paragraph"><p>The second to last line causes the files to be loaded into the context
<span class="monospaced">MyCTX</span>. The quote forces the context to be created if it did not exist.</p></div>
<div class="paragraph"><p>The <span class="monospaced">file://</span> URL is followed by a third <span class="monospaced">/</span> for the directory spec.</p></div>
<div class="paragraph"><p><a id="log"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_log_span"><span class="big red">log</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (log <em>num</em>)<br>
<strong>syntax:</strong> (log <em>num</em> <em>num-base</em>)</p></div>
<div class="paragraph"><p>In the first syntax, the expression in <em>num</em> is evaluated and the
natural logarithmic function is calculated from the result.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">log</span> <span class="ss">1</span><span class="p">)</span>         <span class="err">→</span> <span class="ss">0</span>
<span class="p">(</span><span class="k">log</span> <span class="p">(</span><span class="k">exp</span> <span class="ss">1</span><span class="p">))</span>   <span class="err">→</span> <span class="ss">1</span>
</pre></div></div></div>
<div class="paragraph"><p>In the second syntax, an arbitrary base can be specified in <em>num-base</em>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">log</span> <span class="ss">1024</span> <span class="ss">2</span><span class="p">)</span>             <span class="err">→</span> <span class="ss">10</span>
<span class="p">(</span><span class="k">log</span> <span class="p">(</span><span class="k">exp</span> <span class="ss">1</span><span class="p">)</span> <span class="p">(</span><span class="k">exp</span> <span class="ss">1</span><span class="p">))</span>    <span class="err">→</span>  <span class="ss">1</span>
</pre></div></div></div>
<div class="paragraph"><p>See also <a href="#exp">exp</a>, which is the inverse function to <span class="monospaced">log</span> with
base <strong><em>e</em></strong> (2.718281828).</p></div>
<div class="paragraph"><p><a id="lookup"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_lookup_span"><span class="big red">lookup</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (lookup <em>exp-key</em> <em>list-assoc</em> [<em>int-index</em> [<em>exp-default</em>]])</p></div>
<div class="paragraph"><p>Finds in <em>list-assoc</em> an association, the key element of which has the
same value as <em>exp-key</em>, and returns the <em>int-index</em> element of
association (or the last element if <em>int-index</em> is absent).</p></div>
<div class="paragraph"><p>Optionally, <em>exp-default</em> can be specified, which is returned if an
association matching <em>exp-key</em> cannot be found. If the <em>exp-default</em> is
absent and no association has been found, <span class="monospaced">nil</span> is returned.</p></div>
<div class="paragraph"><p>See also <a href="#indexing">Indexing elements of strings and lists</a>.</p></div>
<div class="paragraph"><p><span class="monospaced">lookup</span> is similar to <a href="#assoc">assoc</a> but goes one step further by
extracting a specific element found in the list.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">params</span> <span class="o">&#39;</span><span class="p">(</span>
    <span class="p">(</span><span class="nv">name</span> <span class="s">&quot;John Doe&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">age</span> <span class="ss">35</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">gender</span> <span class="s">&quot;M&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">balance</span> <span class="ss">12.34</span><span class="p">)</span>
<span class="p">))</span>

<span class="p">(</span><span class="k">lookup</span> <span class="o">&#39;</span><span class="ss">age</span> <span class="ss">params</span><span class="p">)</span>             <span class="err">→</span> <span class="ss">35</span>

<span class="c1">; use together with setf to modify and association list</span>
<span class="p">(</span><span class="k">setf</span> <span class="p">(</span><span class="k">lookup</span> <span class="o">&#39;</span><span class="ss">age</span> <span class="ss">params</span><span class="p">)</span> <span class="ss">42</span><span class="p">)</span>   <span class="err">→</span> <span class="ss">42</span>
<span class="p">(</span><span class="k">lookup</span> <span class="o">&#39;</span><span class="ss">age</span> <span class="ss">params</span><span class="p">)</span>             <span class="err">→</span> <span class="ss">42</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">persons</span> <span class="o">&#39;</span><span class="p">(</span>
    <span class="p">(</span><span class="s">&quot;John Doe&quot;</span> <span class="ss">35</span> <span class="s">&quot;M&quot;</span> <span class="ss">12.34</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&quot;Mickey Mouse&quot;</span> <span class="ss">65</span> <span class="s">&quot;N&quot;</span> <span class="ss">12345678</span><span class="p">)</span>
<span class="p">))</span>

<span class="p">(</span><span class="k">lookup</span> <span class="s">&quot;Mickey Mouse&quot;</span> <span class="ss">persons</span> <span class="ss">2</span><span class="p">)</span>    <span class="err">→</span> <span class="s">&quot;N&quot;</span>
<span class="p">(</span><span class="k">lookup</span> <span class="s">&quot;Mickey Mouse&quot;</span> <span class="ss">persons</span> <span class="k">-</span><span class="ss">3</span><span class="p">)</span>   <span class="err">→</span> <span class="ss">65</span>
<span class="p">(</span><span class="k">lookup</span> <span class="s">&quot;John Doe&quot;</span> <span class="ss">persons</span> <span class="ss">1</span><span class="p">)</span>        <span class="err">→</span> <span class="ss">35</span>
<span class="p">(</span><span class="k">lookup</span> <span class="s">&quot;John Doe&quot;</span> <span class="ss">persons</span> <span class="k">-</span><span class="ss">2</span><span class="p">)</span>       <span class="err">→</span> <span class="s">&quot;M&quot;</span>

<span class="p">(</span><span class="k">lookup</span> <span class="s">&quot;Jane Doe&quot;</span> <span class="ss">persons</span> <span class="ss">1</span> <span class="s">&quot;N/A&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;N/A&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>See also <a href="#assoc">assoc</a></p></div>
<div class="paragraph" id="lower-case"><p><a id="lower-case"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_lower_case_a_href_utf8_capable_utf8_a_span"><span class="big red">lower-case <a href="#utf8_capable">utf8</a></span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (lower-case <em>str</em>)</p></div>
<div class="paragraph"><p>Converts the characters of the string in <em>str</em> to lowercase. A new
string is created, and the original is left unaltered.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">lower-case</span> <span class="s">&quot;HELLO WORLD&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;hello world&quot;</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">Str</span> <span class="s">&quot;ABC&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">lower-case</span> <span class="ss">Str</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;abc&quot;</span>
<span class="ss">Str</span>               <span class="err">→</span> <span class="s">&quot;ABC&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>See also the <a href="#upper-case">upper-case</a> and
<a href="#title-case">title-case</a> functions.</p></div>
<div class="paragraph"><p><a id="macro?"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_macro_span"><span class="big red">macro?</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (macro? <em>exp</em>)</p></div>
<div class="paragraph"><p>returns <span class="monospaced">true</span> if <em>exp</em> evaluates to a lambda-macro expression;
otherwise, <span class="monospaced">nil</span> is returned.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">define-macro</span> <span class="p">(</span><span class="nv">mysetq</span> <span class="ss">lv</span> <span class="ss">rv</span><span class="p">)</span> <span class="p">(</span><span class="k">set</span> <span class="ss">lv</span> <span class="p">(</span><span class="k">eval</span> <span class="ss">rv</span><span class="p">)))</span>

<span class="p">(</span><span class="nv">macro?</span> <span class="ss">mysetq</span><span class="p">)</span>  <span class="err">→</span> <span class="k">true</span>
</pre></div></div></div>
<div class="paragraph"><p><a id="main-args"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_main_args_span"><span class="big red">main-args</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (main-args)<br>
<strong>syntax:</strong> (main-args <em>int-index</em>)</p></div>
<div class="paragraph"><p><span class="monospaced">main-args</span> returns a list with several string members, one for program
invocation and one for each of the command-line arguments.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="ss">newlisp</span> <span class="ss">1</span> <span class="ss">2</span> <span class="ss">3</span>

<span class="ss">&gt;</span> <span class="p">(</span><span class="k">main-args</span><span class="p">)</span>
<span class="p">(</span><span class="s">&quot;/usr/bin/newlisp&quot;</span> <span class="s">&quot;1&quot;</span> <span class="s">&quot;2&quot;</span> <span class="s">&quot;3&quot;</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>After <span class="monospaced">newlisp 1 2 3</span> is executed at the command prompt, <span class="monospaced">main-args</span>
returns a list containing the name of the invoking program and three
command-line arguments.</p></div>
<div class="paragraph"><p>Optionally, <span class="monospaced">main-args</span> can take an <em>int-index</em> for indexing into the
list. Note that an index out of range will cause <span class="monospaced">nil</span> to be returned,
not the last element of the list like in list-indexing.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="ss">newlisp</span> <span class="ss">a</span> <span class="ss">b</span> <span class="ss">c</span>

<span class="ss">&gt;</span> <span class="p">(</span><span class="k">main-args</span> <span class="ss">0</span><span class="p">)</span>
<span class="s">&quot;/usr/bin/newlisp&quot;</span>
<span class="ss">&gt;</span> <span class="p">(</span><span class="k">main-args</span> <span class="k">-</span><span class="ss">1</span><span class="p">)</span>
<span class="s">&quot;c&quot;</span>
<span class="ss">&gt;</span> <span class="p">(</span><span class="k">main-args</span> <span class="ss">2</span><span class="p">)</span>
<span class="s">&quot;b&quot;</span>
<span class="ss">&gt;</span> <span class="p">(</span><span class="k">main-args</span> <span class="ss">10</span><span class="p">)</span>
<span class="k">nil</span>
</pre></div></div></div>
<div class="paragraph"><p>Note that when newLISP is executed from a script, <span class="monospaced">main-args</span> also
returns the <em>name</em> of the script as the second argument:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="cp">#!/usr/bin/newlisp</span>
<span class="c1">#</span>
<span class="c1"># script to show the effect of &#39;main-args&#39; in script file</span>

<span class="p">(</span><span class="k">print</span> <span class="p">(</span><span class="k">main-args</span><span class="p">)</span> <span class="s">&quot;\n&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">exit</span><span class="p">)</span>

<span class="c1"># end of script file</span>

<span class="c1">;; execute script in the OS shell:</span>

<span class="ss">script</span> <span class="ss">1</span> <span class="ss">2</span> <span class="ss">3</span>

<span class="p">(</span><span class="s">&quot;/usr/bin/newlisp&quot;</span> <span class="s">&quot;./script&quot;</span> <span class="s">&quot;1&quot;</span> <span class="s">&quot;2&quot;</span> <span class="s">&quot;3&quot;</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Try executing this script with different command-line parameters.</p></div>
<div class="paragraph"><p><a id="make-dir"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_make_dir_span"><span class="big red">make-dir</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (make-dir <em>str-dir-name</em> [<em>int-mode</em>])</p></div>
<div class="paragraph"><p>Creates a directory as specified in <em>str-dir-name</em>, with the optional
access mode <em>int-mode</em>. Returns <span class="monospaced">true</span> or <span class="monospaced">nil</span> depending on the
outcome. If no access mode is specified, most Unix systems default to
<span class="monospaced">drwxr-xr-x</span>.</p></div>
<div class="paragraph"><p>On Unix systems, the access mode specified will also be masked by the
OS&#8217;s <em>user-mask</em> set by the system administrator. The <em>user-mask</em> can be
retrieved on Unix systems using the command <span class="monospaced">umask</span> and is usually
<span class="monospaced">0022</span> (octal), which masks write (and creation) permission for
non-owners of the file.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">;; 0 (zero) in front of 750 makes it an octal number</span>

<span class="p">(</span><span class="k">make-dir</span> <span class="s">&quot;adir&quot;</span> <span class="ss">0750</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>This example creates a directory named <span class="monospaced">adir</span> in the current directory
with an access mode of <span class="monospaced">0750</span> (octal 750 = <span class="monospaced">drwxr-x---</span>).</p></div>
<div class="paragraph"><p><a id="map"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_map_span"><span class="big red">map</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (map <em>exp-functor</em> <em>list-args-1</em> [<em>list-args-2</em> &#8230; ])</p></div>
<div class="paragraph"><p>Successively applies the primitive function, defined function, or lambda
expression <em>exp-functor</em> to the arguments specified in <em>list-args-1,
list-args-2—</em>, returning all results in a list.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">map</span> <span class="ss">+</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">3</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">50</span> <span class="ss">60</span> <span class="ss">70</span><span class="p">))</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">51</span> <span class="ss">62</span> <span class="ss">73</span><span class="p">)</span>

<span class="p">(</span><span class="k">map</span> <span class="k">if</span> <span class="o">&#39;</span><span class="p">(</span><span class="k">true</span> <span class="k">nil</span> <span class="k">true</span> <span class="k">nil</span> <span class="k">true</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">4</span> <span class="ss">5</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">6</span> <span class="ss">7</span> <span class="ss">8</span> <span class="ss">9</span> <span class="ss">10</span><span class="p">))</span>
<span class="err">→</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1</span> <span class="ss">7</span> <span class="ss">3</span> <span class="ss">9</span> <span class="ss">5</span><span class="p">)</span>

<span class="p">(</span><span class="k">map</span> <span class="p">(</span><span class="k">fn</span> <span class="p">(</span><span class="nv">x</span> <span class="ss">y</span><span class="p">)</span> <span class="p">(</span><span class="nv">*</span> <span class="ss">x</span> <span class="ss">y</span><span class="p">))</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">3</span> <span class="ss">4</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">20</span> <span class="ss">10</span><span class="p">))</span>
<span class="err">→</span> <span class="p">(</span><span class="nv">60</span> <span class="ss">40</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The second example shows how to dynamically create a function for <span class="monospaced">map</span>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">foo</span> <span class="ss">op</span> <span class="ss">p</span><span class="p">)</span>
    <span class="p">(</span><span class="k">append</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span><span class="p">))</span> <span class="p">(</span><span class="k">list</span> <span class="p">(</span><span class="k">list</span> <span class="ss">op</span> <span class="ss">p</span> <span class="o">&#39;</span><span class="ss">x</span><span class="p">))))</span>
</pre></div></div></div>
<div class="paragraph"><p>We can also use the shorter <span class="monospaced">fn</span>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">foo</span> <span class="ss">op</span> <span class="ss">p</span><span class="p">)</span>
    <span class="p">(</span><span class="k">append</span> <span class="p">(</span><span class="k">fn</span> <span class="p">(</span><span class="nv">x</span><span class="p">))</span> <span class="p">(</span><span class="k">list</span> <span class="p">(</span><span class="k">list</span> <span class="ss">op</span> <span class="ss">p</span> <span class="o">&#39;</span><span class="ss">x</span><span class="p">))))</span>
</pre></div></div></div>
<div class="paragraph"><p><span class="monospaced">foo</span> now works like a function-maker:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="nv">foo</span> <span class="o">&#39;</span><span class="k">add</span> <span class="ss">2</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="k">add</span> <span class="ss">2</span> <span class="ss">x</span><span class="p">))</span>

<span class="p">(</span><span class="k">map</span> <span class="p">(</span><span class="nv">foo</span> <span class="k">add</span> <span class="ss">2</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">4</span> <span class="ss">5</span><span class="p">))</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">3</span> <span class="ss">4</span> <span class="ss">5</span> <span class="ss">6</span> <span class="ss">7</span><span class="p">)</span>

<span class="p">(</span><span class="k">map</span> <span class="p">(</span><span class="nv">foo</span> <span class="k">mul</span> <span class="ss">3</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">4</span> <span class="ss">5</span><span class="p">))</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">3</span> <span class="ss">6</span> <span class="ss">9</span> <span class="ss">12</span> <span class="ss">15</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Note that the quote before the operand can be omitted because primitives
evaluate to themselves in newLISP.</p></div>
<div class="paragraph"><p>By incorporating <span class="monospaced">map</span> into the function definition, we can do the
following:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="k">list-map</span> <span class="ss">op</span> <span class="ss">p</span> <span class="ss">lst</span><span class="p">)</span>
    <span class="p">(</span><span class="k">map</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">op</span> <span class="ss">p</span> <span class="ss">x</span><span class="p">))</span> <span class="ss">lst</span><span class="p">))</span>

<span class="p">(</span><span class="k">list-map</span> <span class="ss">+</span> <span class="ss">2</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">))</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">3</span> <span class="ss">4</span> <span class="ss">5</span> <span class="ss">6</span><span class="p">)</span>

<span class="p">(</span><span class="k">list-map</span> <span class="k">mul</span> <span class="ss">1.5</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">))</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">1.5</span> <span class="ss">3</span> <span class="ss">4.5</span> <span class="ss">6</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p><span class="monospaced">map</span> also sets the internal list index <span class="monospaced">$idx</span>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">map</span> <span class="p">(</span><span class="k">fn</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="k">list</span> <span class="k">$</span><span class="ss">idx</span> <span class="ss">x</span><span class="p">))</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span><span class="p">))</span> <span class="err">→</span> <span class="p">((</span><span class="nv">0</span> <span class="ss">a</span><span class="p">)</span> <span class="p">(</span><span class="nv">1</span> <span class="ss">b</span><span class="p">)</span> <span class="p">(</span><span class="nv">2</span> <span class="ss">c</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p>The number of arguments used is determined by the length of the first
argument list. Arguments missing in other argument lists cause map to
stop collecting parameters for that level of arguments. This ensures
that the nth parameter list gets converted to the nth column during the
transposition occurring. If an argument list contains too many elements,
the extra ones will be ignored.</p></div>
<div class="paragraph"><p>Special forms which use parentheses as syntax cannot be mapped (i.e.
<a href="#case">case</a>).</p></div>
<div class="paragraph"><p><a id="mat"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_mat_span"><span class="big red">mat</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (mat <em>+</em> | <em>-</em> | <em>*</em> | <em>/</em> <em>matrix-A matrix-B</em>)<br>
<strong>syntax:</strong> (mat <em>+</em> | <em>-</em> | <em>*</em> | <em>/</em> <em>matrix-A number</em>)</p></div>
<div class="paragraph"><p>Using the first syntax, this function performs fast floating point
scalar operations on two-dimensional matrices in <em>matrix-A</em> or
<em>matrix-B</em>. The type of operation is specified by one of the four
arithmetic operators <span class="monospaced">+</span>, <span class="monospaced">-</span>, <span class="monospaced">*</span>, or <span class="monospaced">/</span>. This type of arithmetic
operator is typically used for integer operations in newLISP. In the
case of <span class="monospaced">mat</span>, however, all operations will be performed as floating
point operations (<span class="monospaced">add</span>, <span class="monospaced">sub</span>, <span class="monospaced">mul</span>, <span class="monospaced">div</span>).</p></div>
<div class="paragraph"><p>Matrices in newLISP are two-dimensional lists or arrays. Internally,
newLISP translates lists and arrays into fast, accessible C-language
data objects. This makes matrix operations in newLISP as fast as those
coded directly in C. The same is true for the matrix operations
<a href="#multiply">multiply</a> and <a href="#invert">invert</a>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">A</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">3</span><span class="p">)</span> <span class="p">(</span><span class="nv">4</span> <span class="ss">5</span> <span class="ss">6</span><span class="p">)))</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">B</span> <span class="ss">A</span><span class="p">)</span>

<span class="p">(</span><span class="k">mat</span> <span class="ss">+</span> <span class="ss">A</span> <span class="ss">B</span><span class="p">)</span>    <span class="err">→</span> <span class="p">((</span><span class="nv">2</span> <span class="ss">4</span> <span class="ss">6</span><span class="p">)</span> <span class="p">(</span><span class="nv">8</span> <span class="ss">10</span> <span class="ss">12</span><span class="p">))</span>
<span class="p">(</span><span class="k">mat</span> <span class="ss">-</span> <span class="ss">A</span> <span class="ss">B</span><span class="p">)</span>    <span class="err">→</span> <span class="p">((</span><span class="nv">0</span> <span class="ss">0</span> <span class="ss">0</span><span class="p">)</span> <span class="p">(</span><span class="nv">0</span> <span class="ss">0</span> <span class="ss">0</span><span class="p">))</span>
<span class="p">(</span><span class="k">mat</span> <span class="ss">*</span> <span class="ss">A</span> <span class="ss">B</span><span class="p">)</span>    <span class="err">→</span> <span class="p">((</span><span class="nv">1</span> <span class="ss">4</span> <span class="ss">9</span><span class="p">)</span> <span class="p">(</span><span class="nv">16</span> <span class="ss">25</span> <span class="ss">36</span><span class="p">))</span>
<span class="p">(</span><span class="k">mat</span> <span class="ss">/</span> <span class="ss">A</span> <span class="ss">B</span><span class="p">)</span>    <span class="err">→</span> <span class="p">((</span><span class="nv">1</span> <span class="ss">1</span> <span class="ss">1</span><span class="p">)</span> <span class="p">(</span><span class="nv">1</span> <span class="ss">1</span> <span class="ss">1</span><span class="p">))</span>

<span class="c1">; specify the operator in a variable</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">op</span> <span class="ss">+</span><span class="p">)</span>
<span class="p">(</span><span class="k">mat</span> <span class="ss">op</span> <span class="ss">A</span> <span class="ss">B</span><span class="p">)</span>    <span class="err">→</span> <span class="p">((</span><span class="nv">2</span> <span class="ss">4</span> <span class="ss">6</span><span class="p">)</span> <span class="p">(</span><span class="nv">8</span> <span class="ss">10</span> <span class="ss">12</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p>Using the second syntax, all cells in <em>matrix-A</em> are operated on with a
scalar in <em>number</em>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">mat</span> <span class="ss">+</span> <span class="ss">A</span> <span class="ss">5</span><span class="p">)</span>    <span class="err">→</span> <span class="p">((</span><span class="nv">6</span> <span class="ss">7</span> <span class="ss">8</span><span class="p">)</span> <span class="p">(</span><span class="nv">9</span> <span class="ss">10</span> <span class="ss">11</span><span class="p">))</span>
<span class="p">(</span><span class="k">mat</span> <span class="ss">-</span> <span class="ss">A</span> <span class="ss">2</span><span class="p">)</span>    <span class="err">→</span> <span class="p">((</span><span class="k">-</span><span class="ss">1</span> <span class="ss">0</span> <span class="ss">1</span><span class="p">)</span> <span class="p">(</span><span class="nv">2</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">))</span>
<span class="p">(</span><span class="k">mat</span> <span class="ss">*</span> <span class="ss">A</span> <span class="ss">3</span><span class="p">)</span>    <span class="err">→</span> <span class="p">((</span><span class="nv">3</span> <span class="ss">6</span> <span class="ss">9</span><span class="p">)</span> <span class="p">(</span><span class="nv">12</span> <span class="ss">15</span> <span class="ss">18</span><span class="p">))</span>
<span class="p">(</span><span class="k">mat</span> <span class="ss">/</span> <span class="ss">A</span> <span class="ss">10</span><span class="p">)</span>   <span class="err">→</span> <span class="p">((</span><span class="nv">.1</span> <span class="ss">.2</span> <span class="ss">.3</span><span class="p">)</span> <span class="p">(</span><span class="nv">.4</span> <span class="ss">.5</span> <span class="ss">.6</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p>See also the other matrix operations <a href="#det">det</a>,
<a href="#invert">invert</a>, <a href="#multiply">multiply</a>, and
<a href="#transpose">transpose</a>.</p></div>
<div class="paragraph"><p><a id="match"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_match_span"><span class="big red">match</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (match <em>list-pattern</em> <em>list-match</em> [<em>bool</em>])</p></div>
<div class="paragraph"><p>The pattern in <em>list-pattern</em> is matched against the list in
<em>list-match</em>, and the matching expressions are returned in a list. The
three wildcard characters <span class="monospaced">?</span>, <span class="monospaced">+</span>, and <span class="monospaced">*</span> can be used in
<em>list-pattern</em>.</p></div>
<div class="paragraph"><p>Wildcard characters may be nested. <span class="monospaced">match</span> returns a list of matched
expressions. For each <span class="monospaced">?</span> (question mark), a matching expression element
is returned. For each <span class="monospaced">+</span> (plus sign) or <span class="monospaced">*</span> (asterisk), a list
containing the matched elements is returned. If the pattern cannot be
matched against the list in <em>list-match</em>, <span class="monospaced">match</span> returns <span class="monospaced">nil</span>. If no
wildcard characters are present in the pattern an empty list is
returned.</p></div>
<div class="paragraph"><p>Optionally, the Boolean value <span class="monospaced">true</span> (or any other expression not
evaluating to <span class="monospaced">nil</span>) can be supplied as a third argument. This causes
<span class="monospaced">match</span> to show all elements in the returned result.</p></div>
<div class="paragraph"><p><span class="monospaced">match</span> is frequently employed as a functor parameter in
<a href="#find">find</a>, <a href="#ref">ref</a>, <a href="#ref-all">ref-all</a> and
<a href="#replace">replace</a> and is internally used by
<a href="#find-all">find-all</a> for lists.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">match</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">?</span> <span class="ss">c</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span><span class="p">))</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">b</span><span class="p">)</span>

<span class="p">(</span><span class="k">match</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">?</span> <span class="ss">?</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span><span class="p">))</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">b</span> <span class="ss">c</span><span class="p">)</span>

<span class="p">(</span><span class="k">match</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">?</span> <span class="ss">c</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="p">(</span><span class="nv">x</span> <span class="ss">y</span> <span class="ss">z</span><span class="p">)</span> <span class="ss">c</span><span class="p">))</span>  <span class="err">→</span> <span class="p">((</span><span class="nv">x</span> <span class="ss">y</span> <span class="ss">z</span><span class="p">))</span>

<span class="p">(</span><span class="k">match</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">?</span> <span class="ss">c</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="p">(</span><span class="nv">x</span> <span class="ss">y</span> <span class="ss">z</span><span class="p">)</span> <span class="ss">c</span><span class="p">)</span> <span class="k">true</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">a</span> <span class="p">(</span><span class="nv">x</span> <span class="ss">y</span> <span class="ss">z</span><span class="p">)</span> <span class="ss">c</span><span class="p">)</span>

<span class="p">(</span><span class="k">match</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">?</span> <span class="ss">c</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">x</span> <span class="ss">y</span> <span class="ss">z</span> <span class="ss">c</span><span class="p">))</span>  <span class="err">→</span> <span class="k">nil</span>

<span class="p">(</span><span class="k">match</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">*</span> <span class="ss">c</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">x</span> <span class="ss">y</span> <span class="ss">z</span> <span class="ss">c</span><span class="p">))</span>  <span class="err">→</span> <span class="p">((</span><span class="nv">x</span> <span class="ss">y</span> <span class="ss">z</span><span class="p">))</span>

<span class="p">(</span><span class="k">match</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="p">(</span><span class="nv">b</span> <span class="ss">c</span> <span class="ss">?</span><span class="p">)</span> <span class="ss">x</span> <span class="ss">y</span> <span class="ss">z</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="p">(</span><span class="nv">b</span> <span class="ss">c</span> <span class="ss">d</span><span class="p">)</span> <span class="ss">x</span> <span class="ss">y</span> <span class="ss">z</span><span class="p">))</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">d</span><span class="p">)</span>

<span class="p">(</span><span class="k">match</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="p">(</span><span class="nv">*</span><span class="p">)</span> <span class="ss">x</span> <span class="ss">?</span> <span class="ss">z</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="p">(</span><span class="nv">b</span> <span class="ss">c</span> <span class="ss">d</span><span class="p">)</span> <span class="ss">x</span> <span class="ss">y</span> <span class="ss">z</span><span class="p">))</span>  <span class="err">→</span> <span class="p">((</span><span class="nv">b</span> <span class="ss">c</span> <span class="ss">d</span><span class="p">)</span> <span class="ss">y</span><span class="p">)</span>

<span class="p">(</span><span class="k">match</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">+</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">())</span>  <span class="err">→</span> <span class="k">nil</span>

<span class="p">(</span><span class="k">match</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">+</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span><span class="p">))</span>  <span class="err">→</span> <span class="p">((</span><span class="nv">a</span><span class="p">))</span>

<span class="p">(</span><span class="k">match</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">+</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span><span class="p">))</span>  <span class="err">→</span> <span class="p">((</span><span class="nv">a</span> <span class="ss">b</span><span class="p">))</span>

<span class="p">(</span><span class="k">match</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="p">(</span><span class="nv">*</span><span class="p">)</span> <span class="ss">x</span> <span class="ss">?</span> <span class="ss">z</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="p">()</span> <span class="ss">x</span> <span class="ss">y</span> <span class="ss">z</span><span class="p">))</span>  <span class="err">→</span> <span class="p">(()</span> <span class="ss">y</span><span class="p">)</span>

<span class="p">(</span><span class="k">match</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="p">(</span><span class="nv">+</span><span class="p">)</span> <span class="ss">x</span> <span class="ss">?</span> <span class="ss">z</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="p">()</span> <span class="ss">x</span> <span class="ss">y</span> <span class="ss">z</span><span class="p">))</span>  <span class="err">→</span> <span class="k">nil</span>
</pre></div></div></div>
<div class="paragraph"><p>Note that the <span class="monospaced">*</span> operator tries to grab the fewest number of elements
possible, but <span class="monospaced">match</span> backtracks and grabs more elements if a match
cannot be found.</p></div>
<div class="paragraph"><p>The <span class="monospaced">+</span> operator works similarly to the <span class="monospaced">*</span> operator, but it requires at
least one list element.</p></div>
<div class="paragraph"><p>The following example shows how the matched expressions can be bound to
variables.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">map</span> <span class="k">set</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">x</span> <span class="ss">y</span><span class="p">)</span> <span class="p">(</span><span class="k">match</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="p">(</span><span class="nv">?</span> <span class="ss">c</span><span class="p">)</span> <span class="ss">d</span> <span class="ss">*</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="p">(</span><span class="nv">b</span> <span class="ss">c</span><span class="p">)</span> <span class="ss">d</span> <span class="ss">e</span> <span class="ss">f</span><span class="p">)))</span>

<span class="ss">x</span>  <span class="err">→</span> <span class="ss">b</span>
<span class="ss">y</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">e</span> <span class="ss">f</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Note that <span class="monospaced">match</span> for strings has been eliminated. For more powerful
string matching, use <a href="#regex">regex</a>, <a href="#find">find</a>,
<a href="#find-all">find-all</a> or <a href="#parse">parse</a>.</p></div>
<div class="paragraph"><p><a href="#unify">unify</a> is another function for matching expressions in a
PROLOG like manner.</p></div>
<div class="paragraph"><p><a id="max"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_max_span"><span class="big red">max</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (max <em>num-1</em> [<em>num-2</em> &#8230; ])</p></div>
<div class="paragraph"><p>Evaluates the expressions _num-1_— and returns the largest number.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">max</span> <span class="ss">4</span> <span class="ss">6</span> <span class="ss">2</span> <span class="ss">3.54</span> <span class="ss">7.1</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">7.1</span>
</pre></div></div></div>
<div class="paragraph"><p>See also the <a href="#min">min</a> function.</p></div>
<div class="paragraph"><p><a id="member"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_member_span"><span class="big red">member</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (member <em>exp</em> <em>list</em>)<br>
<strong>syntax:</strong> (member <em>str-key</em> <em>str</em> [<em>num-option</em>])</p></div>
<div class="paragraph"><p>In the first syntax, <span class="monospaced">member</span> searches for the element <em>exp</em> in the list
<em>list</em>. If the element is a member of the list, a new list starting with
the element found and the rest of the original list is constructed and
returned. If nothing is found, <span class="monospaced">nil</span> is returned. When specifying
<em>num-option</em>, <span class="monospaced">member</span> performs a regular expression search.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">aList</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span> <span class="ss">d</span> <span class="ss">e</span> <span class="ss">f</span> <span class="ss">g</span> <span class="ss">h</span><span class="p">))</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span> <span class="ss">d</span> <span class="ss">e</span> <span class="ss">f</span> <span class="ss">g</span> <span class="ss">h</span><span class="p">)</span>
<span class="p">(</span><span class="k">member</span> <span class="o">&#39;</span><span class="ss">d</span> <span class="ss">aList</span><span class="p">)</span>                <span class="err">→</span> <span class="p">(</span><span class="nv">d</span> <span class="ss">e</span> <span class="ss">f</span> <span class="ss">g</span> <span class="ss">h</span><span class="p">)</span>
<span class="p">(</span><span class="k">member</span> <span class="ss">55</span> <span class="ss">aList</span><span class="p">)</span>                <span class="err">→</span> <span class="k">nil</span>
</pre></div></div></div>
<div class="paragraph"><p>In the second syntax, <span class="monospaced">member</span> searches for <em>str-key</em> in <em>str</em>. If
<em>str-key</em> is found, all of <em>str</em> (starting with <em>str-key</em>) is returned.
<span class="monospaced">nil</span> is returned if nothing is found.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">member</span> <span class="s">&quot;LISP&quot;</span> <span class="s">&quot;newLISP&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;LISP&quot;</span>
<span class="p">(</span><span class="k">member</span> <span class="s">&quot;LI&quot;</span> <span class="s">&quot;newLISP&quot;</span><span class="p">)</span>    <span class="err">→</span> <span class="s">&quot;LISP&quot;</span>
<span class="p">(</span><span class="k">member</span> <span class="s">&quot;&quot;</span> <span class="s">&quot;newLISP&quot;</span><span class="p">)</span>      <span class="err">→</span> <span class="s">&quot;newLISP&quot;</span>
<span class="p">(</span><span class="k">member</span> <span class="s">&quot;xyz&quot;</span> <span class="s">&quot;newLISP&quot;</span><span class="p">)</span>   <span class="err">→</span> <span class="k">nil</span>
<span class="p">(</span><span class="k">member</span> <span class="s">&quot;li&quot;</span> <span class="s">&quot;newLISP&quot;</span> <span class="ss">1</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;LISP&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>See also the related functions <a href="#slice">slice</a> and <a href="#find">find</a>.</p></div>
<div class="paragraph"><p><a id="min"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_min_span"><span class="big red">min</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (min <em>num-1</em> [<em>num-2</em> &#8230; ])</p></div>
<div class="paragraph"><p>Evaluates the expressions _num-1_— and returns the smallest number.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">min</span> <span class="ss">4</span> <span class="ss">6</span> <span class="ss">2</span> <span class="ss">3.54</span> <span class="ss">7.1</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">2</span>
</pre></div></div></div>
<div class="paragraph"><p>See also the <a href="#max">max</a> function.</p></div>
<div class="paragraph"><p><a id="mod"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_mod_span"><span class="big red">mod</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (mod <em>num-1</em> <em>num-2</em> [<em>num-3</em> &#8230; ])<br>
<strong>syntax:</strong> (mod <em>num-1</em>)</p></div>
<div class="paragraph"><p>Calculates the modular value of the numbers in <em>num-1</em> and <em>num-2</em>.
<span class="monospaced">mod</span> computes the remainder from the division of the numerator <em>num-i</em>
by the denominator <em>num-i + 1</em>. Specifically, the return value is
<em>numerator - n * denominator</em>, where <span class="monospaced">n</span> is the quotient of the
numerator divided by the denominator, rounded towards zero to an
integer. The result has the same sign as the numerator and its magnitude
is less than the magnitude of the denominator.</p></div>
<div class="paragraph"><p>In the second syntax <span class="monospaced">1</span> is assumed for <em>num-2</em> and the result is the
fractional part of <em>num-1</em>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">mod</span> <span class="ss">10.5</span> <span class="ss">3.3</span><span class="p">)</span>   <span class="err">→</span>  <span class="ss">0.6</span>
<span class="p">(</span><span class="k">mod</span> <span class="k">-</span><span class="ss">10.5</span> <span class="ss">3.3</span><span class="p">)</span>  <span class="err">→</span> <span class="k">-</span><span class="ss">0.6</span>
<span class="p">(</span><span class="k">mod</span> <span class="k">-</span><span class="ss">10.5</span><span class="p">)</span>      <span class="err">→</span> <span class="k">-</span><span class="ss">0.5</span>
</pre></div></div></div>
<div class="paragraph"><p>Use the <a href="#arithmetic">%</a> (percent sign) function when working with
integers only.</p></div>
<div class="paragraph"><p><a id="mul"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_mul_span"><span class="big red">mul</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (mul <em>num-1</em> <em>num-2</em> [<em>num-3</em> &#8230; ])</p></div>
<div class="paragraph"><p>Evaluates all expressions _num-1_—, calculating and returning the
product. <span class="monospaced">mul</span> can perform mixed-type arithmetic, but it always returns
floating point numbers. Any floating point calculation with <span class="monospaced">NaN</span> also
returns <span class="monospaced">NaN</span>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">mul</span> <span class="ss">1</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">4</span> <span class="ss">5</span> <span class="ss">1.1</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">132</span>
<span class="p">(</span><span class="k">mul</span> <span class="ss">0.5</span> <span class="ss">0.5</span><span class="p">)</span>        <span class="err">→</span> <span class="ss">0.25</span>
</pre></div></div></div>
<div class="paragraph"><p><a id="multiply"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_multiply_span"><span class="big red">multiply</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (multiply <em>matrix-A</em> <em>matrix-B</em>)</p></div>
<div class="paragraph"><p>Returns the matrix multiplication of matrices in <em>matrix-A</em> and
<em>matrix-B</em>. If <em>matrix-A</em> has the dimensions <em>n</em> by <em>m</em> and <em>matrix-B</em>
the dimensions <em>k</em> by <em>l</em> (<em>m</em> and <em>k</em> must be equal), the result is an
<em>n</em> by <em>l</em> matrix. ` multiply` can perform mixed-type arithmetic, but
the results are always double precision floating points, even if all
input values are integers.</p></div>
<div class="paragraph"><p>The dimensions of a matrix are determined by the number of rows and the
number of elements in the first row. For missing elements in
non-rectangular matrices, <span class="monospaced">0.0</span> is assumed. A matrix can either be a
nested list or <a href="#array">array</a>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">A</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">3</span><span class="p">)</span> <span class="p">(</span><span class="nv">4</span> <span class="ss">5</span> <span class="ss">6</span><span class="p">)))</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">B</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">1</span> <span class="ss">2</span><span class="p">)</span> <span class="p">(</span><span class="nv">1</span> <span class="ss">2</span><span class="p">)</span> <span class="p">(</span><span class="nv">1</span> <span class="ss">2</span><span class="p">)))</span>
<span class="p">(</span><span class="k">multiply</span> <span class="ss">A</span> <span class="ss">B</span><span class="p">)</span>  <span class="err">→</span> <span class="p">((</span><span class="nv">6</span> <span class="ss">12</span><span class="p">)</span> <span class="p">(</span><span class="nv">15</span> <span class="ss">30</span><span class="p">))</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">v</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">10</span> <span class="ss">20</span> <span class="ss">30</span><span class="p">))</span>
<span class="p">(</span><span class="k">multiply</span> <span class="ss">A</span> <span class="p">(</span><span class="k">transpose</span> <span class="p">(</span><span class="k">list</span> <span class="ss">v</span><span class="p">)))</span> <span class="err">→</span> <span class="p">((</span><span class="nv">140</span><span class="p">)</span> <span class="p">(</span><span class="nv">320</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p>When multiplying a matrix with a vector of <span class="monospaced">n</span> elements, the vector must
be transformed into <span class="monospaced">n</span> rows by <span class="monospaced">1</span> column matrix using
<a href="#transpose">transpose</a>.</p></div>
<div class="paragraph"><p>All operations shown here on lists can be performed on arrays, as well.</p></div>
<div class="paragraph"><p>See also the matrix operations <a href="#det">det</a>, <a href="#invert">invert</a>,
<a href="#mat">mat</a> and <a href="#transpose">transpose</a>.</p></div>
<div class="paragraph"><p><a id="name"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_name_span"><span class="big red">name</span></h4>
<div class="paragraph"><p>This function is deprecated, use <a href="#term">term</a> instead.</p></div>
<div class="paragraph"><p><a id="NaN?"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_nan_span"><span class="big red">NaN?</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (NaN? <em>float</em>)</p></div>
<div class="paragraph"><p>Tests if the result of a floating point math operation is a <span class="monospaced">NaN</span>.
Certain floating point operations return a special IEEE 754 number
format called a <span class="monospaced">NaN</span> for <em>Not a Number</em>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">; floating point operation on NaN yield NaN</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">x</span> <span class="p">(</span><span class="k">sqrt</span> <span class="k">-</span><span class="ss">1</span><span class="p">))</span>  <span class="err">→</span> <span class="ss">NaN</span>
<span class="p">(</span><span class="nv">NaN?</span> <span class="ss">x</span><span class="p">)</span>            <span class="err">→</span> <span class="k">true</span>
<span class="p">(</span><span class="k">add</span> <span class="ss">x</span> <span class="ss">123</span><span class="p">)</span>         <span class="err">→</span> <span class="ss">NaN</span>
<span class="p">(</span><span class="k">mul</span> <span class="ss">x</span> <span class="ss">123</span><span class="p">)</span>         <span class="err">→</span> <span class="ss">NaN</span>

<span class="c1">; integer operations treat NaN as zero</span>
<span class="p">(</span><span class="nv">+</span> <span class="ss">x</span> <span class="ss">123</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">123</span>
<span class="p">(</span><span class="nv">*</span> <span class="ss">x</span> <span class="ss">123</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">0</span>

<span class="c1">; comparisons with NaN values yield nil</span>
<span class="p">(</span><span class="nv">&gt;</span> <span class="ss">x</span> <span class="ss">0</span><span class="p">)</span>   <span class="err">→</span> <span class="k">nil</span>
<span class="p">(</span><span class="nv">&lt;=</span> <span class="ss">x</span> <span class="ss">0</span><span class="p">)</span>  <span class="err">→</span> <span class="k">nil</span>
<span class="p">(</span><span class="nv">=</span> <span class="ss">x</span> <span class="ss">x</span><span class="p">)</span>   <span class="err">→</span> <span class="k">nil</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">infinity</span> <span class="p">(</span><span class="k">mul</span> <span class="ss">1.0e200</span> <span class="ss">1.0e200</span><span class="p">))</span> <span class="err">→</span> <span class="ss">inf</span>
<span class="p">(</span><span class="nv">NaN?</span> <span class="p">(</span><span class="k">sub</span> <span class="ss">infinity</span> <span class="ss">infinity</span><span class="p">))</span> <span class="err">→</span> <span class="k">true</span>
</pre></div></div></div>
<div class="paragraph"><p>Note that all floating point arithmetic operations with a <span class="monospaced">NaN</span> yield a
<span class="monospaced">NaN</span>. All comparisons with <span class="monospaced">NaN</span> return <span class="monospaced">nil</span>, but <span class="monospaced">true</span> when
comparing to itself. Comparison with itself, however, would result in
<em>not</em> <span class="monospaced">true</span> when using ANSI C. Integer operations treat <span class="monospaced">NaN</span> as <span class="monospaced">0</span>
(zero) values.</p></div>
<div class="paragraph"><p>See also <a href="#infp">inf?</a> for testing a floating point value for
infinity.</p></div>
<div class="paragraph"><p><a id="net-accept"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_net_accept_span"><span class="big red">net-accept</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (net-accept <em>int-socket</em>)</p></div>
<div class="paragraph"><p>Accepts a connection on a socket previously put into listening mode.
Returns a newly created socket handle for receiving and sending data on
this connection.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">socket</span> <span class="p">(</span><span class="k">net-listen</span> <span class="ss">1234</span><span class="p">))</span>
<span class="p">(</span><span class="k">net-accept</span> <span class="ss">socket</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Note that for ports less than 1024, newLISP must be started in superuser
mode on Unix-like operating systems.</p></div>
<div class="paragraph"><p>See also the files <span class="monospaced">server</span> and <span class="monospaced">client</span> examples in the <span class="monospaced">examples/</span>
directory of the source distribution.</p></div>
<div class="paragraph"><p><a id="net-close"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_net_close_span"><span class="big red">net-close</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (net-close <em>int-socket</em> [<em>true</em>])</p></div>
<div class="paragraph"><p>Closes a network socket in <em>int-socket</em> that was previously created by a
<a href="#net-connect">net-connect</a> or <a href="#net-accept">net-accept</a> function.
Returns <span class="monospaced">true</span> on success and <span class="monospaced">nil</span> on failure.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">net-close</span> <span class="ss">aSock</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The optional <em>true</em> flag suppresses immediate shutdown of sockets by
waiting for pending data transmissions to finish.</p></div>
<div class="paragraph"><p><a id="net-connect"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_net_connect_span"><span class="big red">net-connect</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (net-connect <em>str-remote-host</em> <em>int-port</em> [<em>int-timeout-ms</em>])<br>
<strong>syntax:</strong> (net-connect <em>str-remote-host</em> <em>int-port</em> [<em>str-mode</em> [<em>int-ttl</em>]])<br>
<strong>syntax:</strong> (net-connect <em>str-file-path</em>)</p></div>
<div class="paragraph"><p>In the first syntax, connects to a remote host computer specified in
<em>str-remote-host</em> and a port specified in <em>int-port</em>. Returns a socket
handle after having connected successfully; otherwise, returns <span class="monospaced">nil</span>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">socket</span> <span class="p">(</span><span class="k">net-connect</span> <span class="s">&quot;example.com&quot;</span> <span class="ss">80</span><span class="p">))</span>
<span class="p">(</span><span class="k">net-send</span> <span class="ss">socket</span> <span class="s">&quot;GET /\r\n\r\n&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">net-receive</span> <span class="ss">socket</span> <span class="ss">buffer</span> <span class="ss">10000</span><span class="p">)</span>
<span class="p">(</span><span class="k">println</span> <span class="ss">buffer</span><span class="p">)</span>
<span class="p">(</span><span class="k">exit</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>If successful, the <span class="monospaced">net-connect</span> function returns a socket number which
can be used to send and receive information from the host. In the
example a HTTP GET request is sent and subsequently a web page received.
Note that newLISP has already a buit-in function <a href="#get-url">get-url</a>
offering the same functionality.</p></div>
<div class="paragraph"><p>Optionally a timeout value <em>int-timeout</em> in milli seconds can be
specified. Without a timeout value the function will wait up to 10
seconds for an open port. With a timeout value the function can be made
to return on an unavailable port much earlier or later. The following
example shows a port scanner looking for open ports:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">host</span> <span class="p">(</span><span class="k">main-args</span> <span class="ss">2</span><span class="p">))</span>
<span class="p">(</span><span class="k">println</span> <span class="s">&quot;Scanning: &quot;</span> <span class="ss">host</span><span class="p">)</span>
<span class="p">(</span><span class="k">for</span> <span class="p">(</span><span class="nv">port</span> <span class="ss">1</span> <span class="ss">1024</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">socket</span> <span class="p">(</span><span class="k">net-connect</span> <span class="ss">host</span> <span class="ss">port</span> <span class="ss">500</span><span class="p">))</span>
        <span class="p">(</span><span class="k">println</span> <span class="s">&quot;open port: &quot;</span> <span class="ss">port</span> <span class="s">&quot; &quot;</span> <span class="p">(</span><span class="k">or</span> <span class="p">(</span><span class="k">net-service</span> <span class="ss">port</span> <span class="s">&quot;tcp&quot;</span><span class="p">)</span> <span class="s">&quot;&quot;</span><span class="p">))</span>
        <span class="p">(</span><span class="k">print</span> <span class="ss">port</span> <span class="s">&quot;\r&quot;</span><span class="p">))</span>
<span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The programs takes the host string from the shell command line as either
a domain name or an IP number in dot notation then tries to open each
port from 1 to 1024. For each openport the port number and the service
description string is printed. If no description is available, an empty
string "" is output. For closed ports the function outputs numbers in
the shell window staying on the same line.</p></div>
<div class="paragraph"><p>On Unix <span class="monospaced">net-connnect</span> may return with <span class="monospaced">nil</span> before the timeout expires,
when the port is not available. On Win32 <span class="monospaced">net-connect</span> will always wait
for the timout to expire before failing with <span class="monospaced">nil</span>.</p></div>
</div>
<div class="sect3">
<h4 id="_udp_communications">UDP communications</h4>
<div class="paragraph"><p>In the second syntax, a third parameter, the string <span class="monospaced">"udp"</span> or <span class="monospaced">"u"</span> can
be specified in the optional <em>str-mode</em> to create a socket suited for
UDP (User Datagram Protocol) communications. In UDP mode, <span class="monospaced">net-connect</span>
does <em>not</em> try to connect to the remote host, but creates the socket and
binds it to the remote address, if an address is specified. A subsequent
<a href="#net-send">net-send</a> will send a UDP packet containing that target
address. When using <a href="#net-send-to">net-send-to</a>, only one of the two
functions <span class="monospaced">net-connect</span> or <span class="monospaced">net-send-to</span> should provide a target
address. The other function should specify and empty string <span class="monospaced">""</span> as the
target address.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">;; example server</span>
<span class="p">(</span><span class="k">net-listen</span> <span class="ss">4096</span> <span class="s">&quot;226.0.0.1&quot;</span> <span class="s">&quot;udp&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">5</span>
<span class="p">(</span><span class="k">net-receive-from</span> <span class="ss">5</span> <span class="ss">20</span><span class="p">)</span>

<span class="c1">;; example client I</span>
<span class="p">(</span><span class="k">net-connect</span> <span class="s">&quot;226.0.0.1&quot;</span> <span class="ss">4096</span> <span class="s">&quot;udp&quot;</span><span class="p">)</span> <span class="err">→</span> <span class="ss">3</span>
<span class="p">(</span><span class="k">net-send</span> <span class="ss">3</span> <span class="s">&quot;hello&quot;</span><span class="p">)</span>

<span class="c1">;; example client II</span>
<span class="p">(</span><span class="k">net-connect</span> <span class="s">&quot;&quot;</span> <span class="ss">4096</span> <span class="s">&quot;udp&quot;</span><span class="p">)</span> <span class="err">→</span> <span class="ss">3</span>
<span class="p">(</span><span class="k">net-send-to</span> <span class="s">&quot;226.0.0.1&quot;</span> <span class="ss">4096</span> <span class="s">&quot;hello&quot;</span> <span class="ss">3</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The functions <a href="#net-receive">net-receive</a> and
<a href="#net-receive-from">net-receive-from</a> can both be used and will
perform UDP communications when the <span class="monospaced">"udp"</span> option as been used in
<span class="monospaced">net-listen</span> or <span class="monospaced">net-connect</span>. <a href="#net-select">net-select</a> and
<a href="#net-peek">net-peek</a> can be used to check for received data in a
non-blocking fashion.</p></div>
<div class="paragraph"><p><a href="#net-listen">net-listen</a> binds a specific local address and port to
the socket. When <span class="monospaced">net-connect</span> is used, the local address and port will
be picked by the socket-stack functions of the host OS.</p></div>
</div>
<div class="sect3">
<h4 id="_udp_multicast_communications">UDP multicast communications</h4>
<div class="paragraph"><p>When specifying <span class="monospaced">"multi"</span> or <span class="monospaced">"m"</span> as a third parameter for <em>str-mode</em>,
a socket for UDP multicast communications will be created. Optionally,
the fourth parameter <span class="monospaced">int-ttl</span> can be specified as a TTL (time to live)
value. If no <em>int-ttl</em> value is specified, a value of 3 is assumed.</p></div>
<div class="paragraph"><p>Note that specifying UDP multicast mode in <span class="monospaced">net-connect</span> does not
actually establish a connection to the target multicast address but only
puts the socket into UDP multicasting mode. On the receiving side, use
<a href="#net-listen">net-listen</a> together with the UDP multicast option.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">;; example client I</span>
<span class="p">(</span><span class="k">net-connect</span> <span class="s">&quot;&quot;</span> <span class="ss">4096</span> <span class="s">&quot;multi&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">3</span>
<span class="p">(</span><span class="k">net-send-to</span> <span class="s">&quot;226.0.0.1&quot;</span> <span class="ss">4096</span> <span class="s">&quot;hello&quot;</span> <span class="ss">3</span><span class="p">)</span>

<span class="c1">;; example client II</span>
<span class="p">(</span><span class="k">net-connect</span> <span class="s">&quot;226.0.0.1&quot;</span> <span class="ss">4096</span> <span class="s">&quot;multi&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">3</span>
<span class="p">(</span><span class="k">net-send</span> <span class="ss">3</span> <span class="s">&quot;hello&quot;</span><span class="p">)</span>

<span class="c1">;; example server</span>
<span class="p">(</span><span class="k">net-listen</span> <span class="ss">4096</span> <span class="s">&quot;226.0.0.1&quot;</span> <span class="s">&quot;multi&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">5</span>
<span class="p">(</span><span class="k">net-receive-from</span> <span class="ss">5</span> <span class="ss">20</span><span class="p">)</span>
<span class="err">→</span> <span class="p">(</span><span class="s">&quot;hello&quot;</span> <span class="s">&quot;192.168.1.94&quot;</span> <span class="ss">32769</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>On the server side, <a href="#net-peek">net-peek</a> or
<a href="#net-select">net-select</a> can be used for non-blocking
communications. In the above example, the server would block until a
datagram is received.</p></div>
<div class="paragraph"><p>The address <span class="monospaced">226.0.0.1</span> is just one multicast address in the Class D
range of multicast addresses from <span class="monospaced">224.0.0.0</span> to <span class="monospaced">239.255.255.255</span>.</p></div>
<div class="paragraph"><p>The <a href="#net-send">net-send</a> and <a href="#net-receive">net-receive</a>
functions can also be used instead of <a href="#net-send-to">net-send-to</a> and
<a href="#net-receive-from">net-receive-from</a>.</p></div>
</div>
<div class="sect3">
<h4 id="_udp_broadcast_communications">UDP broadcast communications</h4>
<div class="paragraph"><p>Specifying the string <span class="monospaced">"broadcast"</span> or <span class="monospaced">"b"</span> in the third parameter,
<em>str-mode</em>, causes UDP broadcast communications to be set up. In this
case, the broadcast address ending in 255 is used.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">;; example client</span>
<span class="p">(</span><span class="k">net-connect</span> <span class="s">&quot;192.168.2.255&quot;</span> <span class="ss">3000</span> <span class="s">&quot;broadcast&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">3</span>
<span class="p">(</span><span class="k">net-send</span> <span class="ss">3</span> <span class="s">&quot;hello&quot;</span><span class="p">)</span>

<span class="c1">;; example server</span>
<span class="p">(</span><span class="k">net-listen</span> <span class="ss">3000</span> <span class="s">&quot;&quot;</span> <span class="s">&quot;udp&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">5</span>

<span class="p">(</span><span class="k">net-receive</span> <span class="ss">5</span> <span class="ss">buff</span> <span class="ss">10</span><span class="p">)</span>
<span class="ss">buff</span>  <span class="err">→</span> <span class="s">&quot;hello&quot;</span>
<span class="c1">;; or</span>
<span class="p">(</span><span class="k">net-receive-from</span> <span class="ss">5</span> <span class="ss">10</span><span class="p">)</span>
<span class="err">→</span> <span class="p">(</span><span class="s">&quot;hello&quot;</span> <span class="s">&quot;192.168.2.1&quot;</span> <span class="ss">46620</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Note that on the receiving side, <a href="#net-listen">net-listen</a> should be
used with the default address specified with an <span class="monospaced">""</span> (empty string).
Broadcasts will not be received when specifying an address. As with all
UDP communications, <a href="#net-listen">net-listen</a> does not actually put
the receiving side in listen mode, but rather sets up the sockets for
the specific UDP mode.</p></div>
<div class="paragraph"><p>The <a href="#net-select">net-select</a> or <a href="#net-peek">net-peek</a> functions
can be used to check for incoming communications in a non-blocking
fashion.</p></div>
</div>
<div class="sect3">
<h4 id="_local_domain_unix_sockets">Local domain Unix sockets</h4>
<div class="paragraph"><p>In the third syntax, <span class="monospaced">net-connect</span> connects to a server on the local
file system via a <em>local domain Unix socket</em> named using
<em>str-file-path</em>. Returns a socket handle after having connected
successfully; otherwise, returns <span class="monospaced">nil</span>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">net-connect</span> <span class="s">&quot;/tmp/mysocket&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">3</span>

<span class="c1">; on OS/2 use &quot;\\socket\\&quot; prefix</span>

<span class="p">(</span><span class="k">net-connect</span> <span class="s">&quot;\\socket\\mysocket&quot;</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>A <em>local domain</em> file system socket is created and returned. On the
server side, <em>local domain</em> sockets have been created using
<a href="#net-listen">net-listen</a> and <a href="#net-accept">net-accept</a>. After the
connection has been established the functions
<a href="#net-select">net-select</a>, <a href="#net-send">net-send</a> and
<a href="#net-receive">net-receive</a> can be used as usual for TCP/IP stream
communications. This type of connection can be used as a fast
bi-directional communications channel between processes on the same file
system. This type of connection is not available on Win32 platforms.</p></div>
<div class="paragraph"><p><a id="net-error"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_net_error_span"><span class="big red">net-error</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (net-error)<br>
<strong>syntax:</strong> (net-error <em>int-error</em>)</p></div>
<div class="paragraph"><p>Retrieves the last error that occurred when calling a any of the
following functions: <a href="#net-accept">net-accept</a>,
<a href="#net-connect">net-connect</a>, <a href="#net-eval">net-eval</a>,
<a href="#net-listen">net-listen</a>, <a href="#net-lookup">net-lookup</a>,
<a href="#net-receive">net-receive</a>, <a href="#net-receive-udp">net-receive-udp</a>,
<a href="#net-select">net-select</a>, <a href="#net-send">net-send</a>,
<a href="#net-send-udp">net-send-udp</a>, and <a href="#net-service">net-service</a>.
Whenever one of these functions fails, it returns <span class="monospaced">nil</span> and <span class="monospaced">net-error</span>
can be used to retrieve more information.</p></div>
<div class="paragraph"><p>Functions that communicate using sockets close the socket automatically
and remove it from the <a href="#net-sessions">net-sessions</a> list.</p></div>
<div class="paragraph"><p>Each successful termination of a <a href="#socket_tcpip">net-*</a> function
clears the error number.</p></div>
<div class="paragraph"><p>The following messages are returned:</p></div>
<table class="tableblock frame-all grid-all"
style="
width:40%;
">
<col style="width:16%;">
<col style="width:83%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" >no </th>
<th class="tableblock halign-left valign-top" >description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Cannot open socket</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">DNS resolution failed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Not a valid service</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Connection failed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Accept failed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Connection closed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Connection broken</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Socket send() failed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Socket recv() failed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Cannot bind socket</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Too many sockets in net-select</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Listen failed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">13</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Badly formed IP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">14</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Select failed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">15</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Peek failed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">16</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Not a valid socket</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">17</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Cannot unblock socket</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">18</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Operation timed out</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">19</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">HTTP bad formed URL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">20</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">HTTP file operation failed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">21</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">HTTP transfer failed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">22</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">HTTP invalid response from server</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">23</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">HTTP no response from server</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">24</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">HTTP document empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">25</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">HTTP error in header</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">26</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">HTTP error in chunked format</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">net-error</span><span class="p">)</span> <span class="err">→</span> <span class="k">nil</span>

<span class="p">(</span><span class="k">net-connect</span> <span class="s">&quot;jhghjgkjhg&quot;</span> <span class="ss">80</span><span class="p">)</span>  <span class="err">→</span>  <span class="k">nil</span>

<span class="p">(</span><span class="k">net-error</span><span class="p">)</span>  <span class="err">→</span>  <span class="p">(</span><span class="nv">2</span> <span class="s">&quot;ERR: &quot;</span><span class="ss">DNS</span> <span class="ss">resolution</span> <span class="ss">failed</span><span class="err">&quot;</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>When <em>int-error</em> is specified the number and error text for that error
number is returned.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">net-error</span> <span class="ss">10</span><span class="p">)</span> <span class="err">→</span> <span class="p">(</span><span class="nv">10</span> <span class="s">&quot;Cannot bind socket&quot;</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>See also <a href="#last-error">last-error</a> and <a href="#sys-error">sys-error</a>.</p></div>
<div class="paragraph"><p><a id="net-eval"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_net_eval_span"><span class="big red">net-eval</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (net-eval <em>str-host</em> <em>int-port</em> <em>exp</em> [<em>int-timeout</em> [<em>func-handler</em>]])<br>
<strong>syntax:</strong> (net-eval '( (<em>str-host</em> <em>int-port</em> <em>exp</em>) &#8230; ) [<em>int-timeout</em> [<em>func-handler</em>]])</p></div>
<div class="paragraph"><p>Can be used to evaluate source remotely on one or more newLISP servers.
This function handles all communications necessary to connect to the
remote servers, send source for evaluation, and wait and collect
responses.</p></div>
<div class="paragraph"><p>The expression in <em>exp</em> evaluates to either a string or an expression
which will be evaluated remotely in the environment of the target node.</p></div>
<div class="paragraph"><p>The remote TCP/IP servers are started in the following way:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre>newlisp -c -d 4711 &amp;

; or with logging connections

newlisp -l -c -d 4711 &amp;

; communicate via Uix <span class="nb">local </span>domain socket

newlisp -c /tmp/mysocket
</pre></div></div></div>
<div class="paragraph"><p>Instead of <span class="monospaced">4711</span>, any other port number can be used. Multiple nodes can
be started on different hosts and with the same or different port
numbers. The <span class="monospaced">-l</span> or <span class="monospaced">-L</span> logging options can be specified to log
connections and remote commands.</p></div>
<div class="paragraph"><p>The <span class="monospaced">-d</span> daemon mode allows newLISP to maintain state between
connections. When keeping state between connections is not desired, the
<a href="#inetd_daemon">inetd daemon mode</a> offers more advantages. The
Internet <span class="monospaced">inetd</span> or <span class="monospaced">xinetd</span> services daemon will start a new newLISP
process for each client connection. This makes for much faster servicing
of multiple connections. In <span class="monospaced">-d</span> daemon mode, each new client request
would have to wait for the previous request to be finished. See the
chapter <a href="#inetd_daemon">inetd daemon mode</a> on how to configure this
mode correctly.</p></div>
<div class="paragraph"><p>In the first syntax, <span class="monospaced">net-eval</span> talks to only one remote newLISP server
node, sending the host in <em>str-host</em> on port <em>int-port</em> a request to
evaluate the expression <em>exp</em>. If <em>int-timeout</em> is not given, <span class="monospaced">net-eval</span>
will wait up to 60 seconds for a response after a connection is made.
Otherwise, if the timeout in milliseconds has expired, <span class="monospaced">nil</span> is
returned; else, the evaluation result of <em>exp</em> is returned.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">; the code to be evaluated is given in a quoted expression</span>
<span class="p">(</span><span class="k">net-eval</span> <span class="s">&quot;192.168.1.94&quot;</span> <span class="ss">4711</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">+</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">))</span>       <span class="err">→</span> <span class="ss">7</span>

<span class="c1">; expression as a string</span>
<span class="p">(</span><span class="k">net-eval</span> <span class="s">&quot;192.168.1.94&quot;</span> <span class="ss">4711</span> <span class="s">&quot;(+ 3 4)&quot;</span><span class="p">)</span>      <span class="err">→</span> <span class="ss">7</span>

<span class="c1">; with timeout</span>
<span class="p">(</span><span class="k">net-eval</span> <span class="s">&quot;192.168.1.94&quot;</span> <span class="ss">4711</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">+</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">)</span> <span class="ss">1</span><span class="p">)</span>     <span class="err">→</span> <span class="k">nil</span>  <span class="c1">; timeout to short</span>
<span class="p">(</span><span class="k">net-error</span><span class="p">)</span>                                   <span class="err">→</span> <span class="p">(</span><span class="nv">17</span> <span class="s">&quot;ERR: Operation timed out&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">net-eval</span> <span class="s">&quot;192.168.1.94&quot;</span> <span class="ss">4711</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">+</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">)</span> <span class="ss">1000</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">7</span>

<span class="c1">; program contained in a variable</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">prog</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">+</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">))</span>
<span class="p">(</span><span class="k">net-eval</span> <span class="s">&quot;192.168.1.94&quot;</span> <span class="ss">4711</span> <span class="ss">prog</span><span class="p">)</span>           <span class="err">→</span> <span class="ss">7</span>

<span class="c1">; specify a local-domain Unix socket (not available on Win32)</span>
<span class="p">(</span><span class="k">net-eval</span> <span class="s">&quot;/tmp/mysocket&quot;</span> <span class="ss">0</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">+</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">))</span>         <span class="err">→</span> <span class="ss">7</span>
</pre></div></div></div>
<div class="paragraph"><p>The second syntax of <span class="monospaced">net-eval</span> returns a list of the results after all
of the responses are collected or timeout occurs. Responses that time
out return <span class="monospaced">nil</span>. The last example line shows how to specify a
local-domain Unix socket specifying the socket path and a port number of
<span class="monospaced">0</span>. Connection errors or errors that occur when sending information to
nodes are returned as a list of error numbers and descriptive error
strings. See the function <a href="#net-error">net-error</a> for a list of
potential error messages.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">; two different remote nodes different IPs</span>
<span class="p">(</span><span class="k">net-eval</span> <span class="o">&#39;</span><span class="p">(</span>
    <span class="p">(</span><span class="s">&quot;192.168.1.94&quot;</span> <span class="ss">4711</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">+</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">))</span>
    <span class="p">(</span><span class="s">&quot;192.168.1.95&quot;</span> <span class="ss">4711</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">+</span> <span class="ss">5</span> <span class="ss">6</span><span class="p">))</span>
    <span class="p">)</span> <span class="ss">5000</span><span class="p">)</span>
<span class="err">→</span> <span class="p">(</span><span class="nv">7</span> <span class="ss">11</span><span class="p">)</span>

<span class="c1">; two persistent nodes on the same CPU different ports</span>
<span class="p">(</span><span class="k">net-eval</span> <span class="o">&#39;</span><span class="p">(</span>
    <span class="p">(</span><span class="s">&quot;localhost&quot;</span> <span class="ss">8081</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">foo</span> <span class="s">&quot;abc&quot;</span><span class="p">))</span>
    <span class="p">(</span><span class="s">&quot;localhost&quot;</span> <span class="ss">8082</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">myfunc</span> <span class="ss">123</span><span class="p">)</span><span class="o">&#39;</span><span class="p">)</span>
    <span class="p">)</span> <span class="ss">3000</span><span class="p">)</span>

<span class="c1">; inetd or xinetd nodes on the same server and port</span>
<span class="c1">; nodes are loaded on demand</span>
<span class="p">(</span><span class="k">net-eval</span> <span class="o">&#39;</span><span class="p">(</span>
    <span class="p">(</span><span class="s">&quot;localhost&quot;</span> <span class="ss">2000</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">foo</span> <span class="s">&quot;abc&quot;</span><span class="p">))</span>
    <span class="p">(</span><span class="s">&quot;localhost&quot;</span> <span class="ss">2000</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">myfunc</span> <span class="ss">123</span><span class="p">))</span>
    <span class="p">)</span> <span class="ss">3000</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The first example shows two expressions evaluated on two different
remote nodes. In the second example, both nodes run on the local
computer. This may be useful when debugging or taking advantage of
multiple CPUs on the same computer. When specifying <span class="monospaced">0</span> for the port
number , <span class="monospaced">net-eval</span> takes the host name as the file path to the
local-domain Unix socket.</p></div>
<div class="paragraph"><p>Note that definitions of <span class="monospaced">foo</span> and <span class="monospaced">myfunc</span> must both exist in the
target environment. This can be done using a <span class="monospaced">net-eval</span> sending <span class="monospaced">define</span>
statements before. It also can be done by preloading code when starting
remode nodes.</p></div>
<div class="paragraph"><p>When nodes are inetd or xinetd-controlled, several nodes may have the
same IP address and port number. In this case, the Unix daemon inetd or
xinetd will start multiple newLISP servers on demand. This is useful
when testing distributed programs on just one machine. The last example
illustrates this case. It is also useful on multi core CPUs, where the
platform OS can distribute different processes on to different CPU
cores.</p></div>
<div class="paragraph"><p>The source sent for evaluation can consist of entire multiline programs.
This way, remote nodes can be loaded with programs first, then specific
functions can be called. For large program files, the functions
<a href="#put-url">put-url</a> or <a href="#save">save</a> (with a URL file name) can be
used to transfer programs. The a <span class="monospaced">net-eval</span> statement could load these
programs.</p></div>
<div class="paragraph"><p>Optionally, a handler function can be specified. This function will be
repeatedly called while waiting and once for every remote evaluation
completion.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">myhandler</span> <span class="ss">param</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if</span> <span class="ss">param</span>
        <span class="p">(</span><span class="k">println</span> <span class="ss">param</span><span class="p">))</span>
<span class="p">)</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">Nodes</span> <span class="o">&#39;</span><span class="p">(</span>
    <span class="p">(</span><span class="s">&quot;192.168.1.94&quot;</span> <span class="ss">4711</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&quot;192.168.1.95&quot;</span> <span class="ss">4711</span><span class="p">)</span>
<span class="p">))</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">Progs</span> <span class="o">&#39;</span><span class="p">(</span>
    <span class="p">(</span><span class="nv">+</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">+</span> <span class="ss">5</span> <span class="ss">6</span><span class="p">)</span>
<span class="p">))</span>

<span class="p">(</span><span class="k">net-eval</span> <span class="p">(</span><span class="k">map</span> <span class="p">(</span><span class="k">fn</span> <span class="p">(</span><span class="nv">n</span> <span class="ss">p</span><span class="p">)</span> <span class="p">(</span><span class="k">list</span> <span class="p">(</span><span class="nv">n</span> <span class="ss">0</span><span class="p">)</span> <span class="p">(</span><span class="nv">n</span> <span class="ss">1</span><span class="p">)</span> <span class="ss">p</span><span class="p">))</span> <span class="ss">Nodes</span> <span class="ss">Progs</span><span class="p">)</span> <span class="ss">5000</span> <span class="ss">myhandler</span><span class="p">)</span>
<span class="err">→</span>
<span class="p">(</span><span class="s">&quot;192.168.1.94&quot;</span> <span class="ss">4711</span> <span class="ss">7</span><span class="p">)</span>
<span class="p">(</span><span class="s">&quot;192.168.1.95&quot;</span> <span class="ss">4711</span> <span class="ss">11</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The example shows how the list of node specs can be assembled from a
list of nodes and sources to evaluate. This may be useful when
connecting to a larger number of remote nodes.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">net-eval</span> <span class="p">(</span><span class="k">list</span>
  <span class="p">(</span><span class="k">list</span> <span class="p">(</span><span class="nv">Nodes</span> <span class="ss">0</span> <span class="ss">0</span><span class="p">)</span> <span class="p">(</span><span class="nv">Nodes</span> <span class="ss">0</span> <span class="ss">1</span><span class="p">)</span> <span class="p">(</span><span class="nv">Progs</span> <span class="ss">0</span><span class="p">))</span>
  <span class="p">(</span><span class="k">list</span> <span class="p">(</span><span class="nv">Nodes</span> <span class="ss">1</span> <span class="ss">0</span><span class="p">)</span> <span class="p">(</span><span class="nv">Nodes</span> <span class="ss">1</span> <span class="ss">1</span><span class="p">)</span> <span class="p">(</span><span class="nv">Progs</span> <span class="ss">1</span><span class="p">))</span>
 <span class="p">)</span> <span class="ss">3000</span> <span class="ss">myhandler</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>While waiting for input from remote hosts, <span class="monospaced">myhandler</span> will be called
with <span class="monospaced">nil</span> as the argument to <span class="monospaced">param</span>. When a remote node result is
completely received, <span class="monospaced">myhandler</span> will be called with <span class="monospaced">param</span> set to a
list containing the remote host name or IP number, the port, and the
resulting expression. <span class="monospaced">net-eval</span> will return <span class="monospaced">true</span> before a timeout or
<span class="monospaced">nil</span> if the timeout was reached or exceeded. All remote hosts that
exceeded the timeout limit will contain a <span class="monospaced">nil</span> in their results list.</p></div>
<div class="paragraph"><p>For a longer example see this program:
<a href="http://www.newlisp.org/syntax.cgi?code/mapreduce.txt">mapreduce</a>. The
example shows how a word counting task gets distributed to three remote
nodes. The three nodes count words in different texts and the master
node receives and consolidates the results.</p></div>
<div class="paragraph"><p><a id="net-interface"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_net_interface_span"><span class="big red">net-interface</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (net-interface <em>str-ip-addr</em>)<br>
<strong>syntax:</strong> (net-interface)</p></div>
<div class="paragraph"><p>Sets the default local interface address to be used for network
connections. If not set then network functions will default to an
internal default address, except when overwritten by an optional
interface address given in <a href="#net-listen">net-listen</a>.</p></div>
<div class="paragraph"><p>When no <em>str-ip-addr</em> is specified, the current default is returned. If
the <span class="monospaced">net-interface</span> has not been used yet to specify an IP address, the
address <span class="monospaced">0.0.0.0</span> is returned. This means that all network routines will
use the default address preconfigured by the underlying operating
system.</p></div>
<div class="paragraph"><p>This function has only usage on multihomed servers with either multiple
network interface hardware or otherwise supplied multiple IP numbers. On
all other machines network functions will automatically select the
single network interface installed.</p></div>
<div class="paragraph"><p>On error the function returns <span class="monospaced">nil</span> and <a href="#net-error">net-error</a> can
be used to report the error.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">net-interface</span> <span class="s">&quot;192.168.1.95&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;192.168.1.95&quot;</span>
<span class="p">(</span><span class="k">net-interface</span> <span class="s">&quot;localhost&quot;</span><span class="p">)</span>     <span class="err">→</span> <span class="s">&quot;127.0.0.1&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>An interface address can be defined as either an IP address or a name.
The return value is the address given in <em>str-ip-addr</em></p></div>
<div class="paragraph"><p><a id="net-ipv"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_net_ipv_span"><span class="big red">net-ipv</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (net-ipv <em>int-version</em>)<br>
<strong>syntax:</strong> (net-ipv)</p></div>
<div class="paragraph"><p>Switches between IPv4 and IPv6 internet protocol versions. <em>int-version</em>
contains either a 4 for IPv4 or a 6 for IPv6. When no parameter is
given, <span class="monospaced">net-ipv</span> returns the current setting.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">net-ipv</span><span class="p">)</span>      <span class="err">→</span> <span class="ss">4</span>
<span class="p">(</span><span class="k">net-ipv</span> <span class="ss">6</span><span class="p">)</span>    <span class="err">→</span> <span class="ss">6</span>
</pre></div></div></div>
<div class="paragraph"><p>By default newLISP starts up in IPv4 mode. The IPv6 protocol mode can
also be specified from the commandline when starting newlisp:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre>newlisp -6
</pre></div></div></div>
<div class="paragraph"><p>Once a socket is connected with either <a href="#net-connect">net-connect</a> or
listened on with <a href="#net-listen">net-listen</a>, the
<a href="#net-accept">net-accept</a>, <a href="#net-select">net-select</a>,
<a href="#net-send">net-send</a>, <a href="#net-receive">net-receive</a> and
<a href="#net-receive-from">net-receive-from</a> functions automatically adjust
to the address protocol used when creating the sockets. Different
connections with different IPv4/6 settings can be open at the same time.</p></div>
<div class="paragraph"><p>Note, that currently <a href="#net-packet">net-packet</a> does not support IPv6
and will work in IPv4 mode regardless of settings.</p></div>
<div class="paragraph"><p><a id="net-listen"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_net_listen_span"><span class="big red">net-listen</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (net-listen <em>int-port</em> [<em>str-ip-addr</em> [<em>str-mode</em>]])<br>
<strong>syntax:</strong> (net-listen <em>str-file-path</em>)</p></div>
<div class="paragraph"><p>Listens on a port specified in <em>int-port</em>. A call to <span class="monospaced">net-listen</span>
returns immediately with a socket number, which is then used by the
blocking <a href="#net-accept">net-accept</a> function to wait for a connection.
As soon as a connection is accepted, <a href="#net-accept">net-accept</a>
returns a socket number that can be used to communicate with the
connecting client.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">port</span> <span class="ss">1234</span><span class="p">)</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">listen</span> <span class="p">(</span><span class="k">net-listen</span> <span class="ss">port</span><span class="p">))</span>
<span class="p">(</span><span class="k">unless</span> <span class="ss">listen</span> <span class="p">(</span><span class="k">begin</span>
    <span class="p">(</span><span class="k">print</span> <span class="s">&quot;listening failed\n&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="k">exit</span><span class="p">)))</span>

<span class="p">(</span><span class="k">print</span> <span class="s">&quot;Waiting for connection on: &quot;</span> <span class="ss">port</span> <span class="s">&quot;\n&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">connection</span> <span class="p">(</span><span class="k">net-accept</span> <span class="ss">listen</span><span class="p">))</span>
<span class="p">(</span><span class="k">if</span> <span class="ss">connection</span>
    <span class="p">(</span><span class="k">while</span> <span class="p">(</span><span class="k">net-receive</span> <span class="ss">connection</span> <span class="ss">buff</span> <span class="ss">1024</span> <span class="s">&quot;\n&quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="k">print</span> <span class="ss">buff</span><span class="p">)</span>
        <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">=</span> <span class="ss">buff</span> <span class="s">&quot;\r\n&quot;</span><span class="p">)</span> <span class="p">(</span><span class="k">exit</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">print</span> <span class="s">&quot;Could not connect\n&quot;</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p>The example waits for a connection on port 1234, then reads incoming
lines until an empty line is received. Note that listening on ports
lower than 1024 may require superuser access on Unix systems.</p></div>
<div class="paragraph"><p>On computers with more than one interface card, specifying an optional
interface IP address or name in <em>str-ip-addr</em> directs <span class="monospaced">net-listen</span> to
listen on the specified address.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">;; listen on a specific address</span>
<span class="p">(</span><span class="k">net-listen</span> <span class="ss">port</span> <span class="s">&quot;192.168.1.54&quot;</span><span class="p">)</span>
</pre></div></div></div>
</div>
<div class="sect3">
<h4 id="_local_domain_unix_sockets_2">Local domain Unix sockets</h4>
<div class="paragraph"><p>In the second syntax, <span class="monospaced">net-listen</span> listens for a client on the local
file system via a <em>local domain Unix socket</em> named using
<em>str-file-path</em>. If successful, returns a socket handle that can be used
with <a href="#net-accept">net-accept</a> to accept a client connection;
otherwise, returns <span class="monospaced">nil</span>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">net-listen</span> <span class="s">&quot;/tmp/mysocket&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">5</span>

<span class="c1">; on OS/2 use &quot;\\socket\\&quot; prefix</span>

<span class="p">(</span><span class="k">net-listen</span> <span class="s">&quot;\\socket\\mysocket&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">net-accept</span> <span class="ss">5</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>A <em>local domain</em> file system socket is created and listened on. A client
will try to connect using the same <em>str-file-path</em>. After a connection
has been accepted the functions <a href="#net-select">net-select</a>,
<a href="#net-send">net-send</a> and <a href="#net-receive">net-receive</a> can be used
as usual for TCP/IP stream communications. This type of connection can
be used as a fast bi-directional communications channel between
processes on the same file system. This type of connection is not
available on Win32 platforms.</p></div>
</div>
<div class="sect3">
<h4 id="_udp_communications_2">UDP communications</h4>
<div class="paragraph"><p>As a third parameter, the optional string <span class="monospaced">"udp"</span> or <span class="monospaced">"u"</span> can be
specified in <em>str-mode</em> to create a socket suited for UDP (User Datagram
Protocol) communications. A socket created in this way can be used
directly with <a href="#net-receive-from">net-receive-from</a> to await incoming
UDP data <em>without</em> using <span class="monospaced">net-accept</span>, which is only used in TCP
communications. The <a href="#net-receive-from">net-receive-from</a> call will
block until a UDP data packet is received. Alternatively,
<a href="#net-select">net-select</a> or <a href="#net-peek">net-peek</a> can be used to
check for ready data in a non-blocking fashion. To send data back to the
address and port received with <a href="#net-receive-from">net-receive-from</a>,
use <a href="#net-send-to">net-send-to</a>.</p></div>
<div class="paragraph"><p>Note that <a href="#net-peer">net-peer</a> will not work, as UDP communications
do not maintain a connected socket with address information.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">net-listen</span> <span class="ss">10002</span> <span class="s">&quot;192.168.1.120&quot;</span> <span class="s">&quot;udp&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">net-listen</span> <span class="ss">10002</span> <span class="s">&quot;&quot;</span> <span class="s">&quot;udp&quot;</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The first example listens on a specific network adapter, while the
second example listens on the default adapter. Both calls return a
socket number that can be used in subsequent
<a href="#net-receive">net-receive</a>,
<a href="#net-receive-from">net-receive-from</a>,
<a href="#net-send-to">net-send-to</a>, <a href="#net-select">net-select</a>, or
<a href="#net-peek">net-peek</a> function calls.</p></div>
<div class="paragraph"><p>Both a UDP server <em>and</em> UDP client can be set up using <span class="monospaced">net-listen</span> with
the <span class="monospaced">"udp"</span> option. In this mode, <span class="monospaced">net-listen</span> does not really <em>listen</em>
as in TCP/IP communications; it just binds the socket to the local
interface address and port.</p></div>
<div class="paragraph"><p>For a working example, see the files <span class="monospaced">examples/client</span> and
<span class="monospaced">examples/server</span> in the newLISP source distribution.</p></div>
<div class="paragraph"><p>Instead of <span class="monospaced">net-listen</span> and the <span class="monospaced">"udp"</span> option, the functions
<a href="#net-receive-udp">net-receive-udp</a> and
<a href="#net-send-udp">net-send-udp</a> can be used for short transactions
consisting only of one data packet.</p></div>
<div class="paragraph"><p><span class="monospaced">net-listen</span>, <a href="#net-select">net-select</a>, and <a href="#net-peek">net-peek</a>
can be used to facilitate non-blocking reading. The listening/reading
socket is not closed but is used again for subsequent reads. In
contrast, when the <a href="#net-receive-udp">net-receive-udp</a> and
<a href="#net-send-udp">net-send-udp</a> pair is used, both sides close the
sockets after sending and receiving.</p></div>
</div>
<div class="sect3">
<h4 id="_udp_multicast_communications_2">UDP multicast communications</h4>
<div class="paragraph"><p>If the optional string <em>str-mode</em> is specified as <span class="monospaced">"multi"</span> or <span class="monospaced">"m"</span>,
<span class="monospaced">net-listen</span> returns a socket suitable for multicasting. In this case,
<em>str-ip-addr</em> contains one of the multicast addresses in the range
<span class="monospaced">224.0.0.0</span> to <span class="monospaced">239.255.255.255</span>. <span class="monospaced">net-listen</span> will register
<em>str-ip-addr</em> as an address on which to receive multicast transmissions.
This address should not be confused with the IP address of the server
host.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">;; example client</span>

<span class="p">(</span><span class="k">net-connect</span> <span class="s">&quot;226.0.0.1&quot;</span> <span class="ss">4096</span> <span class="s">&quot;multi&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">3</span>

<span class="p">(</span><span class="k">net-send-to</span> <span class="s">&quot;226.0.0.1&quot;</span> <span class="ss">4096</span> <span class="s">&quot;hello&quot;</span> <span class="ss">3</span><span class="p">)</span>

<span class="c1">;; example server</span>

<span class="p">(</span><span class="k">net-listen</span> <span class="ss">4096</span> <span class="s">&quot;226.0.0.1&quot;</span> <span class="s">&quot;multi&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">5</span>

<span class="p">(</span><span class="k">net-receive-from</span> <span class="ss">5</span> <span class="ss">20</span><span class="p">)</span>
<span class="err">→</span> <span class="p">(</span><span class="s">&quot;hello&quot;</span> <span class="s">&quot;192.168.1.94&quot;</span> <span class="ss">32769</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>On the server side, <a href="#net-peek">net-peek</a> or
<a href="#net-select">net-select</a> can be used for non-blocking
communications. In the example above, the server would block until a
datagram is received.</p></div>
<div class="paragraph"><p>The <a href="#net-send">net-send</a> and <a href="#net-receive">net-receive</a>
functions can be used instead of <a href="#net-send-to">net-send-to</a> and
<a href="#net-receive-from">net-receive-from</a>.</p></div>
</div>
<div class="sect3">
<h4 id="_packet_divert_sockets_and_ports">Packet divert sockets and ports</h4>
<div class="paragraph"><p>If <em>str-mode</em> is specified as <span class="monospaced">"divert"</span>, a divert socket can be created
for a divert port in <em>int-port</em> on BSD like platforms. The content of IP
address in <em>str-ip-addr</em> is ignored and can be specifed as an empty
string. Only the <em>int-port</em> is relevant and will be bound to the raw
socket returned.</p></div>
<div class="paragraph"><p>To use the divert option in <span class="monospaced">net-listen</span>, newLISP must run in super-user
mode. This option is only available on Unix like platforms.</p></div>
<div class="paragraph"><p>The divert socket will receive all raw packets diverted to the divert
port. Packets may also be written back to a divert socket, in which case
they re-enter OS kernel IP packet processing.</p></div>
<div class="paragraph"><p>Rules for packet diversion to the divert port must be defined using
either the <em>ipfw</em> BSD or <em>ipchains</em> Linux configuration utilities.</p></div>
<div class="paragraph"><p>The <a href="#net-receive-from">net-receive-from</a> and
<a href="#net-send-to">net-send-to</a> functions are used to read and write raw
packets on the divert socket created and returned by the <span class="monospaced">net-listen</span>
statement. The same address received by
<a href="#net-receive-from">net-receive-from</a> is used in the
<a href="#net-send-to">net-send-to</a> call when re-injecting the packet:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">; rules have been previously configured for a divert port</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">divertSocket</span> <span class="p">(</span><span class="k">net-listen</span> <span class="ss">divertPort</span> <span class="s">&quot;&quot;</span> <span class="s">&quot;divert&quot;</span><span class="p">))</span>

<span class="p">(</span><span class="k">until</span> <span class="p">(</span><span class="k">net-error</span><span class="p">)</span>
    <span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">rlist</span> <span class="p">(</span><span class="k">net-receive-from</span> <span class="ss">divertSocket</span> <span class="ss">maxBytes</span><span class="p">))</span>
    <span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">buffer</span> <span class="p">(</span><span class="nv">rlist</span> <span class="ss">1</span><span class="p">))</span>
    <span class="c1">; buffer can be processed here before reinjecting</span>
    <span class="p">(</span><span class="k">net-send-to</span> <span class="p">(</span><span class="nv">rlist</span> <span class="ss">0</span><span class="p">)</span> <span class="ss">divertPort</span> <span class="ss">buffer</span> <span class="ss">divertSocket</span><span class="p">)</span>
<span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>For more information see the Unix man pages for <em>divert</em> and the <em>ipfw</em>
(BSDs) or <em>ipchains</em> (Linux) configuration utilities.</p></div>
<div class="paragraph"><p><a id="net-local"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_net_local_span"><span class="big red">net-local</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (net-local <em>int-socket</em>)</p></div>
<div class="paragraph"><p>Returns the IP number and port of the local computer for a connection on
a specific <em>int-socket</em>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">net-local</span> <span class="ss">16</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="s">&quot;204.179.131.73&quot;</span> <span class="ss">1689</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Use the <a href="#net-peer">net-peer</a> function to access the remote
computer&#8217;s IP number and port.</p></div>
<div class="paragraph"><p><a id="net-lookup"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_net_lookup_span"><span class="big red">net-lookup</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (net-lookup <em>str-ip-number</em>)<br>
<strong>syntax:</strong> (net-lookup <em>str-hostname</em> [<em>bool</em>])</p></div>
<div class="paragraph"><p>Returns either a hostname string from <em>str-ip-number</em> in IP dot format
or the IP number in dot format from <em>str-hostname</em>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">net-lookup</span> <span class="s">&quot;209.24.120.224&quot;</span><span class="p">)</span>    <span class="err">→</span> <span class="s">&quot;www.nuevatec.com&quot;</span>
<span class="p">(</span><span class="k">net-lookup</span> <span class="s">&quot;www.nuevatec.com&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;209.24.120.224&quot;</span>

<span class="p">(</span><span class="k">net-lookup</span> <span class="s">&quot;216.16.84.66.sbl-xbl.spamhaus.org&quot;</span> <span class="k">true</span><span class="p">)</span>
<span class="err">→</span> <span class="s">&quot;216.16.84.66&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>Optionally, a <em>bool</em> flag can be specified in the second syntax. If the
expression in <em>bool</em> evaluates to anything other than <span class="monospaced">nil</span>,
host-by-name lookup will be forced, even if the name string starts with
an IP number.</p></div>
<div class="paragraph"><p><a id="net-packet"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_net_packet_span"><span class="big red">net-packet</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (net-packet <em>str-packet</em>)</p></div>
<div class="paragraph"><p>The function allows custom configured network packets to be sent via a
<em>raw sockets</em> interface. The packet in <em>str-packet</em> must start with an
IP (Internet Protocol) header followed by either a TCP, UDP or ICMP
header and optional data. newLISP must be run with super user
privileges, and this function is only available on Mac OS X, Linux and
other Unix operating systems and only for IPv4. Currently <span class="monospaced">net-packet</span>
is IPv4 only and has been tested on MAC OS X, Linux and OpenBSD.</p></div>
<div class="paragraph"><p>On success the function returns the number of bytes sent. On failure the
function returns <span class="monospaced">nil</span> and both, <a href="#net-error">net-error</a> and
<a href="#sys-error">sys-error</a>, should be inspected.</p></div>
<div class="paragraph"><p>When custom configured packets contains zeros in the checksum fields,
<span class="monospaced">net-packet</span> will calculate and insert the correct checksums. Already
existing checksums stay untouched.</p></div>
<div class="paragraph"><p>The following example injects a UDP packet for IP number <span class="monospaced">192.168.1.92</span>.
The IP header consists of 20 bytes ending with the target IP number. The
following UDP header has a length of 8 bytes and is followed by the data
string <span class="monospaced">Hello World</span>. The checksum bytes in both headers are left as
<span class="monospaced">0x00 0x00</span> and will be recalculated internally.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">; packet as generated by: (net-send-udp &quot;192.168.1.92&quot; 12345 &quot;Hello World&quot;)</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">udp-packet</span> <span class="p">(</span><span class="k">pack</span> <span class="p">(</span><span class="k">dup</span> <span class="s">&quot;b&quot;</span> <span class="ss">39</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span>
    <span class="ss">0x45</span> <span class="ss">0x00</span> <span class="ss">0x00</span> <span class="ss">0x27</span> <span class="ss">0x4b</span> <span class="ss">0x8f</span> <span class="ss">0x00</span> <span class="ss">0x00</span> <span class="ss">0x40</span> <span class="ss">0x11</span> <span class="ss">0x00</span> <span class="ss">0x00</span> <span class="ss">192</span>  <span class="ss">168</span>  <span class="ss">1</span>    <span class="ss">95</span>
    <span class="ss">192</span>  <span class="ss">168</span>  <span class="ss">1</span>    <span class="ss">92</span>   <span class="ss">0xf2</span> <span class="ss">0xc8</span> <span class="ss">0x30</span> <span class="ss">0x39</span> <span class="ss">0x00</span> <span class="ss">0x13</span> <span class="ss">0x00</span> <span class="ss">0x00</span> <span class="ss">0x48</span> <span class="ss">0x65</span> <span class="ss">0x6c</span> <span class="ss">0x6c</span>
    <span class="ss">0x6f</span> <span class="ss">0x20</span> <span class="ss">0x57</span> <span class="ss">0x6f</span> <span class="ss">0x72</span> <span class="ss">0x6c</span> <span class="ss">0x64</span><span class="p">)))</span>

<span class="p">(</span><span class="k">unless</span> <span class="p">(</span><span class="k">net-packet</span> <span class="ss">udp-packet</span><span class="p">)</span>
    <span class="p">(</span><span class="k">println</span> <span class="s">&quot;net-error: &quot;</span> <span class="p">(</span><span class="k">net-error</span><span class="p">))</span>
    <span class="p">(</span><span class="k">println</span> <span class="s">&quot;sys-error: &quot;</span> <span class="p">(</span><span class="k">sys-error</span><span class="p">)))</span>
</pre></div></div></div>
<div class="paragraph"><p>The <span class="monospaced">net-packet</span> function is used when testing net security. Its wrong
application can upset the correct functioning of network routers and
other devices connected to a network. For this reason the function
should only be used on well isolated, private intra-nets and only by
network professionals.</p></div>
<div class="paragraph"><p>For other examples of packet configuration, see the file
<span class="monospaced">qa-specific-tests/qa-packet</span> in the newLISP source distribution.</p></div>
<div class="paragraph"><p><a id="net-peek"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_net_peek_span"><span class="big red">net-peek</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (net-peek <em>int-socket</em>)</p></div>
<div class="paragraph"><p>Returns the number of bytes ready for reading on the network socket
<em>int-socket</em>. If an error occurs or the connection is closed, <span class="monospaced">nil</span> is
returned.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">aSock</span> <span class="p">(</span><span class="k">net-connect</span> <span class="s">&quot;aserver.com&quot;</span> <span class="ss">123</span><span class="p">))</span>

<span class="p">(</span><span class="k">while</span> <span class="p">(</span> <span class="ss">=</span> <span class="p">(</span><span class="k">net-peek</span> <span class="ss">aSock</span><span class="p">)</span> <span class="ss">0</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">do-something-else</span><span class="p">))</span>

<span class="p">(</span><span class="k">net-receive</span> <span class="ss">aSock</span> <span class="ss">buff</span> <span class="ss">1024</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>After connecting, the program waits in a while loop until <span class="monospaced">aSock</span> can be
read.</p></div>
<div class="paragraph"><p>Use the <a href="#peek">peek</a> function to check file descriptors and <span class="monospaced">stdin</span>.</p></div>
<div class="paragraph"><p><a id="net-peer"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_net_peer_span"><span class="big red">net-peer</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (net-peer <em>int-socket</em>)</p></div>
<div class="paragraph"><p>Returns the IP number and port number of the remote computer for a
connection on <em>int-socket</em>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">net-peer</span> <span class="ss">16</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="s">&quot;192.100.81.100&quot;</span> <span class="ss">13</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Use the <a href="#net-local">net-local</a> function to access the local
computer&#8217;s IP number and port number.</p></div>
<div class="paragraph"><p><a id="net-ping"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_net_ping_span"><span class="big red">net-ping</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (net-ping <em>str-address</em> [<em>int-timeout</em> [<em>int-count</em> <em>bool</em>]]])<br>
<strong>syntax:</strong> (net-ping <em>list-addresses</em> [<em>int-timeout</em> [<em>int-count</em> <em>bool</em>]]])</p></div>
<div class="paragraph"><p>This function is only available on Unix-based systems and must be run in
superuser mode, i.e. using: <span class="monospaced">sudo newlisp</span> to start newLISP on Mac OS X
or other BSD&#8217;s, or as the root user on Linux. Broadcast mode and
specifying ranges with the <span class="monospaced">-</span> (hyphen) or <em>*</em> (star) are not available
on IPv6 address mode.</p></div>
<div class="paragraph"><p>Since version 10.1.7, superuser mode is not required on Mac OS X.</p></div>
<div class="paragraph"><p>In the first syntax, <span class="monospaced">net-ping</span> sends a ping ICMP 64-byte echo request
to the address specified in <em>str-address</em>. If it is a broadcast address,
the ICMP packet will be received by all addresses on the subnet. Note
that for security reasons, many computers do not answer ICMP broadcast
ping (ICMP_ECHO) requests. An optional timeout parameter can be
specified in <em>int-timeout</em>. If no timeout is specified, a waiting time
of 1000 milliseconds (one second) is assumed.</p></div>
<div class="paragraph"><p><span class="monospaced">net-ping</span> returns either a list of lists of IP strings and round-trip
time in microseconds for which a response was received or an empty list
if no response was received.</p></div>
<div class="paragraph"><p>A return value of <span class="monospaced">nil</span> indicates a failure. Use the
<a href="#net-error">net-error</a> function to retrieve the error message. If
the message reads <span class="monospaced">Cannot open socket</span>, it is probably because newLISP
is running without root permissions. newLISP can be started using:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre>sudo newlisp
</pre></div></div></div>
<div class="paragraph"><p>Alternatively, newLISP can be installed with the set-user-ID bit set to
run in superuser mode.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">net-ping</span> <span class="s">&quot;newlisp.org&quot;</span><span class="p">)</span>     <span class="err">→</span> <span class="p">((</span><span class="s">&quot;66.235.209.72&quot;</span> <span class="ss">634080</span><span class="p">))</span>
<span class="p">(</span><span class="k">net-ping</span> <span class="s">&quot;127.0.0.1&quot;</span><span class="p">)</span>       <span class="err">→</span> <span class="p">((</span><span class="s">&quot;127.0.0.1&quot;</span> <span class="ss">115</span><span class="p">))</span>
<span class="p">(</span><span class="k">net-ping</span> <span class="s">&quot;yahoo.com&quot;</span> <span class="ss">3000</span><span class="p">)</span>  <span class="err">→</span> <span class="k">nil</span>
</pre></div></div></div>
<div class="paragraph"><p>In the second syntax, <span class="monospaced">net-ping</span> is run in <em>batch mode</em>. Only one socket
is opened in this mode, but multiple ICMP packets are sent out—one each
to multiple addresses specified in a list or specified by range. Packets
are sent out as fast as possible. In this case, multiple answers can be
received. If the same address is specified multiple times, the receiving
IP address will be flooded with ICMP packets.</p></div>
<div class="paragraph"><p>To limit the number of responses to be waited for in broadcast or batch
mode, an additional argument indicating the maximum number of responses
to receive can be specified in <em>int-count</em>. Usage of this parameter can
cause the function to return sooner than the specified timeout. When a
given number of responses has been received, <span class="monospaced">net-ping</span> will return
before the timeout has occurred. Not specifying <em>int-count</em> or
specifying <span class="monospaced">0</span> assumes an <em>int-count</em> equal to the number of packets
sent out.</p></div>
<div class="paragraph"><p>As third optional parameter, a <span class="monospaced">true</span> value can be specified. This
setting will return an error string instead of the response time, if the
host does not answer.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">net-ping</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;newlisp.org&quot;</span> <span class="s">&quot;192.168.1.255&quot;</span><span class="p">)</span> <span class="ss">2000</span> <span class="ss">20</span><span class="p">)</span>
<span class="err">→</span> <span class="p">((</span><span class="s">&quot;66.235.209.72&quot;</span> <span class="ss">826420</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;192.168.1.1&quot;</span> <span class="ss">124</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;192.168.1.254&quot;</span> <span class="ss">210</span><span class="p">))</span>

<span class="p">(</span><span class="k">net-ping</span> <span class="s">&quot;192.168.1.*&quot;</span> <span class="ss">500</span><span class="p">)</span> <span class="c1">; from 1 to 254</span>
<span class="err">→</span> <span class="p">((</span><span class="s">&quot;192.168.1.1&quot;</span> <span class="ss">120</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;192.168.1.2&quot;</span> <span class="ss">245</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;192.168.2.3&quot;</span> <span class="ss">180</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;192.168.2.254&quot;</span> <span class="ss">234</span><span class="p">))</span>

<span class="p">(</span><span class="k">net-ping</span> <span class="s">&quot;192.168.1.*&quot;</span> <span class="ss">500</span> <span class="ss">2</span><span class="p">)</span> <span class="c1">; returns after 2 responses</span>
<span class="err">→</span> <span class="p">((</span><span class="s">&quot;192.168.1.3&quot;</span> <span class="ss">115</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;192.168.1.1&quot;</span> <span class="ss">145</span><span class="p">))</span>

<span class="p">(</span><span class="k">net-ping</span> <span class="s">&quot;192.168.1.1-10&quot;</span> <span class="ss">1000</span><span class="p">)</span> <span class="c1">; returns after 1 second</span>
<span class="err">→</span> <span class="p">((</span><span class="s">&quot;192.168.1.3&quot;</span> <span class="ss">196</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;192.168.1.1&quot;</span> <span class="ss">205</span><span class="p">))</span>

<span class="p">(</span><span class="k">net-ping</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;192.168.1.100-120&quot;</span> <span class="s">&quot;192.168.1.124-132&quot;</span><span class="p">)</span> <span class="ss">2000</span><span class="p">)</span> <span class="c1">; returns after 2 seconds</span>
<span class="err">→</span> <span class="p">()</span>
</pre></div></div></div>
<div class="paragraph"><p>Broadcast or batch mode—as well as normal addresses and IP numbers or
hostnames— can be mixed in one <span class="monospaced">net-ping</span> statement by putting all of
the IP specs into a list.</p></div>
<div class="paragraph"><p>The second and third lines show how the batch mode of <span class="monospaced">net-ping</span> can be
initiated by specifying the <span class="monospaced">*</span> (asterisk) as a wildcard character for
the last subnet octet in the IP number. The fourth and fifth lines show
how an IP range can be specified for the last subnet octet in the IP
number. <span class="monospaced">net-ping</span> will iterate through all numbers from either 1 to 254
for the star <span class="monospaced">*</span> or the range specified, sending an ICMP packet to each
address. Note that this is different from the <em>broadcast</em> mode specified
with an IP octet of <span class="monospaced">255</span>. While in broadcast mode, <span class="monospaced">net-ping</span> sends out
only one packet, which is received by multiple addresses. Batch mode
explicitly generates multiple packets, one for each target address. When
specifying broadcast mode, <em>int-count</em> should be specified, too.</p></div>
<div class="paragraph"><p>When sending larger lists of IPs in batch mode over one socket, a longer
timeout may be necessary to allow enough time for all of the packets to
be sent out over one socket. If the timeout is too short, the function
<span class="monospaced">net-ping</span> may return an incomplete list or the empty list <span class="monospaced">()</span>. In this
case, <a href="#net-error">net-error</a> will return a timeout error. On error,
<span class="monospaced">nil</span> is returned and <a href="#net-error">net-error</a> can be used to retrieve
an error message.</p></div>
<div class="paragraph"><p>On some systems only lists up to a specific length can be handled
regardless of the timeout specified. In this case, the range should be
broken up into sub-ranges and used with multiple <span class="monospaced">net-ping</span> invocations.
In any case, <span class="monospaced">net-ping</span> will send out packages as quickly as possible.</p></div>
<div class="paragraph"><p><a id="net-receive"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_net_receive_a_href_destructive_a_span"><span class="big red">net-receive <a href="#destructive">!</a></span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (net-receive <em>int-socket</em> <em>sym-buffer</em> <em>int-max-bytes</em> [<em>wait-string</em>])</p></div>
<div class="paragraph"><p>Receives data on the socket <em>int-socket</em> into a string contained in
<em>sym-buffer</em>. <em>sym-buffer</em> can also be a default functor specified by a
context symbol for reference passing in and out of user-defined
functions.</p></div>
<div class="paragraph"><p>A maximum of <em>int-max-bytes</em> is received. <span class="monospaced">net-receive</span> returns the
number of bytes read. If there is a break in the connection, <span class="monospaced">nil</span> is
returned. The space reserved in <em>sym-buffer</em> is exactly the size of
bytes read.</p></div>
<div class="paragraph"><p>Note that <span class="monospaced">net-receive</span> is a blocking call and does not return until the
data arrives at <em>int-socket</em>. Use <a href="#net-peek">net-peek</a> or
<a href="#net-select">net-select</a> to find out if a socket is ready for
reading.</p></div>
<div class="paragraph"><p>Optionally, a <em>wait-string</em> can be specified as a fourth parameter.
<span class="monospaced">net-receive</span> then returns after a character or string of characters
matching <em>wait-string</em> is received. The <em>wait-string</em> will be part of
the data contained in <em>sym-buffer</em>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">gettime</span><span class="p">)</span>
    <span class="p">(</span><span class="k">net-connect</span> <span class="s">&quot;netcom.com&quot;</span> <span class="ss">13</span><span class="p">)</span>
    <span class="p">(</span><span class="k">net-receive</span> <span class="ss">socket</span> <span class="ss">buf</span> <span class="ss">256</span><span class="p">)</span>
    <span class="p">(</span><span class="k">print</span> <span class="ss">buf</span> <span class="s">&quot;\n&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="k">net-close</span> <span class="ss">socket</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p>When calling <span class="monospaced">gettime</span>, the program connects to port 13 of the server
netcom.com. Port 13 is a date-time service on most server installations.
Upon connection, the server sends a string containing the date and time
of day.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="k">net-receive-</span><span class="ss">line</span> <span class="ss">socket</span> <span class="ss">sBuff</span><span class="p">)</span>
    <span class="p">(</span><span class="k">net-receive</span> <span class="ss">socket</span> <span class="ss">sBuff</span> <span class="ss">256</span> <span class="s">&quot;\n&quot;</span><span class="p">))</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">bytesReceived</span> <span class="p">(</span><span class="k">net-receive-</span><span class="ss">line</span> <span class="ss">socket</span> <span class="o">&#39;</span><span class="ss">sm</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p>The second example defines a new function <span class="monospaced">net-receive-line</span>, which
returns after receiving a newline character (a string containing one
character in this example) or 256 characters. The "\n" string is part of
the contents of sBuff.</p></div>
<div class="paragraph"><p>Note that when the fourth parameter is specified, <span class="monospaced">net-receive</span> is
slower than the normal version because information is read
character-by-character. In most situations, the speed difference can be
neglected.</p></div>
<div class="paragraph"><p><a id="net-receive-from"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_net_receive_from_span"><span class="big red">net-receive-from</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (net-receive-from <em>int-socket</em> <em>int-max-size</em>)</p></div>
<div class="paragraph"><p><span class="monospaced">net-receive-from</span> can be used to set up non-blocking UDP
communications. The socket in <em>int-socket</em> must previously have been
opened by either <a href="#net-listen">net-listen</a> or
<a href="#net-connect">net-connect</a> (both using the <span class="monospaced">"udp"</span> option).
<em>int-max-size</em> specifies the maximum number of bytes that will be
received. On Linux/BSD, if more bytes are received, those will be
discarded; on Win32, <span class="monospaced">net-receive-from</span> returns <span class="monospaced">nil</span> and closes the
socket.</p></div>
<div class="paragraph"><p>On success <span class="monospaced">net-receive</span> returns a list of the data string, remote IP
number and remote port used. On failure it returns <span class="monospaced">nil</span>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">;; listen on port 1001 on the default address</span>
<span class="p">(</span><span class="k">net-listen</span> <span class="ss">1001</span> <span class="s">&quot;&quot;</span> <span class="s">&quot;udp&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">1980</span>

<span class="c1">;; optionally poll for arriving data with 100ms timeout</span>
<span class="p">(</span><span class="k">while</span> <span class="p">(</span><span class="k">not</span> <span class="p">(</span><span class="k">net-select</span> <span class="ss">1980</span> <span class="s">&quot;r&quot;</span> <span class="ss">100000</span><span class="p">))</span> <span class="p">(</span><span class="nv">do-something</span> <span class="ss">...</span> <span class="p">))</span>

<span class="p">(</span><span class="k">net-receive-from</span> <span class="ss">1980</span> <span class="ss">20</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="s">&quot;hello&quot;</span> <span class="s">&quot;192.168.0.5&quot;</span> <span class="ss">3240</span><span class="p">)</span>

<span class="c1">;; send answer back to sender</span>
<span class="p">(</span><span class="k">net-send-to</span> <span class="s">&quot;192.168.0.5&quot;</span> <span class="ss">3240</span> <span class="s">&quot;hello to you&quot;</span> <span class="ss">1980</span><span class="p">)</span>

<span class="p">(</span><span class="k">net-close</span> <span class="ss">1980</span><span class="p">)</span> <span class="c1">; close socket</span>
</pre></div></div></div>
<div class="paragraph"><p>The second line in this example is optional. Without it, the
<span class="monospaced">net-receive-from</span> call would block until data arrives. A UDP server
could be set up by listening and polling several ports, serving them as
they receive data.</p></div>
<div class="paragraph"><p>Note that <span class="monospaced">net-receive</span> could not be used in this case because it does
not return the sender&#8217;s address and port information, which are required
to talk back. In UDP communications, the data packet itself contains the
address of the sender, <em>not</em> the socket over which communication takes
place. <span class="monospaced">net-receive</span> can also be used for TCP/IP communications.</p></div>
<div class="paragraph"><p>See also the <a href="#net-connect">net-connect</a> function with the <span class="monospaced">"udp"</span>
option and the <a href="#net-send-to">net-send-to</a> function for sending UDP
data packets over open connections.</p></div>
<div class="paragraph"><p>For blocking short UDP transactions, see the
<a href="#net-send-udp">net-send-udp</a> and
<a href="#net-receive-udp">net-receive-udp</a> functions.</p></div>
<div class="paragraph"><p><a id="net-receive-udp"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_net_receive_udp_span"><span class="big red">net-receive-udp</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (net-receive-udp <em>int-port</em> <em>int-maxsize</em> [<em>int-microsec</em> [<em>str-addr-if</em>]])</p></div>
<div class="paragraph"><p>Receives a User Datagram Protocol (UDP) packet on port <em>int-port</em>,
reading <em>int-maxsize</em> bytes. If more than <em>int-maxsize</em> bytes are
received, bytes over <em>int-maxsize</em> are discarded on Linux/BSD; on Win32,
<span class="monospaced">net-receive-udp</span> returns <span class="monospaced">nil</span>. <span class="monospaced">net-receive-udp</span> blocks until a
datagram arrives or the optional timeout value in <em>int-microsec</em>
expires. When setting up communications between datagram sender and
receiver, the <span class="monospaced">net-receive-udp</span> statement must be set up first.</p></div>
<div class="paragraph"><p>No previous setup using <span class="monospaced">net-listen</span> or <span class="monospaced">net-connect</span> is necessary.</p></div>
<div class="paragraph"><p><span class="monospaced">net-receive-udp</span> returns a list containing a string of the UDP packet
followed by a string containing the sender&#8217;s IP number and the port
used.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">;; wait for datagram with maximum 20 bytes</span>
<span class="p">(</span><span class="k">net-receive-udp</span> <span class="ss">10001</span> <span class="ss">20</span><span class="p">)</span>

<span class="c1">;; or</span>
<span class="p">(</span><span class="k">net-receive-udp</span> <span class="ss">10001</span> <span class="ss">20</span> <span class="ss">5000000</span><span class="p">)</span>  <span class="c1">; wait for max 5 seconds</span>

<span class="c1">;; executed on remote computer</span>
<span class="p">(</span><span class="k">net-send-udp</span> <span class="s">&quot;nuevatec.com&quot;</span> <span class="ss">1001</span> <span class="s">&quot;Hello&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">4</span>

<span class="c1">;; returned from the net-receive-udp statement</span>
<span class="err">→</span> <span class="p">(</span><span class="s">&quot;Hello&quot;</span> <span class="s">&quot;128.121.96.1&quot;</span> <span class="ss">3312</span><span class="p">)</span>

<span class="c1">;; sending binary information</span>
<span class="p">(</span><span class="k">net-send-udp</span> <span class="s">&quot;ahost.com&quot;</span> <span class="ss">2222</span> <span class="p">(</span><span class="k">pack</span> <span class="s">&quot;c c c c&quot;</span> <span class="ss">0</span> <span class="ss">1</span> <span class="ss">2</span> <span class="ss">3</span><span class="p">))</span>
<span class="err">→</span> <span class="ss">4</span>

<span class="c1">;; extracting the received info</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">buff</span> <span class="p">(</span><span class="k">first</span> <span class="p">(</span><span class="k">net-receive-udp</span> <span class="ss">2222</span> <span class="ss">10</span><span class="p">)))</span>

<span class="p">(</span><span class="k">print</span> <span class="p">(</span><span class="k">unpack</span> <span class="s">&quot;c c c c&quot;</span> <span class="ss">buff</span><span class="p">))</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">0</span> <span class="ss">1</span> <span class="ss">2</span> <span class="ss">3</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>See also the <a href="#net-send-udp">net-send-udp</a> function for sending
datagrams and the <a href="#pack">pack</a> and <a href="#unpack">unpack</a> functions
for packing and unpacking binary information.</p></div>
<div class="paragraph"><p>To listen on a specified address on computers with more than one
interface card, an interface IP address or name can be optionally
specified in <em>str-addr-if</em>. When specifying <em>str-addr-if</em>, a timeout
must also be specified in <em>int-wait</em>.</p></div>
<div class="paragraph"><p>As an alternative, UDP communication can be set up using
<a href="#net-listen">net-listen</a>, or <a href="#net-connect">net-connect</a> together
with the <span class="monospaced">"udp"</span> option to make non-blocking data exchange possible with
<a href="#net-receive-from">net-receive-from</a> and
<a href="#net-send-to">net-send-to</a>.</p></div>
<div class="paragraph"><p><a id="net-select"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_net_select_span"><span class="big red">net-select</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (net-select <em>int-socket</em> <em>str-mode</em> <em>int-micro-seconds</em>)<br>
<strong>syntax:</strong> (net-select <em>list-sockets</em> <em>str-mode</em> <em>int-micro-seconds</em>)</p></div>
<div class="paragraph"><p>In the first form, <span class="monospaced">net-select</span> finds out about the status of one socket
specified in <em>int-socket</em>. Depending on <em>str-mode</em>, the socket can be
checked if it is ready for reading or writing, or if the socket has an
error condition. A timeout value is specified in <em>int-micro-seconds</em>.</p></div>
<div class="paragraph"><p>In the second syntax, <span class="monospaced">net-select</span> can check for a list of sockets in
<em>list-sockets</em>.</p></div>
<div class="paragraph"><p>The following value can be given for <em>str-mode</em>:</p></div>
<div class="paragraph"><p><span class="monospaced">"read"</span> or <span class="monospaced">"r"</span> to check if ready for reading or accepting.<br>
<span class="monospaced">"write"</span> or <span class="monospaced">"w"</span> to check if ready for writing.<br>
<span class="monospaced">"exception"</span> or <span class="monospaced">"e"</span> to check for an error condition.<br></p></div>
<div class="paragraph"><p>Read, send, or accept operations can be handled without blocking by
using the <span class="monospaced">net-select</span> function. <span class="monospaced">net-select</span> waits for a socket to be
ready for the value given in <em>int-micro-seconds</em>, then returns <span class="monospaced">true</span> or
<span class="monospaced">nil</span> depending on the readiness of the socket. During the select loop,
other portions of the program can run. On error,
<a href="#net-error">net-error</a> is set. When <span class="monospaced">-1</span> is specified for
<em>int-micro-seconds</em>, <span class="monospaced">net-select</span> will never time out.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">listen-socket</span> <span class="p">(</span><span class="k">net-listen</span> <span class="ss">1001</span><span class="p">))</span>

<span class="c1">;; wait for connection</span>
<span class="p">(</span><span class="k">while</span> <span class="p">(</span><span class="k">not</span> <span class="p">(</span><span class="k">net-select</span> <span class="ss">listen-socket</span> <span class="s">&quot;read&quot;</span> <span class="ss">1000</span><span class="p">))</span>
    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="k">net-error</span><span class="p">)</span> <span class="p">(</span><span class="k">print</span> <span class="p">(</span><span class="k">net-error</span><span class="p">))))</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">connection</span> <span class="p">(</span><span class="k">net-accept</span> <span class="ss">listen-socket</span><span class="p">))</span>
<span class="p">(</span><span class="k">net-send</span> <span class="ss">connection</span> <span class="s">&quot;hello&quot;</span><span class="p">)</span>

<span class="c1">;; wait for incoming message</span>
<span class="p">(</span><span class="k">while</span> <span class="p">(</span><span class="k">not</span> <span class="p">(</span><span class="k">net-select</span> <span class="ss">connection</span> <span class="s">&quot;read&quot;</span> <span class="ss">1000</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">do-something</span><span class="p">))</span>

<span class="p">(</span><span class="k">net-receive</span> <span class="ss">connection</span> <span class="ss">buff</span> <span class="ss">1024</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>When <span class="monospaced">net-select</span> is used, several listen and connection sockets can be
watched, and multiple connections can be handled. When used with a list
of sockets, <span class="monospaced">net-select</span> will return a list of ready sockets. The
following example would listen on two sockets and continue accepting and
servicing connections:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">listen-list</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1001</span> <span class="ss">1002</span><span class="p">))</span>

<span class="c1">; accept-connection, read-connection and write-connection</span>
<span class="c1">; are userdefined functions</span>

<span class="p">(</span><span class="k">while</span> <span class="p">(</span><span class="k">not</span> <span class="p">(</span><span class="k">net-error</span><span class="p">))</span>
    <span class="p">(</span><span class="k">dolist</span> <span class="p">(</span><span class="nv">conn</span> <span class="p">(</span><span class="k">net-select</span> <span class="ss">listen-list</span> <span class="s">&quot;r&quot;</span> <span class="ss">1000</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">accept-connection</span> <span class="ss">conn</span><span class="p">))</span>  <span class="c1">; build an accept-list</span>

    <span class="p">(</span><span class="k">dolist</span> <span class="p">(</span><span class="nv">conn</span> <span class="p">(</span><span class="k">net-select</span> <span class="ss">accept-list</span> <span class="s">&quot;r&quot;</span> <span class="ss">1000</span><span class="p">))</span>
    <span class="p">(</span><span class="k">read-</span><span class="ss">connection</span> <span class="ss">conn</span><span class="p">))</span>    <span class="c1">; read on connected sockets</span>

    <span class="p">(</span><span class="k">dolist</span> <span class="p">(</span><span class="nv">conn</span> <span class="p">(</span><span class="k">net-select</span> <span class="ss">accept-list</span> <span class="s">&quot;w&quot;</span> <span class="ss">1000</span><span class="p">))</span>
    <span class="p">(</span><span class="k">write-</span><span class="ss">connection</span> <span class="ss">conn</span><span class="p">)))</span>  <span class="c1">; write on connected sockets</span>
</pre></div></div></div>
<div class="paragraph"><p>In the second syntax, a list is returned containing all the sockets that
passed the test; if timeout occurred, an empty list is returned. An
error causes <a href="#net-error">net-error</a> to be set.</p></div>
<div class="paragraph"><p>Note that supplying a nonexistent socket to <span class="monospaced">net-select</span> will cause an
error to be set in <a href="#net-error">net-error</a>.</p></div>
<div class="paragraph"><p><a id="net-send"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_net_send_span"><span class="big red">net-send</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (net-send <em>int-socket</em> <em>str-buffer</em> [<em>int-num-bytes</em>])</p></div>
<div class="paragraph"><p>Sends the contents of <em>str-buffer</em> on the connection specified by
<em>int-socket</em>. If <em>int-num-bytes</em> is specified, up to <em>int-num-bytes</em> are
sent. If <em>int-num-bytes</em> is not specified, the entire contents will be
sent. <span class="monospaced">net-send</span> returns the number of bytes sent or <span class="monospaced">nil</span> on failure.</p></div>
<div class="paragraph"><p>On failure, use <a href="#net-error">net-error</a> to get more error
information.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">buf</span> <span class="s">&quot;hello there&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">net-send</span> <span class="ss">sock</span> <span class="ss">buf</span><span class="p">)</span>       <span class="err">→</span> <span class="ss">11</span>
<span class="p">(</span><span class="k">net-send</span> <span class="ss">sock</span> <span class="ss">buf</span> <span class="ss">5</span><span class="p">)</span>     <span class="err">→</span> <span class="ss">5</span>

<span class="p">(</span><span class="k">net-send</span> <span class="ss">sock</span> <span class="s">&quot;bye bye&quot;</span><span class="p">)</span> <span class="err">→</span> <span class="ss">7</span>
</pre></div></div></div>
<div class="paragraph"><p>The first <span class="monospaced">net-send</span> sends the string <span class="monospaced">"hello there"</span>, while the second
<span class="monospaced">net-send</span> sends only the string <span class="monospaced">"hello"</span>.</p></div>
<div class="paragraph"><p><a id="net-send-to"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_net_send_to_span"><span class="big red">net-send-to</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (net-send-to <em>str-remotehost</em> <em>int-remoteport</em> <em>str-buffer</em> <em>int-socket</em>)</p></div>
<div class="paragraph"><p>Can be used for either UDP or TCP/IP communications. The socket in
<em>int-socket</em> must have previously been opened with a
<a href="#net-connect">net-connect</a> or <a href="#net-listen">net-listen</a> function.
If the opening functions was used with the <span class="monospaced">"udp"</span> option, <span class="monospaced">net-listen</span>
or <span class="monospaced">net-connect</span> are not used to listen or to connect but only to create
the UDP socket. The host in <em>str-remotehost</em> can be specified either as
a hostname or as an IP-number string.</p></div>
<div class="paragraph"><p>When using <span class="monospaced">net-connect</span> together with <span class="monospaced">net-send-to</span>, then only one of
the functions should specify the remote host. The other should leave the
address as an empty string.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">;;;;;;;;;;;;;;;;;; UDP server</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">socket</span> <span class="p">(</span><span class="k">net-listen</span> <span class="ss">10001</span> <span class="s">&quot;&quot;</span> <span class="s">&quot;udp&quot;</span><span class="p">))</span>
<span class="p">(</span><span class="k">if</span> <span class="ss">socket</span> <span class="p">(</span><span class="k">println</span> <span class="s">&quot;server listening on port &quot;</span> <span class="ss">10001</span><span class="p">)</span>
       <span class="p">(</span><span class="k">println</span> <span class="p">(</span><span class="k">net-error</span><span class="p">)))</span>
<span class="p">(</span><span class="k">while</span> <span class="p">(</span><span class="k">not</span> <span class="p">(</span><span class="k">net-error</span><span class="p">))</span>
   <span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">msg</span> <span class="p">(</span><span class="k">net-receive-from</span> <span class="ss">socket</span> <span class="ss">255</span><span class="p">))</span>
   <span class="p">(</span><span class="k">println</span> <span class="s">&quot;-&gt; &quot;</span> <span class="ss">msg</span><span class="p">)</span>
   <span class="p">(</span><span class="k">net-send-to</span> <span class="p">(</span><span class="k">nth</span> <span class="ss">1</span> <span class="ss">msg</span><span class="p">)</span> <span class="p">(</span><span class="k">nth</span> <span class="ss">2</span> <span class="ss">msg</span><span class="p">)</span>
                <span class="p">(</span><span class="k">upper-case</span> <span class="p">(</span><span class="k">first</span> <span class="ss">msg</span><span class="p">))</span> <span class="ss">socket</span><span class="p">))</span>

<span class="c1">;;;;;;;;;;;;;;;;;; UDP client</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">socket</span> <span class="p">(</span><span class="k">net-listen</span> <span class="ss">10002</span> <span class="s">&quot;&quot;</span> <span class="s">&quot;udp&quot;</span><span class="p">))</span>
<span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="k">not</span> <span class="ss">socket</span><span class="p">)</span> <span class="p">(</span><span class="k">println</span> <span class="p">(</span><span class="k">net-error</span><span class="p">)))</span>
<span class="p">(</span><span class="k">while</span> <span class="p">(</span><span class="k">not</span> <span class="p">(</span><span class="k">net-error</span><span class="p">))</span>
   <span class="p">(</span><span class="k">print</span> <span class="s">&quot;&gt; &quot;</span><span class="p">)</span>
   <span class="p">(</span><span class="k">net-send-to</span> <span class="s">&quot;127.0.0.1&quot;</span> <span class="ss">10001</span> <span class="p">(</span><span class="k">read-</span><span class="ss">line</span><span class="p">)</span> <span class="ss">socket</span><span class="p">)</span>
   <span class="p">(</span><span class="k">net-receive</span> <span class="ss">socket</span> <span class="ss">buff</span> <span class="ss">255</span><span class="p">)</span>
   <span class="p">(</span><span class="k">println</span> <span class="s">&quot;-&gt; &quot;</span> <span class="ss">buff</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p>In the examples both, the client and the server use <span class="monospaced">net-listen</span> to
create the UDP socket for sending and receiving. The server extracts the
client address and port from the message received and uses it in the
<span class="monospaced">net-send-to</span> statement.</p></div>
<div class="paragraph"><p>See also the <a href="#net-receive-from">net-receive-from</a> function and the
<a href="#net-listen">net-listen</a> function with the <span class="monospaced">"udp"</span> option.</p></div>
<div class="paragraph"><p>For blocking short UDP transactions use <a href="#net-send-udp">net-send-udp</a>
and <a href="#net-receive-udp">net-receive-udp</a>.</p></div>
<div class="paragraph"><p><a id="net-send-udp"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_net_send_udp_span"><span class="big red">net-send-udp</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (net-send-udp <em>str-remotehost</em> <em>int-remoteport</em> <em>str-buffer</em> [<em>bool</em>])</p></div>
<div class="paragraph"><p>Sends a User Datagram Protocol (UDP) to the host specified in
<em>str-remotehost</em> and to the port in <em>int-remoteport</em>. The data sent is
in <em>str-buffer</em>.</p></div>
<div class="paragraph"><p>The theoretical maximum data size of a UDP packet on an IPv4 system is
64K minus IP layer overhead, but much smaller on most Unix flavors. 8k
seems to be a safe size on Mac OS X, BSDs and Linux.</p></div>
<div class="paragraph"><p>No previous setup using <span class="monospaced">net-connect</span> or <span class="monospaced">net-listen</span> is necessary.
<span class="monospaced">net-send-udp</span> returns immediately with the number of bytes sent and
closes the socket used. If no <span class="monospaced">net-receive-udp</span> statement is waiting at
the receiving side, the datagram sent is lost. When using datagram
communications over insecure connections, setting up a simple protocol
between sender and receiver is recommended for ensuring delivery. UDP
communication by itself does not guarantee reliable delivery as TCP/IP
does.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">net-send-udp</span> <span class="s">&quot;somehost.com&quot;</span> <span class="ss">3333</span> <span class="s">&quot;Hello&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">5</span>
</pre></div></div></div>
<div class="paragraph"><p><span class="monospaced">net-send-udp</span> is also suitable for sending binary information (e.g.,
the zero character or other non-visible bytes). For a more comprehensive
example, see <a href="#net-receive-udp">net-receive-udp</a>.</p></div>
<div class="paragraph"><p>Optionally, the sending socket can be put in broadcast mode by
specifying <span class="monospaced">true</span> or any expression not evaluating to <span class="monospaced">nil</span> in <em>bool</em>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">net-send-udp</span> <span class="s">&quot;192.168.1.255&quot;</span> <span class="ss">2000</span> <span class="s">&quot;Hello&quot;</span> <span class="k">true</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">5</span>
</pre></div></div></div>
<div class="paragraph"><p>The UDP will be sent to all nodes on the <span class="monospaced">192.168.1</span> network. Note that
on some operating systems, sending the network mask <span class="monospaced">255</span> without the
<em>bool</em> <span class="monospaced">true</span> option will enable broadcast mode.</p></div>
<div class="paragraph"><p>As an alternative, the <a href="#net-connect">net-connect</a> function using the
<span class="monospaced">"udp"</span> option—together with the <a href="#net-send-to">net-send-to</a>
function—can be used to talk to a UDP listener in a non-blocking
fashion.</p></div>
<div class="paragraph"><p><a id="net-service"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_net_service_span"><span class="big red">net-service</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (net-service <em>str-service</em> <em>str-protocol</em>)<br>
<strong>syntax:</strong> (net-service <em>int-port</em> <em>str-protocol</em>)</p></div>
<div class="paragraph"><p>In the first syntax <span class="monospaced">net-service</span> makes a lookup in the <em>services</em>
database and returns the standard port number for this service.</p></div>
<div class="paragraph"><p>In the second syntax a service port is supplied in <em>int-port</em> to look up
the service name.</p></div>
<div class="paragraph"><p>Returns <span class="monospaced">nil</span> on failure.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">; get the port number from the name</span>
<span class="p">(</span><span class="k">net-service</span> <span class="s">&quot;ftp&quot;</span> <span class="s">&quot;tcp&quot;</span><span class="p">)</span>       <span class="err">→</span> <span class="ss">21</span>
<span class="p">(</span><span class="k">net-service</span> <span class="s">&quot;http&quot;</span> <span class="s">&quot;tcp&quot;</span><span class="p">)</span>      <span class="err">→</span> <span class="ss">80</span>
<span class="p">(</span><span class="k">net-service</span> <span class="s">&quot;net-eval&quot;</span> <span class="s">&quot;tcp&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">4711</span>  <span class="c1">; if configured</span>

<span class="c1">; get the service name from the port number</span>
<span class="p">(</span><span class="k">net-service</span> <span class="ss">22</span> <span class="s">&quot;tcp&quot;</span><span class="p">)</span>          <span class="err">→</span> <span class="s">&quot;ssh&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p><a id="net-sessions"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_net_sessions_span"><span class="big red">net-sessions</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (net-sessions)</p></div>
<div class="paragraph"><p>Returns a list of active listening and connection sockets.</p></div>
<div class="paragraph"><p><a id="new"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_new_span"><span class="big red">new</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (new <em>context-source</em> <em>sym-context-target</em> [<em>bool</em>])<br>
<strong>syntax:</strong> (new <em>context-source</em>)</p></div>
<div class="paragraph"><p>The context <em>context-source</em> is copied to <em>sym-context-target</em>. If the
target context does not exist, a new context with the same variable
names and user-defined functions as in <em>context-source</em> is created. If
the target context already exists, then new symbols and definitions are
added. Existing symbols are only overwritten when the expression in
<em>bool</em> evaluates to anything other than <span class="monospaced">nil</span>; otherwise, the content of
existing symbols will remain. This makes <em>mixins</em> of context objects
possible. <span class="monospaced">new</span> returns the target context, which cannot be MAIN.</p></div>
<div class="paragraph"><p>In the second syntax, the existing context in <em>context-source</em> gets
copied into the current context as the target context.</p></div>
<div class="paragraph"><p>All references to symbols in the originating context will be translated
to references in the target context. This way, all functions and data
structures referring to symbols in the original context will now refer
to symbols in the target context.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">new</span> <span class="ss">CTX</span> <span class="o">&#39;</span><span class="ss">CTX-2</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">CTX-2</span>

<span class="c1">;; force overwrite of existing symbols</span>
<span class="p">(</span><span class="k">new</span> <span class="ss">CTX</span> <span class="ss">MyCTX</span> <span class="k">true</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">MyCTX</span>
</pre></div></div></div>
<div class="paragraph"><p>The first line in the example creates a new context called <span class="monospaced">CTX-2</span> that
has the exact same structure as the original one. Note that <span class="monospaced">CTX</span> is not
quoted because contexts evaluate to themselves, but CTX-2 must be quoted
because it does not exist yet.</p></div>
<div class="paragraph"><p>The second line merges the context <span class="monospaced">CTX</span> into <span class="monospaced">MyCTX</span>. Any existing
symbols of the same name in <span class="monospaced">MyCTX</span> will be overwritten. Because <span class="monospaced">MyCTX</span>
already exists, the quote before the context symbol can be omitted.</p></div>
<div class="paragraph"><p>Context symbols need not be mentioned explicitly, but they can be
contained in variables:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">foo</span><span class="o">:</span><span class="ss">x</span> <span class="ss">123</span><span class="p">)</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">bar</span><span class="o">:</span><span class="ss">y</span> <span class="ss">999</span><span class="p">)</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">ctxa</span> <span class="ss">foo</span><span class="p">)</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">ctxb</span> <span class="ss">bar</span><span class="p">)</span>

<span class="p">(</span><span class="k">new</span> <span class="ss">ctxa</span> <span class="ss">ctxb</span><span class="p">)</span>  <span class="c1">; from foo to bar</span>

<span class="ss">bar</span><span class="o">:</span><span class="ss">x</span>  <span class="err">→</span> <span class="ss">123</span>  <span class="c1">; x has been added to bar</span>
<span class="ss">bar</span><span class="o">:</span><span class="ss">y</span>  <span class="err">→</span> <span class="ss">999</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The example refers to contexts in variables and merges context <span class="monospaced">foo</span>
into <span class="monospaced">bar</span>.</p></div>
<div class="paragraph"><p>See also the function <a href="#def-new">def-new</a> for moving and merging
single functions instead of entire contexts. See the
<a href="#context">context</a> function for a more comprehensive example of
<span class="monospaced">new</span>.</p></div>
<div class="paragraph"><p><a id="nil?"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_nil_span"><span class="big red">nil?</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (nil? <em>exp</em>)</p></div>
<div class="paragraph"><p>If the expression in <em>exp</em> evaluates to <span class="monospaced">nil</span>, then <span class="monospaced">nil?</span> returns
<span class="monospaced">true</span>; otherwise, it returns <span class="monospaced">nil</span>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">map</span> <span class="k">nil</span><span class="ss">?</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">x</span> <span class="k">nil</span>  <span class="ss">1</span> <span class="k">nil</span> <span class="s">&quot;hi&quot;</span> <span class="p">()))</span>
<span class="err">→</span> <span class="p">(</span><span class="k">nil</span> <span class="k">true</span> <span class="k">nil</span> <span class="k">true</span> <span class="k">nil</span> <span class="k">nil</span><span class="p">)</span>

<span class="p">(</span><span class="k">nil</span><span class="ss">?</span> <span class="k">nil</span><span class="p">)</span>  <span class="err">→</span> <span class="k">true</span>
<span class="p">(</span><span class="k">nil</span><span class="ss">?</span> <span class="o">&#39;</span><span class="p">())</span>  <span class="err">→</span> <span class="k">nil</span>

<span class="c1">; nil? means strictly nil</span>
<span class="p">(</span><span class="k">nil</span><span class="ss">?</span> <span class="p">(</span><span class="k">not</span> <span class="o">&#39;</span><span class="p">()))</span>  <span class="err">→</span> <span class="k">nil</span>
</pre></div></div></div>
<div class="paragraph"><p>The <span class="monospaced">nil?</span> predicate is useful for distinguishing between <span class="monospaced">nil</span> and the
empty list <span class="monospaced">()</span>.</p></div>
<div class="paragraph"><p>Note that <span class="monospaced">nil?</span> means <em>strictly</em> <span class="monospaced">nil</span> while <span class="monospaced">true?</span> means everything
not <span class="monospaced">nil</span> or the empty list <span class="monospaced">()</span>.</p></div>
<div class="paragraph"><p><a id="normal"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_normal_span"><span class="big red">normal</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (normal <em>float-mean</em> <em>float-stdev</em> <em>int-n</em>)<br>
<strong>syntax:</strong> (normal <em>float-mean</em> <em>float-stdev</em>)</p></div>
<div class="paragraph"><p>In the first form, <span class="monospaced">normal</span> returns a list of length <em>int-n</em> of random,
continuously distributed floating point numbers with a mean of
<em>float-mean</em> and a standard deviation of <em>float-stdev</em>. The random
generator used internally can be seeded using the <a href="#seed">seed</a>
function.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">normal</span> <span class="ss">10</span> <span class="ss">3</span> <span class="ss">10</span><span class="p">)</span>
<span class="err">→</span> <span class="p">(</span><span class="nv">7</span> <span class="ss">6.563476562</span> <span class="ss">11.93945312</span> <span class="ss">6.153320312</span> <span class="ss">9.98828125</span>
<span class="ss">7.984375</span> <span class="ss">10.17871094</span> <span class="ss">6.58984375</span> <span class="ss">9.42578125</span> <span class="ss">12.11230469</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>In the second form, <span class="monospaced">normal</span> returns a single normal distributed
floating point number:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">normal</span> <span class="ss">0</span> <span class="ss">1</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">0.6630859375</span>
</pre></div></div></div>
<div class="paragraph"><p>See also the <a href="#random">random</a> and <a href="#rand">rand</a> functions for
evenly distributed numbers, <a href="#amb">amb</a> for randomizing evaluation in
a list of expressions, and <a href="#seed">seed</a> for setting a different
start point for pseudo random number generation.</p></div>
<div class="paragraph"><p><a id="not"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_not_span"><span class="big red">not</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (not <em>exp</em>)</p></div>
<div class="paragraph"><p>If <em>exp</em> evaluates to <span class="monospaced">nil</span> or the empty list <span class="monospaced">()</span>, then <span class="monospaced">true</span> is
returned; otherwise, <span class="monospaced">nil</span> is returned.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">not</span> <span class="k">true</span><span class="p">)</span>            <span class="err">→</span> <span class="k">nil</span>
<span class="p">(</span><span class="k">not</span> <span class="k">nil</span><span class="p">)</span>             <span class="err">→</span> <span class="k">true</span>
<span class="p">(</span><span class="k">not</span> <span class="o">&#39;</span><span class="p">())</span>             <span class="err">→</span> <span class="k">true</span>
<span class="p">(</span><span class="k">not</span> <span class="p">(</span><span class="nv">&lt;</span> <span class="ss">1</span> <span class="ss">10</span><span class="p">))</span>        <span class="err">→</span> <span class="k">nil</span>
<span class="p">(</span><span class="k">not</span> <span class="p">(</span><span class="k">not</span> <span class="p">(</span><span class="nv">&lt;</span> <span class="ss">1</span> <span class="ss">10</span><span class="p">)))</span>  <span class="err">→</span> <span class="k">true</span>
</pre></div></div></div>
<div class="paragraph"><p><a id="now"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_now_span"><span class="big red">now</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (now [<em>int-minutes-offset</em> [<em>int-index</em>]])</p></div>
<div class="paragraph"><p>Returns information about the current date and time as a list of
integers. An optional time-zone offset can be specified in minutes in
<em>int-minutes-offset</em>. This causes the time to be shifted forward or
backward in time, before being split into separate date values.</p></div>
<div class="paragraph"><p>An optional list-index in <em>int-index</em> makes <span class="monospaced">now</span> return a specific
member in the result list.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">now</span><span class="p">)</span>       <span class="err">→</span> <span class="p">(</span><span class="nv">2002</span> <span class="ss">2</span> <span class="ss">27</span> <span class="ss">18</span> <span class="ss">21</span> <span class="ss">30</span> <span class="ss">140000</span> <span class="ss">57</span> <span class="ss">3</span> <span class="k">-</span><span class="ss">300</span> <span class="ss">0</span><span class="p">)</span>
<span class="p">(</span><span class="k">now</span> <span class="ss">0</span> <span class="k">-</span><span class="ss">2</span><span class="p">)</span>  <span class="err">→</span> <span class="k">-</span><span class="ss">300</span> <span class="c1">; minutes west of GMT</span>

<span class="p">(</span><span class="k">apply</span> <span class="k">date-value</span> <span class="p">(</span><span class="k">now</span><span class="p">))</span>  <span class="err">→</span> <span class="ss">1014834090</span>
</pre></div></div></div>
<div class="paragraph"><p>The numbers represent the following date-time fields:</p></div>
<table class="tableblock frame-all grid-all"
style="
width:50%;
">
<col style="width:25%;">
<col style="width:75%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" >format </th>
<th class="tableblock halign-left valign-top" >description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">year</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Gregorian calendar</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">month</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">(1–12)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">day</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">(1–31)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">hour</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">(0–23) UTC</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">minute</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">(0–59)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">second</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">(0–59)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">microsecond</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">(0–999999) OS-specific, millisecond resolution</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">day of current year</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Jan 1st is 1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">day of current week</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">(1–7) starting Monday</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">time zone offset in minutes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">west of GMT</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">daylight savings time type</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">(0–6) on Linux/Unix or bias in minutes on
Win32</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>The second example returns the Coordinated Universal Time (UTC) time
value of seconds after January 1, 1970.</p></div>
<div class="paragraph"><p>Ranging from 0 to 23, hours are given in UTC and are not adjusted for
the local time zone. The resolution of the <span class="monospaced">microseconds</span> field depends
on the operating system and platform. On some platforms, the last three
digits of the <span class="monospaced">microseconds</span> field are always <span class="monospaced">0</span> (zero).</p></div>
<div class="paragraph"><p>The "day of the week" field starts with 1 on Monday comforming to the
ISO 8601 international standard for date and time representation.</p></div>
<div class="paragraph"><p>On some platforms, the daylight savings time flag is not active and
returns <span class="monospaced">0</span> (zero) even during daylight savings time (dst).</p></div>
<div class="paragraph"><p>Depending on the geographical area, the daylight savings time type (dst)
has a different value from 1 to 6:</p></div>
<table class="tableblock frame-all grid-all"
style="
width:15%;
">
<col style="width:16%;">
<col style="width:83%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" >type </th>
<th class="tableblock halign-left valign-top" >area</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">not on dst</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">USA style dst</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Australian style dst</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Western European dst</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Middle European dst</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Eastern European dst</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Canada dst</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>See also the <a href="#date">date</a>, <a href="#date-list">date-list</a>,
<a href="#date-parse">date-parse</a>, <a href="#date-value">date-value</a>,
<a href="#time">time</a>, and <a href="#time-of-day">time-of-day</a> functions.</p></div>
<div class="paragraph"><p><a id="nper"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_nper_span"><span class="big red">nper</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (nper <em>num-interest</em> <em>num-pmt</em> <em>num-pv</em> [<em>num-fv</em> [<em>int-type</em>]])</p></div>
<div class="paragraph"><p>Calculates the number of payments required to pay a loan of <em>num-pv</em>
with a constant interest rate of <em>num-interest</em> and payment <em>num-pmt</em>.
If payment is at the end of the period, <em>int-type</em> is <span class="monospaced">0</span> (zero) or
<em>int-type</em> is omitted; for payment at the beginning of each period,
<em>int-type</em> is 1.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">nper</span> <span class="p">(</span><span class="k">div</span> <span class="ss">0.07</span> <span class="ss">12</span><span class="p">)</span> <span class="ss">775.30</span> <span class="k">-</span><span class="ss">100000</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">239.9992828</span>
</pre></div></div></div>
<div class="paragraph"><p>The example calculates the number of monthly payments required to pay a
loan of $100,000 at a yearly interest rate of 7 percent with payments of
$775.30.</p></div>
<div class="paragraph"><p>See also the <a href="#fv">fv</a>, <a href="#irr">irr</a>, <a href="#npv">npv</a>,
<a href="#pmt">pmt</a>, and <a href="#pv">pv</a> functions.</p></div>
<div class="paragraph"><p><a id="npv"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_npv_span"><span class="big red">npv</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (npv <em>num-interest</em> <em>list-values</em>)</p></div>
<div class="paragraph"><p>Calculates the net present value of an investment with a fixed interest
rate <em>num-interest</em> and a series of future payments and income in
<em>list-values</em>. Payments are represented by negative values in
<em>list-values</em>, while income is represented by positive values in
<em>list-values</em>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">npv</span> <span class="ss">0.1</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1000</span> <span class="ss">1000</span> <span class="ss">1000</span><span class="p">))</span>
<span class="err">→</span> <span class="ss">2486.851991</span>

<span class="p">(</span><span class="k">npv</span> <span class="ss">0.1</span> <span class="o">&#39;</span><span class="p">(</span><span class="k">-</span><span class="ss">2486.851991</span> <span class="ss">1000</span> <span class="ss">1000</span> <span class="ss">1000</span><span class="p">))</span>
<span class="err">→</span> <span class="k">-</span><span class="ss">1.434386832e-08</span>  <span class="c1">; ~ 0.0 (zero)</span>
</pre></div></div></div>
<div class="paragraph"><p>In the example, an initial investment of $2,481.85 would allow for an
income of $1,000 after the end of the first, second, and third years.</p></div>
<div class="paragraph"><p>See also the <a href="#fv">fv</a>, <a href="#irr">irr</a>, <a href="#nper">nper</a>,
<a href="#pmt">pmt</a>, and <a href="#pv">pv</a> functions.</p></div>
<div class="paragraph"><p><a id="nth"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_nth_a_href_utf8_capable_utf8_a_span"><span class="big red">nth <a href="#utf8_capable">utf8</a></span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (nth <em>int-index</em> <em>list</em>)<br>
<strong>syntax:</strong> (nth <em>int-index</em> <em>array</em>)<br>
<strong>syntax:</strong> (nth <em>int-index</em> <em>str</em>)<br>
<strong>syntax:</strong> (nth <em>list-indices</em> <em>list</em>)<br>
<strong>syntax:</strong> (nth <em>list-indices</em> <em>array</em>)</p></div>
<div class="paragraph"><p>In the first syntax group <span class="monospaced">nth</span> uses <em>int-index</em> an index into the
<em>list</em>, <em>array</em> or <em>str</em> found and returning the element found at that
index. See also <a href="#indexing">Indexing elements of strings and lists</a>.</p></div>
<div class="paragraph"><p>Multiple indices may be specified to recursively access elements in
nested lists or arrays. If there are more indices than nesting levels,
the extra indices are ignored. When multiple indices are used, they must
be put in a list as shown in the second syntax group.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">L</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span><span class="p">))</span>
<span class="p">(</span><span class="k">nth</span> <span class="ss">0</span> <span class="ss">L</span><span class="p">)</span>    <span class="err">→</span> <span class="ss">a</span>
<span class="c1">; or simply</span>
<span class="p">(</span><span class="nv">L</span> <span class="ss">0</span><span class="p">)</span> <span class="err">→</span> <span class="ss">a</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">names</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">john</span> <span class="ss">martha</span> <span class="ss">robert</span> <span class="ss">alex</span><span class="p">))</span>
<span class="err">→</span> <span class="p">(</span><span class="nv">john</span> <span class="ss">martha</span> <span class="ss">robert</span> <span class="ss">alex</span><span class="p">)</span>

<span class="p">(</span><span class="k">nth</span> <span class="ss">2</span> <span class="ss">names</span><span class="p">)</span>    <span class="err">→</span> <span class="ss">robert</span>
<span class="c1">; or simply</span>
<span class="p">(</span><span class="nv">names</span> <span class="ss">2</span><span class="p">)</span>        <span class="err">→</span> <span class="ss">robert</span>

<span class="p">(</span><span class="nv">names</span> <span class="k">-</span><span class="ss">1</span><span class="p">)</span>       <span class="err">→</span> <span class="ss">alex</span>

<span class="c1">; multiple indices</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">persons</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">john</span> <span class="ss">30</span><span class="p">)</span> <span class="p">(</span><span class="nv">martha</span> <span class="ss">120</span><span class="p">)</span> <span class="p">((</span><span class="nv">john</span> <span class="ss">doe</span><span class="p">)</span> <span class="ss">17</span><span class="p">)))</span>

<span class="p">(</span><span class="nv">persons</span> <span class="ss">1</span> <span class="ss">1</span><span class="p">)</span>           <span class="err">→</span> <span class="ss">120</span>

<span class="p">(</span><span class="k">nth</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">2</span> <span class="ss">0</span> <span class="ss">1</span><span class="p">)</span> <span class="ss">persons</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">doe</span>

<span class="c1">; or simply</span>
<span class="p">(</span><span class="nv">persons</span> <span class="ss">2</span> <span class="ss">0</span> <span class="ss">1</span><span class="p">)</span>        <span class="err">→</span> <span class="ss">doe</span>

<span class="c1">; multiple indices in a vector</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">v</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">2</span> <span class="ss">0</span> <span class="ss">1</span><span class="p">))</span>
<span class="p">(</span><span class="nv">persons</span> <span class="ss">v</span><span class="p">)</span>       <span class="err">→</span> <span class="ss">doe</span>
<span class="p">(</span><span class="k">nth</span> <span class="ss">v</span> <span class="ss">persons</span><span class="p">)</span>   <span class="err">→</span> <span class="ss">doe</span>

<span class="c1">; negative indices</span>
<span class="p">(</span><span class="nv">persons</span> <span class="k">-</span><span class="ss">2</span> <span class="ss">0</span><span class="p">)</span>    <span class="err">→</span> <span class="ss">martha</span>

<span class="c1">; out-of-bounds indices cause error</span>
<span class="p">(</span><span class="nv">persons</span> <span class="ss">10</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">ERR</span><span class="o">:</span> <span class="k">list</span> <span class="k">index</span> <span class="ss">out</span> <span class="ss">of</span> <span class="ss">bounds</span>
<span class="p">(</span><span class="nv">person</span> <span class="k">-</span><span class="ss">5</span><span class="p">)</span>   <span class="err">→</span> <span class="ss">ERR</span><span class="o">:</span> <span class="k">list</span> <span class="k">index</span> <span class="ss">out</span> <span class="ss">of</span> <span class="ss">bounds</span>
</pre></div></div></div>
<div class="paragraph"><p>The list <span class="monospaced">L</span> can be the context of the default functor <span class="monospaced">L:L</span>. This
allows lists passed by reference:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">L</span><span class="o">:</span><span class="ss">L</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span> <span class="ss">d</span> <span class="ss">e</span> <span class="ss">f</span> <span class="ss">g</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">second</span> <span class="ss">ctx</span><span class="p">)</span>
    <span class="p">(</span><span class="k">nth</span> <span class="ss">1</span> <span class="ss">ctx</span><span class="p">))</span>

<span class="p">(</span><span class="k">reverse</span> <span class="ss">L</span><span class="p">)</span> <span class="err">→</span> <span class="p">(</span><span class="nv">g</span> <span class="ss">f</span> <span class="ss">e</span> <span class="ss">d</span> <span class="ss">c</span> <span class="ss">b</span> <span class="ss">a</span><span class="p">)</span>
<span class="ss">L</span><span class="o">:</span><span class="ss">L</span> <span class="err">→</span> <span class="p">(</span><span class="nv">g</span> <span class="ss">f</span> <span class="ss">e</span> <span class="ss">d</span> <span class="ss">c</span> <span class="ss">b</span> <span class="ss">a</span><span class="p">)</span>

<span class="c1">;; passing the list in L:L by reference</span>
<span class="p">(</span><span class="nv">second</span> <span class="ss">L</span><span class="p">)</span>   <span class="err">→</span> <span class="ss">b</span>

<span class="c1">;; passing the list in L:L by value</span>
<span class="p">(</span><span class="nv">second</span> <span class="ss">L</span><span class="o">:</span><span class="ss">L</span><span class="p">)</span> <span class="err">→</span> <span class="ss">b</span>
</pre></div></div></div>
<div class="paragraph"><p>Reference passing is faster and uses less memory in big lists and should
be used on lists with more than a few hundred items.</p></div>
<div class="paragraph"><p>Note that the <em>implicit indexing</em> version of <span class="monospaced">nth</span> is not breaking
newLISP syntax rules but should be understood as a logical expansion of
newLISP syntax rules to other data types than built-in functions or
lambda expressions. A list in the functor position of an s-expression
assumes self-indexing functionality using the index arguments following.</p></div>
<div class="paragraph"><p>The implicit indexed syntax forms are faster but the other form with an
explicit <span class="monospaced">nth</span> may be more readable in some situations.</p></div>
<div class="paragraph"><p><span class="monospaced">nth</span> works on <a href="#array">arrays</a> just like it does on lists:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">aArray</span> <span class="p">(</span><span class="k">array</span> <span class="ss">2</span> <span class="ss">3</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span> <span class="ss">d</span> <span class="ss">e</span> <span class="ss">f</span><span class="p">)))</span>
<span class="err">→</span> <span class="p">((</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span><span class="p">)</span> <span class="p">(</span><span class="nv">d</span> <span class="ss">e</span> <span class="ss">f</span><span class="p">))</span>
<span class="p">(</span><span class="k">nth</span> <span class="ss">1</span> <span class="ss">aArray</span><span class="p">)</span>      <span class="err">→</span>  <span class="p">(</span><span class="nv">d</span> <span class="ss">e</span> <span class="ss">f</span><span class="p">)</span>
<span class="p">(</span><span class="nv">aArray</span> <span class="ss">1</span><span class="p">)</span>          <span class="err">→</span>  <span class="p">(</span><span class="nv">d</span> <span class="ss">e</span> <span class="ss">f</span><span class="p">)</span>

<span class="p">(</span><span class="k">nth</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1</span> <span class="ss">0</span><span class="p">)</span> <span class="ss">aArray</span><span class="p">)</span>    <span class="err">→</span> <span class="ss">d</span>
<span class="p">(</span><span class="nv">aArray</span> <span class="ss">1</span> <span class="ss">0</span><span class="p">)</span>           <span class="err">→</span> <span class="ss">d</span>
<span class="p">(</span><span class="nv">aArray</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1</span> <span class="ss">0</span><span class="p">))</span>        <span class="err">→</span> <span class="ss">d</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">vec</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1</span> <span class="ss">0</span><span class="p">))</span>
<span class="p">(</span><span class="nv">aArray</span> <span class="ss">vec</span><span class="p">)</span>           <span class="err">→</span> <span class="ss">d</span>
</pre></div></div></div>
<div class="paragraph"><p>In the String version, <span class="monospaced">nth</span> returns the character found at the position
<em>int-index</em> in <em>str</em> and returns it as a string.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">nth</span>  <span class="ss">0</span> <span class="s">&quot;newLISP&quot;</span><span class="p">)</span>   <span class="err">→</span> <span class="s">&quot;n&quot;</span>

<span class="p">(</span><span class="s">&quot;newLISP&quot;</span> <span class="ss">0</span><span class="p">)</span>        <span class="err">→</span> <span class="s">&quot;n&quot;</span>

<span class="p">(</span><span class="s">&quot;newLISP&quot;</span> <span class="k">-</span><span class="ss">1</span><span class="p">)</span>       <span class="err">→</span> <span class="s">&quot;P&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>Note that <a href="#nth">nth</a> works on character boundaries rather than byte
boundaries when using the UTF-8–enabled version of newLISP. To access
ASCII and binary string buffers on single byte boundaries use
<a href="#slice">slice</a>.</p></div>
<div class="paragraph"><p>See also <a href="#setf">setf</a> for modifying multidimensional lists and
arrays and <a href="#push">push</a> and <a href="#pop">pop</a> for modifying lists.</p></div>
<div class="paragraph"><p><a id="null?"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_null_span"><span class="big red">null?</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (null? <em>exp</em>)</p></div>
<div class="paragraph"><p>Checks if an expression evaluates to <span class="monospaced">nil</span>, the empty list <span class="monospaced">()</span>, the
empty string <span class="monospaced">""</span>, <span class="monospaced">NaN</span> (not a number), or <span class="monospaced">0</span> (zero), in which case it
returns <span class="monospaced">true</span>. In all other cases, <span class="monospaced">null?</span> returns <span class="monospaced">nil</span>. The predicate
<span class="monospaced">null?</span> is useful in conjunction with the functions <a href="#filter">filter</a>
or <a href="#clean">clean</a> to check the outcome of other newLISP operations.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">x</span> <span class="p">(</span><span class="k">sqrt</span> <span class="k">-</span><span class="ss">1</span><span class="p">))</span> <span class="err">→</span> <span class="ss">NaN</span> <span class="c1">; or nan on UNIX</span>
<span class="p">(</span><span class="nv">null?</span> <span class="ss">x</span><span class="p">)</span> <span class="err">→</span> <span class="k">true</span>

<span class="p">(</span><span class="k">map</span> <span class="ss">null?</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1</span> <span class="ss">0</span> <span class="ss">0.0</span> <span class="ss">2</span> <span class="s">&quot;hello&quot;</span> <span class="s">&quot;&quot;</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span><span class="p">)</span> <span class="p">()</span> <span class="k">true</span><span class="p">))</span>
<span class="err">→</span> <span class="p">(</span><span class="k">nil</span> <span class="k">true</span> <span class="k">true</span> <span class="k">nil</span> <span class="k">nil</span> <span class="k">true</span> <span class="k">nil</span> <span class="k">true</span> <span class="k">nil</span><span class="p">)</span>

<span class="p">(</span><span class="k">filter</span> <span class="ss">null?</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1</span> <span class="ss">0</span> <span class="ss">2</span> <span class="ss">0.0</span> <span class="s">&quot;hello&quot;</span> <span class="s">&quot;&quot;</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span><span class="p">)</span> <span class="p">()</span> <span class="k">nil</span> <span class="k">true</span><span class="p">))</span>
<span class="err">→</span> <span class="p">(</span><span class="nv">0</span> <span class="ss">0</span> <span class="s">&quot;&quot;</span> <span class="p">()</span> <span class="k">nil</span><span class="p">)</span>

<span class="p">(</span><span class="k">clean</span> <span class="ss">null?</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1</span> <span class="ss">0</span> <span class="ss">2</span> <span class="ss">0.0</span> <span class="s">&quot;hello&quot;</span> <span class="s">&quot;&quot;</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span><span class="p">)</span> <span class="p">()</span> <span class="k">nil</span> <span class="k">true</span><span class="p">))</span>
<span class="err">→</span> <span class="p">(</span><span class="nv">1</span> <span class="ss">2</span> <span class="s">&quot;hello&quot;</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span><span class="p">)</span> <span class="k">true</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>See also the predicates <a href="#emptyp">empty?</a>, <a href="#nilp">nil?</a> and
<a href="#zerop">zero?</a>.</p></div>
<div class="paragraph"><p><a id="number?"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_number_span"><span class="big red">number?</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (number? <em>exp</em>)</p></div>
<div class="paragraph"><p><span class="monospaced">true</span> is returned only if <em>exp</em> evaluates to a floating point number or
an integer; otherwise, <span class="monospaced">nil</span> is returned.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">x</span> <span class="ss">1.23</span><span class="p">)</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">y</span> <span class="ss">456</span><span class="p">)</span>
<span class="p">(</span><span class="nv">number?</span> <span class="ss">x</span><span class="p">)</span>      <span class="err">→</span> <span class="k">true</span>
<span class="p">(</span><span class="nv">number?</span> <span class="ss">y</span><span class="p">)</span>      <span class="err">→</span> <span class="k">true</span>
<span class="p">(</span><span class="nv">number?</span> <span class="s">&quot;678&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="k">nil</span>
</pre></div></div></div>
<div class="paragraph"><p>See the functions <a href="#floatp">float?</a> and <a href="#integerp">integer?</a> to
test for a specific number type.</p></div>
<div class="paragraph"><p><a id="odd?"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_odd_span"><span class="big red">odd?</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (odd? <em>int-number</em>)</p></div>
<div class="paragraph"><p>Checks the parity of an integer number. If the number is not <em>even
divisable</em> by <span class="monospaced">2</span>, it has <em>odd</em> parity. When a floating point number is
passed for <em>int-number</em>, it will be converted first to an integer by
cutting off its fractional part.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="nv">odd?</span> <span class="ss">123</span><span class="p">)</span>  <span class="err">→</span> <span class="k">true</span>
<span class="p">(</span><span class="nv">odd?</span> <span class="ss">8</span><span class="p">)</span>    <span class="err">→</span> <span class="k">nil</span>
<span class="p">(</span><span class="nv">odd?</span> <span class="ss">8.7</span><span class="p">)</span>  <span class="err">→</span> <span class="k">nil</span>
</pre></div></div></div>
<div class="paragraph"><p>Use <a href="#evenp">even?</a> to check if an integer is even, divisable by <span class="monospaced">2</span>.</p></div>
<div class="paragraph"><p><a id="open"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_open_span"><span class="big red">open</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (open <em>str-path-file</em> <em>str-access-mode</em> [<em>str-option</em>])</p></div>
<div class="paragraph"><p>The <em>str-path-file</em> is a file name, and <em>str-access-mode</em> is a string
specifying the file access mode. <span class="monospaced">open</span> returns an integer, which is a
file handle to be used on subsequent read or write operations on the
file. On failure, <span class="monospaced">open</span> returns <span class="monospaced">nil</span>. The access mode <span class="monospaced">"write"</span>
creates the file if it doesn&#8217;t exist, or it truncates an existing file
to <span class="monospaced">0</span> (zero) bytes in length.</p></div>
<div class="paragraph"><p>The following strings are legal access modes:</p></div>
<div class="paragraph"><p><span class="monospaced">"read"</span> or <span class="monospaced">"r"</span> for read only access<br>
<span class="monospaced">"write"</span> or <span class="monospaced">"w"</span> for write only access<br>
<span class="monospaced">"update"</span> or <span class="monospaced">"u"</span> for read/write access<br>
<span class="monospaced">"append"</span> or <span class="monospaced">"a"</span> for append read/write access<br></p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">device</span> <span class="p">(</span><span class="k">open</span> <span class="s">&quot;newfile.data&quot;</span> <span class="s">&quot;write&quot;</span><span class="p">))</span>  <span class="err">→</span> <span class="ss">5</span>
<span class="p">(</span><span class="k">print</span> <span class="s">&quot;hello world\n&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;hello world&quot;</span>
<span class="p">(</span><span class="k">close</span> <span class="p">(</span><span class="k">device</span><span class="p">))</span>         <span class="err">→</span> <span class="ss">5</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">aFile</span> <span class="p">(</span><span class="k">open</span> <span class="s">&quot;newfile.data&quot;</span> <span class="s">&quot;read&quot;</span><span class="p">))</span>
<span class="p">(</span><span class="k">seek</span> <span class="ss">aFile</span> <span class="ss">6</span><span class="p">)</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">inChar</span> <span class="p">(</span><span class="k">read-char</span> <span class="ss">aFile</span><span class="p">))</span>
<span class="p">(</span><span class="k">print</span> <span class="ss">inChar</span> <span class="s">&quot;\n&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">close</span> <span class="ss">aFile</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The first example uses <span class="monospaced">open</span> to set the device for <a href="#print">print</a>
and writes the word <span class="monospaced">"hello world"</span> into the file <span class="monospaced">newfile.data</span>. The
second example reads a byte value at offset 6 in the same file (the
ASCII value of <span class="monospaced">'w'</span> is 119). Note that using <span class="monospaced">close</span> on
<a href="#device">(device)</a> automatically resets <a href="#device">device</a> to <span class="monospaced">0</span>
(zero).</p></div>
<div class="paragraph"><p>As an additional <em>str-option</em>, <span class="monospaced">"non-block"</span> or <span class="monospaced">"n"</span> can be specified
after the <span class="monospaced">"read"</span> or <span class="monospaced">"write"</span> option. Only available on Unix systems,
non-blocking mode can be useful when opening <em>named pipes</em> but is not
required to perform I/O on named pipes.</p></div>
<div class="paragraph"><p>To create a named pipe in newLISP, use the <a href="#exec">exec</a> or
<a href="#import">import</a> function:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">exec</span> <span class="s">&quot;mkfifo myfifo&quot;</span><span class="p">)</span>

<span class="c1">;; or alternatively</span>

<span class="p">(</span><span class="k">import</span> <span class="s">&quot;/lib/libc.so.6&quot;</span> <span class="s">&quot;mkfifo&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="nv">mkfifo</span> <span class="s">&quot;/tmp/myfifo&quot;</span> <span class="ss">0777</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The named pipe can now be used like a file with <a href="#open">open</a>,
<a href="#read">read</a>, and <a href="#write">write</a>.</p></div>
<div class="paragraph"><p><a id="or"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_or_span"><span class="big red">or</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (or <em>exp-1</em> [<em>exp-2</em> &#8230; ])</p></div>
<div class="paragraph"><p>Evaluates expressions <em>exp-x</em> from left to right until finding a result
that does not evaluate to <span class="monospaced">nil</span> or the empty list <span class="monospaced">()</span>. The result is
the return value of the <span class="monospaced">or</span> expression.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">x</span> <span class="ss">10</span><span class="p">)</span>
<span class="p">(</span><span class="k">or</span> <span class="p">(</span><span class="nv">&gt;</span> <span class="ss">x</span> <span class="ss">100</span><span class="p">)</span> <span class="p">(</span><span class="nv">=</span> <span class="ss">x</span> <span class="ss">10</span><span class="p">))</span>          <span class="err">→</span> <span class="k">true</span>
<span class="p">(</span><span class="k">or</span> <span class="s">&quot;hello&quot;</span> <span class="p">(</span><span class="nv">&gt;</span> <span class="ss">x</span> <span class="ss">100</span><span class="p">)</span> <span class="p">(</span><span class="nv">=</span> <span class="ss">x</span> <span class="ss">10</span><span class="p">))</span>  <span class="err">→</span> <span class="s">&quot;hello&quot;</span>
<span class="p">(</span><span class="k">or</span> <span class="o">&#39;</span><span class="p">())</span>                         <span class="err">→</span> <span class="p">()</span>
<span class="p">(</span><span class="k">or</span> <span class="k">true</span><span class="p">)</span>                        <span class="err">→</span> <span class="k">true</span>
<span class="p">(</span><span class="k">or</span><span class="p">)</span>                             <span class="err">→</span> <span class="k">nil</span>
</pre></div></div></div>
<div class="paragraph"><p><a id="ostype"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_ostype_span"><span class="big red">ostype</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> ostype</p></div>
<div class="paragraph"><p><span class="monospaced">ostype</span> is a built-in system constant containing the name of the
operating system newLISP is running on.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">ostype</span>  <span class="err">→</span> <span class="s">&quot;Win32&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>One of the following strings is returned:
<span class="monospaced">"Linux", "BSD", "OSX", "Tru64Unix", "Solaris", "SunOS", "Win32", or "OS/2"</span>.</p></div>
<div class="paragraph"><p><span class="monospaced">ostype</span> can be used to write platform-independent code:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">if</span>
    <span class="p">(</span><span class="nv">=</span> <span class="k">ostype</span> <span class="s">&quot;Linux&quot;</span><span class="p">)</span> <span class="p">(</span><span class="k">import</span> <span class="s">&quot;libz.so&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">=</span> <span class="k">ostype</span> <span class="s">&quot;BSD&quot;</span><span class="p">)</span> <span class="p">(</span><span class="k">import</span> <span class="s">&quot;libz.so&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">=</span> <span class="k">ostype</span> <span class="s">&quot;OSX&quot;</span><span class="p">)</span> <span class="p">(</span><span class="k">import</span> <span class="s">&quot;libz.dylib&quot;</span><span class="p">)</span>
    <span class="ss">...</span>
    <span class="p">(</span><span class="k">println</span> <span class="s">&quot;cannot import libz on this platform&quot;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Use <a href="#sys-info">sys-info</a> to learn more about the current flavor of
newLISP running.</p></div>
<div class="paragraph"><p>For a table of other built-in system variables and symbols see the
chapter <a href="#system_symbols">System Symbols and Constants</a> in the
appendix.</p></div>
<div class="paragraph"><p><a id="pack"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_pack_span"><span class="big red">pack</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (pack <em>str-format</em> <em>exp-1</em> [<em>exp-2</em> &#8230; ])<br>
<strong>syntax:</strong> (pack <em>str-format</em> <em>list</em>)<br>
<strong>syntax:</strong> (pack <em>struct</em> <em>exp-1</em> [<em>exp-2</em> &#8230; ])<br>
<strong>syntax:</strong> (pack <em>struct</em> <em>list</em>)</p></div>
<div class="paragraph"><p>When the first parameter is a string, <span class="monospaced">pack</span> packs one or more
expressions (<em>exp-1</em> to <em>exp-n</em>) into a binary format specified in the
format string <em>str-format</em>, and returning the binary structure in a
string buffer. The symmetrical <a href="#unpack">unpack</a> function is used for
unpacking. The expression arguments can also be given in a <em>list</em>.
<span class="monospaced">pack</span> and <span class="monospaced">unpack</span> are useful when reading and writing binary files
(see <a href="#read">read</a> and <a href="#write">write</a>) or when unpacking binary
structures from return values of imported C functions using <span class="monospaced">import</span>.</p></div>
<div class="paragraph"><p>When the first parameter is the symbol of a <a href="#struct">struct</a>
definition, <span class="monospaced">pack</span> uses the format as specified in <em>struct</em>. While
<span class="monospaced">pack</span> with <em>str-format</em> literally packs as specified, <span class="monospaced">pack</span> with
<em>struct</em> will insert structure aligning pad-bytes depending on data
type, order of elements and CPU architecture. Refer to the description
of the <a href="#struct">struct</a> function for more detail.</p></div>
<div class="paragraph"><p>The following characters are used in <em>str-format</em>:</p></div>
<table class="tableblock frame-all grid-all"
style="
width:40%;
">
<col style="width:16%;">
<col style="width:83%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" >format </th>
<th class="tableblock halign-left valign-top" >description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">`c `</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">a signed 8-bit number</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">`b `</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">an unsigned 8-bit number</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">`d `</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">a signed 16-bit short number</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">`u `</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">an unsigned 16-bit short number</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">ld</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">a signed 32-bit long number</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">lu</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">an unsigned 32-bit long number</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">Ld</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">a signed 64-bit long number</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">Lu</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">an unsigned 64-bit long number</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">`f `</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">a float in 32-bit representation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">lf</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">a double float in 64-bit representation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">sn</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">a string of <em>n</em> null padded ASCII characters</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">nn</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><em>n</em> null characters</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">&gt;</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">switch to big endian byte order</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">&lt;</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">switch to little endian byte order</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p><span class="monospaced">pack</span> will convert all floats into integers when passed to <span class="monospaced">b</span>, <span class="monospaced">c</span>,
<span class="monospaced">d</span>, <span class="monospaced">ld</span>, or <span class="monospaced">lu</span> formats. It will also convert integers into floats
when passing them to <span class="monospaced">f</span> and <span class="monospaced">lf</span> formats.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">pack</span> <span class="s">&quot;c c c&quot;</span> <span class="ss">65</span> <span class="ss">66</span> <span class="ss">67</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;ABC&quot;</span>
<span class="p">(</span><span class="k">unpack</span> <span class="s">&quot;c c c&quot;</span> <span class="s">&quot;ABC&quot;</span><span class="p">)</span>   <span class="err">→</span> <span class="p">(</span><span class="nv">65</span> <span class="ss">66</span> <span class="ss">67</span><span class="p">)</span>

<span class="p">(</span><span class="k">pack</span> <span class="s">&quot;c c c&quot;</span> <span class="ss">0</span> <span class="ss">1</span> <span class="ss">2</span><span class="p">)</span>             <span class="err">→</span> <span class="s">&quot;\000\001\002&quot;</span>
<span class="p">(</span><span class="k">unpack</span> <span class="s">&quot;c c c&quot;</span> <span class="s">&quot;\000\001\002&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">0</span> <span class="ss">1</span> <span class="ss">2</span><span class="p">)</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">s</span> <span class="p">(</span><span class="k">pack</span> <span class="s">&quot;c d u&quot;</span> <span class="ss">10</span> <span class="ss">12345</span> <span class="ss">56789</span><span class="p">))</span>
<span class="p">(</span><span class="k">unpack</span> <span class="s">&quot;c d u&quot;</span> <span class="ss">s</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">10</span> <span class="ss">12345</span> <span class="ss">56789</span><span class="p">)</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">s</span> <span class="p">(</span><span class="k">pack</span> <span class="s">&quot;s10 f&quot;</span> <span class="s">&quot;result&quot;</span> <span class="ss">1.23</span><span class="p">))</span>
<span class="p">(</span><span class="k">unpack</span> <span class="s">&quot;s10 f&quot;</span> <span class="ss">s</span><span class="p">)</span>
<span class="err">→</span> <span class="p">(</span><span class="s">&quot;result\000\000\000\000&quot;</span> <span class="ss">1.230000019</span><span class="p">)</span>

<span class="p">(</span><span class="k">pack</span> <span class="s">&quot;n10&quot;</span><span class="p">)</span> <span class="err">→</span> <span class="s">&quot;\000\000\000\000\000\000\000\000\000\000&quot;</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">s</span> <span class="p">(</span><span class="k">pack</span> <span class="s">&quot;s3 lf&quot;</span> <span class="s">&quot;result&quot;</span> <span class="ss">1.23</span><span class="p">))</span>
<span class="p">(</span><span class="k">unpack</span> <span class="s">&quot;s3 f&quot;</span> <span class="ss">s</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="s">&quot;res&quot;</span> <span class="ss">1.23</span><span class="p">)</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">s</span> <span class="p">(</span><span class="k">pack</span> <span class="s">&quot;c n7 c&quot;</span> <span class="ss">11</span> <span class="ss">22</span><span class="p">))</span>
<span class="p">(</span><span class="k">unpack</span> <span class="s">&quot;c n7 c&quot;</span> <span class="ss">s</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">11</span> <span class="ss">22</span><span class="p">))</span>

<span class="p">(</span><span class="k">unpack</span> <span class="s">&quot;b&quot;</span> <span class="p">(</span><span class="k">pack</span> <span class="s">&quot;b&quot;</span> <span class="k">-</span><span class="ss">1.0</span><span class="p">))</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">255</span><span class="p">)</span>
<span class="p">(</span><span class="k">unpack</span> <span class="s">&quot;f&quot;</span> <span class="p">(</span><span class="k">pack</span> <span class="s">&quot;f&quot;</span> <span class="ss">123</span><span class="p">))</span>   <span class="err">→</span> <span class="p">(</span><span class="nv">123</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The last two statements show how floating point numbers are converted
into integers when required by the format specification.</p></div>
<div class="paragraph"><p>The expressions to pack can also be given in a list:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">lst</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;A&quot;</span> <span class="s">&quot;B&quot;</span> <span class="s">&quot;C&quot;</span><span class="p">))</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">adr</span> <span class="p">(</span><span class="k">pack</span> <span class="s">&quot;lululu&quot;</span> <span class="ss">lst</span><span class="p">))</span>
<span class="p">(</span><span class="k">map</span> <span class="k">get-string</span> <span class="p">(</span><span class="k">unpack</span> <span class="s">&quot;lululu&quot;</span> <span class="ss">adr</span><span class="p">))</span>    <span class="err">→</span> <span class="p">(</span><span class="s">&quot;A&quot;</span> <span class="s">&quot;B&quot;</span> <span class="s">&quot;C&quot;</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Note that the list should be referenced directly in <span class="monospaced">pack</span>, so the
pointers passed by <span class="monospaced">adr</span> are valid. <span class="monospaced">adr</span> would be written as
<span class="monospaced">char * adr[]</span> in the C-programming language and represents a 32-bit
pointer to an array of 32-bit string pointers.</p></div>
<div class="paragraph"><p>The <span class="monospaced">&gt;</span> and <span class="monospaced">&lt;</span> specifiers can be used to switch between <em>little endian</em>
and <em>big endian</em> byte order when packing or unpacking:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">pack</span> <span class="s">&quot;d&quot;</span> <span class="ss">1</span><span class="p">)</span>   <span class="err">→</span> <span class="s">&quot;\001\000&quot;</span>  <span class="c1">;; on little endian CPU</span>
<span class="p">(</span><span class="k">pack</span> <span class="s">&quot;&gt;d&quot;</span> <span class="ss">1</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;\000\001&quot;</span>  <span class="c1">;; force big endian</span>

<span class="p">(</span><span class="k">pack</span> <span class="s">&quot;ld&quot;</span> <span class="ss">1</span><span class="p">)</span>   <span class="err">→</span> <span class="s">&quot;\001\000\000\000&quot;</span> <span class="c1">;; on little endian CPU</span>
<span class="p">(</span><span class="k">pack</span> <span class="s">&quot;&lt;ld&quot;</span> <span class="ss">1</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;\000\000\000\001&quot;</span> <span class="c1">;; force big endian</span>

<span class="p">(</span><span class="k">pack</span> <span class="s">&quot;&gt;u &lt;u&quot;</span> <span class="ss">1</span> <span class="ss">1</span><span class="p">)</span> <span class="err">→</span> <span class="s">&quot;\000\001\001\000&quot;</span> <span class="c1">;; switch twice</span>
</pre></div></div></div>
<div class="paragraph"><p>Switching the byte order will affect all number formats with 16-, 32-,
or 64-bit sizes.</p></div>
<div class="paragraph"><p>The pack and unpack format need not be the same:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">s</span> <span class="p">(</span><span class="k">pack</span> <span class="s">&quot;s3&quot;</span> <span class="s">&quot;ABC&quot;</span><span class="p">))</span>
<span class="p">(</span><span class="k">unpack</span> <span class="s">&quot;c c c&quot;</span> <span class="ss">s</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">65</span> <span class="ss">66</span> <span class="ss">67</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The examples show spaces between the format specifiers. These are not
required but can be used to improve readability.</p></div>
<div class="paragraph"><p>See also the <a href="#address">address</a>, <a href="#get-int">get-int</a>,
<a href="#get-long">get-long</a>, <a href="#get-char">get-char</a>,
<a href="#get-string">get-string</a>, and <a href="#unpack">unpack</a> functions.</p></div>
<div class="paragraph"><p><a id="parse"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_parse_span"><span class="big red">parse</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (parse <em>str-data</em> [<em>str-break</em> [<em>int-option</em>]])</p></div>
<div class="paragraph"><p>Breaks the string that results from evaluating <em>str-data</em> into string
tokens, which are then returned in a list. When no <em>str-break</em> is given,
<span class="monospaced">parse</span> tokenizes according to newLISP&#8217;s internal parsing rules. A
string may be specified in <em>str-break</em> for tokenizing only at the
occurrence of a string. If an <em>int-option</em> number is specified, a
regular expression pattern may be used in <em>str-break</em>.</p></div>
<div class="paragraph"><p>When <em>str-break</em> is not specified, the maximum token size is 2048 for
quoted strings and 256 for identifiers. In this case, newLISP uses the
same faster tokenizer it uses for parsing newLISP source. If <em>str-break</em>
is specified, there is no limitation on the length of tokens. A
different algorithm is used that splits the source string <em>str-data</em> at
the string in <em>str-break</em>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">parse</span> <span class="s">&quot;hello how are you&quot;</span><span class="p">)</span>     <span class="err">→</span> <span class="p">(</span><span class="s">&quot;hello&quot;</span> <span class="s">&quot;how&quot;</span> <span class="s">&quot;are&quot;</span> <span class="s">&quot;you&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">parse</span> <span class="s">&quot;one:two:three&quot;</span> <span class="s">&quot;:&quot;</span><span class="p">)</span>     <span class="err">→</span> <span class="p">(</span><span class="s">&quot;one&quot;</span> <span class="s">&quot;two&quot;</span> <span class="s">&quot;three&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">parse</span> <span class="s">&quot;one--two--three&quot;</span> <span class="s">&quot;--&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="s">&quot;one&quot;</span> <span class="s">&quot;two&quot;</span> <span class="s">&quot;three&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">parse</span> <span class="s">&quot;one-two--three---four&quot;</span> <span class="s">&quot;-+&quot;</span> <span class="ss">0</span><span class="p">)</span>
<span class="err">→</span> <span class="p">(</span><span class="s">&quot;one&quot;</span> <span class="s">&quot;two&quot;</span> <span class="s">&quot;three&quot;</span> <span class="s">&quot;four&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">parse</span> <span class="s">&quot;hello regular   expression 1, 2, 3&quot;</span> <span class="s">{,\s*|\s+}</span> <span class="ss">0</span><span class="p">)</span>
<span class="err">→</span> <span class="p">(</span><span class="s">&quot;hello&quot;</span> <span class="s">&quot;regular&quot;</span> <span class="s">&quot;expression&quot;</span> <span class="s">&quot;1&quot;</span> <span class="s">&quot;2&quot;</span> <span class="s">&quot;3&quot;</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The last two examples show a regular expression as the break string with
the default option <span class="monospaced">0</span> (zero). Instead of <span class="monospaced">{</span> and <span class="monospaced">}</span> (left and right
curly brackets), double quotes can be used to limit the pattern. In this
case, double backslashes must be used inside the pattern. The last
pattern could be used for parsing CSV (Comma Separated Values) files.
For the regular expression option numbers, see <a href="#regex">regex</a>.</p></div>
<div class="paragraph"><p><span class="monospaced">parse</span> will return empty fields around separators as empty strings:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">parse</span> <span class="s">&quot;1,2,3,&quot;</span> <span class="s">&quot;,&quot;</span><span class="p">)</span> <span class="err">→</span> <span class="p">(</span><span class="s">&quot;1&quot;</span> <span class="s">&quot;2&quot;</span> <span class="s">&quot;3&quot;</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">parse</span> <span class="s">&quot;1,,,4&quot;</span> <span class="s">&quot;,&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="s">&quot;1&quot;</span> <span class="s">&quot;&quot;</span> <span class="s">&quot;&quot;</span> <span class="s">&quot;4&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">parse</span> <span class="s">&quot;,&quot;</span> <span class="s">&quot;,&quot;</span><span class="p">)</span>      <span class="err">→</span> <span class="p">(</span><span class="s">&quot;&quot;</span> <span class="s">&quot;&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">parse</span> <span class="s">&quot;&quot;</span><span class="p">)</span>      <span class="err">→</span> <span class="p">()</span>
<span class="p">(</span><span class="k">parse</span> <span class="s">&quot;&quot;</span> <span class="s">&quot; &quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="p">()</span>
</pre></div></div></div>
<div class="paragraph"><p>This behavior is needed when parsing records with empty fields.</p></div>
<div class="paragraph"><p>Parsing an empty string will always result in an empty list.</p></div>
<div class="paragraph"><p>Use the <a href="#regex">regex</a> function to break strings up and the
<a href="#directory">directory</a>, <a href="#find">find</a>, <a href="#find-all">find-all</a>,
<a href="#regex">regex</a>, <a href="#replace">replace</a>, and <a href="#search">search</a>
functions for using regular expressions.</p></div>
<div class="paragraph"><p><a id="peek"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_peek_span"><span class="big red">peek</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (peek <em>int-handle</em>)</p></div>
<div class="paragraph"><p>Returns the number of bytes ready to be read on a file descriptor;
otherwise, it returns <span class="monospaced">nil</span> if the file descriptor is invalid. <span class="monospaced">peek</span>
can also be used to check <span class="monospaced">stdin</span>. This function is only available on
Unix-like operating systems.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">peek</span> <span class="ss">0</span><span class="p">)</span>  <span class="c1">; check # of bytes ready on stdin</span>
</pre></div></div></div>
<div class="paragraph"><p>Use the <a href="#net-peek">net-peek</a> function to check for network sockets,
or for the number of available bytes on them. On Unix systems,
<a href="#net-peek">net-peek</a> can be used to check file descriptors. The
difference is that <a href="#net-peek">net-peek</a> also sets
<a href="#net-error">net-error</a>.</p></div>
<div class="paragraph"><p><a id="pipe"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_pipe_span"><span class="big red">pipe</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (pipe)</p></div>
<div class="paragraph"><p>Creates an inter-process communications pipe and returns the <span class="monospaced">read</span> and
<span class="monospaced">write</span> handles to it within a list.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">pipe</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">3</span> <span class="ss">4</span><span class="p">)</span>  <span class="c1">; 3 for read, 4 for writing</span>
</pre></div></div></div>
<div class="paragraph"><p>The pipe handles can be passed to a child process launched via
<a href="#process">process</a> or to <a href="#fork">fork</a> for inter-process
communications.</p></div>
<div class="paragraph"><p>Note that the pipe does not block when being written to, but it does
block reading until bytes are available. A <a href="#read-line">read-line</a>
blocks until a newline character is received. A <a href="#read">read</a> blocks
when fewer characters than specified are available from a pipe that has
not had the writing end closed by all processes.</p></div>
<div class="paragraph"><p>More than one pipe can be opened if required.</p></div>
<div class="paragraph"><p>newLISP can also use <em>named pipes</em>. See the <a href="#open">open</a> function
for further information.</p></div>
<div class="paragraph"><p><a id="pmt"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_pmt_span"><span class="big red">pmt</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (pmt <em>num-interest</em> <em>num-periods</em> <em>num-principal</em> [<em>num-future-value</em> [<em>int-type</em>]])</p></div>
<div class="paragraph"><p>Calculates the payment for a loan based on a constant interest of
<em>num-interest</em> and constant payments over <em>num-periods</em> of time.
<em>num-future-value</em> is the value of the loan at the end (typically
<span class="monospaced">0.0</span>). If payment is at the end of the period, <em>int-type</em> is <span class="monospaced">0</span> (zero)
or <em>int-type</em> is omitted; for payment at the beginning of each period,
<em>int-type</em> is 1.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">pmt</span> <span class="p">(</span><span class="k">div</span> <span class="ss">0.07</span> <span class="ss">12</span><span class="p">)</span> <span class="ss">240</span> <span class="ss">100000</span><span class="p">)</span>  <span class="err">→</span> <span class="k">-</span><span class="ss">775.2989356</span>
</pre></div></div></div>
<div class="paragraph"><p>The above example calculates a payment of $775.30 for a loan of $100,000
at a yearly interest rate of 7 percent. It is calculated monthly and
paid over 20 years (20 * 12 = 240 monthly periods). This illustrates the
typical way payment is calculated for mortgages.</p></div>
<div class="paragraph"><p>See also the <a href="#fv">fv</a>, <a href="#irr">irr</a>, <a href="#nper">nper</a>,
<a href="#npv">npv</a>, and <a href="#pv">pv</a> functions.</p></div>
<div class="paragraph"><p><a id="pop"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_pop_a_href_destructive_a_a_href_utf8_capable_utf8_a_span"><span class="big red">pop <a href="#destructive">!</a> <a href="#utf8_capable">utf8</a></span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (pop <em>list</em> [<em>int-index-1</em> [<em>int-index-2</em> &#8230; ]])<br>
<strong>syntax:</strong> (pop <em>list</em> [<em>list-indexes</em>])<br>
<strong>syntax:</strong> (pop <em>str</em> [<em>int-index</em> [<em>int-length</em>]])</p></div>
<div class="paragraph"><p>Using <span class="monospaced">pop</span>, elements can be removed from lists and characters from
strings.</p></div>
<div class="paragraph"><p>In the first syntax, <span class="monospaced">pop</span> extracts an element from the list found by
evaluating <em>list</em>. If a second parameter is present, the element at
<em>int-index</em> is extracted and returned. See also <a href="#indexing">Indexing
elements of strings and lists</a>.</p></div>
<div class="paragraph"><p>In the second version, indices are specified in the list <em>list-indexes</em>.
This way, <span class="monospaced">pop</span> works easily together with <a href="#ref">ref</a> and
<a href="#ref-all">ref-all</a>, which return lists of indices.</p></div>
<div class="paragraph"><p><span class="monospaced">pop</span> changes the contents of the target list. The popped element is
returned.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">pList</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">f</span> <span class="ss">g</span><span class="p">)</span> <span class="ss">a</span> <span class="ss">b</span> <span class="ss">c</span> <span class="s">&quot;hello&quot;</span> <span class="ss">d</span> <span class="ss">e</span> <span class="ss">10</span><span class="p">))</span>

<span class="p">(</span><span class="k">pop</span> <span class="ss">pList</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">f</span> <span class="ss">g</span><span class="p">)</span>
<span class="p">(</span><span class="k">pop</span> <span class="ss">pList</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">a</span>
<span class="ss">pList</span>        <span class="err">→</span> <span class="p">(</span><span class="nv">b</span> <span class="ss">c</span> <span class="s">&quot;hello&quot;</span> <span class="ss">d</span> <span class="ss">e</span> <span class="ss">10</span><span class="p">)</span>

<span class="p">(</span><span class="k">pop</span> <span class="ss">pList</span> <span class="ss">3</span><span class="p">)</span>    <span class="err">→</span> <span class="ss">d</span>
<span class="p">(</span><span class="k">pop</span> <span class="ss">pList</span> <span class="ss">100</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">10</span>
<span class="ss">pList</span>            <span class="err">→</span> <span class="p">(</span><span class="nv">b</span> <span class="ss">c</span> <span class="s">&quot;hello&quot;</span> <span class="ss">e</span><span class="p">)</span>

<span class="p">(</span><span class="k">pop</span> <span class="ss">pList</span> <span class="k">-</span><span class="ss">1</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">e</span>
<span class="ss">pList</span>           <span class="err">→</span> <span class="p">(</span><span class="nv">b</span> <span class="ss">c</span> <span class="s">&quot;hello&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">pop</span> <span class="ss">pList</span> <span class="k">-</span><span class="ss">2</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">c</span>
<span class="ss">pList</span>           <span class="err">→</span> <span class="p">(</span><span class="nv">b</span> <span class="s">&quot;hello&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">pList</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">2</span> <span class="p">(</span><span class="nv">x</span> <span class="ss">y</span> <span class="p">(</span><span class="nv">p</span> <span class="ss">q</span><span class="p">)</span> <span class="ss">z</span><span class="p">)))</span>

<span class="p">(</span><span class="k">pop</span> <span class="ss">pList</span> <span class="k">-</span><span class="ss">1</span> <span class="ss">2</span> <span class="ss">0</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">p</span>

<span class="c1">;; use indices in a list</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">pList</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="p">(</span><span class="nv">c</span> <span class="ss">d</span> <span class="p">()</span> <span class="ss">e</span><span class="p">)))</span>

<span class="p">(</span><span class="k">push</span> <span class="o">&#39;</span><span class="ss">x</span> <span class="ss">pList</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">2</span> <span class="ss">2</span> <span class="ss">0</span><span class="p">))</span>
<span class="err">→</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="p">(</span><span class="nv">c</span> <span class="ss">d</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="ss">e</span><span class="p">))</span>

<span class="ss">pList</span>
<span class="err">→</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="p">(</span><span class="nv">c</span> <span class="ss">d</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="ss">e</span><span class="p">))</span>

<span class="p">(</span><span class="k">ref</span> <span class="o">&#39;</span><span class="ss">x</span> <span class="ss">pList</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">2</span> <span class="ss">2</span> <span class="ss">0</span><span class="p">)</span>

<span class="p">(</span><span class="k">pop</span> <span class="ss">pList</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">2</span> <span class="ss">2</span> <span class="ss">0</span><span class="p">))</span>  <span class="err">→</span> <span class="ss">x</span>
</pre></div></div></div>
<div class="paragraph"><p><span class="monospaced">pop</span> can also be used on strings with one index:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">;; use pop on strings</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">str</span> <span class="s">&quot;newLISP&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">pop</span> <span class="ss">str</span> <span class="k">-</span><span class="ss">4</span> <span class="ss">4</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;LISP&quot;</span>

<span class="ss">str</span>  <span class="err">→</span> <span class="s">&quot;new&quot;</span>

<span class="p">(</span><span class="k">pop</span> <span class="ss">str</span> <span class="ss">1</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;e&quot;</span>

<span class="ss">str</span>  <span class="err">→</span> <span class="s">&quot;nw&quot;</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">str</span> <span class="s">&quot;x&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">pop</span> <span class="ss">str</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;x&quot;</span>
<span class="p">(</span><span class="k">pop</span> <span class="ss">str</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>Popping an empty string will return an empty string.</p></div>
<div class="paragraph"><p>See also the <a href="#push">push</a> function, the inverse operation to <span class="monospaced">pop</span>.</p></div>
<div class="paragraph"><p><a id="pop-assoc"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_pop_assoc_a_href_destructive_a_span"><span class="big red">pop-assoc <a href="#destructive">!</a></span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (pop-assoc <em>exp-key</em> <em>list-assoc</em>)<br>
<strong>syntax:</strong> (pop-assoc <em>list-keys</em> <em>list-assoc</em>)</p></div>
<div class="paragraph"><p>Removes an association referred to by the key in <em>exp-key</em> from the
association list in <em>list-assoc</em> and returns the popped expression.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">;; simple associations</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">L</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">a</span> <span class="ss">1</span><span class="p">)</span> <span class="p">(</span><span class="nv">b</span> <span class="ss">2</span><span class="p">)</span> <span class="p">(</span><span class="nv">c</span> <span class="ss">3</span><span class="p">)))</span>
<span class="p">(</span><span class="k">pop-assoc</span> <span class="o">&#39;</span><span class="ss">b</span> <span class="ss">L</span><span class="p">)</span> <span class="err">→</span> <span class="p">(</span><span class="nv">b</span> <span class="ss">2</span><span class="p">)</span>
<span class="ss">L</span> <span class="err">→</span> <span class="p">((</span><span class="nv">a</span> <span class="ss">1</span><span class="p">)</span> <span class="p">(</span><span class="nv">c</span> <span class="ss">3</span><span class="p">))</span>

<span class="c1">;; nested associations</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">L</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">a</span> <span class="p">(</span><span class="nv">b</span> <span class="ss">1</span><span class="p">)</span> <span class="p">(</span><span class="nv">c</span> <span class="p">(</span><span class="nv">d</span> <span class="ss">2</span><span class="p">)))))</span>
<span class="p">(</span><span class="k">pop-assoc</span> <span class="o">&#39;</span><span class="ss">a</span> <span class="ss">L</span><span class="p">)</span> <span class="err">→</span> <span class="p">(</span><span class="nv">a</span> <span class="p">(</span><span class="nv">b</span> <span class="ss">1</span><span class="p">)</span> <span class="p">(</span><span class="nv">c</span> <span class="p">(</span><span class="nv">d</span> <span class="ss">2</span><span class="p">)))</span>
<span class="ss">L</span> <span class="err">→</span> <span class="p">()</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">L</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">a</span> <span class="p">(</span><span class="nv">b</span> <span class="ss">1</span><span class="p">)</span> <span class="p">(</span><span class="nv">c</span> <span class="p">(</span><span class="nv">d</span> <span class="ss">2</span><span class="p">)))))</span>
<span class="p">(</span><span class="k">pop-assoc</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span><span class="p">)</span> <span class="ss">L</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">b</span> <span class="ss">1</span><span class="p">)</span>
<span class="ss">L</span> <span class="err">→</span>  <span class="p">((</span><span class="nv">a</span> <span class="p">(</span><span class="nv">c</span> <span class="p">(</span><span class="nv">d</span> <span class="ss">2</span><span class="p">))))</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">L</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">a</span> <span class="p">(</span><span class="nv">b</span> <span class="ss">1</span><span class="p">)</span> <span class="p">(</span><span class="nv">c</span> <span class="p">(</span><span class="nv">d</span> <span class="ss">2</span><span class="p">)))))</span>
<span class="p">(</span><span class="k">pop-assoc</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">c</span><span class="p">)</span> <span class="ss">L</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">c</span> <span class="p">(</span><span class="nv">d</span> <span class="ss">2</span><span class="p">))</span>
<span class="ss">L</span> <span class="err">→</span> <span class="p">((</span><span class="nv">a</span> <span class="p">(</span><span class="nv">b</span> <span class="ss">1</span><span class="p">))))</span>
</pre></div></div></div>
<div class="paragraph"><p>See also <a href="#assoc">assoc</a> for retrieving associations and
<a href="#setf">setf</a> for modifying association lists.</p></div>
<div class="paragraph"><p><a id="post-url"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_post_url_span"><span class="big red">post-url</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (post-url <em>str-url</em> <em>str-content</em> [<em>str-content-type</em> [<em>str-option</em>] [<em>int-timeout</em> [ <em>str-header</em>]]])</p></div>
<div class="paragraph"><p>Sends an HTTP POST request to the URL in <em>str-url</em>. POST requests are
used to post information collected from web entry forms to a web site.
Most of the time, the function <span class="monospaced">post-url</span> mimics what a web browser
would do when sending information collected in an HTML form to a server,
but it can also be used to upload files (see an HTTP reference). The
function returns the page returned from the server in a string.</p></div>
<div class="paragraph"><p>When <span class="monospaced">post-url</span> encounters an error, it returns a string description of
the error beginning with <span class="monospaced">ERR:</span>.</p></div>
<div class="paragraph"><p>The last parameter, <em>int-timeout</em>, is for an optional timeout value,
which is specified in milliseconds. When no response from the host is
received before the timeout has expired, the string <span class="monospaced">ERR: timeout</span> is
returned.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">;; specify content type</span>
<span class="p">(</span><span class="k">post-url</span> <span class="s">&quot;http://somesite.com/form.pl&quot;</span>
          <span class="s">&quot;name=johnDoe&amp;city=New%20York&quot;</span>
          <span class="s">&quot;application/x-www-form-urlencoded&quot;</span><span class="p">)</span>

<span class="c1">;; specify content type and timeout</span>
<span class="p">(</span><span class="k">post-url</span> <span class="s">&quot;http://somesite.com/form.pl&quot;</span>
          <span class="s">&quot;name=johnDoe&amp;city=New%20York&quot;</span>
          <span class="s">&quot;application/x-www-form-urlencoded&quot;</span> <span class="ss">8000</span><span class="p">)</span>

<span class="c1">;; assumes default content type and no timeout</span>
<span class="p">(</span><span class="k">post-url</span> <span class="s">&quot;http://somesite.com/form.pl&quot;</span>
          <span class="s">&quot;name=johnDoe&amp;city=New%20York&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>The above example uploads a user name and city using a special format
called <span class="monospaced">application/x-www-form-urlencoded</span>. <span class="monospaced">post-url</span> can be used to
post other content types such as files or binary data. See an HTTP
reference for other content-type specifications and data encoding
formats. When the content-type parameter is omitted, <span class="monospaced">post-url</span> assumes
<span class="monospaced">application/x-www-form-urlencoded</span> as the default content type.</p></div>
</div>
<div class="sect3">
<h4 id="_additional_parameters">Additional parameters</h4>
<div class="paragraph"><p>When <em>str-content-type</em> is specified, the <em>str-option</em> <span class="monospaced">"header"</span> or
<span class="monospaced">"list"</span> can be specified as the return page. If the <em>int-timeout</em>
option is specified, the custom header option <em>str-header</em> can be
specified, as well. See the function <a href="#get-url">get-url</a> for details
on both of these options.</p></div>
<div class="paragraph"><p>See also the <a href="#get-url">get-url</a> and <a href="#put-url">put-url</a>
functions.</p></div>
<div class="paragraph"><p><a id="pow"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_pow_span"><span class="big red">pow</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (pow <em>num-1</em> <em>num-2</em> [<em>num-3</em> &#8230; ])<br>
<strong>syntax:</strong> (pow <em>num-1</em>)</p></div>
<div class="paragraph"><p>Calculates <em>num-1</em> to the power of <em>num-2</em> and so forth.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">pow</span> <span class="ss">100</span> <span class="ss">2</span><span class="p">)</span>      <span class="err">→</span> <span class="ss">10000</span>
<span class="p">(</span><span class="k">pow</span> <span class="ss">100</span> <span class="ss">0.5</span><span class="p">)</span>    <span class="err">→</span> <span class="ss">10</span>
<span class="p">(</span><span class="k">pow</span> <span class="ss">100</span> <span class="ss">0.5</span> <span class="ss">3</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">1000</span>

<span class="p">(</span><span class="k">pow</span> <span class="ss">3</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">9</span>
</pre></div></div></div>
<div class="paragraph"><p>When <em>num-1</em> is the only argument, <span class="monospaced">pow</span> assumes 2 for the exponent.</p></div>
<div class="paragraph"><p><a id="prefix"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_prefix_span"><span class="big red">prefix</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (prefix <em>sym</em>)</p></div>
<div class="paragraph"><p>Returns the context of a symbol in <em>sym</em>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">setf</span> <span class="ss">s</span> <span class="o">&#39;</span><span class="ss">Foo</span><span class="o">:</span><span class="ss">bar</span><span class="p">)</span>      <span class="err">→</span> <span class="ss">Foo</span><span class="o">:</span><span class="ss">bar</span>
<span class="p">(</span><span class="k">prefix</span> <span class="ss">s</span><span class="p">)</span>             <span class="err">→</span> <span class="ss">Foo</span>
<span class="p">(</span><span class="k">context</span><span class="ss">?</span> <span class="p">(</span><span class="k">prefix</span> <span class="ss">s</span><span class="p">))</span>  <span class="err">→</span> <span class="k">true</span>

<span class="p">(</span><span class="k">term</span> <span class="ss">s</span><span class="p">)</span>                         <span class="err">→</span> <span class="s">&quot;bar&quot;</span>
<span class="p">(</span><span class="nv">=</span> <span class="ss">s</span> <span class="p">(</span><span class="k">sym</span> <span class="p">(</span><span class="k">term</span> <span class="ss">s</span><span class="p">)</span> <span class="p">(</span><span class="k">prefix</span> <span class="ss">s</span><span class="p">)))</span>  <span class="err">→</span> <span class="k">true</span>

<span class="ss">&gt;</span><span class="p">(</span><span class="k">context</span> <span class="p">(</span><span class="k">prefix</span> <span class="ss">s</span><span class="p">))</span>   <span class="c1">; switches to context Foo</span>
<span class="ss">Foo</span>
<span class="ss">Foo&gt;</span>
</pre></div></div></div>
<div class="paragraph"><p>See also <a href="#term">term</a> to extract the term part of a symbol.</p></div>
<div class="paragraph"><p><a id="pretty-print"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_pretty_print_span"><span class="big red">pretty-print</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (pretty-print [<em>int-length</em> [<em>str-tab</em> [<em>str-fp-format</em>]])</p></div>
<div class="paragraph"><p>Reformats expressions for <a href="#print">print</a>, <a href="#save">save</a>, or
<a href="#source">source</a> and when printing in an interactive console. The
first parameter, <em>int-length</em>, specifies the maximum line length, and
<em>str-tab</em> specifies the string used to indent lines. The third parameter
<em>str-fp-format</em> describes the default format for printing floating point
numbers. All parameters are optional. <span class="monospaced">pretty-print</span> returns the current
settings or the new settings when parameters are specified.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">pretty-print</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">80</span> <span class="s">&quot; &quot;</span> <span class="s">&quot;%1.10g&quot;</span><span class="p">)</span>  <span class="c1">; default setting</span>

<span class="p">(</span><span class="k">pretty-print</span> <span class="ss">90</span> <span class="s">&quot;\t&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">90</span> <span class="s">&quot;\t&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">pretty-print</span> <span class="ss">100</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">100</span> <span class="s">&quot;\t&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">sin</span> <span class="ss">1</span><span class="p">)</span>    <span class="err">→</span> <span class="ss">0.8414709848</span>
<span class="p">(</span><span class="k">pretty-print</span> <span class="ss">80</span> <span class="s">&quot; &quot;</span> <span class="s">&quot;%1.3f&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">sin</span> <span class="ss">1</span><span class="p">)</span>    <span class="err">→</span> <span class="ss">0.841</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">x</span> <span class="ss">0.0</span><span class="p">)</span>
<span class="ss">x</span>   <span class="err">→</span> <span class="ss">0.000</span>
</pre></div></div></div>
<div class="paragraph"><p>The first example reports the default settings of 80 for the maximum
line length and a <span class="monospaced">space</span> character for indenting. The second example
changes the line length to 90 and the indent to a TAB character. The
third example changes the line length only. The last example changes the
default format for floating point numbers. This is useful when printing
unformatted floating point numbers without fractional parts, and these
numbers should still be recognizable as floating point numbers. Without
the custom format, <span class="monospaced">x</span> would be printed as <span class="monospaced">0</span> indistinguishable from
floating point number. All situations where unformatted floating point
numbers are printed, are affected.</p></div>
<div class="paragraph"><p>Note that <span class="monospaced">pretty-print</span> cannot be used to prevent line breaks from
being printed. To completely suppress pretty printing, use the function
<a href="#string">string</a> to convert the expression to a raw unformatted
string as follows:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">;; print without formatting</span>

<span class="p">(</span><span class="k">print</span> <span class="p">(</span><span class="k">string</span> <span class="ss">my-expression</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p><a id="primitive?"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_primitive_span"><span class="big red">primitive?</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (primitive? <em>exp</em>)</p></div>
<div class="paragraph"><p>Evaluates and tests if <em>exp</em> is a primitive symbol and returns <span class="monospaced">true</span> or
<span class="monospaced">nil</span> depending on the result.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">var</span> <span class="k">define</span><span class="p">)</span>
<span class="p">(</span><span class="nv">primitive?</span> <span class="ss">var</span><span class="p">)</span>  <span class="err">→</span> <span class="k">true</span>
</pre></div></div></div>
<div class="paragraph"><p><a id="print"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_print_span"><span class="big red">print</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (print <em>exp-1</em> [<em>exp-2</em> &#8230; ])</p></div>
<div class="paragraph"><p>Evaluates and prints _exp-1_— to the current I/O device, which defaults
to the console window. See the built-in function <a href="#device">device</a>
for details on how to specify a different I/O device.</p></div>
<div class="paragraph"><p>List expressions are indented by the nesting levels of their opening
parentheses.</p></div>
<div class="paragraph"><p>Several special characters may be included in strings encoded with the
escape character <span class="monospaced">\</span>:</p></div>
<table class="tableblock frame-all grid-all"
style="
width:40%;
">
<col style="width:20%;">
<col style="width:80%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" >character </th>
<th class="tableblock halign-left valign-top" >description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">\n</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">the line-feed character (ASCII 10)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">\r</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">the carriage-return character (ASCII 13)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">\t</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">the tab character (ASCII 9)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">\nnn</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">where <span class="monospaced">nnn</span> is a decimal ASCII code between 000 and 255</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">\xnn</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">where <span class="monospaced">nn</span> is a hexadecimal ASCII code between 00 and FF</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">print</span> <span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">res</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">1</span> <span class="ss">2</span> <span class="ss">3</span><span class="p">)))</span>
<span class="p">(</span><span class="k">print</span> <span class="s">&quot;the result is&quot;</span> <span class="ss">res</span> <span class="s">&quot;\n&quot;</span><span class="p">)</span>

<span class="s">&quot;\065\066\067&quot;</span>  <span class="err">→</span> <span class="s">&quot;ABC&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>To finish printing with a line-feed, use <a href="#println">println</a>.</p></div>
<div class="paragraph"><p><a id="println"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_println_span"><span class="big red">println</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (println <em>exp-1</em> [<em>exp-2</em> &#8230; ])</p></div>
<div class="paragraph"><p>Evaluates and prints _exp-1_— to the current I/O device, which defaults
to the console window. A line-feed is printed at the end. See the
built-in function <a href="#device">device</a> for details on how to specify a
different I/O device. <span class="monospaced">println</span> works exactly like <a href="#print">print</a>
but emits a line-feed character at the end.</p></div>
<div class="paragraph"><p>See also the <a href="#write-line">write-line</a> and <a href="#print">print</a>
functions.</p></div>
<div class="paragraph"><p><a id="prob-chi2"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_prob_chi2_span"><span class="big red">prob-chi2</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (prob-chi2 <em>num-chi2</em> <em>int-df</em>)</p></div>
<div class="paragraph"><p>Returns the probability of an observed <em>Chi²</em> statistic in <em>num-chi2</em>
with <em>num-df</em> degrees of freedom to be equal or greater under the null
hypothesis. <span class="monospaced">prob-chi2</span> is derived from the incomplete Gamma function
<a href="#gammai">gammai</a>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">prob-chi2</span> <span class="ss">10</span> <span class="ss">6</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">0.1246520195</span>
</pre></div></div></div>
<div class="paragraph"><p>See also the inverse function <a href="#crit-chi2">crit-chi2</a>.</p></div>
<div class="paragraph"><p><a id="prob-f"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_prob_f_span"><span class="big red">prob-f</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (prob-f <em>num-f</em> <em>int-df1</em> <em>int-df2</em>)</p></div>
<div class="paragraph"><p>Returns the probability of an observed <em>F</em> statistic in <em>num-f</em> with
<em>int-df1</em> and <em>int-df2</em> degrees of freedom to be equal or greater under
the null hypothesis.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="nv">prob-f</span> <span class="ss">2.75</span> <span class="ss">10</span> <span class="ss">12</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">0.0501990804</span>
</pre></div></div></div>
<div class="paragraph"><p>See also the inverse function <a href="#crit-f">crit-f</a>.</p></div>
<div class="paragraph"><p><a id="prob-t"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_prob_t_span"><span class="big red">prob-t</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (prob-t <em>num-t</em> <em>int-df1</em>)</p></div>
<div class="paragraph"><p>Returns the probability of an observed <em>Student&#8217;s t</em> statistic in
<em>num-t</em> with <em>int-df</em> degrees of freedom to be equal or greater under
the null hypothesis.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="nv">prob-t</span> <span class="ss">1.76</span> <span class="ss">14</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">0.05011454551</span>
</pre></div></div></div>
<div class="paragraph"><p>See also the inverse function <a href="#crit-t">crit-t</a>.</p></div>
<div class="paragraph"><p><a id="prob-z"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_prob_z_span"><span class="big red">prob-z</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (prob-z <em>num-z</em>)</p></div>
<div class="paragraph"><p>Returns the probability of <em>num-z</em>, not to exceed the observed value
where <em>num-z</em> is a normal distributed value with a mean of <span class="monospaced">0.0</span> and a
standard deviation of <span class="monospaced">1.0</span>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">prob-z</span> <span class="ss">0.0</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">0.5</span>
</pre></div></div></div>
<div class="paragraph"><p>See also the inverse function <a href="#crit-z">crit-z</a>.</p></div>
<div class="paragraph"><p><a id="process"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_process_span"><span class="big red">process</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (process <em>str-command</em>)<br>
<strong>syntax:</strong> (process <em>str-command</em> <em>int-pipe-in</em> <em>int-pipe-out</em> [<em>int-win32-option</em>])<br>
<strong>syntax:</strong> (process <em>str-command</em> <em>int-pipe-in</em> <em>int-pipe-out</em> [<em>int-unix-pipe-error</em>])</p></div>
<div class="paragraph"><p>In the first syntax, <span class="monospaced">process</span> launches a process specified in
<em>str-command</em> and immediately returns with a process ID or <span class="monospaced">nil</span> if a
process could not be created. This process will execute the program
specified or immediately die if <em>str-command</em> could not be executed.</p></div>
<div class="paragraph"><p>On Mac OS X and other Unixes, the application or script must be
specified with its full path-name. The new process inherits the OS
environment from the parent process.</p></div>
<div class="paragraph"><p>Command line arguments are parsed out at spaces. Arguments containing
spaces must be delimited using single quotes on Mac OS X and other
Unixes. On Win32, double quotes are used. The process id returned can be
used to destroy the running process using <a href="#destroy">destroy</a>, if the
process does not exit by itself.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">process</span> <span class="s">&quot;c:/WINDOWS/system32/notepad.exe&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">1894</span> <span class="c1">; on Win32</span>

<span class="c1">; find out the path of the program to start using exec,</span>
<span class="c1">; if the path is not known</span>

<span class="p">(</span><span class="k">process</span> <span class="p">(</span><span class="k">first</span> <span class="p">(</span><span class="k">exec</span> <span class="s">&quot;which xclock&quot;</span><span class="p">)))</span>  <span class="err">→</span> <span class="ss">22607</span> <span class="c1">; on Unix</span>
</pre></div></div></div>
<div class="paragraph"><p>If the path of the executable is unknown, <span class="monospaced">exec</span> together with the Unix
<span class="monospaced">which</span> command can be used to start a program. The pid returned can be
used to <a href="#destroy">destroy</a> the process.</p></div>
<div class="paragraph"><p>In the second syntax, standard input and output of the created process
can be redirected to pipe handles. When remapping standard I/O of the
launched application to a pipe, it is possible to communicate with the
other application via <a href="#write-line">write-line</a> and
<a href="#read-line">read-line</a> or <a href="#write">write</a> and <a href="#read">read</a>
statements:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">;; Linux/Unix</span>
<span class="c1">;; create pipes</span>
<span class="p">(</span><span class="k">map</span> <span class="k">set</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">myin</span> <span class="ss">bcout</span><span class="p">)</span> <span class="p">(</span><span class="k">pipe</span><span class="p">))</span>
<span class="p">(</span><span class="k">map</span> <span class="k">set</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">bcin</span> <span class="ss">myout</span><span class="p">)</span> <span class="p">(</span><span class="k">pipe</span><span class="p">))</span>

<span class="c1">;; launch Unix &#39;bc&#39; calculator application</span>
<span class="p">(</span><span class="k">process</span> <span class="s">&quot;/usr/bin/bc&quot;</span> <span class="ss">bcin</span> <span class="ss">bcout</span><span class="p">)</span> <span class="err">→</span> <span class="ss">7916</span>

<span class="p">(</span><span class="k">write</span> <span class="ss">myout</span> <span class="s">&quot;3 + 4\n&quot;</span><span class="p">)</span>  <span class="c1">; bc expects a line-feed</span>

<span class="p">(</span><span class="k">read-</span><span class="ss">line</span> <span class="ss">myin</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;7&quot;</span>

<span class="c1">;; bc can use bignums with arbitrary precision</span>

<span class="p">(</span><span class="k">write</span> <span class="ss">myout</span> <span class="s">&quot;123456789012345 * 123456789012345\n&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">read-</span><span class="ss">line</span> <span class="ss">myin</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;15241578753238669120562399025&quot;</span>

<span class="c1">;; destroy the process</span>
<span class="p">(</span><span class="k">destroy</span> <span class="ss">7916</span><span class="p">)</span>

<span class="c1">;; Win32</span>
<span class="p">(</span><span class="k">map</span> <span class="k">set</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">myin</span> <span class="ss">cmdout</span><span class="p">)</span> <span class="p">(</span><span class="k">pipe</span><span class="p">))</span>
<span class="p">(</span><span class="k">map</span> <span class="k">set</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">cmdin</span> <span class="ss">myout</span><span class="p">)</span> <span class="p">(</span><span class="k">pipe</span><span class="p">))</span>

<span class="p">(</span><span class="k">process</span> <span class="s">&quot;c:/Program Files/newlisp/newlisp.exe -c&quot;</span> <span class="ss">cmdin</span> <span class="ss">cmdout</span><span class="p">)</span>
<span class="err">→</span> <span class="ss">1284</span>

<span class="p">(</span><span class="k">write-</span><span class="ss">line</span> <span class="ss">myout</span> <span class="s">&quot;(+ 3 4)&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">read-</span><span class="ss">line</span> <span class="ss">myin</span><span class="p">)</span> <span class="err">→</span> <span class="s">&quot;7&quot;</span>

<span class="c1">;; destroy the process</span>
<span class="p">(</span><span class="k">destroy</span> <span class="ss">1284</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>On Win32 versions of newLISP, a fourth optional parameter of
<em>int-win32-option</em> can be specified to control the display status of the
application. This option defaults to <span class="monospaced">1</span> for showing the application&#8217;s
window, <span class="monospaced">0</span> for hiding it, and <span class="monospaced">2</span> for showing it minimized on the
Windows launch bar.</p></div>
<div class="paragraph"><p>On both Win32 and Linux/Unix systems, standard error will be redirected
to standard out by default. On Linux/Unix, an optional pipe handle for
standard error output can be defined in <em>int-unix-pipe-error</em>.</p></div>
<div class="paragraph"><p>The function <a href="#peek">peek</a> can be used to check for information on
the pipe handles:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">;; create pipes</span>
<span class="p">(</span><span class="k">map</span> <span class="k">set</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">myin</span> <span class="ss">bcout</span><span class="p">)</span> <span class="p">(</span><span class="k">pipe</span><span class="p">))</span>
<span class="p">(</span><span class="k">map</span> <span class="k">set</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">bcin</span> <span class="ss">myout</span><span class="p">)</span> <span class="p">(</span><span class="k">pipe</span><span class="p">))</span>
<span class="p">(</span><span class="k">map</span> <span class="k">set</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">errin</span> <span class="ss">errout</span><span class="p">)</span> <span class="p">(</span><span class="k">pipe</span><span class="p">))</span>

<span class="c1">;; launch Unix &#39;bc&#39; calculator application</span>
<span class="p">(</span><span class="k">process</span> <span class="s">&quot;bc&quot;</span> <span class="ss">bcin</span> <span class="ss">bcout</span> <span class="ss">errout</span><span class="p">)</span>

<span class="p">(</span><span class="k">write</span> <span class="ss">myout</span> <span class="ss">command</span><span class="p">)</span>

<span class="c1">;; wait for bc sending result or error info</span>
<span class="p">(</span><span class="k">while</span> <span class="p">(</span><span class="k">and</span> <span class="p">(</span><span class="nv">=</span> <span class="p">(</span><span class="k">peek</span> <span class="ss">myin</span><span class="p">)</span> <span class="ss">0</span><span class="p">)</span>
            <span class="p">(</span><span class="nv">=</span> <span class="p">(</span><span class="k">peek</span> <span class="ss">errin</span><span class="p">)</span> <span class="ss">0</span><span class="p">))</span> <span class="p">(</span><span class="k">sleep</span> <span class="ss">10</span><span class="p">))</span>

<span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">&gt;</span> <span class="p">(</span><span class="k">peek</span> <span class="ss">errin</span><span class="p">)</span> <span class="ss">0</span><span class="p">)</span>
    <span class="p">(</span><span class="k">println</span> <span class="p">(</span><span class="k">read-</span><span class="ss">line</span> <span class="ss">errin</span><span class="p">)))</span>

<span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">&gt;</span> <span class="p">(</span><span class="k">peek</span> <span class="ss">myin</span><span class="p">)</span> <span class="ss">0</span><span class="p">)</span>
    <span class="p">(</span><span class="k">println</span> <span class="p">(</span><span class="k">read-</span><span class="ss">line</span> <span class="ss">myin</span><span class="p">)))</span>
</pre></div></div></div>
<div class="paragraph"><p>Not all interactive console applications can have their standard I/O
channels remapped. Sometimes only one channel, <em>in</em> or <em>out</em>, can be
remapped. In this case, specify <span class="monospaced">0</span> (zero) for the unused channel. The
following statement uses only the launched application&#8217;s output:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">process</span> <span class="s">&quot;app&quot;</span> <span class="ss">0</span> <span class="ss">appout</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Normally, two pipes are used: one for communications to the child
process and the other one for communications from the child process.</p></div>
<div class="paragraph"><p>See also the <a href="#pipe">pipe</a> and <a href="#share">share</a> functions for
inter-process communications and the <a href="#semaphore">semaphore</a> function
for synchronization of several processes. See the <a href="#fork">fork</a>
function for starting separate newLISP processes on Linux/Unix.</p></div>
<div class="paragraph"><p><a id="prompt-event"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_prompt_event_span"><span class="big red">prompt-event</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (prompt-event <em>sym-event-handler</em> | <em>func-event-handler</em>)</p></div>
<div class="paragraph"><p>Refines the prompt as shown in the interactive newLISP shell. The
<em>sym-event-handler</em> or <em>func-event-handler</em> is either a symbol of a
user-defined function or a lambda expression:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="ss">&gt;</span> <span class="p">(</span><span class="k">prompt-event</span> <span class="p">(</span><span class="k">fn</span> <span class="p">(</span><span class="nv">ctx</span><span class="p">)</span> <span class="p">(</span><span class="k">string</span> <span class="ss">ctx</span> <span class="s">&quot;:&quot;</span> <span class="p">(</span><span class="k">real-path</span><span class="p">)</span> <span class="s">&quot;$ &quot;</span><span class="p">)))</span>
<span class="k">$prompt-event</span>
<span class="k">MAIN</span><span class="o">:</span><span class="k">/</span><span class="ss">Users/newlisp$</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">)</span>
<span class="ss">7</span>
<span class="k">MAIN</span><span class="o">:</span><span class="k">/</span><span class="ss">Users/newlisp$</span>
</pre></div></div></div>
<div class="paragraph"><p>The current context before calling the <span class="monospaced">prompt-event</span> code is passed as
a parameter to the function. Computer output is shown in bold.</p></div>
<div class="paragraph"><p>The example redefines the <span class="monospaced">&gt;</span> prompt to be the current context followed
by a colon <span class="monospaced">:</span>, followed by the directory name, followed by the dollar
symbol. Together with the <a href="#command-event">command-event</a> function
this can be used to create fully customized shells or custom command
interpreters.</p></div>
<div class="paragraph"><p>The function in <span class="monospaced">prompt-event</span> must return a string of 63 characters
maximum. Not returning a string will leave the prompt unchanged.</p></div>
<div class="paragraph"><p><a id="protected?"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_protected_span"><span class="big red">protected?</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (protected? <em>sym</em>)</p></div>
<div class="paragraph"><p>Checks if a symbol in <em>sym</em> is protected. Protected symbols are built-in
functions, context symbols, and all symbols made constant using the
<a href="#constant">constant</a> function:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="nv">protected?</span> <span class="o">&#39;</span><span class="k">println</span><span class="p">)</span>    <span class="err">→</span> <span class="k">true</span>
<span class="p">(</span><span class="k">constant</span> <span class="o">&#39;</span><span class="ss">aVar</span> <span class="ss">123</span><span class="p">)</span>
<span class="p">(</span><span class="nv">protected?</span> <span class="o">&#39;</span><span class="ss">aVar</span><span class="p">)</span>       <span class="err">→</span> <span class="k">true</span>
</pre></div></div></div>
<div class="paragraph"><p><a id="push"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_push_a_href_destructive_a_a_href_utf8_capable_utf8_a_span"><span class="big red">push <a href="#destructive">!</a> <a href="#utf8_capable">utf8</a></span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (push <em>exp</em> <em>list</em> [<em>int-index-1</em> [<em>int-index-2</em> &#8230; ]])<br>
<strong>syntax:</strong> (push <em>exp</em> <em>list</em> [<em>list-indexes</em>])<br>
<strong>syntax:</strong> (push <em>str-1</em> <em>str-2</em> [<em>int-index</em>])</p></div>
<div class="paragraph"><p>Inserts the value of <em>exp</em> into the list <em>list</em>. If <em>int-index</em> is
present, the element is inserted at that index. If the index is absent,
the element is inserted at index <span class="monospaced">0</span> (zero), the first element. <span class="monospaced">push</span>
is a destructive operation that changes the contents of the target list.</p></div>
<div class="paragraph"><p>The list changed is returned as a reference on which other built-in
functions can work. See also <a href="#indexing">Indexing elements of strings
and lists</a>.</p></div>
<div class="paragraph"><p>If more than one <em>int-index</em> is present, the indices are used to access
a nested list structure. Improper indices (those not matching list
elements) are discarded.</p></div>
<div class="paragraph"><p>The second version takes a list of <em>list-indexes</em> but is otherwise
identical to the first. In this way, <span class="monospaced">push</span> works easily together with
<a href="#ref">ref</a> and <a href="#ref-all">ref-all</a>, which return lists of
indices.</p></div>
<div class="paragraph"><p>If <em>list</em> does not contain a list, <em>list</em> must contain a <span class="monospaced">nil</span> and will
be initialized to the empty list.</p></div>
<div class="paragraph"><p>Repeatedly using <span class="monospaced">push</span> to the end of a list using <span class="monospaced">-1</span> as the
<em>int-index</em> is optimized and as fast as pushing to the front of a list
with no index at all. This can be used to efficiently grow a list.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">; inserting in front</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">pList</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">b</span> <span class="ss">c</span><span class="p">))</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">b</span> <span class="ss">c</span><span class="p">)</span>
<span class="p">(</span><span class="k">push</span> <span class="o">&#39;</span><span class="ss">a</span> <span class="ss">pList</span><span class="p">)</span>      <span class="err">→</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span><span class="p">)</span>
<span class="ss">pList</span>                <span class="err">→</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span><span class="p">)</span>

<span class="c1">; insert at index</span>
<span class="p">(</span><span class="k">push</span> <span class="s">&quot;hello&quot;</span> <span class="ss">pList</span> <span class="ss">2</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="s">&quot;hello&quot;</span> <span class="ss">c</span><span class="p">)</span>

<span class="c1">; optimized appending at the end</span>
<span class="p">(</span><span class="k">push</span> <span class="o">&#39;</span><span class="ss">z</span> <span class="ss">pList</span> <span class="k">-</span><span class="ss">1</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="s">&quot;hello&quot;</span> <span class="ss">c</span> <span class="ss">z</span><span class="p">)</span>

<span class="c1">; inserting lists in lists</span>
<span class="p">(</span><span class="k">push</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">f</span> <span class="ss">g</span><span class="p">)</span> <span class="ss">pList</span><span class="p">)</span>  <span class="err">→</span> <span class="p">((</span><span class="nv">f</span> <span class="ss">g</span><span class="p">)</span> <span class="ss">a</span> <span class="ss">b</span> <span class="s">&quot;hello&quot;</span> <span class="ss">c</span> <span class="ss">z</span><span class="p">)</span>

<span class="c1">; inserting at negative index</span>
<span class="p">(</span><span class="k">push</span> <span class="o">&#39;</span><span class="ss">x</span> <span class="ss">pList</span> <span class="k">-</span><span class="ss">3</span><span class="p">)</span>  <span class="err">→</span> <span class="p">((</span><span class="nv">f</span> <span class="ss">g</span><span class="p">)</span> <span class="ss">a</span> <span class="ss">b</span> <span class="s">&quot;hello&quot;</span> <span class="ss">x</span> <span class="ss">c</span> <span class="ss">z</span><span class="p">)</span>

<span class="c1">; using multiple indices</span>
<span class="p">(</span><span class="k">push</span> <span class="o">&#39;</span><span class="ss">h</span> <span class="ss">pList</span> <span class="ss">0</span> <span class="k">-</span><span class="ss">1</span><span class="p">)</span>  <span class="err">→</span> <span class="p">((</span><span class="nv">f</span> <span class="ss">g</span> <span class="ss">h</span><span class="p">)</span> <span class="ss">a</span> <span class="ss">b</span> <span class="s">&quot;hello&quot;</span> <span class="ss">x</span> <span class="ss">c</span> <span class="ss">z</span><span class="p">)</span>

<span class="c1">; use indices in a list</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">pList</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="p">(</span><span class="nv">c</span> <span class="ss">d</span> <span class="p">()</span> <span class="ss">e</span><span class="p">)))</span>

<span class="p">(</span><span class="k">push</span> <span class="o">&#39;</span><span class="ss">x</span> <span class="ss">pList</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">2</span> <span class="ss">2</span> <span class="ss">0</span><span class="p">))</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="p">(</span><span class="nv">c</span> <span class="ss">d</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="ss">e</span><span class="p">))</span>

<span class="p">(</span><span class="k">ref</span> <span class="o">&#39;</span><span class="ss">x</span> <span class="ss">pList</span><span class="p">)</span>   <span class="err">→</span> <span class="p">(</span><span class="nv">2</span> <span class="ss">2</span> <span class="ss">0</span><span class="p">)</span>

<span class="p">(</span><span class="k">pop</span> <span class="ss">pList</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">2</span> <span class="ss">2</span> <span class="ss">0</span><span class="p">))</span>  <span class="err">→</span> <span class="ss">x</span>

<span class="c1">; push on un-initialized symbol</span>
<span class="ss">aVar</span>  <span class="err">→</span> <span class="k">nil</span>

<span class="p">(</span><span class="k">push</span> <span class="ss">999</span> <span class="ss">aVar</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">999</span><span class="p">)</span>

<span class="ss">aVar</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">999</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p><span class="monospaced">push</span> and pop can be combined to model a queue:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">; pop and push a as a queue</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">Q</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span> <span class="ss">d</span> <span class="ss">e</span><span class="p">))</span>

<span class="p">(</span><span class="k">pop</span> <span class="p">(</span><span class="k">push</span> <span class="o">&#39;</span><span class="ss">f</span> <span class="ss">Q</span> <span class="k">-</span><span class="ss">1</span><span class="p">))</span> <span class="err">→</span> <span class="ss">a</span>
<span class="p">(</span><span class="k">pop</span> <span class="p">(</span><span class="k">push</span> <span class="o">&#39;</span><span class="ss">g</span> <span class="ss">Q</span> <span class="k">-</span><span class="ss">1</span><span class="p">))</span> <span class="err">→</span> <span class="ss">b</span>

<span class="ss">Q</span> <span class="err">→</span>  <span class="p">(</span><span class="nv">c</span> <span class="ss">d</span> <span class="ss">e</span> <span class="ss">f</span> <span class="ss">g</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Because <span class="monospaced">push</span> returns a reference to the modified list, <span class="monospaced">pop</span> can work
on it directly.</p></div>
<div class="paragraph"><p>In the third syntax <span class="monospaced">push</span> can be used to change strings. When
<em>int-index</em> is used, it refers to character positions rather than byte
positions. UTF-8 characters may be multi-byte characters.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">;; push on strings</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">str</span> <span class="s">&quot;abcdefg&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">push</span> <span class="s">&quot;hijk&quot;</span> <span class="ss">str</span> <span class="k">-</span><span class="ss">1</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;abcdefghijk&quot;</span>
<span class="ss">str</span>                   <span class="err">→</span> <span class="s">&quot;abcdefghijk&quot;</span>

<span class="p">(</span><span class="k">push</span> <span class="s">&quot;123&quot;</span> <span class="ss">str</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;123abcdefghijk&quot;</span>
<span class="p">(</span><span class="k">push</span> <span class="s">&quot;4&quot;</span> <span class="ss">str</span> <span class="ss">3</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;1234abcdefghijk&quot;</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">str</span> <span class="s">&quot;\u03b1\u03b2\u03b3&quot;</span><span class="p">)</span>  <span class="err">→</span>  <span class="s">&quot;αβγ&quot;</span>

<span class="p">(</span><span class="k">push</span> <span class="s">&quot;*&quot;</span> <span class="ss">str</span> <span class="ss">1</span><span class="p">)</span>  <span class="err">→</span>  <span class="s">&quot;α*βγ&quot;</span>

<span class="c1">;; push on a string reference</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">lst</span> <span class="o">&#39;</span><span class="p">(</span><span class="s">&quot;abc&quot;</span> <span class="s">&quot;xyz&quot;</span><span class="p">))</span>

<span class="p">(</span><span class="k">push</span> <span class="ss">x</span> <span class="p">(</span><span class="nv">lst</span> <span class="ss">0</span><span class="p">))</span> <span class="err">→</span> <span class="s">&quot;xabc&quot;</span>

<span class="ss">lst</span> <span class="err">→</span> <span class="p">(</span><span class="s">&quot;xabc&quot;</span> <span class="s">&quot;xyz&quot;</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>See also the <a href="#pop">pop</a> function, which is the inverse operation to
<span class="monospaced">push</span>.</p></div>
<div class="paragraph"><p><a id="put-url"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_put_url_span"><span class="big red">put-url</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (put-url <em>str-url</em> <em>str-content</em> [<em>str-option</em>] [<em>int-timeout</em> [<em>str-header</em>]])</p></div>
<div class="paragraph"><p>The HTTP PUT protocol is used to transfer information in <em>str-content</em>
to a file specified in <em>str-url</em>. The lesser-known HTTP PUT mode is
frequently used for transferring web pages from HTML editors to Web
servers. In order to use PUT mode, the web server&#8217;s software must be
configured correctly. On the Apache web server, use the <span class="monospaced">'Script PUT'</span>
directive in the section where directory access rights are configured.</p></div>
<div class="paragraph"><p>If <em>str-url</em> starts with <span class="monospaced">file://</span> then <em>str-content</em> is written to the
local file system.</p></div>
<div class="paragraph"><p>Optionally, an <em>int-timeout</em> value can be specified in milliseconds as
the last parameter. <span class="monospaced">put-url</span> will return <span class="monospaced">ERR:     timeout</span> when the
host gives no response and the timeout expires. On other error
conditions, <span class="monospaced">put-url</span> returns a string starting with <span class="monospaced">ERR:</span> and the
description of the error.</p></div>
<div class="paragraph"><p><span class="monospaced">put-url</span> requests are also understood by newLISP server nodes.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">put-url</span> <span class="s">&quot;http://asite.com/myFile.txt&quot;</span> <span class="s">&quot;Hi there&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">put-url</span> <span class="s">&quot;http://asite.com/myFile.txt&quot;</span> <span class="s">&quot;Hi there&quot;</span> <span class="ss">2000</span><span class="p">)</span>

<span class="p">(</span><span class="k">put-url</span> <span class="s">&quot;http://asite.com/webpage.html&quot;</span>
    <span class="p">(</span><span class="k">read-</span><span class="ss">file</span> <span class="s">&quot;webpage.html&quot;</span><span class="p">))</span>

<span class="c1">; write /home/joe/newfile.txt on the local file system</span>
<span class="p">(</span><span class="nv">puts-url</span> <span class="s">&quot;file:///home/joe/newfile.txt&quot;</span> <span class="s">&quot;Hello World!&quot;</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The first example creates a file called <span class="monospaced">myFile.txt</span> on the target
server and stores the text string <span class="monospaced">'Hi there'</span> in it. In the second
example, the local file <span class="monospaced">webpage.html</span> is transferred to <span class="monospaced">asite.com</span>.</p></div>
<div class="paragraph"><p>On an Apache web server, the following could be configured in
<span class="monospaced">httpd.conf</span>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">&lt;directory</span> <span class="k">/</span><span class="ss">www/htdocs&gt;</span>
<span class="ss">Options</span> <span class="ss">All</span>
<span class="ss">Script</span> <span class="ss">PUT</span> <span class="k">/</span><span class="ss">cgi-bin/put.cgi</span>
<span class="ss">&lt;/directory&gt;</span>
</pre></div></div></div>
<div class="paragraph"><p>The script <span class="monospaced">put.cgi</span> would contain code to receive content from the web
server via STDIN. The following is a working <span class="monospaced">put.cgi</span> written in
newLISP for the Apache web server:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="cp">#!/usr/home/johndoe/bin/newlisp</span>
<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1"># get PUT method data from CGI STDIN</span>
<span class="c1"># and write data to a file specified</span>
<span class="c1"># int the PUT request</span>
<span class="c1">#</span>
<span class="c1">#</span>

<span class="p">(</span><span class="k">print</span> <span class="s">&quot;Content-Type: text/html\n\n&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">cnt</span> <span class="ss">0</span><span class="p">)</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">result</span> <span class="s">&quot;&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">=</span> <span class="s">&quot;PUT&quot;</span> <span class="p">(</span><span class="k">env</span> <span class="s">&quot;REQUEST_METHOD&quot;</span><span class="p">))</span>
    <span class="p">(</span><span class="k">begin</span>
      <span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">len</span> <span class="p">(</span><span class="k">int</span> <span class="p">(</span><span class="k">env</span> <span class="s">&quot;CONTENT_LENGTH&quot;</span><span class="p">)))</span>

      <span class="p">(</span><span class="k">while</span> <span class="p">(</span><span class="nv">&lt;</span> <span class="ss">cnt</span> <span class="ss">len</span><span class="p">)</span>
          <span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">n</span> <span class="p">(</span><span class="k">read</span> <span class="p">(</span><span class="k">device</span><span class="p">)</span> <span class="ss">buffer</span> <span class="ss">len</span><span class="p">))</span>
          <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="k">not</span> <span class="ss">n</span><span class="p">)</span>
            <span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">cnt</span> <span class="ss">len</span><span class="p">)</span>
            <span class="p">(</span><span class="k">begin</span>
              <span class="p">(</span><span class="k">inc</span> <span class="ss">cnt</span> <span class="ss">n</span><span class="p">)</span>
              <span class="p">(</span><span class="k">write</span> <span class="ss">result</span> <span class="ss">buffer</span><span class="p">))))</span>

      <span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">path</span> <span class="p">(</span><span class="k">append</span>
              <span class="s">&quot;/usr/home/johndoe&quot;</span>
              <span class="p">(</span><span class="k">env</span> <span class="s">&quot;PATH_TRANSLATED&quot;</span><span class="p">)))</span>

      <span class="p">(</span><span class="k">write-</span><span class="ss">file</span> <span class="ss">path</span> <span class="ss">result</span><span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="p">(</span><span class="k">exit</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Note that the script appends ".txt" to the path to avoid the CGI
execution of uploaded malicious scripts. Note also that the two lines
where the file path is composed may work differently in your web server
environment. Check environment variables passed by your web server for
composition of the right file path.</p></div>
<div class="paragraph"><p><span class="monospaced">put-url</span> returns content returned by the <span class="monospaced">put.cgi</span> script.</p></div>
</div>
<div class="sect3">
<h4 id="_additional_parameters_2">Additional parameters</h4>
<div class="paragraph"><p>In <em>str-option</em>, <span class="monospaced">"header"</span> or <span class="monospaced">"list"</span> can be specified for the
returned page. If the <em>int-timeout</em> option is specified, the custom
header option <em>str-header</em> can be specified, as well. See the function
<a href="#get-url">get-url</a> for details on both of these options.</p></div>
<div class="paragraph"><p>See also the functions <a href="#get-url">get-url</a> and
<a href="#post-url">post-url</a>, which can be used to upload files when
formatting form data as <span class="monospaced">multipart/form-data</span>.</p></div>
<div class="paragraph"><p><a id="pv"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_pv_span"><span class="big red">pv</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (pv <em>num-int</em> <em>num-nper</em> <em>num-pmt</em> [<em>num-fv</em> [<em>int-type</em>]])</p></div>
<div class="paragraph"><p>Calculates the present value of a loan with the constant interest rate
<em>num-interest</em> and the constant payment <em>num-pmt</em> after <em>num-nper</em>
number of payments. The future value <em>num-fv</em> is assumed to be <span class="monospaced">0.0</span> if
omitted. If payment is at the end of the period, <em>int-type</em> is <span class="monospaced">0</span>
(zero) or <em>int-type</em> is omitted; for payment at the beginning of each
period, <em>int-type</em> is 1.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">pv</span> <span class="p">(</span><span class="k">div</span> <span class="ss">0.07</span> <span class="ss">12</span><span class="p">)</span> <span class="ss">240</span> <span class="ss">775.30</span><span class="p">)</span>  <span class="err">→</span> <span class="k">-</span><span class="ss">100000.1373</span>
</pre></div></div></div>
<div class="paragraph"><p>In the example, a loan that would be paid off (future value = <span class="monospaced">0.0</span>) in
240 payments of $775.30 at a constant interest rate of 7 percent per
year would start out at $100,000.14.</p></div>
<div class="paragraph"><p>See also the <a href="#fv">fv</a>, <a href="#irr">irr</a>, <a href="#nper">nper</a>,
<a href="#npv">npv</a>, and <a href="#pmt">pmt</a> functions.</p></div>
<div class="paragraph"><p><a id="quote"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_quote_span"><span class="big red">quote</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (quote <em>exp</em>)</p></div>
<div class="paragraph"><p>Returns <em>exp</em> without evaluating it. The same effect can be obtained by
prepending a <span class="monospaced">'</span> (single quote) to <em>exp</em>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">quote</span> <span class="ss">x</span><span class="p">)</span>         <span class="err">→</span> <span class="ss">x</span>
<span class="p">(</span><span class="k">quote</span> <span class="ss">123</span><span class="p">)</span>       <span class="err">→</span> <span class="ss">123</span>
<span class="p">(</span><span class="k">quote</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span><span class="p">))</span>   <span class="err">→</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span><span class="p">)</span>
<span class="p">(</span><span class="nv">=</span> <span class="p">(</span><span class="k">quote</span> <span class="ss">x</span><span class="p">)</span> <span class="o">&#39;</span><span class="ss">x</span><span class="p">)</span>  <span class="err">→</span> <span class="k">true</span>
</pre></div></div></div>
<div class="paragraph"><p><a id="quote?"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_quote_span_2"><span class="big red">quote?</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (quote? <em>exp</em>)</p></div>
<div class="paragraph"><p>Evaluates and tests whether <em>exp</em> is quoted. Returns <span class="monospaced">true</span> or <span class="monospaced">nil</span>
depending on the result.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">var</span> <span class="o">&#39;&#39;</span><span class="ss">x</span><span class="p">)</span>  <span class="err">→</span> <span class="o">&#39;</span><span class="ss">x</span>
<span class="p">(</span><span class="k">quote</span><span class="ss">?</span> <span class="ss">var</span><span class="p">)</span>    <span class="err">→</span> <span class="k">true</span>
</pre></div></div></div>
<div class="paragraph"><p>Note that in the <span class="monospaced">set</span> statement, ` ''x` is quoted twice because the
first quote is lost during the evaluation of the <span class="monospaced">set</span> assignment.</p></div>
<div class="paragraph"><p><a id="rand"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_rand_span"><span class="big red">rand</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (rand <em>int-range</em> [<em>int-N</em>])</p></div>
<div class="paragraph"><p>Evaluates the expression in <em>int-range</em> and generates a random number in
the range of <span class="monospaced">0</span> (zero) to (<em>int-range</em> - 1). When <span class="monospaced">0</span> (zero) is passed,
the internal random generator is initialized using the current value
returned by the C <span class="monospaced">time()</span> function. Optionally, a second parameter can
be specified to return a list of length <em>int-N</em> of random numbers.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">dotimes</span> <span class="p">(</span><span class="nv">x</span> <span class="ss">100</span><span class="p">)</span> <span class="p">(</span><span class="k">print</span> <span class="p">(</span><span class="k">rand</span> <span class="ss">2</span><span class="p">)))</span> <span class="ss">=&gt;</span>
<span class="ss">11100000110100111100111101</span> <span class="ss">...</span> <span class="ss">10111101011101111101001100001000</span>

<span class="p">(</span><span class="k">rand</span> <span class="ss">3</span> <span class="ss">100</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">2</span> <span class="ss">0</span> <span class="ss">1</span> <span class="ss">1</span> <span class="ss">2</span> <span class="ss">0</span> <span class="err">…</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The first line in the example prints equally distributed <span class="monospaced">0</span>'s and
<span class="monospaced">1</span>'s, while the second line produces a list of 100 integers with <span class="monospaced">0</span>,
<span class="monospaced">1</span>, and <span class="monospaced">2</span> equally distributed. Use the <a href="#random">random</a> and
<a href="#normal">normal</a> functions to generate floating point random
numbers, and use <a href="#seed">seed</a> to vary the initial seed for random
number generation.</p></div>
<div class="paragraph"><p><a id="random"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_random_span"><span class="big red">random</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (random <em>float-offset</em> <em>float-scale</em> <em>int-n</em>)<br>
<strong>syntax:</strong> (random <em>float-offset</em> <em>float-scale</em>)</p></div>
<div class="paragraph"><p>In the first form, <span class="monospaced">random</span> returns a list of <em>int-n</em> evenly distributed
floating point numbers scaled (multiplied) by <em>float-scale</em>, with an
added offset of <em>float-offset</em>. The starting point of the internal
random generator can be seeded using <a href="#seed">seed</a>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">random</span> <span class="ss">0</span> <span class="ss">1</span> <span class="ss">10</span><span class="p">)</span>
<span class="err">→</span> <span class="p">(</span><span class="nv">0.10898973</span> <span class="ss">0.69823783</span> <span class="ss">0.56434872</span> <span class="ss">0.041507289</span> <span class="ss">0.16516733</span>
    <span class="ss">0.81540917</span> <span class="ss">0.68553784</span> <span class="ss">0.76471068</span> <span class="ss">0.82314585</span> <span class="ss">0.95924564</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>When used in the second form, <span class="monospaced">random</span> returns a single evenly
distributed number:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">random</span> <span class="ss">10</span> <span class="ss">5</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">11.0971</span>
</pre></div></div></div>
<div class="paragraph"><p>See also the <a href="#normal">normal</a> and <a href="#rand">rand</a> functions.</p></div>
<div class="paragraph"><p><a id="randomize"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_randomize_span"><span class="big red">randomize</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (randomize <em>list</em> [<em>bool</em>])</p></div>
<div class="paragraph"><p>Rearranges the order of elements in <em>list</em> into a random order.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">randomize</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span> <span class="ss">d</span> <span class="ss">e</span> <span class="ss">f</span> <span class="ss">g</span><span class="p">))</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">b</span> <span class="ss">a</span> <span class="ss">c</span> <span class="ss">g</span> <span class="ss">d</span> <span class="ss">e</span> <span class="ss">f</span><span class="p">)</span>
<span class="p">(</span><span class="k">randomize</span> <span class="p">(</span><span class="k">sequence</span> <span class="ss">1</span> <span class="ss">5</span><span class="p">))</span>    <span class="err">→</span> <span class="p">(</span><span class="nv">3</span> <span class="ss">5</span> <span class="ss">4</span> <span class="ss">1</span> <span class="ss">2</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p><span class="monospaced">randomize</span> will always return a sequence different from the previous
one without the optional <em>bool</em> flag. This may require the function to
calculate several sets of reordered elements, which in turn may lead to
different processing times with different invocations of the function on
the same input list length. To allow for the output to be equal to the
input, <span class="monospaced">true</span> or any expression evaluating to not <span class="monospaced">nil</span> must be
specified in <em>bool</em>.</p></div>
<div class="paragraph"><p><span class="monospaced">randomize</span> uses an internal <em>pseudo random sequence</em> generator that
returns the same series of results each time newLISP is started. Use the
<a href="#seed">seed</a> function to change this sequence.</p></div>
<div class="paragraph"><p><a id="read"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_read_a_href_destructive_a_span"><span class="big red">read <a href="#destructive">!</a></span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (read <em>int-file</em> <em>sym-buffer</em> <em>int-size</em> [<em>str-wait</em>])</p></div>
<div class="paragraph"><p>Reads a maximum of <em>int-size</em> bytes from a file specified in <em>int-file</em>
into a buffer in <em>sym-buffer</em>. Any data referenced by the symbol
<em>sym-buffer</em> prior to the reading is deleted. The handle in <em>int-file</em>
is obtained from a previous <a href="#open">open</a> statement. The symbol
<em>sym-buffer</em> contains data of type string after the read operation.
<em>sym-buffer</em> can also be a default functor specified by a context symbol
for reference passing in and out of user-defined functions.</p></div>
<div class="paragraph"><p><span class="monospaced">read</span> is a shorter writing of <span class="monospaced">read-buffer</span>. The longer form still
works but is deprecated and should be avoided in new code.</p></div>
<div class="paragraph"><p>Optionally, a string to be waited for can be specified in <em>str-wait</em>.
<span class="monospaced">read</span> will read a maximum amount of bytes specified in <em>int-size</em> or
return earlier if <em>str-wait</em> was found in the data. The wait-string is
part of the returned data and must not contain binary <span class="monospaced">0</span> (zero)
characters.</p></div>
<div class="paragraph"><p>Returns the number of bytes read or <span class="monospaced">nil</span> when the wait-string was not
found. In any case, the bytes read are put into the buffer pointed to by
<em>sym-buffer</em>, and the file pointer of the file read is moved forward. If
no new bytes have been read, <em>sym-buffer</em> will contain <span class="monospaced">nil</span>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">handle</span> <span class="p">(</span><span class="k">open</span> <span class="s">&quot;aFile.ext&quot;</span> <span class="s">&quot;read&quot;</span><span class="p">))</span>
<span class="p">(</span><span class="k">read</span> <span class="ss">handle</span> <span class="ss">buff</span> <span class="ss">200</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Reads 200 bytes into the symbol <span class="monospaced">buff</span> from the file <span class="monospaced">aFile.ext</span>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">read</span> <span class="ss">handle</span> <span class="ss">buff</span> <span class="ss">1000</span> <span class="s">&quot;password:&quot;</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Reads 1000 bytes or until the string <span class="monospaced">password:</span> is encountered. The
string <span class="monospaced">password:</span> will be part of the data returned.</p></div>
<div class="paragraph"><p>See also the <a href="#write">write</a> function.</p></div>
<div class="paragraph"><p><a id="read-char"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_read_char_span"><span class="big red">read-char</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (read-char [<em>int-file</em>])</p></div>
<div class="paragraph"><p>Reads a byte from a file specified by the file handle in <em>int-file</em> or
from the current I/O device - e.g. <em>stdin</em> - when no file handle is
specified. The file handle is obtained from a previous <a href="#open">open</a>
operation. Each <span class="monospaced">read-char</span> advances the file pointer by one byte. Once
the end of the file is reached, <span class="monospaced">nil</span> is returned.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">slow-file-copy</span> <span class="ss">from-file</span> <span class="ss">to-file</span><span class="p">)</span>
    <span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">in-file</span> <span class="p">(</span><span class="k">open</span> <span class="ss">from-file</span> <span class="s">&quot;read&quot;</span><span class="p">))</span>
    <span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">out-file</span> <span class="p">(</span><span class="k">open</span> <span class="ss">to-file</span> <span class="s">&quot;write&quot;</span><span class="p">))</span>
    <span class="p">(</span><span class="k">while</span> <span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">chr</span> <span class="p">(</span><span class="k">read-char</span> <span class="ss">in-file</span><span class="p">))</span>
        <span class="p">(</span><span class="k">write-char</span> <span class="ss">out-file</span> <span class="ss">chr</span><span class="p">))</span>
    <span class="p">(</span><span class="k">close</span> <span class="ss">in-file</span><span class="p">)</span>
    <span class="p">(</span><span class="k">close</span> <span class="ss">out-file</span><span class="p">)</span>
    <span class="s">&quot;finished&quot;</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Use <a href="#read-line">read-line</a> and <a href="#device">device</a> to read whole
text lines at a time. Note that newLISP supplies a fast built-in
function called <a href="#copy-file">copy-file</a> for copying files.</p></div>
<div class="paragraph"><p>See also the <a href="#write-char">write-char</a> function.</p></div>
<div class="paragraph"><p><a id="read-expr"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_read_expr_span"><span class="big red">read-expr</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (read-expr <em>str-source</em> [<em>sym-context</em> [<em>exp-error</em> [<em>int-offset</em>]]])</p></div>
<div class="paragraph"><p><span class="monospaced">read-expr</span> parses the first expressions it finds in <em>str-source</em> and
returns the translated expression without evaluating it. An optional
context in <em>sym-context</em> specifies a namespace for the translated
expression.</p></div>
<div class="paragraph"><p>After a call to <span class="monospaced">read-expr</span> the system variable <span class="monospaced">$0</span> contains the number
of characters scanned.</p></div>
<div class="paragraph"><p>If an error occurs when translating <em>str-source</em> the expression in
<em>exp-error</em> is evaluated and the result returned.</p></div>
<div class="paragraph"><p><em>int-offset</em> specifies an optional offset into <em>str-source</em> where
processing should start. When calling <span class="monospaced">read-expr</span> repeatedly this number
can be updated using <span class="monospaced">$0</span>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">code</span> <span class="s">&quot;; a statement\n(define (double x) (+ x x))&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">read-</span><span class="ss">expr</span> <span class="ss">code</span><span class="p">)</span> <span class="err">→</span> <span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">double</span> <span class="ss">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">x</span> <span class="ss">x</span><span class="p">))</span>

<span class="k">$</span><span class="ss">0</span> <span class="err">→</span> <span class="ss">41</span>
</pre></div></div></div>
<div class="paragraph"><p><span class="monospaced">read-expr</span> behaves similar to <a href="#eval-string">eval-string</a> but
without the evaluation step:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">read-</span><span class="ss">expr</span> <span class="s">&quot;(+ 3 4)&quot;</span><span class="p">)</span>    <span class="err">→</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">)</span>

<span class="p">(</span><span class="k">eval-string</span> <span class="s">&quot;(+ 3 4)&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">7</span>
</pre></div></div></div>
<div class="paragraph"><p>Using <span class="monospaced">read-expr</span> a customized code reader can be programmed
preprocessing expressions before evaluation.</p></div>
<div class="paragraph"><p>See also <a href="#reader-event">reader-event</a> for preprocessing expressions
event-driven.</p></div>
<div class="paragraph"><p><a id="read-file"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_read_file_span"><span class="big red">read-file</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (read-file <em>str-file-name</em>)</p></div>
<div class="paragraph"><p>Reads a file in <em>str-file-name</em> in one swoop and returns a string buffer
containing the data.</p></div>
<div class="paragraph"><p>On failure the function returns <span class="monospaced">nil</span>. For error information, use
<a href="#sys-error">sys-error</a> when used on files. When used on URLs
<a href="#net-error">net-error</a> gives more error information.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">write-</span><span class="ss">file</span> <span class="s">&quot;myfile.enc&quot;</span>
    <span class="p">(</span><span class="k">encrypt</span> <span class="p">(</span><span class="k">read-</span><span class="ss">file</span> <span class="s">&quot;/home/lisp/myFile&quot;</span><span class="p">)</span> <span class="s">&quot;secret&quot;</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p>The file <span class="monospaced">myfile</span> is read, then encrypted using the password <span class="monospaced">"secret"</span>
before being written back into a new file titled <span class="monospaced">"myfile.enc"</span> in the
current directory.</p></div>
<div class="paragraph"><p><span class="monospaced">read-file</span> can take an <span class="monospaced">http://</span> or <span class="monospaced">file://</span> URL in <em>str-file-name</em>.
When the prefix is <span class="monospaced">http://</span>, <span class="monospaced">read-file</span> works exactly like
<a href="#get-url">get-url</a> and can take the same additional parameters.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">read-</span><span class="ss">file</span> <span class="s">&quot;http://asite.com/somefile.tgz&quot;</span> <span class="ss">10000</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The file <span class="monospaced">somefile.tgz</span> is retrieved from the remote location
<span class="monospaced">http://asite.com</span>. The file transfer will time out after 10 seconds if
it is not finished. In this mode, <span class="monospaced">read-file</span> can also be used to
transfer files from remote newLISP server nodes.</p></div>
<div class="paragraph"><p>See also the <a href="#write-file">write-file</a> and
<a href="#append-file">append-file</a> functions.</p></div>
<div class="paragraph"><p><a id="read-key"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_read_key_span"><span class="big red">read-key</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (read-key)</p></div>
<div class="paragraph"><p>Reads a key from the keyboard and returns an integer value. For
navigation keys, more than one <span class="monospaced">read-key</span> call must be made. For keys
representing ASCII characters, the return value is the same on all OSes,
except for navigation keys and other control sequences like function
keys, in which case the return values may vary on different OSes and
configurations.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">read-</span><span class="ss">key</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">97</span>  <span class="c1">; after hitting the A key</span>
<span class="p">(</span><span class="k">read-</span><span class="ss">key</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">65</span>  <span class="c1">; after hitting the shifted A key</span>
<span class="p">(</span><span class="k">read-</span><span class="ss">key</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">10</span>  <span class="c1">; after hitting [enter] on Linux</span>
<span class="p">(</span><span class="k">read-</span><span class="ss">key</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">13</span>  <span class="c1">; after hitting [enter] on Win32</span>

<span class="p">(</span><span class="k">while</span> <span class="p">(</span><span class="nv">!=</span> <span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">c</span> <span class="p">(</span><span class="k">read-</span><span class="ss">key</span><span class="p">))</span> <span class="ss">1</span><span class="p">)</span> <span class="p">(</span><span class="k">println</span> <span class="ss">c</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p>The last example can be used to check return sequences from navigation
and function keys. To break out of the loop, press <span class="monospaced">Ctrl-A</span>.</p></div>
<div class="paragraph"><p>Note that <span class="monospaced">read-key</span> will only work when newLISP is running in a Unix
shell or Win32 command shell. It will not work in the Java based
newLISP-GS or Tcl/Tk based newLISP-Tk frontend. It will also not work
when executed by newLISP Unix shared library or newLISP Win32 DLL
(Dynamic Link Library).</p></div>
<div class="paragraph"><p><a id="read-line"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_read_line_span"><span class="big red">read-line</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (read-line [<em>int-file</em>])</p></div>
<div class="paragraph"><p>Reads from the current I/O device a string delimited by a line-feed
character (ASCII 10). There is no limit to the length of the string that
can be read. The line-feed character is not part of the returned string.
The line always breaks on a line-feed, which is then swallowed. A line
breaks on a carriage return (ASCII 13) only if followed by a line-feed,
in which case both characters are discarded. A carriage return alone
only breaks and is swallowed if it is the last character in the stream.</p></div>
<div class="paragraph"><p>By default, the current <a href="#device">device</a> is the keyboard
(<a href="#device">device</a> <span class="monospaced">0</span>). Use the built-in function
<a href="#device">device</a> to specify a different I/O device (e.g., a file).
Optionally, a file handle can be specified in the <em>int-file</em> obtained
from a previous <a href="#open">open</a> statement.</p></div>
<div class="paragraph"><p>The last buffer contents from a read-line operation can be retrieved
using <a href="#current-line">current-line</a>.</p></div>
<div class="paragraph"><p>When <span class="monospaced">read-line</span> is reading from a file or from <em>stdin</em> in a CGI program
or pipe, it will return <span class="monospaced">nil</span> when input is exhausted.</p></div>
<div class="paragraph"><p>When using <span class="monospaced">read-line</span> on <em>stdin</em>, line length is limited to 2048
characters and performance is much faster.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">print</span> <span class="s">&quot;Enter a num:&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">num</span> <span class="p">(</span><span class="k">int</span> <span class="p">(</span><span class="k">read-</span><span class="ss">line</span><span class="p">)))</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">in-file</span> <span class="p">(</span><span class="k">open</span> <span class="s">&quot;afile.dat&quot;</span> <span class="s">&quot;read&quot;</span><span class="p">))</span>
<span class="p">(</span><span class="k">while</span> <span class="p">(</span><span class="k">read-</span><span class="ss">line</span> <span class="ss">in-file</span><span class="p">)</span>
        <span class="p">(</span><span class="k">write-</span><span class="ss">line</span><span class="p">))</span>
<span class="p">(</span><span class="k">close</span> <span class="ss">in-file</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The first example reads input from the keyboard and converts it to a
number. In the second example, a file is read line-by-line and displayed
on the screen. The <span class="monospaced">write-line</span> statement takes advantage of the fact
that the result from the last <span class="monospaced">read-line</span> operation is stored in a
system internal buffer. When <a href="#write-line">write-line</a> is used
without argument, it writes the contents of the last <span class="monospaced">read-line</span> buffer
to the screen.</p></div>
<div class="paragraph"><p>See also the <a href="#current-line">current-line</a> function for retrieving
this buffer.</p></div>
<div class="paragraph"><p><a id="read-utf8"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_read_utf8_span"><span class="big red">read-utf8</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (read-utf8 <em>int-file</em>)</p></div>
<div class="paragraph"><p>Reads an UTF-8 character from a file specified by the file handle in
<em>int-file</em>. The file handle is obtained from a previous <a href="#open">open</a>
operation. Each <span class="monospaced">read-utf8</span> advances the file pointer by the number of
bytes contained in the UTF-8 character. Once the end of the file is
reached, <span class="monospaced">nil</span> is returned.</p></div>
<div class="paragraph"><p>The function returns an integer value which can be converted to a
displayable UTF-8 character string using the <a href="#char">char</a> function.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">fle</span> <span class="p">(</span><span class="k">open</span> <span class="s">&quot;utf8text.txt&quot;</span> <span class="s">&quot;read&quot;</span><span class="p">))</span>
<span class="p">(</span><span class="k">while</span> <span class="p">(</span><span class="k">setq</span> <span class="ss">chr</span> <span class="p">(</span><span class="k">read-utf8</span> <span class="ss">fle</span><span class="p">))</span>
    <span class="p">(</span><span class="k">print</span> <span class="p">(</span><span class="k">char</span> <span class="ss">chr</span><span class="p">)))</span>
</pre></div></div></div>
<div class="paragraph"><p>The example reads a file containing UTF-8 encoded text and displays it
to the terminal screen.</p></div>
<div class="paragraph"><p><a id="reader-event"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_reader_event_span"><span class="big red">reader-event</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (reader-event [<em>sym-event-handler | func-event-handler</em>])<br>
<strong>syntax:</strong> (reader-event 'nil)</p></div>
<div class="paragraph"><p>An event handler can be specified to hook between newLISP&#8217;s reader,
translation and evaluation process. The function specified in
<em>sym-event-handler</em> or <em>func-event-handler</em> gets called after newLISP
translates an expression and before evaluating it. The event handler can
do transformation on the expression before it gets evaluated.</p></div>
<div class="paragraph"><p>Specifying a quoted <span class="monospaced">nil</span> for the event will disable it.</p></div>
<div class="paragraph"><p>The following one-liner <span class="monospaced">reader-event</span> could be used to enhance the
interactive shell with a tracer:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="ss">&gt;</span><span class="p">(</span><span class="k">reader-event</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">ex</span><span class="p">)</span> <span class="p">(</span><span class="k">print</span> <span class="s">&quot; =&gt; &quot;</span> <span class="ss">ex</span><span class="p">)))</span>
<span class="k">$reader-event</span>
<span class="ss">&gt;</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">1</span> <span class="ss">2</span> <span class="ss">3</span><span class="p">)</span>
 <span class="ss">=&gt;</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">1</span> <span class="ss">2</span> <span class="ss">3</span><span class="p">)</span>
<span class="ss">6</span>
<span class="ss">&gt;</span>
</pre></div></div></div>
<div class="paragraph"><p>The expression intercepted passes through unchanged, but output is
enhanced.</p></div>
<div class="paragraph"><p>The following example shows the core of a simple macro rewrite
pre-processor. A full version is installed in the standard location as
module file <span class="monospaced">macro.lsp</span>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">context</span> <span class="o">&#39;</span><span class="ss">macro</span><span class="p">)</span>

<span class="c1">; initialize macro list</span>
<span class="p">(</span><span class="k">setf</span> <span class="ss">macro-list</span> <span class="o">&#39;</span><span class="p">())</span>

<span class="c1">; registers a macro</span>
<span class="p">(</span><span class="k">define-macro</span> <span class="p">(</span><span class="nv">macro</span><span class="o">:</span><span class="ss">macro</span> <span class="ss">callp</span> <span class="ss">body</span><span class="p">)</span>
    <span class="p">(</span><span class="k">push</span> <span class="p">(</span><span class="k">list</span> <span class="p">(</span><span class="k">first</span> <span class="ss">callp</span><span class="p">)</span> <span class="o">&#39;</span><span class="ss">*</span><span class="p">)</span> <span class="ss">macro-list</span> <span class="k">-</span><span class="ss">1</span><span class="p">)</span>
    <span class="p">(</span><span class="k">eval</span> <span class="p">(</span><span class="k">expand</span> <span class="o">&#39;</span><span class="p">(</span><span class="k">define-macro</span> <span class="ss">callp</span> <span class="p">(</span><span class="k">expand</span> <span class="o">&#39;</span><span class="ss">body</span><span class="p">))</span> <span class="o">&#39;</span><span class="ss">callp</span> <span class="o">&#39;</span><span class="ss">body</span><span class="p">))</span>
<span class="p">)</span>

<span class="c1">; the event handler translating expressions</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">rewrite</span> <span class="ss">expr</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="k">list</span><span class="ss">?</span> <span class="ss">expr</span><span class="p">)</span>
        <span class="p">(</span><span class="k">dolist</span> <span class="p">(</span><span class="nv">pattern</span> <span class="ss">macro-list</span><span class="p">)</span>
            <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="k">match</span> <span class="ss">pattern</span> <span class="ss">expr</span><span class="p">)</span>
                <span class="p">(</span><span class="k">setf</span> <span class="ss">expr</span> <span class="p">(</span><span class="k">eval</span> <span class="ss">expr</span><span class="p">))</span>
                <span class="p">(</span><span class="k">set-ref-all</span> <span class="ss">pattern</span> <span class="ss">expr</span> <span class="p">(</span><span class="k">eval</span> <span class="k">$</span><span class="ss">it</span><span class="p">)</span> <span class="k">match</span><span class="p">))</span> <span class="p">)</span>
    <span class="p">)</span>
    <span class="ss">expr</span>
<span class="p">)</span>

<span class="c1">; register event handler</span>
<span class="p">(</span><span class="k">reader-event</span> <span class="ss">rewrite</span><span class="p">)</span>

<span class="p">(</span><span class="k">context</span> <span class="k">MAIN</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The reader event function will be called after each reading of an
s-expression by the <a href="#load">load</a> or <a href="#eval-string">eval-string</a>
function.</p></div>
<div class="paragraph"><p>Register a function macro for pre-processing:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="nv">macro</span> <span class="p">(</span><span class="nv">square</span> <span class="ss">X</span><span class="p">)</span> <span class="p">(</span><span class="k">pow</span> <span class="ss">X</span> <span class="ss">2</span><span class="p">))</span> <span class="c1">; must use uppercase vars</span>

<span class="c1">; use the macro</span>
<span class="p">(</span><span class="nv">square</span> <span class="ss">3</span><span class="p">)</span> <span class="err">→</span> <span class="ss">9</span>
</pre></div></div></div>
<div class="paragraph"><p>After registering the macro <span class="monospaced">square</span> newLISP will expand each occurrence
of a <span class="monospaced">(square ...)</span> to a <span class="monospaced">(pow ... 2)</span> expression.</p></div>
<div class="paragraph"><p>Note, that variables in the macro definition must be upper-case. The
macro registering function uses a syntax form of <span class="monospaced">expand</span> working only
on upper-case variables.</p></div>
<div class="paragraph"><p>For a more detailed description see the documentation for <span class="monospaced">macro.lsp</span>.</p></div>
<div class="paragraph"><p><a id="real-path"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_real_path_span"><span class="big red">real-path</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (real-path [<em>str-path</em>])</p></div>
<div class="paragraph"><p>Returns the full path from the relative file path given in <em>str-path</em>.
If a path is not given, <span class="monospaced">"."</span> (the current directory) is assumed.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">real-path</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;/usr/home/fred&quot;</span>  <span class="c1">; current directory</span>
<span class="p">(</span><span class="k">real-path</span> <span class="s">&quot;./somefile.txt&quot;</span><span class="p">)</span>
<span class="err">→</span> <span class="s">&quot;/usr/home/fred/somefile.txt&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>The output length is limited by the OS&#8217;s maximum allowed path length. If
<span class="monospaced">real-path</span> fails (e.g., because of a nonexistent path), <span class="monospaced">nil</span> is
returned.</p></div>
<div class="paragraph"><p><a id="receive"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_receive_a_href_destructive_a_span"><span class="big red">receive <a href="#destructive">!</a></span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (receive <em>int-pid</em> <em>sym-message</em>)<br>
<strong>syntax:</strong> (receive)</p></div>
<div class="paragraph"><p>In the first syntax, the function is used for message exchange between
child processes launched with <a href="#spawn">spawn</a> and their parent
process. The message received replaces the contents in <em>sym-message.</em></p></div>
<div class="paragraph"><p>The function reads one message from the receiver queue of <em>int-pid</em> for
each invocation. When the queue is empty, <span class="monospaced">nil</span> is returned.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">; sending process</span>
<span class="p">(</span><span class="k">send</span> <span class="ss">spid</span> <span class="s">&quot;hello&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="k">true</span>

<span class="c1">; receiving process</span>
<span class="p">(</span><span class="k">receive</span> <span class="ss">pid</span> <span class="ss">msg</span><span class="p">)</span>    <span class="err">→</span> <span class="k">true</span>
<span class="ss">msg</span>                  <span class="err">→</span> <span class="s">&quot;hello&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>To make <span class="monospaced">receive</span> blocking and wait for arriving messages, use the
following form:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">; wait until a message can be read</span>
<span class="p">(</span><span class="k">until</span> <span class="p">(</span><span class="k">receive</span> <span class="ss">pid</span> <span class="ss">msg</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p>The function will loop until a message can be read from the queue.</p></div>
<div class="paragraph"><p>In the second syntax, the function returns a list of all child processes
with pending messages for the parent process:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">; read pending messages from child processes</span>
<span class="p">(</span><span class="k">dolist</span> <span class="p">(</span><span class="nv">pid</span> <span class="p">(</span><span class="k">receive</span><span class="p">))</span>
    <span class="p">(</span><span class="k">receive</span> <span class="ss">pid</span> <span class="ss">msg</span><span class="p">)</span>
    <span class="p">(</span><span class="k">println</span> <span class="s">&quot;received message: &quot;</span> <span class="ss">msg</span> <span class="s">&quot; from:&quot;</span> <span class="ss">pid</span><span class="p">)</span>
<span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The list of child process IDs returned by <span class="monospaced">(receive)</span> only contains PIDs
of processes which have unread messages in their send queues. The
<span class="monospaced">(receive pid msg)</span> statement now can be issued non-blocking, because it
always is guarenteed to find a pending message in a child&#8217;s message
queue.</p></div>
<div class="paragraph"><p>The <span class="monospaced">receive</span> function is not available on Win32.</p></div>
<div class="paragraph"><p>For a more detailed discussion of this function and examples, see the
<a href="#send">send</a> function.</p></div>
<div class="paragraph"><p><a id="ref"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_ref_span"><span class="big red">ref</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (ref <em>exp-key</em> <em>list</em> [<em>func-compare</em> [true]])</p></div>
<div class="paragraph"><p><span class="monospaced">ref</span> searches for the key expression <em>exp-key</em> in <em>list</em> and returns a
list of integer indices or an empty list if <em>exp-key</em> cannot be found.
<span class="monospaced">ref</span> can work together with <a href="#push">push</a> and <a href="pop">pop</a>, both of
which can also take lists of indices.</p></div>
<div class="paragraph"><p>By default, <span class="monospaced">ref</span> checks if expressions are equal. With <em>func-compare</em>,
more complex comparison functions can be used. The comparison function
can be a previously defined function. Note that this function always
takes two arguments, even if only the second argument is used inside the
function.</p></div>
<div class="paragraph"><p>When the optional <span class="monospaced">true</span> parameter is present, the element found is
returned instead of the index vector.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">; get index vectors for list elements</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">pList</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="p">(</span><span class="nv">c</span> <span class="ss">d</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="ss">e</span><span class="p">)))</span>

<span class="p">(</span><span class="k">ref</span> <span class="o">&#39;</span><span class="ss">x</span> <span class="ss">pList</span><span class="p">)</span>    <span class="err">→</span> <span class="p">(</span><span class="nv">2</span> <span class="ss">2</span> <span class="ss">0</span><span class="p">)</span>

<span class="p">(</span><span class="k">ref</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="ss">pList</span><span class="p">)</span>   <span class="err">→</span> <span class="p">(</span><span class="nv">2</span> <span class="ss">2</span><span class="p">)</span>

<span class="c1">; the key expression is in a variable</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">p</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">c</span> <span class="ss">d</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="ss">e</span><span class="p">))</span>

<span class="p">(</span><span class="k">ref</span> <span class="ss">p</span> <span class="ss">pList</span> <span class="ss">p</span><span class="p">)</span>     <span class="err">→</span> <span class="p">(</span><span class="nv">2</span><span class="p">)</span>

<span class="c1">; indexing using the vector returned from ref</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">v</span> <span class="p">(</span><span class="k">ref</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="ss">pList</span><span class="p">))</span> <span class="err">→</span> <span class="p">(</span><span class="nv">2</span> <span class="ss">2</span><span class="p">)</span>

<span class="p">(</span><span class="nv">pList</span> <span class="ss">v</span><span class="p">)</span> <span class="err">→</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span>

<span class="c1">; if nothing is found, nil is returned</span>

<span class="p">(</span><span class="k">ref</span> <span class="o">&#39;</span><span class="ss">foo</span> <span class="ss">plist</span><span class="p">)</span>  <span class="err">→</span> <span class="k">nil</span>

<span class="c1">; not specifying a comparison functor assumes =</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">L</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="p">(</span><span class="nv">c</span> <span class="ss">d</span> <span class="p">(</span><span class="nv">e</span><span class="p">)</span> <span class="ss">f</span><span class="p">)))</span>

<span class="p">(</span><span class="k">ref</span> <span class="o">&#39;</span><span class="ss">e</span> <span class="ss">L</span><span class="p">)</span>      <span class="err">→</span> <span class="p">(</span><span class="nv">2</span> <span class="ss">2</span> <span class="ss">0</span><span class="p">)</span>
<span class="p">(</span><span class="k">ref</span> <span class="o">&#39;</span><span class="ss">e</span> <span class="ss">L</span> <span class="ss">=</span><span class="p">)</span>    <span class="err">→</span> <span class="p">(</span><span class="nv">2</span> <span class="ss">2</span> <span class="ss">0</span><span class="p">)</span>

<span class="c1">; a is the first symbol where e is greater</span>

<span class="p">(</span><span class="k">ref</span> <span class="o">&#39;</span><span class="ss">e</span> <span class="ss">L</span> <span class="ss">&gt;</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">0</span><span class="p">)</span>

<span class="c1">; return the element instead of the index</span>

<span class="p">(</span><span class="k">ref</span> <span class="o">&#39;</span><span class="ss">e</span> <span class="ss">L</span> <span class="ss">&gt;</span> <span class="k">true</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">a</span>

<span class="c1">; use an anonymous comparison function</span>

<span class="p">(</span><span class="k">ref</span> <span class="o">&#39;</span><span class="ss">e</span> <span class="ss">L</span> <span class="p">(</span><span class="k">fn</span> <span class="p">(</span><span class="nv">x</span> <span class="ss">y</span><span class="p">)</span> <span class="p">(</span><span class="k">or</span> <span class="p">(</span><span class="nv">=</span> <span class="ss">x</span> <span class="ss">y</span><span class="p">)</span> <span class="p">(</span><span class="nv">=</span> <span class="ss">y</span> <span class="o">&#39;</span><span class="ss">d</span><span class="p">))))</span>      <span class="err">→</span> <span class="p">(</span><span class="nv">2</span> <span class="ss">1</span><span class="p">)</span>

<span class="p">(</span><span class="k">ref</span> <span class="o">&#39;</span><span class="ss">e</span> <span class="ss">L</span> <span class="p">(</span><span class="k">fn</span> <span class="p">(</span><span class="nv">x</span> <span class="ss">y</span><span class="p">)</span> <span class="p">(</span><span class="k">or</span> <span class="p">(</span><span class="nv">=</span> <span class="ss">x</span> <span class="ss">y</span><span class="p">)</span> <span class="p">(</span><span class="nv">=</span> <span class="ss">y</span> <span class="o">&#39;</span><span class="ss">d</span><span class="p">)))</span> <span class="k">true</span><span class="p">)</span> <span class="err">→</span> <span class="ss">d</span>
</pre></div></div></div>
<div class="paragraph"><p>The following example shows the use of <a href="#match">match</a> and
<a href="#unify">unify</a> to formulate searches that are as powerful as regular
expressions are for strings:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">L</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">l</span> <span class="ss">3</span><span class="p">)</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">12</span><span class="p">)</span> <span class="p">(</span><span class="nv">k</span> <span class="ss">5</span><span class="p">)</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">10</span><span class="p">)</span> <span class="p">(</span><span class="nv">z</span> <span class="ss">22</span><span class="p">)))</span>

<span class="c1">; use match as a comparison function</span>

<span class="p">(</span><span class="k">ref</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">?</span><span class="p">)</span> <span class="ss">L</span> <span class="k">match</span><span class="p">)</span> <span class="err">→</span> <span class="p">(</span><span class="nv">1</span><span class="p">)</span>

<span class="c1">; use unify as a comparison function</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">L</span> <span class="o">&#39;</span><span class="p">(</span> <span class="p">((</span><span class="nv">a</span> <span class="ss">b</span><span class="p">)</span> <span class="p">(</span><span class="nv">c</span> <span class="ss">d</span><span class="p">))</span> <span class="p">((</span><span class="nv">e</span> <span class="ss">e</span><span class="p">)</span> <span class="p">(</span><span class="nv">f</span> <span class="ss">g</span><span class="p">))</span> <span class="p">))</span>

<span class="p">(</span><span class="k">ref</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">X</span> <span class="ss">X</span><span class="p">)</span> <span class="ss">L</span> <span class="k">unify</span><span class="p">)</span>      <span class="err">→</span> <span class="p">(</span><span class="nv">1</span> <span class="ss">0</span><span class="p">)</span>

<span class="p">(</span><span class="k">ref</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">X</span> <span class="ss">g</span><span class="p">)</span> <span class="ss">L</span> <span class="k">unify</span><span class="p">)</span>      <span class="err">→</span> <span class="p">(</span><span class="nv">1</span> <span class="ss">1</span><span class="p">)</span>

<span class="p">(</span><span class="k">ref</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">X</span> <span class="ss">g</span><span class="p">)</span> <span class="ss">L</span> <span class="k">unify</span> <span class="k">true</span><span class="p">)</span> <span class="err">→</span> <span class="p">(</span><span class="nv">f</span> <span class="ss">g</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The <span class="monospaced">'(X X)</span> pattern with <a href="#unify">unify</a> searches for a list pair
where the two elements are equal. The <span class="monospaced">unify</span> pattern <span class="monospaced">'(X g)</span> searches
for a list pair with the symbol <span class="monospaced">g</span> as the second member. The patterns
are quoted to protect them from evaluation.</p></div>
<div class="paragraph"><p>Pass the list as a default functor:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">C</span><span class="o">:</span><span class="ss">C</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="p">(</span><span class="nv">c</span> <span class="ss">d</span><span class="p">)</span> <span class="ss">e</span> <span class="ss">f</span><span class="p">))</span>

<span class="p">(</span><span class="k">ref</span> <span class="o">&#39;</span><span class="ss">d</span> <span class="ss">C</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">2</span> <span class="ss">1</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>This is suitable when passing lists by reference using a context. See
also the chapter <a href="#pass_big">Passing data by reference</a>.</p></div>
<div class="paragraph"><p>See also the <a href="#ref-all">ref-all</a> function, which searches for all
occurrences of a key expression in a nested list.</p></div>
<div class="paragraph"><p><a id="ref-all"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_ref_all_span"><span class="big red">ref-all</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (ref-all <em>exp-key</em> <em>list</em> [<em>func-compare</em> [true]])</p></div>
<div class="paragraph"><p>Works similarly to <a href="#ref">ref</a>, but returns a list of all index
vectors found for <em>exp-key</em> in <em>list</em>.</p></div>
<div class="paragraph"><p>When the optional <span class="monospaced">true</span> parameter is present, the elements found is
returned of the index vectors.</p></div>
<div class="paragraph"><p>By default, <span class="monospaced">ref-all</span> checks if expressions are equal. With
<em>func-compare</em>, more complex comparison functions can be used.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">L</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span> <span class="p">(</span><span class="nv">d</span> <span class="ss">a</span> <span class="ss">f</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">h</span> <span class="ss">a</span><span class="p">))</span> <span class="p">(</span><span class="nv">k</span> <span class="ss">a</span> <span class="p">(</span><span class="nv">m</span> <span class="ss">n</span> <span class="ss">a</span><span class="p">)</span> <span class="p">(</span><span class="nv">x</span><span class="p">))))</span>

<span class="p">(</span><span class="k">ref-all</span> <span class="o">&#39;</span><span class="ss">a</span> <span class="ss">L</span><span class="p">)</span> <span class="err">→</span> <span class="p">((</span><span class="nv">0</span><span class="p">)</span> <span class="p">(</span><span class="nv">3</span> <span class="ss">1</span><span class="p">)</span> <span class="p">(</span><span class="nv">3</span> <span class="ss">3</span> <span class="ss">0</span><span class="p">)</span> <span class="p">(</span><span class="nv">3</span> <span class="ss">3</span> <span class="ss">2</span><span class="p">)</span> <span class="p">(</span><span class="nv">4</span> <span class="ss">1</span><span class="p">)</span> <span class="p">(</span><span class="nv">4</span> <span class="ss">2</span> <span class="ss">2</span><span class="p">))</span>

<span class="c1">; the index vector returned by ref-all can be used to index the list</span>

<span class="p">(</span><span class="nv">L</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">3</span> <span class="ss">1</span><span class="p">))</span> <span class="err">→</span> <span class="ss">a</span>

<span class="c1">; mapped implicit indexing of L</span>

<span class="p">(</span><span class="k">map</span> <span class="o">&#39;</span><span class="ss">L</span> <span class="p">(</span><span class="k">ref-all</span> <span class="o">&#39;</span><span class="ss">a</span> <span class="ss">L</span><span class="p">))</span> <span class="err">→</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">a</span> <span class="ss">a</span> <span class="ss">a</span> <span class="ss">a</span> <span class="ss">a</span><span class="p">)</span>

<span class="c1">; with comparison operator</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">L</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span> <span class="p">(</span><span class="nv">d</span> <span class="ss">f</span> <span class="p">(</span><span class="nv">h</span> <span class="ss">l</span> <span class="ss">a</span><span class="p">))</span> <span class="p">(</span><span class="nv">k</span> <span class="ss">a</span> <span class="p">(</span><span class="nv">m</span> <span class="ss">n</span><span class="p">)</span> <span class="p">(</span><span class="nv">x</span><span class="p">))))</span>

<span class="c1">; not specifying a comparison functor assumes =</span>

<span class="p">(</span><span class="k">ref-all</span> <span class="o">&#39;</span><span class="ss">c</span> <span class="ss">L</span><span class="p">)</span>       <span class="err">→</span> <span class="p">((</span><span class="nv">2</span><span class="p">))</span>
<span class="p">(</span><span class="k">ref-all</span> <span class="o">&#39;</span><span class="ss">c</span> <span class="ss">L</span> <span class="ss">=</span><span class="p">)</span>     <span class="err">→</span> <span class="p">((</span><span class="nv">2</span><span class="p">))</span>

<span class="c1">; look for all elements where c is greater</span>

<span class="p">(</span><span class="k">ref-all</span> <span class="o">&#39;</span><span class="ss">c</span> <span class="ss">L</span> <span class="ss">&gt;</span><span class="p">)</span>       <span class="err">→</span> <span class="p">((</span><span class="nv">0</span><span class="p">)</span> <span class="p">(</span><span class="nv">1</span><span class="p">)</span> <span class="p">(</span><span class="nv">3</span> <span class="ss">2</span> <span class="ss">2</span><span class="p">)</span> <span class="p">(</span><span class="nv">4</span> <span class="ss">1</span><span class="p">))</span>
<span class="p">(</span><span class="k">ref-all</span> <span class="o">&#39;</span><span class="ss">c</span> <span class="ss">L</span> <span class="ss">&gt;</span> <span class="k">true</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">a</span> <span class="ss">a</span><span class="p">)</span>

<span class="c1">; use an anonymous function to compare</span>

<span class="p">(</span><span class="k">ref-all</span> <span class="o">&#39;</span><span class="ss">a</span> <span class="ss">L</span> <span class="p">(</span><span class="k">fn</span> <span class="p">(</span><span class="nv">x</span> <span class="ss">y</span><span class="p">)</span> <span class="p">(</span><span class="k">or</span> <span class="p">(</span><span class="nv">=</span> <span class="ss">x</span> <span class="ss">y</span><span class="p">)</span> <span class="p">(</span><span class="nv">=</span> <span class="ss">y</span> <span class="o">&#39;</span><span class="ss">k</span><span class="p">))))</span>
<span class="err">→</span> <span class="p">((</span><span class="nv">0</span><span class="p">)</span> <span class="p">(</span><span class="nv">3</span> <span class="ss">2</span> <span class="ss">2</span><span class="p">)</span> <span class="p">(</span><span class="nv">4</span> <span class="ss">0</span><span class="p">)</span> <span class="p">(</span><span class="nv">4</span> <span class="ss">1</span><span class="p">))</span>

<span class="c1">; the key is nil because the comparison function only looks at the second argument</span>

<span class="p">(</span><span class="k">ref-all</span> <span class="k">nil</span> <span class="ss">L</span> <span class="p">(</span><span class="k">fn</span> <span class="p">(</span><span class="nv">x</span> <span class="ss">y</span><span class="p">)</span> <span class="p">(</span><span class="nv">&gt;</span> <span class="p">(</span><span class="k">length</span> <span class="ss">y</span><span class="p">)</span> <span class="ss">2</span><span class="p">)))</span>
<span class="err">→</span> <span class="p">((</span><span class="nv">3</span><span class="p">)</span> <span class="p">(</span><span class="nv">3</span> <span class="ss">2</span><span class="p">)</span> <span class="p">(</span><span class="nv">4</span><span class="p">))</span>

<span class="c1">; define the comparison functions first</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">is-long?</span> <span class="ss">x</span> <span class="ss">y</span><span class="p">)</span> <span class="p">(</span><span class="nv">&gt;</span> <span class="p">(</span><span class="k">length</span> <span class="ss">y</span><span class="p">)</span> <span class="ss">2</span><span class="p">))</span> <span class="c1">; the x gets occupied by &#39;nil</span>

<span class="p">(</span><span class="k">ref-all</span> <span class="k">nil</span> <span class="ss">L</span> <span class="ss">is-long?</span><span class="p">)</span>    <span class="err">→</span>  <span class="p">((</span><span class="nv">3</span><span class="p">)</span> <span class="p">(</span><span class="nv">3</span> <span class="ss">2</span><span class="p">)</span> <span class="p">(</span><span class="nv">4</span><span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">is-it-or-d</span> <span class="ss">x</span> <span class="ss">y</span><span class="p">)</span> <span class="p">(</span><span class="k">or</span> <span class="p">(</span><span class="nv">=</span> <span class="ss">x</span> <span class="ss">y</span><span class="p">)</span> <span class="p">(</span><span class="nv">=</span> <span class="ss">y</span> <span class="o">&#39;</span><span class="ss">d</span><span class="p">)))</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">L</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="p">(</span><span class="nv">c</span> <span class="ss">d</span> <span class="p">(</span><span class="nv">e</span><span class="p">)</span> <span class="ss">f</span><span class="p">))</span> <span class="p">)</span>

<span class="p">(</span><span class="k">ref-all</span> <span class="o">&#39;</span><span class="ss">e</span> <span class="ss">L</span> <span class="ss">is-it-or-d</span><span class="p">)</span>  <span class="err">→</span> <span class="p">((</span><span class="nv">2</span> <span class="ss">1</span><span class="p">)</span> <span class="p">(</span><span class="nv">2</span> <span class="ss">2</span> <span class="ss">0</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p>The comparison function can be a previously defined function. Note that
the comparison function always takes two arguments, even if only the
second argument is used inside the function (as in the example using
<span class="monospaced">is-long?</span>).</p></div>
<div class="paragraph"><p>Using the <a href="#match">match</a> and <a href="#unify">unify</a> functions, list
searches can be formulated that are as powerful as regular expression
searches are for strings.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">L</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">l</span> <span class="ss">3</span><span class="p">)</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">12</span><span class="p">)</span> <span class="p">(</span><span class="nv">k</span> <span class="ss">5</span><span class="p">)</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">10</span><span class="p">)</span> <span class="p">(</span><span class="nv">z</span> <span class="ss">22</span><span class="p">))</span> <span class="p">)</span>

<span class="c1">; look for all pairs staring with the symbol a</span>

<span class="p">(</span><span class="k">ref-all</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">?</span><span class="p">)</span> <span class="ss">L</span> <span class="k">match</span><span class="p">)</span>      <span class="err">→</span> <span class="p">((</span><span class="nv">1</span><span class="p">)</span> <span class="p">(</span><span class="nv">3</span><span class="p">))</span>
<span class="p">(</span><span class="k">ref-all</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">?</span><span class="p">)</span> <span class="ss">L</span> <span class="k">match</span> <span class="k">true</span><span class="p">)</span> <span class="err">→</span> <span class="p">((</span><span class="nv">a</span> <span class="ss">12</span><span class="p">)</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">10</span><span class="p">))</span>

<span class="c1">; look for all pairs where elements are equal</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">L</span> <span class="o">&#39;</span><span class="p">(</span> <span class="p">((</span><span class="nv">a</span> <span class="ss">b</span><span class="p">)</span> <span class="p">(</span><span class="nv">c</span> <span class="ss">d</span><span class="p">))</span> <span class="p">((</span><span class="nv">e</span> <span class="ss">e</span><span class="p">)</span> <span class="p">(</span><span class="nv">f</span> <span class="ss">g</span><span class="p">))</span> <span class="p">((</span><span class="nv">z</span><span class="p">)</span> <span class="p">(</span><span class="nv">z</span><span class="p">))))</span>

<span class="p">(</span><span class="k">ref-all</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">X</span> <span class="ss">X</span><span class="p">)</span> <span class="ss">L</span> <span class="k">unify</span><span class="p">)</span>      <span class="err">→</span> <span class="p">((</span><span class="nv">1</span> <span class="ss">0</span><span class="p">)</span> <span class="p">(</span><span class="nv">2</span><span class="p">))</span>
<span class="p">(</span><span class="k">ref-all</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">X</span> <span class="ss">X</span><span class="p">)</span> <span class="ss">L</span> <span class="k">unify</span> <span class="k">true</span><span class="p">)</span> <span class="err">→</span> <span class="p">((</span><span class="nv">e</span> <span class="ss">e</span><span class="p">)</span> <span class="p">((</span><span class="nv">z</span><span class="p">)</span> <span class="p">(</span><span class="nv">z</span><span class="p">)))</span>

<span class="c1">; look for all pairs where the second element is the symbol g</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">L</span> <span class="o">&#39;</span><span class="p">(</span> <span class="p">((</span><span class="nv">x</span> <span class="ss">y</span> <span class="ss">z</span><span class="p">)</span> <span class="ss">g</span><span class="p">)</span> <span class="p">((</span><span class="nv">a</span> <span class="ss">b</span><span class="p">)</span> <span class="p">(</span><span class="nv">c</span> <span class="ss">d</span><span class="p">))</span> <span class="p">((</span><span class="nv">e</span> <span class="ss">e</span><span class="p">)</span> <span class="p">(</span><span class="nv">f</span> <span class="ss">g</span><span class="p">))</span> <span class="p">))</span>

<span class="p">(</span><span class="k">ref-all</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">X</span> <span class="ss">g</span><span class="p">)</span> <span class="ss">L</span> <span class="k">unify</span><span class="p">)</span>      <span class="err">→</span> <span class="p">((</span><span class="nv">0</span><span class="p">)</span> <span class="p">(</span><span class="nv">2</span> <span class="ss">1</span><span class="p">))</span>
<span class="p">(</span><span class="k">ref-all</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">X</span> <span class="ss">g</span><span class="p">)</span> <span class="ss">L</span> <span class="k">unify</span> <span class="k">true</span><span class="p">)</span> <span class="err">→</span> <span class="p">(((</span><span class="nv">x</span> <span class="ss">y</span> <span class="ss">z</span><span class="p">)</span> <span class="ss">g</span><span class="p">)</span> <span class="p">(</span><span class="nv">f</span> <span class="ss">g</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p>See also the <a href="#ref">ref</a> function.</p></div>
<div class="paragraph"><p><a id="regex"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_regex_span"><span class="big red">regex</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (regex <em>str-pattern</em> <em>str-text</em> [<em>int-option</em> [<em>int-offset</em>]])</p></div>
<div class="paragraph"><p>Performs a Perl Compatible Regular Expression (PCRE) search on
<em>str-text</em> with the pattern specified in <em>str-pattern</em>. The same regular
expression pattern matching is also supported in the functions
<a href="#directory">directory</a>, <a href="#find">find</a>, <a href="#find-all">find-all</a>,
<a href="#parse">parse</a>, <a href="#replace">replace</a>, and <a href="#search">search</a>
when using these functions on strings.</p></div>
<div class="paragraph"><p><span class="monospaced">regex</span> returns a list with the matched strings and substrings and the
beginning and length of each string inside the text. If no match is
found, it returns <span class="monospaced">nil</span>. The offset numbers can be used for subsequent
processing.</p></div>
<div class="paragraph"><p>Additionally an <em>int-option</em> can be specified to control certain regular
expression options explained later. The additional <em>int-offset</em>
parameter tells <span class="monospaced">regex</span> to start searching for a match not at the
beginning of the string but at an offset.</p></div>
<div class="paragraph"><p>The offset and length numbers in the <span class="monospaced">regex</span> results are given based on
single bytes even when running the UTF-8 enabled version of newLISP.</p></div>
<div class="paragraph"><p><span class="monospaced">regex</span> also sets the variables <span class="monospaced">$0, $1,</span> and <span class="monospaced">$2—</span> to the expression
and subexpressions found. Just like any other symbol in newLISP, these
variables or their equivalent expressions <span class="monospaced">($ 0), ($ 1),</span> and <span class="monospaced">($ 2)—</span>
can be used in other newLISP expressions for further processing.</p></div>
<div class="paragraph"><p>Functions using regular expressions will not reset the <span class="monospaced">$0, $1 ... $15</span>
variables to <span class="monospaced">nil</span> when no match is found.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">regex</span> <span class="s">&quot;b+&quot;</span> <span class="s">&quot;aaaabbbaaaa&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="s">&quot;bbb&quot;</span> <span class="ss">4</span> <span class="ss">3</span><span class="p">)</span>

<span class="c1">; case-insensitive search option 1</span>
<span class="p">(</span><span class="k">regex</span> <span class="s">&quot;b+&quot;</span> <span class="s">&quot;AAAABBBAAAA&quot;</span> <span class="ss">1</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="s">&quot;BBB&quot;</span> <span class="ss">4</span> <span class="ss">3</span><span class="p">)</span>

<span class="p">(</span><span class="k">regex</span> <span class="s">&quot;[bB]+&quot;</span> <span class="s">&quot;AAAABbBAAAA&quot;</span> <span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="s">&quot;BbB&quot;</span> <span class="ss">4</span> <span class="ss">3</span><span class="p">)</span>

<span class="p">(</span><span class="k">regex</span> <span class="s">&quot;http://(.*):(.*)&quot;</span> <span class="s">&quot;http://nuevatec.com:80&quot;</span><span class="p">)</span>
<span class="err">→</span> <span class="p">(</span><span class="s">&quot;http://nuevatec.com:80&quot;</span> <span class="ss">0</span> <span class="ss">22</span> <span class="s">&quot;nuevatec.com&quot;</span> <span class="ss">7</span> <span class="ss">12</span> <span class="s">&quot;80&quot;</span> <span class="ss">20</span> <span class="ss">2</span><span class="p">)</span>

<span class="k">$</span><span class="ss">0</span>  <span class="err">→</span> <span class="s">&quot;http://nuevatec.com:80&quot;</span>
<span class="k">$</span><span class="ss">1</span>  <span class="err">→</span> <span class="s">&quot;nuevatec.com&quot;</span>
<span class="k">$</span><span class="ss">2</span>  <span class="err">→</span> <span class="s">&quot;80&quot;</span>

<span class="p">(</span><span class="k">dotimes</span> <span class="p">(</span><span class="nv">i</span> <span class="ss">3</span><span class="p">)</span> <span class="p">(</span><span class="k">println</span> <span class="p">(</span><span class="nv">$</span> <span class="ss">i</span><span class="p">)))</span>
<span class="ss">http</span><span class="o">:</span><span class="ss">//nuevatec.com</span><span class="o">:</span><span class="ss">80</span>
<span class="ss">nuevatec.com</span>
<span class="ss">80</span>
<span class="err">→</span> <span class="s">&quot;80&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>The second example shows the usage of extra options, while the third
example demonstrates more complex parsing of two subexpressions that
were marked by parentheses in the search pattern. In the last example,
the expression and subexpressions are retrieved using the system
variables <span class="monospaced">$0</span> to <span class="monospaced">$2</span> or their equivalent expression <span class="monospaced">($ 0)</span> to
<span class="monospaced">($ 2)</span>.</p></div>
<div class="paragraph"><p>When <span class="monospaced">""</span> (quotes) are used to delimit strings that include literal
backslashes, the backslash must be doubled in the regular expression
pattern. As an alternative, <span class="monospaced">{ }</span> (curly brackets) or <span class="monospaced">[text]</span> and
<span class="monospaced">[/text]</span> (text tags) can be used to delimit text strings. In these
cases, no extra backslashes are required.</p></div>
<div class="paragraph"><p>Characters escaped by a backslash in newLISP (e.g., the quote <span class="monospaced">\"</span> or
<span class="monospaced">\n</span>) need not to be doubled in a regular expression pattern, which
itself is delimited by quotes.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">;; double backslash for parentheses (special char in regex)</span>
<span class="p">(</span><span class="k">regex</span> <span class="s">&quot;\\(abc\\)&quot;</span> <span class="s">&quot;xyz(abc)xyz&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="s">&quot;(abc)&quot;</span> <span class="ss">3</span> <span class="ss">5</span><span class="p">)</span>

<span class="c1">;; one backslash for quotes (special char in newLISP)</span>
<span class="p">(</span><span class="k">regex</span> <span class="s">&quot;\&quot;&quot;</span> <span class="s">&quot;abc\&quot;def&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="s">&quot;\&quot;&quot;</span> <span class="ss">3</span> <span class="ss">1</span><span class="p">)</span>

<span class="c1">;; brackets as delimiters</span>
<span class="p">(</span><span class="k">regex</span> <span class="s">{\(abc\)}</span> <span class="s">&quot;xyz(abc)xyz&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="s">&quot;(abc)&quot;</span> <span class="ss">3</span> <span class="ss">5</span><span class="p">)</span>

<span class="c1">;; brackets as delimiters and quote in pattern</span>
<span class="p">(</span><span class="k">regex</span> <span class="s">{&quot;}</span> <span class="s">&quot;abc\&quot;def&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="s">&quot;\&quot;&quot;</span> <span class="ss">3</span> <span class="ss">1</span><span class="p">)</span>

<span class="c1">;; text tags as delimiters, good for multiline text in CGI</span>
<span class="p">(</span><span class="k">regex</span> <span class="s">[text]\(abc\)[/text]</span> <span class="s">&quot;xyz(abc)xyz&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="s">&quot;(abc)&quot;</span> <span class="ss">3</span> <span class="ss">5</span><span class="p">)</span>
<span class="p">(</span><span class="k">regex</span> <span class="s">[text]&quot;[/text]</span> <span class="s">&quot;abc\&quot;def&quot;</span><span class="p">)</span>           <span class="err">→</span> <span class="p">(</span><span class="s">&quot;\&quot;&quot;</span> <span class="ss">3</span> <span class="ss">1</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>When curly brackets or text tags are used to delimit the pattern string
instead of quotes, a simple backslash is sufficient. The pattern and
string are then passed in raw form to the regular expression routines.
When curly brackets are used inside a pattern itself delimited by curly
brackets, the inner brackets must be balanced, as follows:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">;; brackets inside brackets are balanced</span>
<span class="p">(</span><span class="k">regex</span> <span class="s">{\d{1,3}}</span> <span class="s">&quot;qwerty567asdfg&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="s">&quot;567&quot;</span> <span class="ss">6</span> <span class="ss">3</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The following constants can be used for <em>int-option</em>. Several options
can be combined using a binary or <span class="monospaced">|</span> (pipe) operator. E.g. <span class="monospaced">(| 1 4)</span>
would combine options <span class="monospaced">1</span> and <span class="monospaced">4</span>. The uppercase names are used in the
PCRE regex documentation and could be predefined in <span class="monospaced">init.lsp</span>. The last
option is a newLISP custom option only to be used in
<a href="#replace">replace</a>; it can be combined with PCRE options.</p></div>
<table class="tableblock frame-all grid-all"
style="
width:75%;
">
<col style="width:33%;">
<col style="width:11%;">
<col style="width:55%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" >PCRE name </th>
<th class="tableblock halign-left valign-top" >no </th>
<th class="tableblock halign-left valign-top" >description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">PCRE_CASELESS</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">treat uppercase like lowercase</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">PCRE_MULTILINE</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">limit search at a newline like Perl&#8217;s /m</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">PCRE_DOTALL</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">. (dot) also matches newline</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">PCRE_EXTENDED</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">ignore whitespace except inside char class</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">PCRE_ANCHORED</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">16</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">anchor at the start</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">PCRE_DOLLAR_ENDONLY</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">32</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">$ matches at end of string, not before newline</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">PCRE_EXTRA</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">64</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">additional functionality currently not used</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">PCRE_NOTBOL</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">128</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">first ch, not start of line; ^ shouldn&#8217;t match</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">PCRE_NOTEOL</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">256</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">last char, not end of line; $ shouldn&#8217;t match</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">PCRE_UNGREEDY</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">512</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">invert greediness of quantifiers</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">PCRE_NOTEMPTY</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">1024</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">empty string considered invalid</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">PCRE_UTF8</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">2048</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">pattern and strings as UTF-8 characters</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">REPLACE_ONCE</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">0x8000</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">replace only one occurrence only for use in
<a href="#replace">replace</a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">PRECOMPILED</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">0x10000</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">pattern is pre-compiled, can only be combined
with RREPLACE_ONCE 0x8000</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>The settings of the PCRE_CASELESS, PCRE_MULTILINE, PCRE_DOTALL, and
PCRE_EXTENDED options can be changed from within the pattern by a
sequence of option letters enclosed between "(?" and ")". The option
letters are:</p></div>
<table class="tableblock frame-all grid-all"
style="
width:15%;
">
<col style="width:20%;">
<col style="width:80%;">
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">i</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">for PCRE_CASELESS</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">m</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">for PCRE_MULTILINE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">s</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">for PCRE_DOTALL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">x</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">for PCRE_EXTENDED</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>Note that regular expression syntax is very complex and feature-rich
with many special characters and forms. Please consult a book or the
PCRE manual pages for more detail. Most PERL books or introductions to
Linux or Unix also contain chapters about regular expressions. See also
<a href="http://www.pcre.org">http://www.pcre.org</a> for further references and
manual pages.</p></div>
<div class="paragraph"><p>Regular expression patterns can be precompiled for higher speed when
using changing repetitive patterns with <a href="#regex-comp">regex-comp</a>.</p></div>
<div class="paragraph"><p><a id="regex-comp"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_regex_comp_span"><span class="big red">regex-comp</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (regex-comp <em>str-pattern</em> [<em>int-option</em>])</p></div>
<div class="paragraph"><p>newLISP automatically compiles regular expression patterns and caches
the last compilation to speed up repetitive pattern searches. If
patterns change from one to the next, but are repeated over and over
again, then the caching of the last pattern is not sufficient.
<span class="monospaced">regex-comp</span> can be used to pre-compile repetitive patterns to speed up
regular expression searches:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">; slower without pre-compilation</span>

<span class="p">(</span><span class="k">dolist</span> <span class="p">(</span><span class="nv">line</span> <span class="ss">page</span><span class="p">)</span>
    <span class="p">(</span><span class="k">replace</span> <span class="ss">pattern-str1</span> <span class="ss">line</span> <span class="ss">repl1</span> <span class="ss">0</span><span class="p">)</span>
    <span class="p">(</span><span class="k">replace</span> <span class="ss">pattern-str2</span> <span class="ss">line</span> <span class="ss">repl2</span> <span class="ss">512</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1">; fast with pre-compilation and option 0x10000</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">p1</span> <span class="p">(</span><span class="k">regex-comp</span> <span class="ss">pattern-str1</span><span class="p">))</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">p2</span> <span class="p">(</span><span class="k">regex-comp</span> <span class="ss">pattern-str2</span> <span class="ss">512</span><span class="p">))</span>

<span class="p">(</span><span class="k">dolist</span> <span class="p">(</span><span class="nv">line</span> <span class="ss">page</span><span class="p">)</span>
    <span class="p">(</span><span class="k">replace</span> <span class="ss">p1</span> <span class="ss">line</span> <span class="ss">repl1</span> <span class="ss">0x10000</span><span class="p">)</span>
    <span class="p">(</span><span class="k">replace</span> <span class="ss">p2</span> <span class="ss">line</span> <span class="ss">repl2</span> <span class="ss">0x10000</span><span class="p">)</span>
<span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>When using pre-compiled patterns in any of the functions using regular
expressions, the option number is set to <span class="monospaced">0x10000</span> to signal that
pre-compiled patterns are used. Normal pattern options are specified
during pre-compilation with <span class="monospaced">regex-comp</span> . The <span class="monospaced">0x10000</span> option can only
be combined with <span class="monospaced">0x8000</span>, the option used to specify that only one
replacement should be made when using <a href="#replace">replace</a>.</p></div>
<div class="paragraph"><p><a id="remove-dir"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_remove_dir_span"><span class="big red">remove-dir</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (remove-dir <em>str-path</em>)</p></div>
<div class="paragraph"><p>Removes the directory whose path name is specified in <em>str-path</em>. The
directory must be empty for <span class="monospaced">remove-dir</span> to succeed. Returns <span class="monospaced">nil</span> on
failure.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">remove-dir</span> <span class="s">&quot;temp&quot;</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Removes the directory <span class="monospaced">temp</span> in the current directory.</p></div>
<div class="paragraph"><p><a id="rename-file"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_rename_file_span"><span class="big red">rename-file</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (rename-file <em>str-path-old</em> <em>str-path-new</em>)</p></div>
<div class="paragraph"><p>Renames a file or directory entry given in the path name <em>str-path-old</em>
to the name given in <em>str-path-new</em>. Returns <span class="monospaced">nil</span> or <span class="monospaced">true</span> depending
on the operation&#8217;s success.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">rename-file</span> <span class="s">&quot;data.lisp&quot;</span> <span class="s">&quot;data.backup&quot;</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p><a id="replace"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_replace_a_href_destructive_a_span"><span class="big red">replace <a href="#destructive">!</a></span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (replace <em>exp-key</em> <em>list</em> <em>exp-replacement</em> [<em>func-compare</em>])<br>
<strong>syntax:</strong> (replace <em>exp list</em>)<br>
<strong>syntax:</strong> (replace <em>str-key</em> <em>str-data</em> <em>exp-replacement</em>)<br>
<strong>syntax:</strong> (replace <em>str-pattern</em> <em>str-data</em> <em>exp-replacement</em> <em>int-regex-option</em>)</p></div>
</div>
<div class="sect3">
<h4 id="_list_replacement">List replacement</h4>
<div class="paragraph"><p>If the second argument is a list, <span class="monospaced">replace</span> replaces all elements in the
list <em>list</em> that are equal to the expression in <em>exp-key</em>. The element
is replaced with <em>exp-replacement</em>. Note that <span class="monospaced">replace</span> is destructive.
It changes the list passed to it and returns the changed list. The
number of replacements made is contained in the system variable <span class="monospaced">$0</span>
when the function returns. During executions of the replacement
expression, the system variable <span class="monospaced">$0</span> and the anaphoric system variable
<span class="monospaced">$it</span> are set to the expression to be replaced.</p></div>
<div class="paragraph"><p>Optionally, <em>func-compare</em> can specify a comparison operator or
user-defined function. By default, <em>func-compare</em> is the <span class="monospaced">=</span> (equals
sign).</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">;; list replacement</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">aList</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span> <span class="ss">d</span> <span class="ss">e</span> <span class="ss">a</span> <span class="ss">b</span> <span class="ss">c</span> <span class="ss">d</span><span class="p">))</span>

<span class="p">(</span><span class="k">replace</span> <span class="o">&#39;</span><span class="ss">b</span> <span class="ss">aList</span> <span class="o">&#39;</span><span class="ss">B</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">B</span> <span class="ss">c</span> <span class="ss">d</span> <span class="ss">e</span> <span class="ss">a</span> <span class="ss">B</span> <span class="ss">c</span> <span class="ss">d</span><span class="p">)</span>
<span class="ss">aList</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">B</span> <span class="ss">c</span> <span class="ss">d</span> <span class="ss">e</span> <span class="ss">a</span> <span class="ss">B</span> <span class="ss">c</span> <span class="ss">d</span><span class="p">)</span>
<span class="k">$</span><span class="ss">0</span>     <span class="err">→</span> <span class="ss">2</span>  <span class="c1">; number of replacements</span>

<span class="c1">;; list replacement with special compare functor/function</span>

<span class="c1">; replace all numbers where 10 &lt; number</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">L</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1</span> <span class="ss">4</span> <span class="ss">22</span> <span class="ss">5</span> <span class="ss">6</span> <span class="ss">89</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">24</span><span class="p">))</span>

<span class="p">(</span><span class="k">replace</span> <span class="ss">10</span> <span class="ss">L</span> <span class="ss">10</span> <span class="ss">&lt;</span><span class="p">)</span> <span class="err">→</span> <span class="p">(</span><span class="nv">1</span> <span class="ss">4</span> <span class="ss">10</span> <span class="ss">5</span> <span class="ss">6</span> <span class="ss">10</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">10</span><span class="p">)</span>

<span class="c1">; same as:</span>

<span class="p">(</span><span class="k">replace</span> <span class="ss">10</span> <span class="ss">L</span> <span class="ss">10</span> <span class="p">(</span><span class="k">fn</span> <span class="p">(</span><span class="nv">x</span> <span class="ss">y</span><span class="p">)</span> <span class="p">(</span><span class="nv">&lt;</span> <span class="ss">x</span> <span class="ss">y</span><span class="p">)))</span> <span class="err">→</span> <span class="p">(</span><span class="nv">1</span> <span class="ss">4</span> <span class="ss">10</span> <span class="ss">5</span> <span class="ss">6</span> <span class="ss">10</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">10</span><span class="p">)</span>

<span class="c1">; change name-string to symbol, x is ignored as nil</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">AL</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">john</span> <span class="ss">5</span> <span class="ss">6</span> <span class="ss">4</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;mary&quot;</span> <span class="ss">3</span> <span class="ss">4</span> <span class="ss">7</span><span class="p">)</span> <span class="p">(</span><span class="nv">bob</span> <span class="ss">4</span> <span class="ss">2</span> <span class="ss">7</span> <span class="ss">9</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;jane&quot;</span> <span class="ss">3</span><span class="p">)))</span>

<span class="p">(</span><span class="k">replace</span> <span class="k">nil</span> <span class="ss">AL</span> <span class="p">(</span><span class="k">cons</span> <span class="p">(</span><span class="k">sym</span> <span class="p">(</span><span class="k">$</span><span class="ss">it</span> <span class="ss">0</span><span class="p">))</span> <span class="p">(</span><span class="k">rest</span> <span class="k">$</span><span class="ss">it</span><span class="p">))</span>
                <span class="p">(</span><span class="k">fn</span> <span class="p">(</span><span class="nv">x</span> <span class="ss">y</span><span class="p">)</span> <span class="p">(</span><span class="k">string</span><span class="ss">?</span> <span class="p">(</span><span class="nv">y</span> <span class="ss">0</span><span class="p">))))</span>
<span class="err">→</span> <span class="p">((</span><span class="nv">john</span> <span class="ss">5</span> <span class="ss">6</span> <span class="ss">4</span><span class="p">)</span> <span class="p">(</span><span class="nv">mary</span> <span class="ss">3</span> <span class="ss">4</span> <span class="ss">7</span><span class="p">)</span> <span class="p">(</span><span class="nv">bob</span> <span class="ss">4</span> <span class="ss">2</span> <span class="ss">7</span> <span class="ss">9</span><span class="p">)</span> <span class="p">(</span><span class="nv">jane</span> <span class="ss">3</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p>Using the <a href="#match">match</a> and <a href="#unify">unify</a> functions, list
searches can be formulated that are as powerful as regular expression
string searches:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">; calculate the sum in all associations with &#39;mary</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">AL</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">john</span> <span class="ss">5</span> <span class="ss">6</span> <span class="ss">4</span><span class="p">)</span> <span class="p">(</span><span class="nv">mary</span> <span class="ss">3</span> <span class="ss">4</span> <span class="ss">7</span><span class="p">)</span> <span class="p">(</span><span class="nv">bob</span> <span class="ss">4</span> <span class="ss">2</span> <span class="ss">7</span> <span class="ss">9</span><span class="p">)</span> <span class="p">(</span><span class="nv">jane</span> <span class="ss">3</span><span class="p">)))</span>

<span class="p">(</span><span class="k">replace</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">mary</span> <span class="ss">*</span><span class="p">)</span>  <span class="ss">AL</span> <span class="p">(</span><span class="k">list</span> <span class="o">&#39;</span><span class="ss">mary</span> <span class="p">(</span><span class="k">apply</span> <span class="ss">+</span> <span class="p">(</span><span class="k">rest</span> <span class="k">$</span><span class="ss">it</span><span class="p">)))</span> <span class="k">match</span><span class="p">)</span>
<span class="err">→</span> <span class="p">((</span><span class="nv">john</span> <span class="ss">5</span> <span class="ss">6</span> <span class="ss">4</span><span class="p">)</span> <span class="p">(</span><span class="nv">mary</span> <span class="ss">14</span><span class="p">)</span> <span class="p">(</span><span class="nv">bob</span> <span class="ss">4</span> <span class="ss">2</span> <span class="ss">7</span> <span class="ss">9</span><span class="p">)</span> <span class="p">(</span><span class="nv">jane</span> <span class="ss">3</span><span class="p">))</span>

<span class="c1">; make sum in all expressions</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">AL</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">john</span> <span class="ss">5</span> <span class="ss">6</span> <span class="ss">4</span><span class="p">)</span> <span class="p">(</span><span class="nv">mary</span> <span class="ss">3</span> <span class="ss">4</span> <span class="ss">7</span><span class="p">)</span> <span class="p">(</span><span class="nv">bob</span> <span class="ss">4</span> <span class="ss">2</span> <span class="ss">7</span> <span class="ss">9</span><span class="p">)</span> <span class="p">(</span><span class="nv">jane</span> <span class="ss">3</span><span class="p">)))</span>

<span class="p">(</span><span class="k">replace</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">*</span><span class="p">)</span> <span class="ss">AL</span> <span class="p">(</span><span class="k">list</span> <span class="p">(</span><span class="k">$</span><span class="ss">0</span> <span class="ss">0</span><span class="p">)</span> <span class="p">(</span><span class="k">apply</span> <span class="ss">+</span> <span class="p">(</span><span class="k">rest</span> <span class="k">$</span><span class="ss">it</span><span class="p">)))</span> <span class="k">match</span><span class="p">)</span>
<span class="err">→</span> <span class="p">((</span><span class="nv">john</span> <span class="ss">15</span><span class="p">)</span> <span class="p">(</span><span class="nv">mary</span> <span class="ss">14</span><span class="p">)</span> <span class="p">(</span><span class="nv">bob</span> <span class="ss">22</span><span class="p">)</span> <span class="p">(</span><span class="nv">jane</span> <span class="ss">3</span><span class="p">))</span>

<span class="c1">; using unify</span>
<span class="p">(</span><span class="k">replace</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">X</span> <span class="ss">X</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">3</span> <span class="ss">10</span><span class="p">)</span> <span class="p">(</span><span class="nv">2</span> <span class="ss">5</span><span class="p">)</span> <span class="p">(</span><span class="nv">4</span> <span class="ss">4</span><span class="p">)</span> <span class="p">(</span><span class="nv">6</span> <span class="ss">7</span><span class="p">)</span> <span class="p">(</span><span class="nv">8</span> <span class="ss">8</span><span class="p">))</span> <span class="p">(</span><span class="k">list</span> <span class="p">(</span><span class="k">$</span><span class="ss">it</span> <span class="ss">0</span><span class="p">)</span> <span class="o">&#39;</span><span class="ss">double</span> <span class="p">(</span><span class="k">$</span><span class="ss">it</span> <span class="ss">1</span><span class="p">))</span> <span class="k">unify</span><span class="p">)</span>
<span class="err">→</span> <span class="p">((</span><span class="nv">3</span> <span class="ss">10</span><span class="p">)</span> <span class="p">(</span><span class="nv">2</span> <span class="ss">5</span><span class="p">)</span> <span class="p">(</span><span class="nv">4</span> <span class="ss">double</span> <span class="ss">4</span><span class="p">)</span> <span class="p">(</span><span class="nv">6</span> <span class="ss">7</span><span class="p">)</span> <span class="p">(</span><span class="nv">8</span> <span class="ss">double</span> <span class="ss">8</span><span class="p">))</span>
</pre></div></div></div>
</div>
<div class="sect3">
<h4 id="_list_removal">List removal</h4>
<div class="paragraph"><p>The last form of <span class="monospaced">replace</span> has only two arguments: the expression <em>exp</em>
and <em>list</em>. This form removes all <em>exp_s found in _list</em>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">;; removing elements from a list</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">lst</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">a</span> <span class="ss">a</span> <span class="ss">c</span> <span class="ss">d</span> <span class="ss">a</span> <span class="ss">f</span> <span class="ss">g</span><span class="p">))</span>
<span class="p">(</span><span class="k">replace</span> <span class="o">&#39;</span><span class="ss">a</span> <span class="ss">lst</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">b</span> <span class="ss">c</span> <span class="ss">d</span> <span class="ss">f</span> <span class="ss">g</span><span class="p">)</span>
<span class="ss">lst</span>               <span class="err">→</span> <span class="p">(</span><span class="nv">b</span> <span class="ss">c</span> <span class="ss">d</span> <span class="ss">f</span> <span class="ss">g</span><span class="p">)</span>

<span class="k">$</span><span class="ss">0</span>  <span class="err">→</span> <span class="ss">4</span>
</pre></div></div></div>
</div>
<div class="sect3">
<h4 id="_string_replacement_without_regular_expression">String replacement without regular expression</h4>
<div class="paragraph"><p>If all arguments are strings, <span class="monospaced">replace</span> replaces all occurrences of
<em>str-key</em> in <em>str-data</em> with the evaluated <em>exp-replacement</em>, returning
the changed string. The expression in <em>exp-replacement</em> is evaluated for
every replacement. The number of replacements made is contained in the
system variable <span class="monospaced">$0</span>. This form of <span class="monospaced">replace</span> can also process binary
`0`s (zeros).</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">;; string replacement</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">str</span> <span class="s">&quot;this isa sentence&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">replace</span> <span class="s">&quot;isa&quot;</span> <span class="ss">str</span> <span class="s">&quot;is a&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;this is a sentence&quot;</span>
</pre></div></div></div>
</div>
<div class="sect3">
<h4 id="_regular_expression_replacement">Regular expression replacement</h4>
<div class="paragraph"><p>The presence of a fourth parameter indicates that a regular expression
search should be performed with a regular expression pattern specified
in <em>str-pattern</em> and an option number specified in <em>int-option</em> (e.g.,
<span class="monospaced">1</span> (one) for case-insensitive searching or <span class="monospaced">0</span> (zero) for a standard
Perl Compatible Regular Expression (PCRE) search). See
<a href="#regex">regex</a> above for details.</p></div>
<div class="paragraph"><p>By default, <span class="monospaced">replace</span> replaces all occurrences of a search string even
if a beginning-of-line specification is included in the search pattern.
After each replace, a new search is started at a new position in
<em>str-data</em>. Setting the option bit to <span class="monospaced">0x8000</span> in <em>int-option</em> will
force <span class="monospaced">replace</span> to replace only the first occurrence. The changed string
is returned.</p></div>
<div class="paragraph"><p><span class="monospaced">replace</span> with regular expressions also sets the internal variables
<span class="monospaced">$0, $1,</span> and <span class="monospaced">$2—</span> with the contents of the expressions and
subexpressions found. The anaphoric system variable <span class="monospaced">$it</span> is set to the
same value as <span class="monospaced">$0</span>. These can be used to perform replacements that
depend on the content found during replacement. The symbols
<span class="monospaced">$it, $0, $1,</span> and <span class="monospaced">$2—</span> can be used in expressions just like any other
symbols. If the replacement expression evaluates to something other than
a string, no replacement is made. As an alternative, the contents of
these variables can also be accessed by using <span class="monospaced">($ 0), ($ 1), ($ 2),</span> and
so forth. This method allows indexed access (e.g., <span class="monospaced">($ i)</span>, where <span class="monospaced">i</span> is
an integer).</p></div>
<div class="paragraph"><p>After all replacements are made, the number of replacements is contained
in the system variable <span class="monospaced">$0</span>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">;; using the option parameter to employ regular expressions</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">str</span> <span class="s">&quot;ZZZZZxZZZZyy&quot;</span><span class="p">)</span>     <span class="err">→</span> <span class="s">&quot;ZZZZZxZZZZyy&quot;</span>
<span class="p">(</span><span class="k">replace</span> <span class="s">&quot;[x|y]&quot;</span> <span class="ss">str</span> <span class="s">&quot;PP&quot;</span> <span class="ss">0</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;ZZZZZPPZZZZPPPP&quot;</span>
<span class="ss">str</span>                           <span class="err">→</span> <span class="s">&quot;ZZZZZPPZZZZPPPP&quot;</span>

<span class="c1">;; using system variables for dynamic replacement</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">str</span> <span class="s">&quot;---axb---ayb---&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">replace</span> <span class="s">&quot;(a)(.)(b)&quot;</span> <span class="ss">str</span> <span class="p">(</span><span class="k">append</span> <span class="k">$</span><span class="ss">3</span> <span class="k">$</span><span class="ss">2</span> <span class="k">$</span><span class="ss">1</span><span class="p">)</span> <span class="ss">0</span><span class="p">)</span>
<span class="err">→</span> <span class="s">&quot;---bxa---bya---&quot;</span>

<span class="ss">str</span>  <span class="err">→</span> <span class="s">&quot;---bxa---bya---&quot;</span>

<span class="c1">;; using the &#39;replace once&#39; option bit 0x8000</span>

<span class="p">(</span><span class="k">replace</span> <span class="s">&quot;a&quot;</span> <span class="s">&quot;aaa&quot;</span> <span class="s">&quot;X&quot;</span> <span class="ss">0</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;XXX&quot;</span>

<span class="p">(</span><span class="k">replace</span> <span class="s">&quot;a&quot;</span> <span class="s">&quot;aaa&quot;</span> <span class="s">&quot;X&quot;</span> <span class="ss">0x8000</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;Xaa&quot;</span>

<span class="c1">;; URL translation of hex codes with dynamic replacement</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">str</span> <span class="s">&quot;xxx%41xxx%42&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">replace</span> <span class="s">&quot;%([0-9A-F][0-9A-F])&quot;</span> <span class="ss">str</span>
               <span class="p">(</span><span class="k">char</span> <span class="p">(</span><span class="k">int</span> <span class="p">(</span><span class="k">append</span> <span class="s">&quot;0x&quot;</span> <span class="k">$</span><span class="ss">1</span><span class="p">)))</span> <span class="ss">1</span><span class="p">)</span>

<span class="ss">str</span>  <span class="err">→</span> <span class="s">&quot;xxxAxxxB&quot;</span>

<span class="k">$</span><span class="ss">0</span>   <span class="err">→</span> <span class="ss">2</span>
</pre></div></div></div>
<div class="paragraph"><p>The <a href="#setf">setf</a> function together with <a href="#nth">nth</a>,
<a href="#first">first</a> or <a href="#last">last</a> can also be used to change
elements in a list.</p></div>
<div class="paragraph"><p>See <a href="#directory">directory</a>, <a href="#find">find</a>,
<a href="#find-all">find-all</a>, <a href="#parse">parse</a>, <a href="#regex">regex</a>, and
<a href="#search">search</a> for other functions using regular expressions.</p></div>
<div class="paragraph"><p><a id="reset"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_reset_span"><span class="big red">reset</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (reset)<br>
<strong>syntax:</strong> (reset true)</p></div>
<div class="paragraph"><p>In the first syntax, <span class="monospaced">reset</span> returns to the top level of evaluation,
switches the <a href="#trace">trace</a> mode off, and switches to the MAIN
context/namespace. <span class="monospaced">reset</span> restores the top-level variable environment
using the saved variable environments on the stack. It also fires an
error "user reset - no error". This behavior can be used when writing
error handlers.</p></div>
<div class="paragraph"><p><span class="monospaced">reset</span> may return memory that was claimed by newLISP to the operating
system. <span class="monospaced">reset</span> walks through the entire cell space, which may take a
few seconds in a heavily loaded system.</p></div>
<div class="paragraph"><p><span class="monospaced">reset</span> occurs automatically after an error condition.</p></div>
<div class="paragraph"><p>In the second syntax, <span class="monospaced">reset</span> will stop the current process and start a
new clean newLISP process with the same command-line parameters. This
mode will only work when newLISP was started using its full path-name,
e.g. <span class="monospaced">/usr/bin/newlisp</span> instead of only <span class="monospaced">newlisp</span>. This mode is not
available on Win32.</p></div>
<div class="paragraph"><p><a id="rest"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_rest_a_href_utf8_capable_utf8_a_span"><span class="big red">rest <a href="#utf8_capable">utf8</a></span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (rest <em>list</em>)<br>
<strong>syntax:</strong> (rest <em>array</em>)<br>
<strong>syntax:</strong> (rest <em>str</em>)</p></div>
<div class="paragraph"><p>Returns all of the items in a list or a string, except for the first.
<span class="monospaced">rest</span> is equivalent to <em>cdr</em> or <em>tail</em> in other Lisp dialects.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">rest</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">))</span>            <span class="err">→</span> <span class="p">(</span><span class="nv">2</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">)</span>
<span class="p">(</span><span class="k">rest</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">a</span> <span class="ss">b</span><span class="p">)</span> <span class="ss">c</span> <span class="ss">d</span><span class="p">))</span>          <span class="err">→</span> <span class="p">(</span><span class="nv">c</span> <span class="ss">d</span><span class="p">)</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">aList</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span> <span class="ss">d</span> <span class="ss">e</span><span class="p">))</span>    <span class="err">→</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span> <span class="ss">d</span> <span class="ss">e</span><span class="p">)</span>
<span class="p">(</span><span class="k">rest</span> <span class="ss">aList</span><span class="p">)</span>                 <span class="err">→</span> <span class="p">(</span><span class="nv">b</span> <span class="ss">c</span> <span class="ss">d</span> <span class="ss">e</span><span class="p">)</span>
<span class="p">(</span><span class="k">first</span> <span class="p">(</span><span class="k">rest</span> <span class="ss">aList</span><span class="p">))</span>         <span class="err">→</span> <span class="ss">b</span>
<span class="p">(</span><span class="k">rest</span> <span class="p">(</span><span class="k">rest</span> <span class="ss">aList</span><span class="p">))</span>          <span class="err">→</span> <span class="p">(</span><span class="nv">d</span> <span class="ss">e</span><span class="p">)</span>
<span class="p">(</span><span class="k">rest</span> <span class="p">(</span><span class="k">first</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">a</span> <span class="ss">b</span><span class="p">)</span> <span class="ss">c</span> <span class="ss">d</span><span class="p">)))</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">b</span><span class="p">)</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">A</span> <span class="p">(</span><span class="k">array</span> <span class="ss">2</span> <span class="ss">3</span> <span class="p">(</span><span class="k">sequence</span> <span class="ss">1</span> <span class="ss">6</span><span class="p">)))</span>
<span class="err">→</span> <span class="p">((</span><span class="nv">1</span> <span class="ss">2</span><span class="p">)</span> <span class="p">(</span><span class="nv">3</span> <span class="ss">4</span><span class="p">)</span> <span class="p">(</span><span class="nv">5</span> <span class="ss">6</span><span class="p">))</span>

<span class="p">(</span><span class="k">rest</span> <span class="ss">A</span><span class="p">)</span>  <span class="err">→</span> <span class="p">((</span><span class="nv">3</span> <span class="ss">4</span><span class="p">)</span> <span class="p">(</span><span class="nv">5</span> <span class="ss">6</span><span class="p">))</span>

<span class="p">(</span><span class="k">rest</span> <span class="o">&#39;</span><span class="p">())</span> <span class="err">→</span> <span class="p">()</span>
</pre></div></div></div>
<div class="paragraph"><p>In the second version, <span class="monospaced">rest</span> returns all but the first character of the
string <em>str</em> in a string.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">rest</span> <span class="s">&quot;newLISP&quot;</span><span class="p">)</span>          <span class="err">→</span> <span class="s">&quot;ewLISP&quot;</span>
<span class="p">(</span><span class="k">first</span> <span class="p">(</span><span class="k">rest</span> <span class="s">&quot;newLISP&quot;</span><span class="p">))</span>  <span class="err">→</span> <span class="s">&quot;e&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>See also the <a href="#first">first</a> and <a href="#last">last</a> functions.</p></div>
<div class="paragraph"><p>Note that an <em>implicit rest</em> is available for lists. See the chapter
<a href="#implicit_rest_slice">Implicit rest and slice</a>.</p></div>
<div class="paragraph"><p>Note that <a href="#rest">rest</a> works on character boundaries rather than
byte boundaries when the UTF-8–enabled version of newLISP is used.</p></div>
<div class="paragraph"><p><a id="reverse"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_reverse_a_href_destructive_a_span"><span class="big red">reverse <a href="#destructive">!</a></span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (reverse <em>list</em>)<br>
<strong>syntax:</strong> (reverse <em>string</em>)</p></div>
<div class="paragraph"><p>In the first form, <span class="monospaced">reverse</span> reverses and returns the <em>list</em>. Note that
<span class="monospaced">reverse</span> is destructive and changes the original list.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">l</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">4</span> <span class="ss">5</span> <span class="ss">6</span> <span class="ss">7</span> <span class="ss">8</span> <span class="ss">9</span><span class="p">))</span>

<span class="p">(</span><span class="k">reverse</span> <span class="ss">l</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">9</span> <span class="ss">8</span> <span class="ss">7</span> <span class="ss">6</span> <span class="ss">5</span> <span class="ss">4</span> <span class="ss">3</span> <span class="ss">2</span> <span class="ss">1</span><span class="p">)</span>
<span class="ss">l</span>            <span class="err">→</span> <span class="p">(</span><span class="nv">9</span> <span class="ss">8</span> <span class="ss">7</span> <span class="ss">6</span> <span class="ss">5</span> <span class="ss">4</span> <span class="ss">3</span> <span class="ss">2</span> <span class="ss">1</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>In the second form, <span class="monospaced">reverse</span> is used to reverse the order of characters
in a string.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">str</span> <span class="s">&quot;newLISP&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">reverse</span> <span class="ss">str</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;PSILwen&quot;</span>
<span class="ss">str</span>            <span class="err">→</span> <span class="s">&quot;PSILwen&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>See also the <a href="#sort">sort</a> function.</p></div>
<div class="paragraph"><p><a id="rotate"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_rotate_a_href_destructive_a_span"><span class="big red">rotate <a href="#destructive">!</a></span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (rotate <em>list</em> [<em>int-count</em>])<br>
<strong>syntax:</strong> (rotate <em>str</em> [<em>int-count</em>])</p></div>
<div class="paragraph"><p>Rotates and returns the <em>list</em> or string in <em>str</em>. A count can be
optionally specified in <em>int-count</em> to rotate more than one position. If
<em>int-count</em> is positive, the rotation is to the right; if <em>int-count</em> is
negative, the rotation is to the left. If no <em>int-count</em> is specified,
<span class="monospaced">rotate</span> rotates 1 to the right. <span class="monospaced">rotate</span> is a destructive function that
changes the contents of the original list or string.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">l</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">4</span> <span class="ss">5</span> <span class="ss">6</span> <span class="ss">7</span> <span class="ss">8</span> <span class="ss">9</span><span class="p">))</span>

<span class="p">(</span><span class="k">rotate</span> <span class="ss">l</span><span class="p">)</span>    <span class="err">→</span> <span class="p">(</span><span class="nv">9</span> <span class="ss">1</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">4</span> <span class="ss">5</span> <span class="ss">6</span> <span class="ss">7</span> <span class="ss">8</span><span class="p">)</span>
<span class="p">(</span><span class="k">rotate</span> <span class="ss">l</span> <span class="ss">2</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">7</span> <span class="ss">8</span> <span class="ss">9</span> <span class="ss">1</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">4</span> <span class="ss">5</span> <span class="ss">6</span><span class="p">)</span>

<span class="ss">l</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">7</span> <span class="ss">8</span> <span class="ss">9</span> <span class="ss">1</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">4</span> <span class="ss">5</span> <span class="ss">6</span><span class="p">)</span>

<span class="p">(</span><span class="k">rotate</span> <span class="ss">l</span> <span class="k">-</span><span class="ss">3</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">4</span> <span class="ss">5</span> <span class="ss">6</span> <span class="ss">7</span> <span class="ss">8</span> <span class="ss">9</span><span class="p">)</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">str</span> <span class="s">&quot;newLISP&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">rotate</span> <span class="ss">str</span><span class="p">)</span>     <span class="err">→</span> <span class="s">&quot;PnewLIS&quot;</span>
<span class="p">(</span><span class="k">rotate</span> <span class="ss">str</span> <span class="ss">3</span><span class="p">)</span>   <span class="err">→</span> <span class="s">&quot;LISPnew&quot;</span>
<span class="p">(</span><span class="k">rotate</span> <span class="ss">str</span> <span class="k">-</span><span class="ss">4</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;newLISP&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>When working on a string, <span class="monospaced">rotate</span> works on byte boundaries rather than
character boundaries.</p></div>
<div class="paragraph"><p><a id="round"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_round_span"><span class="big red">round</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (round <em>number</em> [<em>int-digits</em>])</p></div>
<div class="paragraph"><p>Rounds the number in <em>number</em> to the number of digits given in
<em>int-digits</em>. When decimals are being rounded, <em>int-digits</em> is negative.
It is positive when the integer part of a number is being rounded.</p></div>
<div class="paragraph"><p>If <em>int-digits</em> is omitted, the function rounds to <span class="monospaced">0</span> decimal digits.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">round</span> <span class="ss">123.49</span> <span class="ss">2</span><span class="p">)</span>    <span class="err">→</span> <span class="ss">100</span>
<span class="p">(</span><span class="k">round</span> <span class="ss">123.49</span> <span class="ss">1</span><span class="p">)</span>    <span class="err">→</span> <span class="ss">120</span>
<span class="p">(</span><span class="k">round</span> <span class="ss">123.49</span> <span class="ss">0</span><span class="p">)</span>    <span class="err">→</span> <span class="ss">123</span>
<span class="p">(</span><span class="k">round</span> <span class="ss">123.49</span><span class="p">)</span>      <span class="err">→</span> <span class="ss">123</span>
<span class="p">(</span><span class="k">round</span> <span class="ss">123.49</span> <span class="k">-</span><span class="ss">1</span><span class="p">)</span>   <span class="err">→</span> <span class="ss">123.5</span>
<span class="p">(</span><span class="k">round</span> <span class="ss">123.49</span> <span class="k">-</span><span class="ss">2</span><span class="p">)</span>   <span class="err">→</span> <span class="ss">123.49</span>
</pre></div></div></div>
<div class="paragraph"><p>Note that rounding for display purposes is better accomplished using
<a href="#format">format</a>.</p></div>
<div class="paragraph"><p><a id="save"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_save_span"><span class="big red">save</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (save <em>str-file</em>)<br>
<strong>syntax:</strong> (save <em>str-file</em> <em>sym-1</em> [<em>sym-2</em> &#8230; ])</p></div>
<div class="paragraph"><p>In the first syntax, the <span class="monospaced">save</span> function writes the contents of the
newLISP workspace (in textual form) to the file <em>str-file</em>. <span class="monospaced">save</span> is
the inverse function of <span class="monospaced">load</span>. Using <span class="monospaced">load</span> on files created with
<span class="monospaced">save</span> causes newLISP to return to the same state as when <span class="monospaced">save</span> was
originally invoked. System symbols starting with the <span class="monospaced">$</span> character
(e.g., <span class="monospaced">$0</span> from regular expressions or <span class="monospaced">$main-args</span> from the
command-line), symbols of built-in functions and symbols containing
<span class="monospaced">nil</span> are not saved.</p></div>
<div class="paragraph"><p>In the second syntax, symbols can be supplied as arguments. If <em>sym-n</em>
is supplied, only the definition of that symbol is saved. If <em>sym-n</em>
evaluates to a context, all symbols in that context are saved. More than
one symbol can be specified, and symbols and context symbols can be
mixed. When contexts are saved, system variables and symbols starting
with the <span class="monospaced">$</span> character are not saved. Specifying system symbols
explicitly causes them to be saved.</p></div>
<div class="paragraph"><p>Each symbol is saved by means of a <a href="#set">set</a> statement or—if the
symbol contains a lambda or lambda-macro function—by means of
<a href="#define">define</a> or <a href="#define-macro">define-macro</a> statements.</p></div>
<div class="paragraph"><p><span class="monospaced">save</span> returns <span class="monospaced">true</span> on completion.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">save</span> <span class="s">&quot;save.lsp&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">save</span> <span class="s">&quot;/home/myself/myfunc.LSP&quot;</span> <span class="o">&#39;</span><span class="ss">my-func</span><span class="p">)</span>
<span class="p">(</span><span class="k">save</span> <span class="s">&quot;file:///home/myself/myfunc.LSP&quot;</span> <span class="o">&#39;</span><span class="ss">my-func</span><span class="p">)</span>

<span class="p">(</span><span class="k">save</span> <span class="s">&quot;http://asite.com:8080//home/myself/myfunc.LSP&quot;</span> <span class="o">&#39;</span><span class="ss">my-func</span><span class="p">)</span>

<span class="p">(</span><span class="k">save</span> <span class="s">&quot;mycontext.lsp&quot;</span> <span class="o">&#39;</span><span class="ss">mycontext</span><span class="p">)</span>

<span class="c1">;; multiple args</span>
<span class="p">(</span><span class="k">save</span> <span class="s">&quot;stuff.lsp&quot;</span> <span class="o">&#39;</span><span class="ss">aContext</span> <span class="o">&#39;</span><span class="ss">myFunc</span> <span class="o">&#39;</span><span class="k">$main-args</span> <span class="o">&#39;</span><span class="ss">Acontext</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Because all context symbols are part of the context <span class="monospaced">MAIN</span>, saving
<span class="monospaced">MAIN</span> saves all contexts.</p></div>
<div class="paragraph"><p>Saving to a URL will cause an HTTP PUT request to be sent to the URL. In
this mode, <span class="monospaced">save</span> can also be used to push program source to remote
newLISP server nodes. Note that a double backslash is required when path
names are specified relative to the root directory. <span class="monospaced">save</span> in <span class="monospaced">HTTP</span>
mode will observe a 60-second timeout.</p></div>
<div class="paragraph"><p>Symbols made using <a href="#sym">sym</a> that are incompatible with the normal
syntax rules for symbols are serialized using a <a href="#sym">sym</a> statement
instead of a <a href="#set">set</a> statement.</p></div>
<div class="paragraph"><p><span class="monospaced">save</span> serializes contexts and symbols as if the current context is
<span class="monospaced">MAIN</span>. Regardless of the current context, <span class="monospaced">save</span> will always generate
the same output.</p></div>
<div class="paragraph"><p>See also the functions <a href="#load">load</a> (the inverse operation of
<span class="monospaced">save</span>) and <a href="#source">source</a>, which saves symbols and contexts to a
string instead of a file.</p></div>
<div class="paragraph"><p><a id="search"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_search_span"><span class="big red">search</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (search <em>int-file</em> <em>str-search</em> [<em>bool-flag</em> [<em>int-options</em>]])</p></div>
<div class="paragraph"><p>Searches a file specified by its handle in <em>int-file</em> for a string in
<em>str-search</em>. <em>int-file</em> can be obtained from a previous
<a href="#open">open</a> file. After the search, the file pointer is positioned
at the beginning or the end of the searched string or at the end of the
file if nothing is found.</p></div>
<div class="paragraph"><p>By default, the file pointer is positioned at the beginning of the
searched string. If <em>bool-flag</em> evaluates to <span class="monospaced">true</span>, then the file
pointer is positioned at the end of the searched string.</p></div>
<div class="paragraph"><p>In <em>int-options</em>, the options flags can be specified to perform a PCRE
regular expression search. See the function <a href="#regex">regex</a> for
details. If <em>int-options</em> is not specified a faster, plain string search
is performed. <span class="monospaced">search</span> returns the new file position or <span class="monospaced">nil</span> if nothing
is found.</p></div>
<div class="paragraph"><p>When using the regular expression options flag, patterns found are
stored in the system variables <span class="monospaced">$0</span> to <span class="monospaced">$15</span>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">file</span> <span class="p">(</span><span class="k">open</span> <span class="s">&quot;init.lsp&quot;</span> <span class="s">&quot;read&quot;</span><span class="p">))</span>
<span class="p">(</span><span class="k">search</span> <span class="ss">file</span> <span class="s">&quot;define&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">print</span> <span class="p">(</span><span class="k">read-</span><span class="ss">line</span> <span class="ss">file</span><span class="p">)</span> <span class="s">&quot;\n&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">close</span> <span class="ss">file</span><span class="p">)</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">file</span> <span class="p">(</span><span class="k">open</span> <span class="s">&quot;program.c&quot;</span> <span class="s">&quot;r&quot;</span><span class="p">))</span>
<span class="p">(</span><span class="k">while</span> <span class="p">(</span><span class="k">search</span> <span class="ss">file</span> <span class="s">&quot;#define (.*)&quot;</span> <span class="k">true</span> <span class="ss">0</span><span class="p">)</span> <span class="p">(</span><span class="k">println</span> <span class="k">$</span><span class="ss">1</span><span class="p">))</span>
<span class="p">(</span><span class="k">close</span> <span class="ss">file</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The file <span class="monospaced">init.lsp</span> is opened and searched for the string <span class="monospaced">define</span> and
the line in which the string occurs is printed.</p></div>
<div class="paragraph"><p>The second example looks for all lines in the file <span class="monospaced">program.c</span> which
start with the string <span class="monospaced">#define</span> and prints the rest of the line after
the string "#define ".</p></div>
<div class="paragraph"><p>For other functions using regular expressions, see
<a href="#directory">directory</a>, <a href="#find">find</a>, <a href="#find-all">find-all</a>,
<a href="#parse">parse</a>, <a href="#regex">regex</a>, and <a href="#replace">replace</a>.</p></div>
<div class="paragraph"><p><a id="seed"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_seed_span"><span class="big red">seed</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (seed <em>int-seed</em>)</p></div>
<div class="paragraph"><p>Seeds the internal random generator that generates numbers for
<a href="#amb">amb</a>, <a href="#normal">normal</a>, <a href="#rand">rand</a>, and
<a href="#random">random</a> with the number specified in <em>int-seed</em>. Note that
the random generator used in newLISP is the C-library function <em>rand()</em>.
All randomizing functions in newLISP are based on this function.</p></div>
<div class="paragraph"><p>Note that the maximum value for <em>int-seed</em> is limited to 16 or 32 bits,
depending on the operating system used. Internally, only the 32 least
significant bits are passed to the random seed function of the OS.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">seed</span> <span class="ss">12345</span><span class="p">)</span>

<span class="p">(</span><span class="k">seed</span> <span class="p">(</span><span class="k">time-of-day</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p>After using <span class="monospaced">seed</span> with the same number, the random generator starts the
same sequence of numbers. This facilitates debugging when randomized
data are involved. Using <span class="monospaced">seed</span>, the same random sequences can be
generated over and over again.</p></div>
<div class="paragraph"><p>The second example is useful for guaranteeing a different seed any time
the program starts.</p></div>
<div class="paragraph"><p><a id="self"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_self_span"><span class="big red">self</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (self [<em>int-index</em> &#8230; ])</p></div>
<div class="paragraph"><p>The function <span class="monospaced">self</span> accesses the target object of a FOOP method. One or
more <em>int-index</em> are used to access the object members.</p></div>
<div class="paragraph"><p>Objects referenced with <span class="monospaced">self</span> are mutable:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">new</span> <span class="k">Class</span> <span class="o">&#39;</span><span class="ss">Circle</span><span class="p">)</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">Circle</span><span class="o">:</span><span class="ss">move</span> <span class="ss">dx</span> <span class="ss">dy</span><span class="p">)</span>
    <span class="p">(</span><span class="k">inc</span> <span class="p">(</span><span class="k">self</span> <span class="ss">1</span><span class="p">)</span> <span class="ss">dx</span><span class="p">)</span>
    <span class="p">(</span><span class="k">inc</span> <span class="p">(</span><span class="k">self</span> <span class="ss">2</span><span class="p">)</span> <span class="ss">dy</span><span class="p">))</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">aCircle</span> <span class="p">(</span><span class="nv">Circle</span> <span class="ss">1</span> <span class="ss">2</span> <span class="ss">3</span><span class="p">))</span>
<span class="p">(</span><span class="o">:</span><span class="ss">move</span> <span class="ss">aCircle</span> <span class="ss">10</span> <span class="ss">20</span><span class="p">)</span>

<span class="ss">aCircle</span> <span class="err">→</span> <span class="p">(</span><span class="nv">Circle</span> <span class="ss">11</span> <span class="ss">22</span> <span class="ss">3</span><span class="p">)</span>

<span class="c1">; objects can be anonymous</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">circles</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">Circle</span> <span class="ss">1</span> <span class="ss">2</span> <span class="ss">3</span><span class="p">)</span> <span class="p">(</span><span class="nv">Circle</span> <span class="ss">4</span> <span class="ss">5</span> <span class="ss">6</span><span class="p">)))</span>

<span class="p">(</span><span class="o">:</span><span class="ss">move</span> <span class="p">(</span><span class="nv">circles</span> <span class="ss">0</span><span class="p">)</span> <span class="ss">10</span> <span class="ss">20</span><span class="p">)</span>
<span class="p">(</span><span class="o">:</span><span class="ss">move</span> <span class="p">(</span><span class="nv">circles</span> <span class="ss">1</span><span class="p">)</span> <span class="ss">10</span> <span class="ss">20</span><span class="p">)</span>

<span class="ss">circles</span> <span class="err">→</span> <span class="p">((</span><span class="nv">Circle</span> <span class="ss">11</span> <span class="ss">22</span> <span class="ss">3</span><span class="p">)</span> <span class="p">(</span><span class="nv">Circle</span> <span class="ss">14</span> <span class="ss">25</span> <span class="ss">6</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p>See also the chapter about programming with FOOP: <a href="#foop">Functional
object-oriented programming in newLISP</a></p></div>
<div class="paragraph"><p><a id="seek"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_seek_span"><span class="big red">seek</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (seek <em>int-file</em> [<em>int-position</em>])</p></div>
<div class="paragraph"><p>Sets the file pointer to the new position <em>int-position</em> in the file
specified by <em>int-file</em>.The new position is expressed as an offset from
the beginning of the file, <span class="monospaced">0</span> (zero) meaning the beginning of the file.
If no <em>int-position</em> is specified, <span class="monospaced">seek</span> returns the current position
in the file. If <em>int-file</em> is <span class="monospaced">0</span> (zero), on BSD, <span class="monospaced">seek</span> will return the
number of characters printed to STDOUT, and on Linux and Win32, it will
return <span class="monospaced">-1</span>. On failure, <span class="monospaced">seek</span> returns <span class="monospaced">nil</span>. When <em>int-position</em> is
set to <span class="monospaced">-1</span>, <span class="monospaced">seek</span> sets the file pointer to the end of the file.</p></div>
<div class="paragraph"><p><span class="monospaced">seek</span> can set the file position past the current end of the file.
Subsequent writing to this position will extend the file and fill unused
positions with zero&#8217;s. The blocks of zeros are not actually allocated on
disk, so the file takes up less space and is called a <em>sparse file</em>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">file</span> <span class="p">(</span><span class="k">open</span> <span class="s">&quot;myfile&quot;</span> <span class="s">&quot;read&quot;</span><span class="p">))</span>  <span class="err">→</span> <span class="ss">5</span>
<span class="p">(</span><span class="k">seek</span> <span class="ss">file</span> <span class="ss">100</span><span class="p">)</span>                     <span class="err">→</span> <span class="ss">100</span>
<span class="p">(</span><span class="k">seek</span> <span class="ss">file</span><span class="p">)</span>                         <span class="err">→</span> <span class="ss">100</span>

<span class="p">(</span><span class="k">open</span> <span class="s">&quot;newlisp_manual.html&quot;</span> <span class="s">&quot;read&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">seek</span> <span class="ss">file</span> <span class="k">-</span><span class="ss">1</span><span class="p">)</span>  <span class="c1">; seek to EOF</span>
<span class="err">→</span> <span class="ss">593816</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">fle</span> <span class="p">(</span><span class="k">open</span> <span class="s">&quot;large-file&quot;</span> <span class="s">&quot;read&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">seek</span> <span class="ss">file</span> <span class="ss">30000000000</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">30000000000</span>
</pre></div></div></div>
<div class="paragraph"><p>newLISP supports file position numbers up to 9,223,372,036,854,775,807.</p></div>
<div class="paragraph"><p><a id="select"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_select_a_href_utf8_capable_utf8_a_span"><span class="big red">select <a href="#utf8_capable">utf8</a></span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (select <em>list</em> <em>list-selection</em>)<br>
<strong>syntax:</strong> (select <em>list</em> [<em>int-index_i</em> &#8230; ])<br>
<strong>syntax:</strong> (select <em>string</em> <em>list-selection</em>)<br>
<strong>syntax:</strong> (select <em>string</em> [<em>int-index_i</em> &#8230; ])</p></div>
<div class="paragraph"><p>In the first two forms, <span class="monospaced">select</span> picks one or more elements from <em>list</em>
using one or more indices specified in <em>list-selection</em> or the
<em>int-index_i</em>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">lst</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span> <span class="ss">d</span> <span class="ss">e</span> <span class="ss">f</span> <span class="ss">g</span><span class="p">))</span>

<span class="p">(</span><span class="k">select</span> <span class="ss">lst</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">0</span> <span class="ss">3</span> <span class="ss">2</span> <span class="ss">5</span> <span class="ss">3</span><span class="p">))</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">d</span> <span class="ss">c</span> <span class="ss">f</span> <span class="ss">d</span><span class="p">)</span>

<span class="p">(</span><span class="k">select</span> <span class="ss">lst</span> <span class="o">&#39;</span><span class="p">(</span><span class="k">-</span><span class="ss">2</span> <span class="k">-</span><span class="ss">1</span> <span class="ss">0</span><span class="p">))</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">f</span> <span class="ss">g</span> <span class="ss">a</span><span class="p">)</span>

<span class="p">(</span><span class="k">select</span> <span class="ss">lst</span> <span class="k">-</span><span class="ss">2</span> <span class="k">-</span><span class="ss">1</span> <span class="ss">0</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">f</span> <span class="ss">g</span> <span class="ss">a</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>In the second two forms, <span class="monospaced">select</span> picks one or more characters from
<em>string</em> using one or more indices specified in <em>list-selection</em> or the
<em>int-index_i</em>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">str</span> <span class="s">&quot;abcdefg&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">select</span> <span class="ss">str</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">0</span> <span class="ss">3</span> <span class="ss">2</span> <span class="ss">5</span> <span class="ss">3</span><span class="p">))</span>  <span class="err">→</span> <span class="s">&quot;adcfd&quot;</span>

<span class="p">(</span><span class="k">select</span> <span class="ss">str</span> <span class="o">&#39;</span><span class="p">(</span><span class="k">-</span><span class="ss">2</span> <span class="k">-</span><span class="ss">1</span> <span class="ss">0</span><span class="p">))</span>  <span class="err">→</span> <span class="s">&quot;fga&quot;</span>

<span class="p">(</span><span class="k">select</span> <span class="ss">str</span> <span class="k">-</span><span class="ss">2</span> <span class="k">-</span><span class="ss">1</span> <span class="ss">0</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;fga&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>Selected elements can be repeated and do not have to appear in order,
although this speeds up processing. The order in <em>list-selection</em> or
<em>int-index_i</em> can be changed to rearrange elements.</p></div>
<div class="paragraph"><p><a id="semaphore"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_semaphore_span"><span class="big red">semaphore</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (semaphore)<br>
<strong>syntax:</strong> (semaphore <em>int-id</em>)<br>
<strong>syntax:</strong> (semaphore <em>int-id</em> <em>int-wait</em>)<br>
<strong>syntax:</strong> (semaphore <em>int-id</em> <em>int-signal</em>)<br>
<strong>syntax:</strong> (semaphore <em>int-id</em> <em>0</em>)</p></div>
<div class="paragraph"><p>A semaphore is an interprocess synchronization object that maintains a
count between <span class="monospaced">0</span> (zero) and some maximum value. Useful in controlling
access to a shared resource, a semaphore is set to signaled when its
count is greater than zero and to non-signaled when its count is zero.</p></div>
<div class="paragraph"><p>A semaphore is created using the first syntax. This returns the
semaphore ID, an integer used subsequently as <em>int-id</em> when the
<em>semaphore</em> function is called. Initially, the semaphore has a value of
zero, which represents the non-signaled state.</p></div>
<div class="paragraph"><p>If calling <span class="monospaced">semaphore</span> with a negative value in <em>int-wait</em> causes it to
be decremented below zero, the function call will block until another
process signals the semaphore with a positive value in <em>int-signal</em>.
Calls to the semaphore with <em>int-wait</em> or <em>int-signal</em> effectively try
to increment or decrement the semaphore value by a positive or negative
value specified in <em>int-signal</em> or <em>int-wait</em>. Because the value of a
semaphore must never fall below zero, the function call will block when
this is attempted (i.e., a semaphore with a value of zero will block
until another process increases the value with a positive <em>int-signal</em>).</p></div>
<div class="paragraph"><p>The second syntax is used to inquire about the value of a semaphore by
calling <span class="monospaced">semaphore</span> with the <em>int-id</em> only. This form is not available
on Win32.</p></div>
<div class="paragraph"><p>Supplying <span class="monospaced">0</span> (zero) as the last argument will release system resources
for the semaphore, which then becomes unavailable. Any pending waits on
this semaphore in other child processes will be released.</p></div>
<div class="paragraph"><p>On Win32, only parent and child processes can share a semaphore. On
Linux/Unix, independent processes can share a semaphore.</p></div>
<div class="paragraph"><p>On failure the <span class="monospaced">semaphore</span> function returns <span class="monospaced">nil</span>.
<a href="#sys-error">sys-error</a> can be used to retrieve the error number and
text from the underlying operating system.</p></div>
<div class="paragraph"><p>The following code examples summarize the different syntax forms:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">;; init semaphores</span>
<span class="p">(</span><span class="k">semaphore</span><span class="p">)</span>

<span class="c1">;; assign a semaphore to sid</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">sid</span> <span class="p">(</span><span class="k">semaphore</span><span class="p">))</span>

<span class="c1">;; inquire the state of a semaphore (not on Win32)</span>
<span class="p">(</span><span class="k">semaphore</span> <span class="ss">sid</span><span class="p">)</span>

<span class="c1">;; put sid semaphore in wait state (-1)</span>
<span class="p">(</span><span class="k">semaphore</span> <span class="ss">sid</span> <span class="k">-</span><span class="ss">1</span><span class="p">)</span>

<span class="c1">;; run sid semaphore previously put in wait (always 1)</span>
<span class="p">(</span><span class="k">semaphore</span> <span class="ss">sid</span> <span class="ss">1</span><span class="p">)</span>

<span class="c1">;; run sid semaphore with X times a skip (backward or forward) on the function</span>
<span class="p">(</span><span class="k">semaphore</span> <span class="ss">sid</span> <span class="ss">X</span><span class="p">)</span>

<span class="c1">;; release sid semaphore system-wide (always 0)</span>
<span class="p">(</span><span class="k">semaphore</span> <span class="ss">sid</span> <span class="ss">0</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The following example shows semaphores controlling a child process:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">;; counter process output in bold</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">counter</span> <span class="ss">n</span><span class="p">)</span>
    <span class="p">(</span><span class="k">println</span> <span class="s">&quot;counter started&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="k">dotimes</span> <span class="p">(</span><span class="nv">x</span> <span class="ss">n</span><span class="p">)</span>
        <span class="p">(</span><span class="k">semaphore</span> <span class="ss">sid</span> <span class="k">-</span><span class="ss">1</span><span class="p">)</span>
        <span class="p">(</span><span class="k">println</span> <span class="ss">x</span><span class="p">)))</span>

<span class="c1">;; hit extra &lt;enter&gt; to make the prompt come back</span>
<span class="c1">;; after output to the console from the counter process</span>

<span class="ss">&gt;</span> <span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">sid</span> <span class="p">(</span><span class="k">semaphore</span><span class="p">))</span>

<span class="ss">&gt;</span> <span class="p">(</span><span class="k">semaphore</span> <span class="ss">sid</span><span class="p">)</span>
<span class="ss">0</span>

<span class="ss">&gt;</span> <span class="p">(</span><span class="k">fork</span> <span class="p">(</span><span class="nv">counter</span> <span class="ss">100</span><span class="p">))</span>

<span class="ss">counter</span> <span class="ss">started</span>
<span class="ss">&gt;</span> <span class="p">(</span><span class="k">semaphore</span> <span class="ss">sid</span> <span class="ss">1</span><span class="p">)</span>
<span class="ss">0</span>
<span class="ss">&gt;</span> <span class="p">(</span><span class="k">semaphore</span> <span class="ss">sid</span> <span class="ss">3</span><span class="p">)</span>
<span class="ss">1</span>
<span class="ss">2</span>
<span class="ss">3</span>
<span class="ss">&gt;</span> <span class="p">(</span><span class="k">semaphore</span> <span class="ss">sid</span> <span class="ss">2</span><span class="p">)</span>
<span class="ss">4</span>

<span class="ss">5</span>
<span class="ss">&gt;</span> <span class="ss">_</span>
</pre></div></div></div>
<div class="paragraph"><p>After the semaphore is acquired in <span class="monospaced">sid</span>, it has a value of <span class="monospaced">0</span> (the
non-signaled state). When starting the process <span class="monospaced">counter</span>, the semaphore
will block after the initial start message and will wait in the
semaphore call. The <span class="monospaced">-1</span> is trying to decrement the semaphore, which is
not possible because its value is already zero. In the interactive, main
parent process, the semaphore is signaled by raising its value by <span class="monospaced">1</span>.
This unblocks the semaphore call in the <span class="monospaced">counter</span> process, which can now
decrement the semaphore from <span class="monospaced">1</span> to <span class="monospaced">0</span> and execute the <span class="monospaced">print</span>
statement. When the semaphore call is reached again, it will block
because the semaphore is already in the wait (<span class="monospaced">0</span>) state.</p></div>
<div class="paragraph"><p>Subsequent calls to <span class="monospaced">semaphore</span> with numbers greater than <span class="monospaced">1</span> give the
<span class="monospaced">counter</span> process an opportunity to decrement the semaphore several
times before blocking.</p></div>
<div class="paragraph"><p>More than one process can participate in controlling the semaphore, just
as more than one semaphore can be created. The maximum number of
semaphores is controlled by a system-wide kernel setting on Unix-like
operating systems.</p></div>
<div class="paragraph"><p>Use the <a href="#fork">fork</a> function to start a new process and the
<a href="#share">share</a> function to share information between processes. For
a more comprehensive example of using <span class="monospaced">semaphore</span> to synchronize
processes, see the file <span class="monospaced">prodcons.lsp</span> example in the <span class="monospaced">examples</span>
directory in the source distribution, as well as the examples and
modules distributed with newLISP.</p></div>
<div class="paragraph"><p><a id="send"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_send_span"><span class="big red">send</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (send <em>int-pid</em> <em>exp</em>)<br>
<strong>syntax:</strong> (send)</p></div>
<div class="paragraph"><p>The <span class="monospaced">send</span> function enables communication between parent and child
processes started with <a href="#spawn">spawn</a>. Parent processes can send and
receive messages to and from their child processes and child processes
can send and receive messages to and from their parent process. A proxy
technique – shown further down – is employed to communicate between
child process peers. <span class="monospaced">send</span> and <a href="#receive">receive</a> do not require
locks or semaphores. They work on dual send and receive message queues.</p></div>
<div class="paragraph"><p>Processes started using <a href="#fork">fork</a> or <a href="#process">process</a> can
not use <span class="monospaced">send</span> and <span class="monospaced">receive</span> message functions. Instead they should use
either <a href="#share">share</a> with <a href="#semaphore">semaphore</a> or
<a href="#pipe">pipe</a> to communicate.</p></div>
<div class="paragraph"><p>The <span class="monospaced">send</span> function is not available on Win32.</p></div>
<div class="paragraph"><p>In the first syntax <span class="monospaced">send</span> is used to send a message from a parent to a
child process or a child to a parent process.</p></div>
<div class="paragraph"><p>The second syntax is only used by parent processes to get a list of all
child processes ready to accept message from the parent in their receive
queues. If a child&#8217;s receive queue is full, it will not be part of the
list returned by the <span class="monospaced">(send)</span> statement.</p></div>
<div class="paragraph"><p>The content of a message may be any newLISP expression either atomic or
list expressions: boolean constants <span class="monospaced">nil</span> and <span class="monospaced">true</span>, integers, floating
point numbers or strings, or any list expression in valid newLISP
syntax. The size of a message is unlimited.</p></div>
<div class="paragraph"><p>The <em>exp</em> parameter specifies the data to be sent to the recipient in
<em>int-pid</em>. The recipient can be either a spawned child process of the
current process or the parent process. If a message queue is full, it
can be read from the receiving end, but a <span class="monospaced">send</span> issued on the other
side of the queue will fail and return <span class="monospaced">nil</span>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">; child process dispatching message to parent</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">ppid</span> <span class="p">(</span><span class="k">sys-info</span> <span class="k">-</span><span class="ss">4</span><span class="p">))</span> <span class="c1">; get parent pid</span>

<span class="p">(</span><span class="k">send</span> <span class="ss">ppid</span> <span class="s">&quot;hello&quot;</span><span class="p">)</span> <span class="c1">; send message</span>
</pre></div></div></div>
<div class="paragraph"><p>The targeted recipient of the message is the parent process:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">; parent process receiving message from child</span>

<span class="p">(</span><span class="k">receive</span> <span class="ss">child-pid</span> <span class="ss">msg</span><span class="p">)</span> <span class="err">→</span> <span class="k">true</span>
<span class="ss">msg</span>                     <span class="err">→</span> <span class="s">&quot;hello&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>When the <span class="monospaced">send</span> queue is full, <span class="monospaced">send</span> will return <span class="monospaced">nil</span> until enough
message content is read on the receiving side of the queue and the queue
is ready to accept new messages from <span class="monospaced">send</span> statements.</p></div>
<div class="paragraph"><p>Using the <a href="#until">until</a> looping function, the message statements
can be repeated until they return a value not <span class="monospaced">nil</span>. This way,
non-blocking <span class="monospaced">send</span> and <span class="monospaced">receive</span> can be made blocking until they
succeed:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">; blocking sender</span>
<span class="p">(</span><span class="k">until</span> <span class="p">(</span><span class="k">send</span> <span class="ss">pid</span> <span class="ss">msg</span><span class="p">))</span> <span class="c1">; true after message is queued up</span>

<span class="c1">; blocking receiver</span>
<span class="p">(</span><span class="k">until</span> <span class="p">(</span><span class="k">receive</span> <span class="ss">pid</span> <span class="ss">msg</span><span class="p">))</span> <span class="c1">; true after message could be read</span>
</pre></div></div></div>
<div class="paragraph"><p>The sender statement blocks until the message could be deposited in the
recipients queue.</p></div>
<div class="paragraph"><p>The <span class="monospaced">receive</span> statement blocks until a new message can be fetched from
the queue.</p></div>
<div class="paragraph"><p>As the <span class="monospaced">until</span> statements in this example lack body expressions, the
last value of the evaluated conditional expression is the return value
of the <span class="monospaced">until</span> loop.</p></div>
</div>
<div class="sect3">
<h4 id="_blocking_message_exchange">Blocking message exchange</h4>
<div class="paragraph"><p>The following code shows how a recipient can listen for incoming
messages, and in turn how a sender can retry to deposit a message into a
queue. The example shows 5 child processes constantly delivering status
data to a parent process which will display the data. After three data
sets have been read, the parent will abort all child processes and exit:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="cp">#!/usr/bin/newlisp</span>

<span class="c1">; child process transmits random numbers</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">child-process</span><span class="p">)</span>
    <span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">ppid</span> <span class="p">(</span><span class="k">sys-info</span> <span class="k">-</span><span class="ss">4</span><span class="p">))</span> <span class="c1">; get parent pid</span>
    <span class="p">(</span><span class="k">while</span> <span class="k">true</span>
        <span class="p">(</span><span class="k">until</span> <span class="p">(</span><span class="k">send</span> <span class="ss">ppid</span> <span class="p">(</span><span class="k">rand</span> <span class="ss">100</span><span class="p">))))</span>
<span class="p">)</span>

<span class="c1">; parent starts 5  child processes, listens and displays</span>
<span class="c1">; the true flag is specified to enable send/receive</span>

<span class="p">(</span><span class="k">dotimes</span> <span class="p">(</span><span class="nv">i</span> <span class="ss">5</span><span class="p">)</span> <span class="p">(</span><span class="k">spawn</span> <span class="o">&#39;</span><span class="ss">result</span> <span class="p">(</span><span class="nv">child-process</span><span class="p">)</span> <span class="k">true</span><span class="p">))</span>

<span class="p">(</span><span class="k">for</span> <span class="p">(</span><span class="nv">i</span> <span class="ss">1</span> <span class="ss">3</span><span class="p">)</span>
    <span class="p">(</span><span class="k">dolist</span> <span class="p">(</span><span class="nv">cpid</span> <span class="p">(</span><span class="k">sync</span><span class="p">))</span> <span class="c1">; iterate thru pending child PIDs</span>
        <span class="p">(</span><span class="k">until</span> <span class="p">(</span><span class="k">receive</span> <span class="ss">cpid</span> <span class="ss">msg</span><span class="p">))</span>
        <span class="p">(</span><span class="k">print</span> <span class="s">&quot;pid:&quot;</span> <span class="ss">cpid</span> <span class="s">&quot;-&gt;&quot;</span> <span class="p">(</span><span class="k">format</span> <span class="s">&quot;%-2d  &quot;</span> <span class="ss">msg</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">println</span><span class="p">)</span>
<span class="p">)</span>

<span class="p">(</span><span class="k">abort</span><span class="p">)</span> <span class="c1">; cancel child-processes</span>
<span class="p">(</span><span class="k">exit</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Running above example produces the following output:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>pid:53181-&gt;47  pid:53180-&gt;61  pid:53179-&gt;75  pid:53178-&gt;39  pid:53177-&gt;3
pid:53181-&gt;59  pid:53180-&gt;12  pid:53179-&gt;20  pid:53178-&gt;77  pid:53177-&gt;47
pid:53181-&gt;6   pid:53180-&gt;56  pid:53179-&gt;96  pid:53178-&gt;78  pid:53177-&gt;18</pre>
</div></div>
<div class="paragraph"><p>The <span class="monospaced">(sync)</span> expression returns a list of all child PIDs, and
<span class="monospaced">(until (receive cpid msg))</span> is used to force a wait until status
messages are recived for each of the child processes.</p></div>
<div class="paragraph"><p>A timeout mechanism could be part of an <span class="monospaced">until</span> or <span class="monospaced">while</span> loop to stop
waiting after certain time has expired.</p></div>
<div class="paragraph"><p>The examples show messages flowing from a child processes to a parent
process, in the same fashion messages could flow into the other
direction from parent to child processes. In that case the parent
process would use <span class="monospaced">(send)</span> to obtain a list of child processes with
place in their message queues.</p></div>
</div>
<div class="sect3">
<h4 id="_messages_containing_code_for_evaluation">Messages containing code for evaluation</h4>
<div class="paragraph"><p>The most powerful feature of the message functions is the ability to
send any newLISP expression, which then can be evaluated by the
recipient. The recipient uses <a href="#eval">eval</a> to evaluate the received
expression. Symbols contained in the expression are evaluated in the
receivers environment.</p></div>
<div class="paragraph"><p>The following example shows how a parent process acts like a message
proxy. The parent receives messages from a child process A and routes
them to a second child process with ID B. In effect this implements
messages between child process peers. The implementation relies on the
fact that the recipient can evaluate expressions contained in messages
received. These expressions can be any valid newLISP statements:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="cp">#!/usr/bin/newlisp</span>

<span class="c1">; sender child process of the message</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">A</span> <span class="p">(</span><span class="k">spawn</span> <span class="o">&#39;</span><span class="ss">result</span>
    <span class="p">(</span><span class="k">begin</span>
        <span class="p">(</span><span class="k">dotimes</span> <span class="p">(</span><span class="nv">i</span> <span class="ss">3</span><span class="p">)</span>
            <span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">ppid</span> <span class="p">(</span><span class="k">sys-info</span> <span class="k">-</span><span class="ss">4</span><span class="p">))</span>
            <span class="ss">/*</span> <span class="ss">the</span> <span class="ss">statement</span> <span class="ss">in</span> <span class="ss">msg</span> <span class="ss">will</span> <span class="ss">be</span> <span class="ss">evaluated</span> <span class="ss">in</span> <span class="ss">the</span> <span class="ss">proxy</span> <span class="ss">*/</span>
            <span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">msg</span> <span class="o">&#39;</span><span class="p">(</span><span class="k">until</span> <span class="p">(</span><span class="k">send</span> <span class="ss">B</span> <span class="p">(</span><span class="k">string</span> <span class="s">&quot;greetings from &quot;</span> <span class="ss">A</span><span class="p">))))</span>
            <span class="p">(</span><span class="k">until</span> <span class="p">(</span><span class="k">send</span> <span class="ss">ppid</span> <span class="ss">msg</span><span class="p">)))</span>
        <span class="p">(</span><span class="k">until</span> <span class="p">(</span><span class="k">send</span> <span class="ss">ppid</span> <span class="o">&#39;</span><span class="p">(</span><span class="k">begin</span>
            <span class="p">(</span><span class="k">sleep</span> <span class="ss">100</span><span class="p">)</span> <span class="c1">; make sure all else is printed</span>
            <span class="p">(</span><span class="k">println</span> <span class="s">&quot;parent exiting ...\n&quot;</span><span class="p">)</span>
            <span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">finished</span> <span class="k">true</span><span class="p">)))))</span> <span class="k">true</span><span class="p">))</span>

<span class="c1">; receiver child process of the message</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">B</span> <span class="p">(</span><span class="k">spawn</span> <span class="o">&#39;</span><span class="ss">result</span>
    <span class="p">(</span><span class="k">begin</span>
        <span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">ppid</span> <span class="p">(</span><span class="k">sys-info</span> <span class="k">-</span><span class="ss">4</span><span class="p">))</span>
        <span class="p">(</span><span class="k">while</span> <span class="k">true</span>
            <span class="p">(</span><span class="k">until</span> <span class="p">(</span><span class="k">receive</span> <span class="ss">ppid</span> <span class="ss">msg</span><span class="p">))</span>
            <span class="p">(</span><span class="k">println</span> <span class="ss">msg</span><span class="p">)</span>
            <span class="p">(</span><span class="k">unless</span> <span class="p">(</span><span class="nv">=</span> <span class="ss">msg</span> <span class="p">(</span><span class="k">string</span> <span class="s">&quot;greetings from &quot;</span> <span class="ss">A</span><span class="p">))</span>
                <span class="p">(</span><span class="k">println</span> <span class="s">&quot;ERROR in proxy message: &quot;</span> <span class="ss">msg</span><span class="p">))))</span> <span class="k">true</span><span class="p">))</span>

<span class="p">(</span><span class="k">until</span> <span class="ss">finished</span> <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="k">receive</span> <span class="ss">A</span> <span class="ss">msg</span><span class="p">)</span> <span class="p">(</span><span class="k">eval</span> <span class="ss">msg</span><span class="p">)))</span> <span class="c1">; proxy loop</span>

<span class="p">(</span><span class="k">abort</span><span class="p">)</span>
<span class="p">(</span><span class="k">exit</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Child process <span class="monospaced">A</span> sends three messages to <span class="monospaced">B</span>. As this cannot be done
directly <span class="monospaced">A</span> sends <span class="monospaced">send</span> statements to the parent for evaluation. The
statement:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">until</span> <span class="p">(</span><span class="k">send</span> <span class="ss">pidB</span> <span class="p">(</span><span class="k">string</span> <span class="s">&quot;greetings from &quot;</span> <span class="ss">A</span><span class="p">)))</span>
</pre></div></div></div>
<div class="paragraph"><p>will be evaluated in the environment of the parent process. Even so the
variables <span class="monospaced">A</span> and <span class="monospaced">B</span> are bound to <span class="monospaced">nil</span> in the sender process <span class="monospaced">A</span>, in
the parent process they will be bound to the correct process ID numbers.</p></div>
<div class="paragraph"><p>After sending the three messages, the statement:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">finished</span> <span class="k">true</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>is sent to the parent process. Once evaluated, it will cause the <span class="monospaced">until</span>
loop to finish.</p></div>
<div class="paragraph"><p>For more details on <span class="monospaced">send</span> and <span class="monospaced">receive</span> and more examples see the
<a href="http://www.newlisp.org/CodePatterns.html">Code Patterns</a> document.</p></div>
<div class="paragraph"><p><a id="sequence"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_sequence_span"><span class="big red">sequence</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (sequence <em>num-start</em> <em>num-end</em> [<em>num-step</em>])</p></div>
<div class="paragraph"><p>Generates a sequence of numbers from <em>num-start</em> to <em>num-end</em> with an
optional step size of <em>num-step</em>. When <em>num-step</em> is omitted, the value
<span class="monospaced">1</span> (one) is assumed. The generated numbers are of type integer (when no
optional step size is specified) or floating point (when the optional
step size is present).</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">sequence</span> <span class="ss">10</span> <span class="ss">5</span><span class="p">)</span>     <span class="err">→</span> <span class="p">(</span><span class="nv">10</span> <span class="ss">9</span> <span class="ss">8</span> <span class="ss">7</span> <span class="ss">6</span> <span class="ss">5</span><span class="p">)</span>
<span class="p">(</span><span class="k">sequence</span> <span class="ss">0</span> <span class="ss">1</span> <span class="ss">0.2</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">0</span> <span class="ss">0.2</span> <span class="ss">0.4</span> <span class="ss">0.6</span> <span class="ss">0.8</span> <span class="ss">1</span><span class="p">)</span>
<span class="p">(</span><span class="k">sequence</span> <span class="ss">2</span> <span class="ss">0</span> <span class="ss">0.3</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">2</span> <span class="ss">1.7</span> <span class="ss">1.4</span> <span class="ss">1.1</span> <span class="ss">0.8</span> <span class="ss">0.5</span> <span class="ss">0.2</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Note that the step size must be a positive number, even if sequencing
from a higher to a lower number.</p></div>
<div class="paragraph"><p>Use the <a href="#series">series</a> function to generate geometric sequences.</p></div>
<div class="paragraph"><p><a id="series"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_series_span"><span class="big red">series</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (series <em>num-start</em> <em>num-factor</em> <em>num-count</em>)<br>
<strong>syntax:</strong> (series <em>exp-start</em> <em>func</em> <em>num-count</em>)</p></div>
<div class="paragraph"><p>In the first syntax, <span class="monospaced">series</span> creates a geometric sequence with
<em>num-count</em> elements starting with the element in <em>num-start</em>. Each
subsequent element is multiplied by <em>num-factor</em>. The generated numbers
are always floating point numbers.</p></div>
<div class="paragraph"><p>When <em>num-count</em> is less than <span class="monospaced">1</span>, then <span class="monospaced">series</span> returns an empty list.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">series</span> <span class="ss">2</span> <span class="ss">2</span> <span class="ss">5</span><span class="p">)</span>     <span class="err">→</span> <span class="p">(</span><span class="nv">2</span> <span class="ss">4</span> <span class="ss">8</span> <span class="ss">16</span> <span class="ss">32</span><span class="p">)</span>
<span class="p">(</span><span class="k">series</span> <span class="ss">1</span> <span class="ss">1.2</span> <span class="ss">6</span><span class="p">)</span>   <span class="err">→</span> <span class="p">(</span><span class="nv">1</span> <span class="ss">1.2</span> <span class="ss">1.44</span> <span class="ss">1.728</span> <span class="ss">2.0736</span> <span class="ss">2.48832</span><span class="p">)</span>
<span class="p">(</span><span class="k">series</span> <span class="ss">10</span> <span class="ss">0.9</span> <span class="ss">4</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">10</span> <span class="ss">9</span> <span class="ss">8.1</span> <span class="ss">7.29</span><span class="p">)</span>
<span class="p">(</span><span class="k">series</span> <span class="ss">0</span> <span class="ss">0</span> <span class="ss">10</span><span class="p">)</span>    <span class="err">→</span> <span class="p">(</span><span class="nv">0</span> <span class="ss">0</span> <span class="ss">0</span> <span class="ss">0</span> <span class="ss">0</span> <span class="ss">0</span> <span class="ss">0</span> <span class="ss">0</span> <span class="ss">0</span> <span class="ss">0</span><span class="p">)</span>
<span class="p">(</span><span class="k">series</span> <span class="ss">99</span> <span class="ss">1</span> <span class="ss">5</span><span class="p">)</span>    <span class="err">→</span> <span class="p">(</span><span class="nv">99</span> <span class="ss">99</span> <span class="ss">99</span> <span class="ss">99</span> <span class="ss">99</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>In the second syntax, <span class="monospaced">series</span> uses a function specified in <em>func</em> to
transform the previous expression in to the next expression:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">; embed the function Phi: f(x) = 1 / (1 + x)</span>
<span class="c1">; see also http://en.wikipedia.org/wiki/Golden_ratio</span>

<span class="p">(</span><span class="k">series</span> <span class="ss">1</span> <span class="p">(</span><span class="k">fn</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="k">div</span> <span class="p">(</span><span class="k">add</span> <span class="ss">1</span> <span class="ss">x</span><span class="p">)))</span> <span class="ss">20</span><span class="p">)</span>  <span class="err">→</span>

<span class="p">(</span><span class="nv">1</span> <span class="ss">0.5</span> <span class="ss">0.6666666</span> <span class="ss">0.6</span> <span class="ss">0.625</span> <span class="ss">0.6153846</span> <span class="ss">0.619047</span> <span class="ss">0.6176470</span> <span class="ss">0.6181818</span>
 <span class="ss">0.6179775</span> <span class="ss">0.6180555</span> <span class="ss">0.6180257</span> <span class="ss">0.6180371</span> <span class="ss">0.6180327</span> <span class="ss">0.6180344</span>
 <span class="ss">0.6180338</span> <span class="ss">0.6180340</span> <span class="ss">0.6180339</span> <span class="ss">0.6180339</span> <span class="ss">0.6180339</span><span class="p">)</span>

<span class="c1">; pre-define the function</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">oscillate</span> <span class="ss">x</span><span class="p">)</span>
  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">&lt;</span> <span class="ss">x</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">+</span> <span class="p">(</span><span class="nv">-</span> <span class="ss">x</span><span class="p">)</span> <span class="ss">1</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">-</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">x</span> <span class="ss">1</span><span class="p">)))</span>
<span class="p">)</span>

<span class="p">(</span><span class="k">series</span> <span class="ss">1</span> <span class="ss">oscillate</span> <span class="ss">20</span><span class="p">)</span>  <span class="err">→</span>

<span class="p">(</span><span class="nv">1</span> <span class="k">-</span><span class="ss">2</span> <span class="ss">3</span> <span class="k">-</span><span class="ss">4</span> <span class="ss">5</span> <span class="k">-</span><span class="ss">6</span> <span class="ss">7</span> <span class="k">-</span><span class="ss">8</span> <span class="ss">9</span> <span class="k">-</span><span class="ss">10</span> <span class="ss">11</span> <span class="k">-</span><span class="ss">12</span> <span class="ss">13</span> <span class="k">-</span><span class="ss">14</span> <span class="ss">15</span> <span class="k">-</span><span class="ss">16</span> <span class="ss">17</span> <span class="k">-</span><span class="ss">18</span> <span class="ss">19</span> <span class="k">-</span><span class="ss">20</span><span class="p">)</span>

<span class="c1">; any data type is accepted as a start expression</span>

<span class="p">(</span><span class="k">series</span> <span class="s">&quot;a&quot;</span> <span class="p">(</span><span class="k">fn</span> <span class="p">(</span><span class="nv">c</span><span class="p">)</span> <span class="p">(</span><span class="k">char</span> <span class="p">(</span><span class="k">inc</span> <span class="p">(</span><span class="k">char</span> <span class="ss">c</span><span class="p">))))</span> <span class="ss">5</span><span class="p">)</span> <span class="err">→</span> <span class="p">(</span><span class="s">&quot;a&quot;</span> <span class="s">&quot;b&quot;</span> <span class="s">&quot;c&quot;</span> <span class="s">&quot;d&quot;</span> <span class="s">&quot;e&quot;</span><span class="p">)</span>

<span class="c1">; dependency of the two previous values in this fibonacci generator</span>

<span class="p">(</span><span class="k">let</span> <span class="p">(</span><span class="nv">x</span> <span class="ss">1</span><span class="p">)</span> <span class="p">(</span><span class="k">series</span> <span class="ss">x</span> <span class="p">(</span><span class="k">fn</span> <span class="p">(</span><span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">x</span> <span class="p">(</span><span class="k">swap</span> <span class="ss">y</span> <span class="ss">x</span><span class="p">)))</span> <span class="ss">10</span><span class="p">))</span>  <span class="err">→</span>

<span class="p">(</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">5</span> <span class="ss">8</span> <span class="ss">13</span> <span class="ss">21</span> <span class="ss">34</span> <span class="ss">55</span> <span class="ss">89</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The first example shows a series converging to the <em>golden ratio, φ</em>
(for any starting value). The second example shows how <em>func</em> can be
defined previously for better readability of the <span class="monospaced">series</span> statement.</p></div>
<div class="paragraph"><p>The <span class="monospaced">series</span> function also updates the internal list <span class="monospaced">$idx</span> index value,
which can be used inside <em>func</em>.</p></div>
<div class="paragraph"><p>Use the <a href="#sequence">sequence</a> function to generate arithmetic
sequences.</p></div>
<div class="paragraph"><p><a id="set"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_set_a_href_destructive_a_span"><span class="big red">set <a href="#destructive">!</a></span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (set <em>sym-1</em> <em>exp-1</em> [<em>sym-2</em> <em>exp-2</em> &#8230; ])</p></div>
<div class="paragraph"><p>Evaluates both arguments and then assigns the result of <em>exp</em> to the
symbol found in <em>sym</em>. The <span class="monospaced">set</span> expression returns the result of the
assignment. The assignment is performed by copying the contents of the
right side into the symbol. The old contents of the symbol are deleted.
An error message results when trying to change the contents of the
symbols <span class="monospaced">nil</span>, <span class="monospaced">true</span>, or a context symbol. <span class="monospaced">set</span> can take multiple
argument pairs.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">x</span> <span class="ss">123</span><span class="p">)</span>     <span class="err">→</span> <span class="ss">123</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">x</span> <span class="o">&#39;</span><span class="ss">y</span><span class="p">)</span>      <span class="err">→</span> <span class="ss">y</span>
<span class="p">(</span><span class="k">set</span> <span class="ss">x</span> <span class="s">&quot;hello&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;hello&quot;</span>

<span class="ss">y</span>  <span class="err">→</span> <span class="s">&quot;hello&quot;</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">alist</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">3</span><span class="p">))</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">3</span><span class="p">)</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">x</span> <span class="ss">1</span> <span class="o">&#39;</span><span class="ss">y</span> <span class="s">&quot;hello&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;hello&quot;</span>  <span class="c1">; multiple arguments</span>

<span class="ss">x</span>  <span class="err">→</span> <span class="ss">1</span>
<span class="ss">y</span>  <span class="err">→</span> <span class="s">&quot;hello&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>The symbol for assignment could be the result from another newLISP
expression:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">lst</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">x</span> <span class="ss">y</span> <span class="ss">z</span><span class="p">))</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">x</span> <span class="ss">y</span> <span class="ss">z</span><span class="p">)</span>

<span class="p">(</span><span class="k">set</span> <span class="p">(</span><span class="k">first</span> <span class="ss">lst</span><span class="p">)</span> <span class="ss">123</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">123</span>

<span class="ss">x</span>  <span class="err">→</span> <span class="ss">123</span>
</pre></div></div></div>
<div class="paragraph"><p>Symbols can be set to lambda or lambda-macro expressions. This operation
is equivalent to using <a href="#define">define</a> or
<a href="#define-macro">define-macro</a>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">double</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">x</span> <span class="ss">x</span><span class="p">)))</span>
<span class="err">→</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">x</span> <span class="ss">x</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p>is equivalent to:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">double</span> <span class="ss">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">x</span> <span class="ss">x</span><span class="p">))</span>
<span class="err">→</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">x</span> <span class="ss">x</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p>is equivalent to:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">define</span> <span class="ss">double</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">x</span> <span class="ss">x</span><span class="p">)))</span>
<span class="err">→</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">x</span> <span class="ss">x</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p>Use the <a href="#constant">constant</a> function (which works like <span class="monospaced">set</span>) to
protect the symbol from subsequent alteration. Using the
<a href="#setq">setq</a> or <a href="#setf">setf</a> function eliminates the need to
quote the variable symbol.</p></div>
<div class="paragraph"><p><a id="set-locale"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_set_locale_span"><span class="big red">set-locale</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (set-locale [<em>str-locale</em> [<em>int-category</em>]])</p></div>
<div class="paragraph"><p>Reports or switches to a different locale on your operating system or
platform. When used without arguments, <em>set-locale</em> reports the current
locale being used. When <em>str-locale</em> is specified, <em>set-locale</em> switches
to the locale with all category options turned on (<span class="monospaced">LC_ALL</span>). Placing an
empty string in <em>str-locale</em> switches to the default locale used on the
current platform.</p></div>
<div class="paragraph"><p><span class="monospaced">set-locale</span> returns either the current locale string and decimal point
string in a list or <span class="monospaced">nil</span> if the requested change could not be
performed.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">; report current locale</span>

<span class="p">(</span><span class="k">set-locale</span><span class="p">)</span>

<span class="c1">; set default locale of your platform and country</span>
<span class="c1">; return value shown when executing on German MS-Windows</span>

<span class="p">(</span><span class="k">set-locale</span> <span class="s">&quot;&quot;</span><span class="p">)</span>    <span class="err">→</span> <span class="p">(</span><span class="s">&quot;German_Germany.1252&quot;</span> <span class="s">&quot;,&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">add</span> <span class="ss">1,234</span> <span class="ss">1,234</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">2,468</span>
</pre></div></div></div>
<div class="paragraph"><p>By default, newLISP – if not enabled for UTF-8 – starts up with the
POSIX C default locale. This guarantees that newLISP&#8217;s behavior will be
identical on any platform locale. On UTF-8 enabled versions of newLISP
the locale of the current platform is chosen.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">; after non-UTF-8 newLISP start up</span>

<span class="p">(</span><span class="k">set-locale</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="s">&quot;C&quot;</span> <span class="s">&quot;.&quot;</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>In <em>int-category</em>, integer numbers may be specified as <em>category
options</em> for fine-tuning certain aspects of the locale, such as number
display, date display, and so forth. The numbers used vary from
system-to-system. The options valid on your platform can be found in the
C include file <span class="monospaced">locale.h</span>. This file defines constants like
<span class="monospaced">LC_ALL, LC_NUMERIC,</span> and <span class="monospaced">LC_MONETARY</span>. When <span class="monospaced">set-locale</span> is used
without the option number, it assumes the <span class="monospaced">LC_ALL</span> option, which turns
on all options for that locale.</p></div>
<div class="paragraph"><p>Note that the locale also controls the decimal separator in numbers. The
default C locale uses the decimal dot, but most others use a decimal
comma.</p></div>
<div class="paragraph"><p>Note that using <span class="monospaced">set-locale</span> does not change the behavior of regular
expressions in newLISP. To localize the behavior of PCRE (Perl
Compatible Regular Expressions), newLISP must be compiled with different
character tables. See the file, LOCALIZATION, in the newLISP source
distribution for details.</p></div>
<div class="paragraph"><p>See also the chapter <a href="#switching">Switching the locale</a>.</p></div>
<div class="paragraph"><p><a id="set-ref"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_set_ref_a_href_destructive_a_span"><span class="big red">set-ref <a href="#destructive">!</a></span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (set-ref <em>exp-key</em> <em>list</em> <em>exp-replacement</em> [<em>func-compare</em>])</p></div>
<div class="paragraph"><p>Searches for <em>exp-key</em> in <em>list</em> and replaces the found element with
<em>exp-replacement</em>. The <em>list</em> can be nested. The system variables <span class="monospaced">$it</span>
contains the expression found and can be used in <em>exp-replacement</em>. The
function returns the new modified <em>list</em>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">data</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">fruits</span> <span class="p">(</span><span class="nv">apples</span> <span class="ss">123</span> <span class="ss">44</span><span class="p">)</span> <span class="p">(</span><span class="nv">oranges</span> <span class="ss">1</span> <span class="ss">5</span> <span class="ss">3</span><span class="p">)))</span>

<span class="p">(</span><span class="k">set-ref</span> <span class="o">&#39;</span><span class="ss">apples</span> <span class="ss">data</span> <span class="o">&#39;</span><span class="ss">Apples</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">fruits</span> <span class="p">(</span><span class="nv">Apples</span> <span class="ss">123</span> <span class="ss">44</span><span class="p">)</span> <span class="p">(</span><span class="nv">oranges</span> <span class="ss">1</span> <span class="ss">5</span> <span class="ss">3</span><span class="p">))</span>

<span class="ss">data</span> <span class="err">→</span> <span class="p">(</span><span class="nv">fruits</span> <span class="p">(</span><span class="nv">Apples</span> <span class="ss">123</span> <span class="ss">44</span><span class="p">)</span> <span class="p">(</span><span class="nv">oranges</span> <span class="ss">1</span> <span class="ss">5</span> <span class="ss">3</span><span class="p">)))</span>
</pre></div></div></div>
<div class="paragraph"><p><span class="monospaced">data</span> could be the context identifier of a default function for passing
lists by reference:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">db</span><span class="o">:</span><span class="ss">db</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">fruits</span> <span class="p">(</span><span class="nv">apples</span> <span class="ss">123</span> <span class="ss">44</span><span class="p">)</span> <span class="p">(</span><span class="nv">oranges</span> <span class="ss">1</span> <span class="ss">5</span> <span class="ss">3</span><span class="p">)))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">update</span> <span class="ss">ct</span> <span class="ss">key</span> <span class="ss">value</span><span class="p">)</span>
    <span class="p">(</span><span class="k">set-ref</span> <span class="ss">key</span> <span class="ss">ct</span> <span class="ss">value</span><span class="p">))</span>

<span class="p">(</span><span class="nv">update</span> <span class="ss">db</span> <span class="o">&#39;</span><span class="ss">apples</span> <span class="o">&#39;</span><span class="ss">Apples</span><span class="p">)</span>    <span class="err">→</span> <span class="p">(</span><span class="nv">fruits</span> <span class="p">(</span><span class="nv">Apples</span> <span class="ss">123</span> <span class="ss">44</span><span class="p">)</span> <span class="p">(</span><span class="nv">oranges</span> <span class="ss">1</span> <span class="ss">5</span> <span class="ss">3</span><span class="p">))</span>
<span class="p">(</span><span class="nv">update</span> <span class="ss">db</span> <span class="o">&#39;</span><span class="ss">oranges</span> <span class="o">&#39;</span><span class="ss">Oranges</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">fruits</span> <span class="p">(</span><span class="nv">Apples</span> <span class="ss">123</span> <span class="ss">44</span><span class="p">)</span> <span class="p">(</span><span class="nv">Oranges</span> <span class="ss">1</span> <span class="ss">5</span> <span class="ss">3</span><span class="p">))</span>

<span class="ss">db</span><span class="o">:</span><span class="ss">db</span> <span class="err">→</span> <span class="p">(</span><span class="nv">fruits</span> <span class="p">(</span><span class="nv">Apples</span> <span class="ss">123</span> <span class="ss">44</span><span class="p">)</span> <span class="p">(</span><span class="nv">Oranges</span> <span class="ss">1</span> <span class="ss">5</span> <span class="ss">3</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p>For examples on how to use <em>func-compare</em> see
<a href="#set-ref-all">set-ref-all</a></p></div>
<div class="paragraph"><p>For changing all occurrences of an element in a list use
<a href="#set-ref-all">set-ref-all</a>.</p></div>
<div class="paragraph"><p><a id="set-ref-all"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_set_ref_all_a_href_destructive_a_span"><span class="big red">set-ref-all <a href="#destructive">!</a></span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (set-ref-all <em>exp-key</em> <em>list</em> <em>exp-replacement</em> [<em>func-compare</em>])</p></div>
<div class="paragraph"><p>Searches for <em>exp-key</em> in <em>list</em> and replaces each instance of the found
element with <em>exp-replacement</em>. The <em>list</em> can be nested. The system
variable <span class="monospaced">$it</span> contains the expression found and can be used in
<em>exp-replacement</em>. The function returns the new modified <em>list</em>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">data</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">monday</span> <span class="p">(</span><span class="nv">apples</span> <span class="ss">20</span> <span class="ss">30</span><span class="p">)</span> <span class="p">(</span><span class="nv">oranges</span> <span class="ss">2</span> <span class="ss">4</span> <span class="ss">9</span><span class="p">))</span> <span class="p">(</span><span class="nv">tuesday</span> <span class="p">(</span><span class="nv">apples</span> <span class="ss">5</span><span class="p">)</span> <span class="p">(</span><span class="nv">oranges</span> <span class="ss">32</span> <span class="ss">1</span><span class="p">))))</span>

<span class="p">(</span><span class="k">set-ref-all</span> <span class="o">&#39;</span><span class="ss">apples</span> <span class="ss">data</span> <span class="s">&quot;Apples&quot;</span><span class="p">)</span>
 <span class="err">→</span> <span class="p">((</span><span class="nv">monday</span> <span class="p">(</span><span class="s">&quot;Apples&quot;</span> <span class="ss">20</span> <span class="ss">30</span><span class="p">)</span> <span class="p">(</span><span class="nv">oranges</span> <span class="ss">2</span> <span class="ss">4</span> <span class="ss">9</span><span class="p">))</span> <span class="p">(</span><span class="nv">tuesday</span> <span class="p">(</span><span class="s">&quot;Apples&quot;</span> <span class="ss">5</span><span class="p">)</span> <span class="p">(</span><span class="nv">oranges</span> <span class="ss">32</span> <span class="ss">1</span><span class="p">)))</span>
</pre></div></div></div>
<div class="paragraph"><p>Using the default functor in the <span class="monospaced">(list key)</span> pattern allows the list to
be passed by reference to a user-defined function containing a
<span class="monospaced">set-ref-all</span> statement. This would result in less memory usage and
higher speeds in when doing replacements in large lists:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">db</span><span class="o">:</span><span class="ss">db</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">monday</span> <span class="p">(</span><span class="nv">apples</span> <span class="ss">20</span> <span class="ss">30</span><span class="p">)</span> <span class="p">(</span><span class="nv">oranges</span> <span class="ss">2</span> <span class="ss">4</span> <span class="ss">9</span><span class="p">))</span> <span class="p">(</span><span class="nv">tuesday</span> <span class="p">(</span><span class="nv">apples</span> <span class="ss">5</span><span class="p">)</span> <span class="p">(</span><span class="nv">oranges</span> <span class="ss">32</span> <span class="ss">1</span><span class="p">))))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">foo</span> <span class="ss">ctx</span><span class="p">)</span>
    <span class="p">(</span><span class="k">set-ref-all</span> <span class="o">&#39;</span><span class="ss">apples</span> <span class="ss">ctx</span> <span class="s">&quot;Apples&quot;</span><span class="p">)</span>
<span class="p">)</span>

<span class="p">(</span><span class="nv">foo</span> <span class="ss">db</span><span class="p">)</span>
 <span class="err">→</span> <span class="p">((</span><span class="nv">monday</span> <span class="p">(</span><span class="s">&quot;Apples&quot;</span> <span class="ss">20</span> <span class="ss">30</span><span class="p">)</span> <span class="p">(</span><span class="nv">oranges</span> <span class="ss">2</span> <span class="ss">4</span> <span class="ss">9</span><span class="p">))</span> <span class="p">(</span><span class="nv">tuesday</span> <span class="p">(</span><span class="s">&quot;Apples&quot;</span> <span class="ss">5</span><span class="p">)</span> <span class="p">(</span><span class="nv">oranges</span> <span class="ss">32</span> <span class="ss">1</span><span class="p">)))</span>
</pre></div></div></div>
<div class="paragraph"><p>When evaluating <span class="monospaced">(foo db)</span>, the list in <span class="monospaced">db:db</span> will be passed by
reference and <span class="monospaced">set-ref-all</span> will make the changes on the original, not
on a copy of <span class="monospaced">db:db</span>.</p></div>
<div class="paragraph"><p>Like with <a href="#find">find</a>, <a href="#replace">replace</a>, <a href="#ref">ref</a> and
<a href="#ref-all">ref-all</a>, complex searches can be expressed using
<a href="#match">match</a> or <a href="#unify">unify</a> in <em>func-compare</em>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">data</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">monday</span> <span class="p">(</span><span class="nv">apples</span> <span class="ss">20</span> <span class="ss">30</span><span class="p">)</span> <span class="p">(</span><span class="nv">oranges</span> <span class="ss">2</span> <span class="ss">4</span> <span class="ss">9</span><span class="p">))</span> <span class="p">(</span><span class="nv">tuesday</span> <span class="p">(</span><span class="nv">apples</span> <span class="ss">5</span><span class="p">)</span> <span class="p">(</span><span class="nv">oranges</span> <span class="ss">32</span> <span class="ss">1</span><span class="p">))))</span>

<span class="p">(</span><span class="k">set-ref-all</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">oranges</span> <span class="ss">*</span><span class="p">)</span> <span class="ss">data</span> <span class="p">(</span><span class="k">list</span> <span class="p">(</span><span class="k">first</span> <span class="k">$</span><span class="ss">it</span><span class="p">)</span> <span class="p">(</span><span class="k">apply</span> <span class="ss">+</span> <span class="p">(</span><span class="k">rest</span> <span class="k">$</span><span class="ss">it</span><span class="p">)))</span> <span class="k">match</span><span class="p">)</span>
    <span class="err">→</span> <span class="p">(</span> <span class="ss">...</span> <span class="p">(</span><span class="nv">oranges</span> <span class="ss">15</span><span class="p">)</span> <span class="ss">...</span> <span class="p">(</span><span class="nv">oranges</span> <span class="ss">33</span><span class="p">)</span> <span class="ss">...</span> <span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The example sums all numbers found in records starting with the symbol
<span class="monospaced">oranges</span>. The found items appear in <span class="monospaced">$it</span></p></div>
<div class="paragraph"><p>See also <a href="#set-ref">set-ref</a> which replaces only the first element
found.</p></div>
<div class="paragraph"><p><a id="setq"></a>
<a id="setf"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_setq_setf_a_href_destructive_a_span"><span class="big red">setq, setf <a href="#destructive">!</a></span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (setq <em>place-1</em> <em>exp-1</em> [<em>place-2</em> <em>exp-2</em> &#8230; ])</p></div>
<div class="paragraph"><p><span class="monospaced">setq</span> and <span class="monospaced">setf</span> work alike in newLISP and set the contents of a
symbol, list, array or string or of a list, array or string place
reference. Like <a href="#set">set</a>, <span class="monospaced">setq</span> and <span class="monospaced">setf</span> can take multiple
argument pairs. Although both <span class="monospaced">setq</span> and <span class="monospaced">setf</span> point to the same
built-in function internally, throughout this manual <span class="monospaced">setq</span> is used when
setting a symbol reference and <span class="monospaced">setf</span> is used when setting list or array
references.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">setq</span> <span class="ss">x</span> <span class="ss">123</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">123</span>

<span class="c1">; multiple arguments</span>

<span class="p">(</span><span class="k">setq</span> <span class="ss">x</span> <span class="ss">1</span> <span class="ss">y</span> <span class="ss">2</span> <span class="ss">z</span> <span class="ss">3</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">3</span>

<span class="ss">x</span>  <span class="err">→</span> <span class="ss">1</span>
<span class="ss">y</span>  <span class="err">→</span> <span class="ss">2</span>
<span class="ss">z</span>  <span class="err">→</span> <span class="ss">3</span>

<span class="c1">; with nth or implicit indices</span>
<span class="p">(</span><span class="k">setq</span> <span class="ss">L</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="p">(</span><span class="nv">c</span> <span class="ss">d</span><span class="p">)</span> <span class="ss">e</span> <span class="ss">f</span> <span class="ss">g</span><span class="p">))</span>

<span class="p">(</span><span class="k">setf</span> <span class="p">(</span><span class="nv">L</span> <span class="ss">1</span><span class="p">)</span> <span class="o">&#39;</span><span class="ss">B</span><span class="p">)</span>      <span class="err">→</span> <span class="ss">B</span>
<span class="c1">; or the same</span>
<span class="p">(</span><span class="k">setf</span> <span class="p">(</span><span class="k">nth</span> <span class="ss">1</span> <span class="ss">L</span><span class="p">)</span> <span class="o">&#39;</span><span class="ss">B</span><span class="p">)</span>
<span class="ss">L</span>                    <span class="err">→</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">B</span> <span class="p">(</span><span class="nv">c</span> <span class="ss">d</span><span class="p">)</span> <span class="ss">e</span> <span class="ss">f</span> <span class="ss">g</span><span class="p">)</span>

<span class="p">(</span><span class="k">setf</span> <span class="p">(</span><span class="nv">L</span> <span class="ss">2</span> <span class="ss">0</span><span class="p">)</span> <span class="o">&#39;</span><span class="ss">C</span><span class="p">)</span>    <span class="err">→</span> <span class="ss">C</span>
<span class="ss">L</span>                    <span class="err">→</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">B</span> <span class="p">(</span><span class="nv">C</span> <span class="ss">d</span><span class="p">)</span> <span class="ss">e</span> <span class="ss">f</span> <span class="ss">g</span><span class="p">)</span>

<span class="p">(</span><span class="k">setf</span> <span class="p">(</span><span class="nv">L</span> <span class="ss">2</span><span class="p">)</span> <span class="o">&#39;</span><span class="ss">X</span><span class="p">)</span>
<span class="ss">L</span>                    <span class="err">→</span> <span class="p">(</span><span class="nv">A</span> <span class="ss">B</span> <span class="ss">X</span> <span class="ss">e</span> <span class="ss">f</span> <span class="ss">g</span><span class="p">)</span>

<span class="c1">; with assoc</span>
<span class="p">(</span><span class="k">setq</span> <span class="ss">L</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">a</span> <span class="ss">1</span><span class="p">)</span> <span class="p">(</span><span class="nv">b</span> <span class="ss">2</span><span class="p">)))</span>
<span class="p">(</span><span class="k">setf</span> <span class="p">(</span><span class="k">assoc</span> <span class="o">&#39;</span><span class="ss">b</span> <span class="ss">L</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">b</span> <span class="ss">3</span><span class="p">))</span> <span class="err">→</span> <span class="p">(</span><span class="nv">b</span> <span class="ss">3</span><span class="p">)</span>
<span class="ss">L</span>                          <span class="err">→</span> <span class="p">((</span><span class="nv">a</span> <span class="ss">1</span><span class="p">)</span> <span class="p">(</span><span class="nv">b</span> <span class="ss">3</span><span class="p">))</span>

<span class="c1">; with lookup</span>
<span class="p">(</span><span class="k">setf</span> <span class="p">(</span><span class="k">lookup</span> <span class="o">&#39;</span><span class="ss">b</span> <span class="ss">L</span><span class="p">)</span> <span class="ss">30</span><span class="p">)</span> <span class="err">→</span> <span class="ss">30</span>
<span class="ss">L</span>                       <span class="err">→</span> <span class="p">((</span><span class="nv">a</span> <span class="ss">1</span><span class="p">)</span> <span class="p">(</span><span class="nv">b</span> <span class="ss">30</span><span class="p">))</span>

<span class="c1">; several list accessors can be nested</span>
<span class="p">(</span><span class="k">setq</span> <span class="ss">L</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">a</span> <span class="ss">1</span><span class="p">)</span> <span class="p">(</span><span class="nv">b</span> <span class="ss">2</span><span class="p">)))</span>

<span class="p">(</span><span class="k">push</span> <span class="o">&#39;</span><span class="ss">b</span> <span class="p">(</span><span class="k">setf</span> <span class="p">(</span><span class="k">assoc</span> <span class="o">&#39;</span><span class="ss">b</span> <span class="ss">l</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">b</span> <span class="ss">4</span><span class="p">)))</span> <span class="o">&#39;</span><span class="ss">b</span><span class="p">)</span> <span class="err">→</span> <span class="ss">b</span>
<span class="ss">L</span>                                        <span class="err">→</span><span class="p">((</span><span class="nv">a</span> <span class="ss">1</span><span class="p">)</span> <span class="p">(</span><span class="nv">b</span> <span class="ss">b</span> <span class="ss">4</span><span class="p">)))</span>

<span class="c1">; on strings</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">s</span> <span class="s">&quot;NewISP&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">setf</span> <span class="p">(</span><span class="nv">s</span> <span class="ss">0</span><span class="p">)</span> <span class="s">&quot;n&quot;</span><span class="p">)</span> <span class="err">→</span> <span class="s">&quot;n&quot;</span>
<span class="ss">s</span> <span class="err">→</span> <span class="s">&quot;newISP&quot;</span>

<span class="p">(</span><span class="k">setf</span> <span class="p">(</span><span class="nv">s</span> <span class="ss">3</span><span class="p">)</span> <span class="s">&quot;LI&quot;</span><span class="p">)</span> <span class="err">→</span> <span class="s">&quot;LI&quot;</span>
<span class="ss">s</span> <span class="err">→</span> <span class="s">&quot;newLISP&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>Often the new value set is dependent on the old value. <span class="monospaced">setf</span> can use
the anaphoric system variable <span class="monospaced">$it</span> to refer to the old value inside the
<span class="monospaced">setf</span> expression:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">setq</span> <span class="ss">L</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">apples</span> <span class="ss">4</span><span class="p">)</span> <span class="p">(</span><span class="nv">oranges</span> <span class="ss">1</span><span class="p">)))</span>

<span class="p">(</span><span class="k">setf</span> <span class="p">(</span><span class="nv">L</span> <span class="ss">1</span> <span class="ss">1</span><span class="p">)</span> <span class="p">(</span><span class="nv">+</span> <span class="k">$</span><span class="ss">it</span> <span class="ss">1</span><span class="p">))</span> <span class="err">→</span> <span class="ss">2</span>

<span class="ss">L</span>                        <span class="err">→</span> <span class="p">((</span><span class="nv">apples</span> <span class="ss">4</span><span class="p">)</span> <span class="p">(</span><span class="nv">oranges</span> <span class="ss">2</span><span class="p">))</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">s</span> <span class="s">&quot;NewLISP&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">setf</span> <span class="p">(</span><span class="nv">s</span> <span class="ss">0</span><span class="p">)</span> <span class="p">(</span><span class="k">lower-case</span> <span class="k">$</span><span class="ss">it</span><span class="p">))</span> <span class="err">→</span> <span class="s">&quot;n&quot;</span><span class="p">)</span>

<span class="ss">s</span> <span class="err">→</span> <span class="s">&quot;newLISP&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p><a id="sgn"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_sgn_span"><span class="big red">sgn</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (sgn <em>num</em>)<br>
<strong>syntax:</strong> (sgn <em>num</em> <em>exp-1</em> [<em>exp-2</em> [<em>exp-3</em>]])</p></div>
<div class="paragraph"><p>In the first syntax, the <span class="monospaced">sgn</span> function is a logical function that
extracts the sign of a real number according to the following rules:</p></div>
<div class="paragraph"><p><strong><em>x &gt; <span class="monospaced">0</span> : sgn(x) = 1<br>
x &lt; <span class="monospaced">0</span> : sgn(x) = -1<br>
x = <span class="monospaced">0</span> : sgn(x) = <span class="monospaced">0</span></em></strong></p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">sgn</span> <span class="k">-</span><span class="ss">3.5</span><span class="p">)</span>  <span class="err">→</span> <span class="k">-</span><span class="ss">1</span>
<span class="p">(</span><span class="k">sgn</span> <span class="ss">0</span><span class="p">)</span>     <span class="err">→</span> <span class="ss">0</span>
<span class="p">(</span><span class="k">sgn</span> <span class="ss">123</span><span class="p">)</span>   <span class="err">→</span> <span class="ss">1</span>
</pre></div></div></div>
<div class="paragraph"><p>In the second syntax, the result of evaluating one of the optional
expressions <em>exp-1</em>, <em>exp-2</em>, or <em>exp-3</em> is returned, instead of <span class="monospaced">-1</span>,
<span class="monospaced">0</span>, or <span class="monospaced">1</span>. If <em>exp-n</em> is missing for the case triggered, then <span class="monospaced">nil</span> is
returned.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">sgn</span> <span class="ss">x</span> <span class="k">-</span><span class="ss">1</span> <span class="ss">0</span> <span class="ss">1</span><span class="p">)</span>         <span class="c1">; works like (sgn x)</span>
<span class="p">(</span><span class="k">sgn</span> <span class="ss">x</span> <span class="k">-</span><span class="ss">1</span> <span class="ss">1</span> <span class="ss">1</span><span class="p">)</span>         <span class="c1">; -1 for negative x all others 1</span>
<span class="p">(</span><span class="k">sgn</span> <span class="ss">x</span> <span class="k">nil</span> <span class="k">true</span> <span class="k">true</span><span class="p">)</span>  <span class="c1">; nil for negative else true</span>
<span class="p">(</span><span class="k">sgn</span> <span class="ss">x</span> <span class="p">(</span><span class="k">abs</span> <span class="ss">x</span><span class="p">)</span> <span class="ss">0</span><span class="p">)</span>      <span class="c1">; (abs x) for x &lt; 0, 0 for x = 0, else nil</span>
</pre></div></div></div>
<div class="paragraph"><p>Any expression or constant can be used for <em>exp-1</em>, <em>exp-2</em>, or <em>exp-3</em>.</p></div>
<div class="paragraph"><p><a id="share"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_share_span"><span class="big red">share</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (share)<br>
<strong>syntax:</strong> (share <em>int-address-or-handle</em>)<br>
<strong>syntax:</strong> (share <em>int-address-or-handle</em> <em>exp-value</em>)<br>
<strong>syntax:</strong> (share <em>nil</em> <em>int-address</em>)</p></div>
<div class="paragraph"><p>Accesses shared memory for communicating between several newLISP
processes. When called without arguments, <span class="monospaced">share</span> requests a page of
shared memory from the operating system. This returns a memory address
on Linux/Unix and a handle on Win32, which can then be assigned to a
variable for later reference. This function is not available on OS/2.</p></div>
<div class="paragraph"><p>To set the contents of shared memory, use the third syntax of <span class="monospaced">share</span>.
Supply a shared memory address on Linux/Unix or a handle on Win32 in
<em>int-address-or-handle</em>, along with an integer, float, string expression
or any other expression (since v.10.1.0) supplied in <em>exp-value</em>. Using
this syntax, the value supplied in <em>exp-value</em> is also the return value.</p></div>
<div class="paragraph"><p>To access the contents of shared memory, use the second syntax of
<span class="monospaced">share</span>, supplying only the shared memory address or handle. The return
value will be any constant or expression (since v.10.1.0) written
previously into the memory. If the memory has not been previously set to
a value, <span class="monospaced">nil</span> will be returned.</p></div>
<div class="paragraph"><p>Only available on Unix-like operating systems, the last syntax unmaps a
shared memory address. Note that using a shared address after unmapping
it will crash the system.</p></div>
<div class="paragraph"><p>Memory can be shared between parent and child processes, but not between
independent processes.</p></div>
<div class="paragraph"><p>Since v.10.1.0 size of share objects can exceed the shared memory
pagesize of the operating system. For objects bigger than the pagesize,
newLISP internally uses files for sharing. This requires a <span class="monospaced">/tmp</span>
directory on Unix-like operating system and a <span class="monospaced">temp</span> directory in the
root of the current disk drive on Win32 systems. On Unix-like systems
this directory is present, on Win32 it may have to be created.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">mem</span> <span class="p">(</span><span class="k">share</span><span class="p">))</span>

<span class="p">(</span><span class="k">share</span> <span class="ss">mem</span> <span class="ss">123</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">123</span>
<span class="p">(</span><span class="k">share</span> <span class="ss">mem</span><span class="p">)</span>      <span class="err">→</span> <span class="ss">123</span>

<span class="p">(</span><span class="k">share</span> <span class="ss">mem</span> <span class="s">&quot;hello world&quot;</span><span class="p">)</span> <span class="err">→</span> <span class="s">&quot;hello world&quot;</span>
<span class="p">(</span><span class="k">share</span> <span class="ss">mem</span><span class="p">)</span>               <span class="err">→</span> <span class="s">&quot;hello world&quot;</span>

<span class="p">(</span><span class="k">share</span> <span class="ss">mem</span> <span class="k">true</span><span class="p">)</span>  <span class="err">→</span> <span class="k">true</span>
<span class="p">(</span><span class="k">share</span> <span class="ss">mem</span><span class="p">)</span>       <span class="err">→</span> <span class="k">true</span>

<span class="p">(</span><span class="k">share</span> <span class="ss">mem</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">+</span> <span class="ss">1</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">))</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">1</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">)</span>
<span class="p">(</span><span class="k">share</span> <span class="ss">mem</span><span class="p">)</span>               <span class="err">→</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">1</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">)</span>

<span class="c1">; expressions received can be evaluated (since v.10.1.0)</span>
<span class="p">(</span><span class="k">eval</span> <span class="p">(</span><span class="k">share</span> <span class="ss">mem</span><span class="p">))</span>        <span class="err">→</span> <span class="ss">10</span>

<span class="p">(</span><span class="k">share</span> <span class="k">nil</span> <span class="ss">mem</span><span class="p">)</span>   <span class="err">→</span> <span class="k">true</span>  <span class="c1">; unmap only on Unix</span>
</pre></div></div></div>
<div class="paragraph"><p>Expression read from shared memory and evaluated, will be evaluated in
the recipient&#8217;s process environment.</p></div>
<div class="paragraph"><p>Note that shared memory access between different processes should be
synchronized using a <a href="#semaphore">semaphore</a>. Simultaneous access to
shared memory can crash the running process.</p></div>
<div class="paragraph"><p>For a more comprehensive example of using shared memory in a multi
process Linux/Unix application, see the file <span class="monospaced">example/prodcons.lsp</span> in
the newLISP source distribution.</p></div>
<div class="paragraph"><p><a id="signal"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_signal_span"><span class="big red">signal</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (signal <em>int-signal</em> <em>sym-event-handler</em> | <em>func-event-handler</em>)<br>
<strong>syntax:</strong> (signal <em>int-signal</em> "ignore" | "default" | "reset")<br>
<strong>syntax:</strong> (signal <em>int-signal</em>)</p></div>
<div class="paragraph"><p>Sets a user-defined handler in <em>sym-event-handler</em> for a signal
specified in <em>int-signal</em> or sets to a function expression in
<em>func-event-handler</em>.</p></div>
<div class="paragraph"><p>A parameter following <em>int-signal</em> is not evaluated.</p></div>
<div class="paragraph"><p>If no signal handler is speified any of the string constants <span class="monospaced">"ignore"</span>,
<span class="monospaced">"default"</span> or <span class="monospaced">"reset"</span> can be specified in either lower or upper case
or simply using the the first letter of the option string. When signal
setup with any of these three options has been successfull <span class="monospaced">true</span> is
returned.</p></div>
<div class="paragraph"><p>Using <span class="monospaced">"ignore"</span> will make newLISP ignore the signal. Using <span class="monospaced">"default"</span>
will set the handler to the default handler of the underlying platform
OS. The <span class="monospaced">"reset"</span> option will restore the handler to newLISP startup
state.</p></div>
<div class="paragraph"><p>On startup, newLISP either specifies an empty newLISP handler or a
Ctrl-C handler for <span class="monospaced">SIGINT</span> and a <span class="monospaced">waitpipd(-1, 0, WNOHANG)</span> C-call for
<span class="monospaced">SIGCHLD</span>.</p></div>
<div class="paragraph"><p>Different signals are available on different OS platforms and Linux/Unix
flavors. The numbers to specify in <em>int-signal</em> also differ from
platform-to-platform. Valid values can normally be extracted from a file
found in <span class="monospaced">/usr/include/sys/signal.h</span> or <span class="monospaced">/usr/include/signal.h</span>.</p></div>
<div class="paragraph"><p>Some signals make newLISP exit even after a user-defined handler has
been specified and executed (e.g., signal SIGKILL). This behavior may
also be different on different platforms.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">constant</span> <span class="o">&#39;</span><span class="ss">SIGINT</span> <span class="ss">2</span><span class="p">)</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">ctrlC-handler</span><span class="p">)</span> <span class="p">(</span><span class="k">println</span> <span class="s">&quot;ctrl-C has been pressed&quot;</span><span class="p">))</span>

<span class="p">(</span><span class="k">signal</span> <span class="ss">SIGINT</span> <span class="o">&#39;</span><span class="ss">ctrlC-handler</span><span class="p">)</span>

<span class="c1">; now press ctrl-C</span>
<span class="c1">; the following line will appear</span>
<span class="c1">; this will only work in an interactive terminal window</span>
<span class="c1">; and will not work in the newLISP-GS editor</span>

<span class="ss">ctrl-C</span> <span class="ss">has</span> <span class="ss">been</span> <span class="ss">pressed</span>

<span class="c1">; reset tratment of signal 2 to startup conditions</span>

<span class="p">(</span><span class="k">signal</span> <span class="ss">SIGINT</span> <span class="s">&quot;reset&quot;</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>On Win32, the above example would execute the handler before exiting
newLISP. On most Linux/Unix systems, newLISP would stay loaded and the
prompt would appear after hitting the [enter] key.</p></div>
<div class="paragraph"><p>Instead of specifying a symbol containing the signal handler, a function
can be specified directly. The signal number is passed as a parameter:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">signal</span> <span class="ss">SIGINT</span> <span class="k">exit</span><span class="p">)</span>  <span class="err">→</span> <span class="k">$signal-</span><span class="ss">2</span>

<span class="p">(</span><span class="k">signal</span> <span class="ss">SIGINT</span> <span class="p">(</span><span class="k">fn</span> <span class="p">(</span><span class="nv">s</span><span class="p">)</span> <span class="p">(</span><span class="k">println</span> <span class="s">&quot;signal &quot;</span> <span class="ss">s</span> <span class="s">&quot; occurred&quot;</span><span class="p">)))</span>
</pre></div></div></div>
<div class="paragraph"><p>Note that the signal SIGKILL (9 on most platforms) will always terminate
the application regardless of an existing signal handler.</p></div>
<div class="paragraph"><p>The signal could have been sent from another shell on the same computer:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nb">kill</span> -s SIGINT 2035
</pre></div></div></div>
<div class="paragraph"><p>In this example, <span class="monospaced">2035</span> is the process ID of the running newLISP.</p></div>
<div class="paragraph"><p>The signal could also have been sent from another newLISP application
using the function <a href="#destroy">destroy</a>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">destroy</span> <span class="ss">2035</span><span class="p">)</span> <span class="err">→</span> <span class="k">true</span>
</pre></div></div></div>
<div class="paragraph"><p>If newLISP receives a signal while evaluating another function, it will
still accept the signal and the handler function will be executed:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">constant</span> <span class="o">&#39;</span><span class="ss">SIGINT</span> <span class="ss">2</span><span class="p">)</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">ctrlC-handler</span><span class="p">)</span> <span class="p">(</span><span class="k">println</span> <span class="s">&quot;ctrl-C has been pressed&quot;</span><span class="p">))</span>

<span class="p">(</span><span class="k">signal</span> <span class="ss">SIGINT</span> <span class="o">&#39;</span><span class="ss">ctrlC-handler</span><span class="p">)</span>
<span class="c1">;; or</span>
<span class="p">(</span><span class="k">signal</span> <span class="ss">SIGINT</span> <span class="ss">ctrlC-handler</span><span class="p">)</span>

<span class="p">(</span><span class="k">while</span> <span class="k">true</span> <span class="p">(</span><span class="k">sleep</span> <span class="ss">300</span><span class="p">)</span> <span class="p">(</span><span class="k">println</span> <span class="s">&quot;busy&quot;</span><span class="p">))</span>

<span class="c1">;; generates following output</span>
<span class="ss">busy</span>
<span class="ss">busy</span>
<span class="ss">busy</span>
<span class="ss">ctrl-C</span> <span class="ss">has</span> <span class="ss">been</span> <span class="ss">pressed</span>
<span class="ss">busy</span>
<span class="ss">busy</span>
<span class="err">…</span>
</pre></div></div></div>
<div class="paragraph"><p>Specifying only a signal number will return either the name of the
currently defined handler function or <span class="monospaced">nil</span>.</p></div>
<div class="paragraph"><p>The user-defined signal handler can pass the signal number as a
parameter.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="k">signal-</span><span class="ss">handler</span> <span class="ss">sig</span><span class="p">)</span>
    <span class="p">(</span><span class="k">println</span> <span class="s">&quot;received signal: &quot;</span> <span class="ss">sig</span><span class="p">))</span>

<span class="c1">;; set all signals from 1 to 8 to the same handler</span>
<span class="p">(</span><span class="k">for</span> <span class="p">(</span><span class="nv">s</span> <span class="ss">1</span> <span class="ss">8</span><span class="p">)</span>
    <span class="p">(</span><span class="k">signal</span> <span class="ss">s</span> <span class="o">&#39;</span><span class="k">signal-</span><span class="ss">handler</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p>In this example, all signals from 1 to 8 are set to the same handler.</p></div>
<div class="paragraph"><p><a id="silent"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_silent_span"><span class="big red">silent</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (silent [<em>exp-1</em> [<em>exp-2</em> &#8230; ]])</p></div>
<div class="paragraph"><p>Evaluates one or more expressions in _exp-1_—. <span class="monospaced">silent</span> is similar to
<a href="#begin">begin</a>, but it suppresses console output of the return value
and the following prompt. It is often used when communicating from a
remote application with newLISP (e.g., GUI front-ends or other
applications controlling newLISP), and the return value is of no
interest.</p></div>
<div class="paragraph"><p>Silent mode is reset when returning to a prompt. This way, it can also
be used without arguments in a batch of expressions. When in interactive
mode, hit [enter] twice after a statement using <span class="monospaced">silent</span> to get the
prompt back.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">silent</span> <span class="p">(</span><span class="nv">my-func</span><span class="p">))</span>  <span class="c1">; same as next</span>

<span class="p">(</span><span class="k">silent</span><span class="p">)</span> <span class="p">(</span><span class="nv">my-func</span><span class="p">)</span>  <span class="c1">; same effect as previous</span>
</pre></div></div></div>
<div class="paragraph"><p><a id="sin"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_sin_span"><span class="big red">sin</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (sin <em>num-radians</em>)</p></div>
<div class="paragraph"><p>Calculates the sine function from <em>num-radians</em> and returns the result.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">sin</span> <span class="ss">1</span><span class="p">)</span>                     <span class="err">→</span> <span class="ss">0.8414709838</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">pi</span> <span class="p">(</span><span class="k">mul</span> <span class="ss">2</span> <span class="p">(</span><span class="k">acos</span> <span class="ss">0</span><span class="p">)))</span>  <span class="err">→</span> <span class="ss">3.141592654</span>
<span class="p">(</span><span class="k">sin</span> <span class="p">(</span><span class="k">div</span> <span class="ss">pi</span> <span class="ss">2</span><span class="p">))</span>            <span class="err">→</span> <span class="ss">1</span>
</pre></div></div></div>
<div class="paragraph"><p><a id="sinh"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_sinh_span"><span class="big red">sinh</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (sinh <em>num-radians</em>)</p></div>
<div class="paragraph"><p>Calculates the hyperbolic sine of <em>num-radians</em>. The hyperbolic sine is
defined mathematically as: <em>(exp (x) - exp (-x)) / 2</em>. An overflow to
<span class="monospaced">inf</span> may occur if <em>num-radians</em> is too large.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">sinh</span> <span class="ss">1</span><span class="p">)</span>     <span class="err">→</span> <span class="ss">1.175201194</span>
<span class="p">(</span><span class="k">sinh</span> <span class="ss">10</span><span class="p">)</span>    <span class="err">→</span> <span class="ss">11013.23287</span>
<span class="p">(</span><span class="k">sinh</span> <span class="ss">1000</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">inf</span>
<span class="p">(</span><span class="k">sub</span> <span class="p">(</span><span class="k">tanh</span> <span class="ss">1</span><span class="p">)</span> <span class="p">(</span><span class="k">div</span> <span class="p">(</span><span class="k">sinh</span> <span class="ss">1</span><span class="p">)</span> <span class="p">(</span><span class="k">cosh</span> <span class="ss">1</span><span class="p">)))</span> <span class="err">→</span> <span class="ss">0</span>
</pre></div></div></div>
<div class="paragraph"><p><a id="sleep"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_sleep_span"><span class="big red">sleep</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (sleep <em>num-milliseconds</em>)</p></div>
<div class="paragraph"><p>Gives up CPU time to other processes for the amount of milliseconds
specified in <em>num-milli-seconds</em>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">sleep</span> <span class="ss">1000</span><span class="p">)</span>  <span class="c1">; sleeps 1 second</span>
<span class="p">(</span><span class="k">sleep</span> <span class="ss">0.5</span><span class="p">)</span>   <span class="c1">; sleeps 500 micro seconds</span>
</pre></div></div></div>
<div class="paragraph"><p>On some platforms, <span class="monospaced">sleep</span> is only available with a resolution of one
second. In this case, the parameter <em>int-milli-seconds</em> will be rounded
to the nearest full second.</p></div>
<div class="paragraph"><p><a id="slice"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_slice_span"><span class="big red">slice</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (slice <em>list</em> <em>int-index</em> [<em>int-length</em>])<br>
<strong>syntax:</strong> (slice <em>array</em> <em>int-index</em> [<em>int-length</em>])<br>
<strong>syntax:</strong> (slice <em>str</em> <em>int-index</em> [<em>int-length</em>])</p></div>
<div class="paragraph"><p>In the first form, <span class="monospaced">slice</span> copies a sublist from a <em>list</em>. The original
list is left unchanged. The sublist extracted starts at index
<em>int-index</em> and has a length of <em>int-length</em>. If <em>int-length</em> is
negative, <span class="monospaced">slice</span> will take the parameter as offset counting from the
end and copy up to that offset. If the parameter is omitted, <span class="monospaced">slice</span>
copies all of the elements to the end of the list.</p></div>
<div class="paragraph"><p>See also <a href="#indexing">Indexing elements of strings and lists</a>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">slice</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span> <span class="ss">d</span> <span class="ss">e</span> <span class="ss">f</span><span class="p">)</span> <span class="ss">3</span> <span class="ss">2</span><span class="p">)</span>   <span class="err">→</span> <span class="p">(</span><span class="nv">d</span> <span class="ss">e</span><span class="p">)</span>
<span class="p">(</span><span class="k">slice</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span> <span class="ss">d</span> <span class="ss">e</span> <span class="ss">f</span><span class="p">)</span> <span class="ss">2</span> <span class="k">-</span><span class="ss">2</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">c</span> <span class="ss">d</span><span class="p">)</span>
<span class="p">(</span><span class="k">slice</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span> <span class="ss">d</span> <span class="ss">e</span> <span class="ss">f</span><span class="p">)</span> <span class="ss">2</span><span class="p">)</span>     <span class="err">→</span> <span class="p">(</span><span class="nv">c</span> <span class="ss">d</span> <span class="ss">e</span> <span class="ss">f</span><span class="p">)</span>
<span class="p">(</span><span class="k">slice</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span> <span class="ss">d</span> <span class="ss">e</span> <span class="ss">f</span><span class="p">)</span> <span class="k">-</span><span class="ss">4</span> <span class="ss">3</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">c</span> <span class="ss">d</span> <span class="ss">e</span><span class="p">)</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">A</span> <span class="p">(</span><span class="k">array</span> <span class="ss">3</span> <span class="ss">2</span> <span class="p">(</span><span class="k">sequence</span> <span class="ss">1</span> <span class="ss">6</span><span class="p">)))</span> <span class="err">→</span> <span class="p">((</span><span class="nv">1</span> <span class="ss">2</span><span class="p">)</span> <span class="p">(</span><span class="nv">3</span> <span class="ss">4</span><span class="p">)</span> <span class="p">(</span><span class="nv">5</span> <span class="ss">6</span><span class="p">))</span>
<span class="p">(</span><span class="k">slice</span> <span class="ss">A</span> <span class="ss">1</span> <span class="ss">2</span><span class="p">)</span> <span class="err">→</span> <span class="p">((</span><span class="nv">3</span> <span class="ss">4</span><span class="p">)</span> <span class="p">(</span><span class="nv">5</span> <span class="ss">6</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p>In the second form, a part of the string in <em>str</em> is extracted.
<em>int-index</em> contains the start index and <em>int-length</em> contains the
length of the substring. If <em>int-length</em> is not specified, everything to
the end of the string is extracted. <span class="monospaced">slice</span> also works on string buffers
containing binary data like <span class="monospaced">0</span>'s (zeroes). It operates on byte
boundaries rather than character boundaries. See also
<a href="#indexing">Indexing elements of strings and lists</a>.</p></div>
<div class="paragraph"><p>Note that <span class="monospaced">slice</span> always works on single 8-bit byte boundaries for
offset and length numbers, even when running the UTF-8 enabled version
of newLISP.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">slice</span> <span class="s">&quot;Hello World&quot;</span> <span class="ss">6</span> <span class="ss">2</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;Wo&quot;</span>
<span class="p">(</span><span class="k">slice</span> <span class="s">&quot;Hello World&quot;</span> <span class="ss">0</span> <span class="ss">5</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;Hello&quot;</span>
<span class="p">(</span><span class="k">slice</span> <span class="s">&quot;Hello World&quot;</span> <span class="ss">6</span><span class="p">)</span>    <span class="err">→</span> <span class="s">&quot;World&quot;</span>
<span class="p">(</span><span class="k">slice</span> <span class="s">&quot;newLISP&quot;</span> <span class="k">-</span><span class="ss">4</span> <span class="ss">2</span><span class="p">)</span>     <span class="err">→</span> <span class="s">&quot;LI&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>Note that an <em>implicit slice</em> is available for lists. See the chapter
<a href="#implicit_rest_slice">Implicit rest and slice</a>.</p></div>
<div class="paragraph"><p>Be aware that <a href="#slice">slice</a> always works on byte boundaries rather
than character boundaries in the UTF-8–enabled version of newLISP. As a
result, <a href="#slice">slice</a> can be used to manipulate binary content.</p></div>
<div class="paragraph"><p><a id="sort"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_sort_a_href_destructive_a_span"><span class="big red">sort <a href="#destructive">!</a></span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (sort <em>list</em> [<em>func-compare</em>])</p></div>
<div class="paragraph"><p>All members in <em>list</em> are sorted in ascending order. Anything may be
sorted, regardless of the types. When members are themselves lists, each
list element is recursively compared. If two expressions of different
types are compared, the lower type is sorted before the higher type in
the following order:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="ss">Atoms</span><span class="o">:</span> <span class="k">nil</span><span class="ss">,</span> <span class="k">true</span><span class="ss">,</span> <span class="k">integer</span> <span class="k">or</span> <span class="k">float</span><span class="ss">,</span> <span class="k">string</span><span class="ss">,</span> <span class="ss">symbol,</span> <span class="ss">primitive</span>
<span class="ss">Lists</span><span class="o">:</span> <span class="ss">quoted</span> <span class="ss">expression,</span> <span class="k">list</span><span class="ss">,</span> <span class="k">lambda</span><span class="ss">,</span> <span class="k">lambda-macro</span>
</pre></div></div></div>
<div class="paragraph"><p>The sort is destructive, changing the order of the elements in the
original list. The return value of <span class="monospaced">sort</span> is a copy of the sorted list.</p></div>
<div class="paragraph"><p>An optional comparison operator, user-defined function, or anonymous
function can be supplied. The functor or operator can be given with or
without a preceding quote.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">sort</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">v</span> <span class="ss">f</span> <span class="ss">r</span> <span class="ss">t</span> <span class="ss">h</span> <span class="ss">n</span> <span class="ss">m</span> <span class="ss">j</span><span class="p">))</span>     <span class="err">→</span> <span class="p">(</span><span class="nv">f</span> <span class="ss">h</span> <span class="ss">j</span> <span class="ss">m</span> <span class="ss">n</span> <span class="ss">r</span> <span class="ss">t</span> <span class="ss">v</span><span class="p">)</span>
<span class="p">(</span><span class="k">sort</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">3</span> <span class="ss">4</span><span class="p">)</span> <span class="p">(</span><span class="nv">2</span> <span class="ss">1</span><span class="p">)</span> <span class="p">(</span><span class="nv">1</span> <span class="ss">10</span><span class="p">)))</span>  <span class="err">→</span> <span class="p">((</span><span class="nv">1</span> <span class="ss">10</span><span class="p">)</span> <span class="p">(</span><span class="nv">2</span> <span class="ss">1</span><span class="p">)</span> <span class="p">(</span><span class="nv">3</span> <span class="ss">4</span><span class="p">))</span>
<span class="p">(</span><span class="k">sort</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">3</span> <span class="ss">4</span><span class="p">)</span> <span class="s">&quot;hi&quot;</span> <span class="ss">2.8</span> <span class="ss">8</span> <span class="ss">b</span><span class="p">))</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">2.8</span> <span class="ss">8</span> <span class="s">&quot;hi&quot;</span> <span class="ss">b</span> <span class="p">(</span><span class="nv">3</span> <span class="ss">4</span><span class="p">))</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">s</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">k</span> <span class="ss">a</span> <span class="ss">l</span> <span class="ss">s</span><span class="p">))</span>
<span class="p">(</span><span class="k">sort</span> <span class="ss">s</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">k</span> <span class="ss">l</span> <span class="ss">s</span><span class="p">)</span>

<span class="p">(</span><span class="k">sort</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">v</span> <span class="ss">f</span> <span class="ss">r</span> <span class="ss">t</span> <span class="ss">h</span> <span class="ss">n</span> <span class="ss">m</span> <span class="ss">j</span><span class="p">)</span> <span class="ss">&gt;</span><span class="p">)</span> <span class="err">→</span> <span class="p">(</span><span class="nv">v</span> <span class="ss">t</span> <span class="ss">r</span> <span class="ss">n</span> <span class="ss">m</span> <span class="ss">j</span> <span class="ss">h</span> <span class="ss">f</span><span class="p">)</span>

<span class="p">(</span><span class="k">sort</span> <span class="ss">s</span> <span class="ss">&lt;</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">k</span> <span class="ss">l</span> <span class="ss">s</span><span class="p">)</span>
<span class="p">(</span><span class="k">sort</span> <span class="ss">s</span> <span class="ss">&gt;</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">s</span> <span class="ss">l</span> <span class="ss">k</span> <span class="ss">a</span><span class="p">)</span>
<span class="ss">s</span>           <span class="err">→</span> <span class="p">(</span><span class="nv">s</span> <span class="ss">l</span> <span class="ss">k</span> <span class="ss">a</span><span class="p">)</span>

<span class="c1">;; define a comparison function</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">comp</span> <span class="ss">x</span> <span class="ss">y</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">&gt;</span> <span class="p">(</span><span class="k">last</span> <span class="ss">x</span><span class="p">)</span> <span class="p">(</span><span class="k">last</span> <span class="ss">y</span><span class="p">)))</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">db</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">a</span> <span class="ss">3</span><span class="p">)</span> <span class="p">(</span><span class="nv">g</span> <span class="ss">2</span><span class="p">)</span> <span class="p">(</span><span class="nv">c</span> <span class="ss">5</span><span class="p">)))</span>

<span class="p">(</span><span class="k">sort</span> <span class="ss">db</span> <span class="ss">comp</span><span class="p">)</span>  <span class="err">→</span>  <span class="p">((</span><span class="nv">c</span> <span class="ss">5</span><span class="p">)</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">3</span><span class="p">)</span> <span class="p">(</span><span class="nv">g</span> <span class="ss">2</span><span class="p">))</span>

<span class="c1">;; use an anonymous function</span>
<span class="p">(</span><span class="k">sort</span> <span class="ss">db</span> <span class="p">(</span><span class="k">fn</span> <span class="p">(</span><span class="nv">x</span> <span class="ss">y</span><span class="p">)</span> <span class="p">(</span><span class="nv">&gt;</span> <span class="p">(</span><span class="k">last</span> <span class="ss">x</span><span class="p">)</span> <span class="p">(</span><span class="k">last</span> <span class="ss">y</span><span class="p">))))</span>
</pre></div></div></div>
<div class="paragraph"><p><a id="source"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_source_span"><span class="big red">source</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (source)<br>
<strong>syntax:</strong> (source <em>sym-1</em> [<em>sym-2</em> &#8230; ])</p></div>
<div class="paragraph"><p>Works almost identically to <a href="#save">save</a>, except symbols and
contexts get serialized to a string instead of being written to a file.
Multiple variable symbols, definitions, and contexts can be specified.
If no argument is given, <span class="monospaced">source</span> serializes the entire newLISP
workspace. When context symbols are serialized, any symbols contained
within that context will be serialized, as well. Symbols containing
<span class="monospaced">nil</span> are not serialized. System symbols beginning with the <span class="monospaced">$</span> (dollar
sign) character are only serialized when mentioned explicitly.</p></div>
<div class="paragraph"><p>Symbols not belonging to the current context are written out with their
context prefix.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">double</span> <span class="ss">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">x</span> <span class="ss">x</span><span class="p">))</span>

<span class="p">(</span><span class="k">source</span> <span class="o">&#39;</span><span class="ss">double</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;(define (double x)\n  (+ x x))\n\n&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>As with <a href="#save">save</a>, the formatting of line breaks and leading
spaces or tabs can be controlled using the
<a href="#pretty-print">pretty-print</a> function.</p></div>
<div class="paragraph"><p><a id="spawn"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_spawn_span"><span class="big red">spawn</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (spawn <em>sym</em> <em>exp</em> [true])</p></div>
<div class="paragraph"><p>Launches the evaluation of <em>exp</em> as a child process and immediately
returns. The symbol in <em>sym</em> is quoted and receives the result of the
evaluation when the function <a href="#sync">sync</a> is executed. <span class="monospaced">spawn</span> is
used to start parallel evaluation of expressions in concurrent
processes. If newLISP is running on a multi-core CPU, the underlying
operating system will distribute spawned processes onto different cores,
thereby evaluating expressions in parallel and speeding up overall
processing.</p></div>
<div class="paragraph"><p>The optional <span class="monospaced">true</span> parameter must be set if <a href="#send">send</a> or
<a href="#receive">receive</a> is used to communicated with the child process
spawned.</p></div>
<div class="paragraph"><p>The function <span class="monospaced">spawn</span> is not available on Win32.</p></div>
<div class="paragraph"><p>After successfully starting a child process, the <span class="monospaced">spawn</span> expression
returns the process id of the forked process. The following examples
shows how the calculation of a range of prime numbers can be split up in
four sub ranges to speed up the calculation of the whole range:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">; calculate primes in a range</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">primes</span> <span class="ss">from</span> <span class="ss">to</span><span class="p">)</span>
  <span class="p">(</span><span class="k">local</span> <span class="p">(</span><span class="nv">plist</span><span class="p">)</span>
      <span class="p">(</span><span class="k">for</span> <span class="p">(</span><span class="nv">i</span> <span class="ss">from</span> <span class="ss">to</span><span class="p">)</span>
          <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">=</span> <span class="ss">1</span> <span class="p">(</span><span class="k">length</span> <span class="p">(</span><span class="k">factor</span> <span class="ss">i</span><span class="p">)))</span>
              <span class="p">(</span><span class="k">push</span> <span class="ss">i</span> <span class="ss">plist</span> <span class="k">-</span><span class="ss">1</span><span class="p">)))</span>
      <span class="ss">plist</span><span class="p">))</span>

<span class="c1">; start child processes</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">start</span> <span class="p">(</span><span class="k">time-of-day</span><span class="p">))</span>

<span class="p">(</span><span class="k">spawn</span> <span class="o">&#39;</span><span class="ss">p1</span> <span class="p">(</span><span class="nv">primes</span> <span class="ss">1</span> <span class="ss">1000000</span><span class="p">))</span>
<span class="p">(</span><span class="k">spawn</span> <span class="o">&#39;</span><span class="ss">p2</span> <span class="p">(</span><span class="nv">primes</span> <span class="ss">1000001</span> <span class="ss">2000000</span><span class="p">))</span>
<span class="p">(</span><span class="k">spawn</span> <span class="o">&#39;</span><span class="ss">p3</span> <span class="p">(</span><span class="nv">primes</span> <span class="ss">2000001</span> <span class="ss">3000000</span><span class="p">))</span>
<span class="p">(</span><span class="k">spawn</span> <span class="o">&#39;</span><span class="ss">p4</span> <span class="p">(</span><span class="nv">primes</span> <span class="ss">3000001</span> <span class="ss">4000000</span><span class="p">))</span>

<span class="c1">; wait for a maximum of 60 seconds for all tasks to finish</span>
<span class="p">(</span><span class="k">sync</span> <span class="ss">60000</span><span class="p">)</span> <span class="c1">; returns true if all finished in time</span>
<span class="c1">; p1, p2, p3 and p4 now each contain a lists of primes</span>

<span class="p">(</span><span class="k">println</span> <span class="s">&quot;time spawn: &quot;</span> <span class="p">(</span><span class="nv">-</span> <span class="p">(</span><span class="k">time-of-day</span><span class="p">)</span> <span class="ss">start</span><span class="p">))</span>
<span class="p">(</span><span class="k">println</span> <span class="s">&quot;time simple: &quot;</span> <span class="p">(</span><span class="k">time</span>  <span class="p">(</span><span class="nv">primes</span> <span class="ss">1</span> <span class="ss">4000000</span><span class="p">)))</span>

<span class="p">(</span><span class="k">exit</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>On a 1.83 Intel Core 2 Duo processor, the above example will finish
after about 13 seconds. Calculating all primes using
<span class="monospaced">(primes 1 4000000)</span> would take about 20 seconds.</p></div>
<div class="paragraph"><p>The <a href="#sync">sync</a> function will wait for all child processes to
finish and receive the evaluation results in the symbols <span class="monospaced">p1</span> to <span class="monospaced">p4</span>.
When all results are collected, <span class="monospaced">sync</span> will stop waiting and return
<span class="monospaced">true</span>. When the time specified was insufficient , <span class="monospaced">sync</span> will return
<span class="monospaced">nil</span> and another <span class="monospaced">sync</span> statement could be given to further wait and
collect results. A short timeout time can be used to do other processing
during waiting:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">spawn</span> <span class="o">&#39;</span><span class="ss">p1</span> <span class="p">(</span><span class="nv">primes</span> <span class="ss">1</span> <span class="ss">1000000</span><span class="p">))</span>
<span class="p">(</span><span class="k">spawn</span> <span class="o">&#39;</span><span class="ss">p2</span> <span class="p">(</span><span class="nv">primes</span> <span class="ss">1000001</span> <span class="ss">2000000</span><span class="p">))</span>
<span class="p">(</span><span class="k">spawn</span> <span class="o">&#39;</span><span class="ss">p3</span> <span class="p">(</span><span class="nv">primes</span> <span class="ss">2000001</span> <span class="ss">3000000</span><span class="p">))</span>
<span class="p">(</span><span class="k">spawn</span> <span class="o">&#39;</span><span class="ss">p4</span> <span class="p">(</span><span class="nv">primes</span> <span class="ss">3000001</span> <span class="ss">4000000</span><span class="p">))</span>

<span class="c1">; print a dot after each 2 seconds of waiting</span>
<span class="p">(</span><span class="k">until</span> <span class="p">(</span><span class="k">sync</span> <span class="ss">2000</span><span class="p">)</span> <span class="p">(</span><span class="k">println</span> <span class="s">&quot;.&quot;</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p><span class="monospaced">sync</span> when used without any parameters, will not wait but immediately
return a list of pending child processes. For the <span class="monospaced">primes</span> example, the
following <span class="monospaced">sync</span> expression could be used to watch the progress:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">spawn</span> <span class="o">&#39;</span><span class="ss">p1</span> <span class="p">(</span><span class="nv">primes</span> <span class="ss">1</span> <span class="ss">1000000</span><span class="p">))</span>
<span class="p">(</span><span class="k">spawn</span> <span class="o">&#39;</span><span class="ss">p2</span> <span class="p">(</span><span class="nv">primes</span> <span class="ss">1000001</span> <span class="ss">2000000</span><span class="p">))</span>
<span class="p">(</span><span class="k">spawn</span> <span class="o">&#39;</span><span class="ss">p3</span> <span class="p">(</span><span class="nv">primes</span> <span class="ss">2000001</span> <span class="ss">3000000</span><span class="p">))</span>
<span class="p">(</span><span class="k">spawn</span> <span class="o">&#39;</span><span class="ss">p4</span> <span class="p">(</span><span class="nv">primes</span> <span class="ss">3000001</span> <span class="ss">4000000</span><span class="p">))</span>

<span class="c1">; show a list of pending process ids after each three-tenths of a second</span>
<span class="p">(</span><span class="k">until</span> <span class="p">(</span><span class="k">sync</span> <span class="ss">300</span><span class="p">)</span> <span class="p">(</span><span class="k">println</span> <span class="p">(</span><span class="k">sync</span><span class="p">)))</span>
</pre></div></div></div>
<div class="paragraph"><p>A parameter of <span class="monospaced">-1</span> tells <span class="monospaced">sync</span> to wait for a very long time (~ 1193
hours). A better solution would be to wait for a maximum time, then
<a href="#abort">abort</a> all pending child processes:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">spawn</span> <span class="o">&#39;</span><span class="ss">p1</span> <span class="p">(</span><span class="nv">primes</span> <span class="ss">1</span> <span class="ss">1000000</span><span class="p">))</span>
<span class="p">(</span><span class="k">spawn</span> <span class="o">&#39;</span><span class="ss">p2</span> <span class="p">(</span><span class="nv">primes</span> <span class="ss">1000001</span> <span class="ss">2000000</span><span class="p">))</span>
<span class="p">(</span><span class="k">spawn</span> <span class="o">&#39;</span><span class="ss">p3</span> <span class="p">(</span><span class="nv">primes</span> <span class="ss">2000001</span> <span class="ss">3000000</span><span class="p">))</span>
<span class="p">(</span><span class="k">spawn</span> <span class="o">&#39;</span><span class="ss">p4</span> <span class="p">(</span><span class="nv">primes</span> <span class="ss">3000001</span> <span class="ss">4000000</span><span class="p">))</span>

<span class="c1">; wait for one minute, then abort and</span>
<span class="c1">; report unfinished PIDs</span>

<span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="k">not</span> <span class="p">(</span><span class="k">sync</span> <span class="ss">60000</span><span class="p">))</span>
    <span class="p">(</span><span class="k">begin</span>
        <span class="p">(</span><span class="k">println</span> <span class="s">&quot;aborting unfinished: &quot;</span> <span class="p">(</span><span class="k">sync</span><span class="p">))</span>
        <span class="p">(</span><span class="k">abort</span><span class="p">))</span>
    <span class="p">(</span><span class="k">println</span> <span class="s">&quot;all finished successfully&quot;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The three functions <span class="monospaced">spawn</span>, <span class="monospaced">sync</span> and <span class="monospaced">abort</span> are part of the
<a href="http://supertech.csail.mit.edu/cilk/">Cilk</a> API. The original
implementation also does sophisticated scheduling and allocation of
threaded tasks to multiple CPU cores. The newLISP implementation of the
Cilk API lets the operating system of the underlying platform handle
process management. Internally, the API is implemented using the Unix
libc functions <span class="monospaced">fork()</span>, <span class="monospaced">waitpid()</span> and <span class="monospaced">kill()</span>. Intercommunications
between processes and child processes is done using the <a href="#send">send</a>
and <a href="#receive">receive</a> functions.</p></div>
<div class="paragraph"><p><span class="monospaced">spawn</span> can be called recursively from spawned subtasks:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">fibo</span> <span class="ss">n</span><span class="p">)</span>
  <span class="p">(</span><span class="k">local</span> <span class="p">(</span><span class="nv">f1</span> <span class="ss">f2</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if</span><span class="p">(</span><span class="nv">&lt;</span> <span class="ss">n</span> <span class="ss">2</span><span class="p">)</span> <span class="ss">1</span>
       <span class="p">(</span><span class="k">begin</span>
          <span class="p">(</span><span class="k">spawn</span> <span class="o">&#39;</span><span class="ss">f1</span> <span class="p">(</span><span class="nv">fibo</span> <span class="p">(</span><span class="nv">-</span> <span class="ss">n</span> <span class="ss">1</span><span class="p">)))</span>
          <span class="p">(</span><span class="k">spawn</span> <span class="o">&#39;</span><span class="ss">f2</span> <span class="p">(</span><span class="nv">fibo</span> <span class="p">(</span><span class="nv">-</span> <span class="ss">n</span> <span class="ss">2</span><span class="p">)))</span>
          <span class="p">(</span><span class="k">sync</span> <span class="ss">10000</span><span class="p">)</span>
          <span class="p">(</span><span class="nv">+</span> <span class="ss">f1</span> <span class="ss">f2</span><span class="p">)))))</span>

<span class="p">(</span><span class="nv">fibo</span> <span class="ss">7</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">21</span>
</pre></div></div></div>
<div class="paragraph"><p>With <span class="monospaced">(fibo 7)</span> 41 processes will be generated. Although the above code
shows the working of the Cilk API in a recursive application, it would
not be practical, as the overhead required to spawn subtasks is much
higher than the time saved through parallelization.</p></div>
<div class="paragraph"><p>Since version 10.1 a <a href="#send">send</a> and <a href="#receive">receive</a> message
functions are available for communications between parent and child
processes. Using these functions any data or expression of any size can
be transferred. Additionally messaged expressions can be evaluated in
the recipient&#8217;s environment.</p></div>
<div class="paragraph"><p><a id="sqrt"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_sqrt_span"><span class="big red">sqrt</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (sqrt <em>num</em>)</p></div>
<div class="paragraph"><p>Calculates the square root from the expression in <em>num</em> and returns the
result.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">sqrt</span> <span class="ss">10</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">3.16227766</span>
<span class="p">(</span><span class="k">sqrt</span> <span class="ss">25</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">5</span>
</pre></div></div></div>
<div class="paragraph"><p><a id="starts-with"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_starts_with_span"><span class="big red">starts-with</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (starts-with <em>str</em> <em>str-key</em> [<em>num-option</em>])<br>
<strong>syntax:</strong> (starts-with <em>list</em> [<em>exp</em>])</p></div>
<div class="paragraph"><p>In the first version, <span class="monospaced">starts-with</span> checks if the string <em>str</em> starts
with a key string in <em>str-key</em> and returns <span class="monospaced">true</span> or <span class="monospaced">nil</span> depending on
the outcome.</p></div>
<div class="paragraph"><p>If a regular expression number is specified in <em>num-option</em>, <em>str-key</em>
contains a regular expression pattern. See <a href="#regex">regex</a> for valid
<em>option</em> numbers.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">starts-with</span> <span class="s">&quot;this is useful&quot;</span> <span class="s">&quot;this&quot;</span><span class="p">)</span>        <span class="err">→</span> <span class="k">true</span>
<span class="p">(</span><span class="k">starts-with</span> <span class="s">&quot;this is useful&quot;</span> <span class="s">&quot;THIS&quot;</span><span class="p">)</span>        <span class="err">→</span> <span class="k">nil</span>

<span class="c1">;; use regular expressions</span>
<span class="p">(</span><span class="k">starts-with</span> <span class="s">&quot;this is useful&quot;</span> <span class="s">&quot;THIS&quot;</span> <span class="ss">1</span><span class="p">)</span>      <span class="err">→</span> <span class="k">true</span>
<span class="p">(</span><span class="k">starts-with</span> <span class="s">&quot;this is useful&quot;</span> <span class="s">&quot;this|that&quot;</span> <span class="ss">0</span><span class="p">)</span> <span class="err">→</span> <span class="k">true</span>
</pre></div></div></div>
<div class="paragraph"><p>In the second version, <span class="monospaced">starts-with</span> checks to see if a list starts with
the list element in <em>exp</em>. <span class="monospaced">true</span> or <span class="monospaced">nil</span> is returned depending on
outcome.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">starts-with</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">3</span> <span class="ss">4</span> <span class="ss">5</span><span class="p">)</span> <span class="ss">1</span><span class="p">)</span>             <span class="err">→</span> <span class="k">true</span>
<span class="p">(</span><span class="k">starts-with</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span> <span class="ss">d</span> <span class="ss">e</span><span class="p">)</span> <span class="o">&#39;</span><span class="ss">b</span><span class="p">)</span>            <span class="err">→</span> <span class="k">nil</span>
<span class="p">(</span><span class="k">starts-with</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">+</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">)</span> <span class="ss">b</span> <span class="ss">c</span> <span class="ss">d</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">+</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">))</span>  <span class="err">→</span> <span class="k">true</span>
</pre></div></div></div>
<div class="paragraph"><p>See also the <a href="#ends-with">ends-with</a> function.</p></div>
<div class="paragraph"><p><a id="stats"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_stats_span"><span class="big red">stats</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (stats <em>list-vector</em>)</p></div>
<div class="paragraph"><p>The functions calculates statistical values of central tendency and
dsitribution moments of values in <em>list-vector</em>. The following values
are returned by <span class="monospaced">stats</span> in a list:</p></div>
<table class="tableblock frame-all grid-all"
style="
width:30%;
">
<col style="width:20%;">
<col style="width:80%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" >name </th>
<th class="tableblock halign-left valign-top" >description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">N</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Number of values</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">mean</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Mean of values</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">avdev</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Average deviation from mean value</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">sdev</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Standard deviation (population estimate)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">var</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Variance (population estimate)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">skew</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Skew of distribution</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">kurt</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Kurtosis of distribution</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="ss">The</span> <span class="ss">following</span> <span class="ss">example</span> <span class="ss">uses</span> <span class="ss">the</span> <span class="k">list</span> <span class="ss">output</span> <span class="ss">from</span> <span class="ss">the</span> <span class="err">`</span><span class="ss">stats</span><span class="err">`</span> <span class="ss">expression</span>
<span class="ss">as</span> <span class="ss">an</span> <span class="ss">argument</span> <span class="k">for</span> <span class="ss">the</span> <span class="ss">link</span><span class="o">:</span><span class="c1">#format[format] statement:</span>
</pre></div></div></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">data</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">90</span> <span class="ss">100</span> <span class="ss">130</span> <span class="ss">150</span> <span class="ss">180</span> <span class="ss">200</span> <span class="ss">220</span> <span class="ss">300</span> <span class="ss">350</span> <span class="ss">400</span><span class="p">))</span>

<span class="p">(</span><span class="k">println</span> <span class="p">(</span><span class="k">format</span> <span class="s">[text]</span>
<span class="s">    N        = %5d</span>
<span class="s">    mean     = %8.2f</span>
<span class="s">    avdev    = %8.2f</span>
<span class="s">    sdev     = %8.2f</span>
<span class="s">    var      = %8.2f</span>
<span class="s">    skew     = %8.2f</span>
<span class="s">    kurt     = %8.2f</span>
<span class="s">[/text]</span> <span class="p">(</span><span class="nv">stats</span> <span class="ss">data</span><span class="p">)))</span>

<span class="c1">; outputs the following</span>

    <span class="ss">N</span>        <span class="ss">=</span>    <span class="ss">10</span>
    <span class="ss">mean</span>     <span class="ss">=</span>   <span class="ss">212.00</span>
    <span class="ss">avdev</span>    <span class="ss">=</span>    <span class="ss">84.40</span>
    <span class="ss">sdev</span>     <span class="ss">=</span>   <span class="ss">106.12</span>
    <span class="ss">var</span>      <span class="ss">=</span> <span class="ss">11262.22</span>
    <span class="ss">skew</span>     <span class="ss">=</span>     <span class="ss">0.49</span>
    <span class="ss">kurtosis</span> <span class="ss">=</span>    <span class="k">-</span><span class="ss">1.34</span>
</pre></div></div></div>
<div class="paragraph"><p><a id="string"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_string_span"><span class="big red">string</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (string <em>exp-1</em> [<em>exp-2</em> &#8230; ])</p></div>
<div class="paragraph"><p>Translates into a string anything that results from evaluating _exp-1_—.
If more than one expression is specified, the resulting strings are
concatenated.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">string</span> <span class="o">&#39;</span><span class="ss">hello</span><span class="p">)</span>          <span class="err">→</span> <span class="s">&quot;hello&quot;</span>
<span class="p">(</span><span class="k">string</span> <span class="ss">1234</span><span class="p">)</span>            <span class="err">→</span> <span class="s">&quot;1234&quot;</span>
<span class="p">(</span><span class="k">string</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">+</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">))</span>        <span class="err">→</span> <span class="s">&quot;(+ 3 4)&quot;</span>
<span class="p">(</span><span class="k">string</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">3</span> <span class="ss">4</span><span class="p">)</span> <span class="ss">8</span><span class="p">)</span>       <span class="err">→</span> <span class="s">&quot;78&quot;</span>
<span class="p">(</span><span class="k">string</span> <span class="o">&#39;</span><span class="ss">hello</span> <span class="s">&quot; &quot;</span> <span class="ss">123</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;hello 123&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>If a buffer passed to <span class="monospaced">string</span> contains <span class="monospaced">\000</span>, only the string up to
the first terminating zero will be copied:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">buff</span> <span class="s">&quot;ABC\000\000\000&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;ABC\000\000\000&quot;</span>

<span class="p">(</span><span class="k">length</span> <span class="ss">buff</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">6</span>

<span class="p">(</span><span class="k">string</span> <span class="ss">buff</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;ABC&quot;</span>

<span class="p">(</span><span class="k">length</span> <span class="p">(</span><span class="k">string</span> <span class="ss">buff</span><span class="p">))</span>  <span class="err">→</span> <span class="ss">3</span>
</pre></div></div></div>
<div class="paragraph"><p>Use the <a href="#append">append</a> and <a href="#join">join</a> (allows the joining
string to be specified) functions to concatenate strings containing zero
bytes. Use the <a href="#source">source</a> function to convert a lambda
expression into its newLISP source string representation.</p></div>
<div class="paragraph"><p><a id="string?"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_string_span_2"><span class="big red">string?</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (string? <em>exp</em>)</p></div>
<div class="paragraph"><p>Evaluates <em>exp</em> and tests to see if it is a string. Returns <span class="monospaced">true</span> or
<span class="monospaced">nil</span> depending on the result.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">var</span> <span class="s">&quot;hello&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">string</span><span class="ss">?</span> <span class="ss">var</span><span class="p">)</span>  <span class="err">→</span> <span class="k">true</span>
</pre></div></div></div>
<div class="paragraph"><p><a id="struct"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_struct_span"><span class="big red">struct</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (struct <em>symbol</em> [<em>str-data-type</em> &#8230; ])</p></div>
<div class="paragraph"><p>The <span class="monospaced">struct</span> function can be used to define aggregate data types for
usage with the extended syntax of <a href="#import">import</a>, <a href="#pack">pack</a>
and <a href="#unpack">unpack</a>. This allows importing functions which take
C-language <em>struct</em> data types or pointers to these aggregate data
types.</p></div>
<div class="paragraph"><p>The following example illustrates the usage of <span class="monospaced">struct</span> together with
the C data functions <span class="monospaced">localtime</span> and <span class="monospaced">asctime</span>. The <span class="monospaced">localtime</span>
functions works similar to the built-in <a href="#now">now</a> function. The
<span class="monospaced">asctime</span> function takes the numerical data output by <span class="monospaced">localtime</span> and
formats these to readable text.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="cm">/* The C function prototypes for the functions to import */</span>

<span class="k">struct</span> <span class="n">tm</span> <span class="o">*</span> <span class="nf">localtime</span><span class="p">(</span><span class="k">const</span> <span class="kt">time_t</span> <span class="o">*</span><span class="n">clock</span><span class="p">);</span>

<span class="kt">char</span> <span class="o">*</span> <span class="nf">asctime</span><span class="p">(</span><span class="k">const</span> <span class="k">struct</span> <span class="n">tm</span> <span class="o">*</span><span class="n">timeptr</span><span class="p">);</span>

<span class="cm">/* the tm struct aggregating different time related values */</span>

<span class="k">struct</span> <span class="n">tm</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="n">tm_sec</span><span class="p">;</span>      <span class="cm">/* seconds after the minute [0-60] */</span>
    <span class="kt">int</span> <span class="n">tm_min</span><span class="p">;</span>      <span class="cm">/* minutes after the hour [0-59] */</span>
    <span class="kt">int</span> <span class="n">tm_hour</span><span class="p">;</span>     <span class="cm">/* hours since midnight [0-23] */</span>
    <span class="kt">int</span> <span class="n">tm_mday</span><span class="p">;</span>     <span class="cm">/* day of the month [1-31] */</span>
    <span class="kt">int</span> <span class="n">tm_mon</span><span class="p">;</span>      <span class="cm">/* months since January [0-11] */</span>
    <span class="kt">int</span> <span class="n">tm_year</span><span class="p">;</span>     <span class="cm">/* years since 1900 */</span>
    <span class="kt">int</span> <span class="n">tm_wday</span><span class="p">;</span>     <span class="cm">/* days since Sunday [0-6] */</span>
    <span class="kt">int</span> <span class="n">tm_yday</span><span class="p">;</span>     <span class="cm">/* days since January 1 [0-365] */</span>
    <span class="kt">int</span> <span class="n">tm_isdst</span><span class="p">;</span>    <span class="cm">/* Daylight Savings Time flag */</span>
    <span class="kt">long</span> <span class="n">tm_gmtoff</span><span class="p">;</span>  <span class="cm">/* offset from CUT in seconds */</span>   <span class="cm">/*** not on Windows ***/</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">tm_zone</span><span class="p">;</span>   <span class="cm">/* timezone abbreviation */</span>        <span class="cm">/*** not on Windows ***/</span>
<span class="p">};</span>
</pre></div></div></div>
<div class="paragraph"><p>Function import and definition of the structure data type in newLISP:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">;; for pointers to structs always use void*</span>
<span class="c1">;; as a library use msvcrt.dll on Windows or libc.so on Unix.</span>
<span class="c1">;; The tm struct type is configured for Mac OSX and Linux.</span>
<span class="c1">;; On other OS the tm structure may be different</span>

<span class="p">(</span><span class="k">import</span> <span class="s">&quot;libc.dylib&quot;</span> <span class="s">&quot;asctime&quot;</span> <span class="s">&quot;char*&quot;</span> <span class="s">&quot;void*&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">import</span> <span class="s">&quot;libc.dylib&quot;</span> <span class="s">&quot;localtime&quot;</span> <span class="s">&quot;void*&quot;</span> <span class="s">&quot;void*&quot;</span><span class="p">)</span>

<span class="c1">; definition of the struct</span>
<span class="p">(</span><span class="nv">struct</span> <span class="o">&#39;</span><span class="ss">tm</span> <span class="s">&quot;int&quot;</span> <span class="s">&quot;int&quot;</span> <span class="s">&quot;int&quot;</span> <span class="s">&quot;int&quot;</span> <span class="s">&quot;int&quot;</span> <span class="s">&quot;int&quot;</span> <span class="s">&quot;int&quot;</span> <span class="s">&quot;int&quot;</span> <span class="s">&quot;int&quot;</span> <span class="s">&quot;long&quot;</span> <span class="s">&quot;char*&quot;</span><span class="p">)</span>

<span class="c1">;; use import and struct</span>

<span class="c1">; todays date number (seconds after 1970 also called Unix epoch time)</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">today</span> <span class="p">(</span><span class="k">date-value</span><span class="p">))</span>  <span class="err">→</span> <span class="ss">1324134913</span>

<span class="c1">;; the time value is passed by it&#39;s address</span>
<span class="c1">;; localtime retirns a pointer to a tm struct</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">ptr</span> <span class="p">(</span><span class="nv">localtime</span> <span class="p">(</span><span class="k">address</span> <span class="ss">today</span><span class="p">)))</span> <span class="err">→</span> <span class="ss">2896219696</span>

<span class="c1">; unpack the the tm struct  (7:15:13 on the 17th etc.)</span>
<span class="p">(</span><span class="k">unpack</span> <span class="ss">tm</span> <span class="ss">ptr</span><span class="p">)</span> <span class="err">→</span> <span class="p">(</span><span class="nv">13</span> <span class="ss">15</span> <span class="ss">7</span> <span class="ss">17</span> <span class="ss">11</span> <span class="ss">111</span> <span class="ss">6</span> <span class="ss">350</span> <span class="ss">0</span> <span class="k">-</span><span class="ss">28800</span> <span class="s">&quot;PST&quot;</span><span class="p">)</span>

<span class="c1">; transform to readable form</span>
<span class="p">(</span><span class="nv">asctime</span> <span class="ss">ptr</span><span class="p">)</span> <span class="err">→</span> <span class="s">&quot;Sat Dec 17 07:15:13 2011\n&quot;</span>

<span class="c1">; all in one statement does actually not use struct, pointers are passed directly</span>
<span class="p">(</span><span class="nv">asctime</span> <span class="p">(</span><span class="nv">localtime</span> <span class="p">(</span><span class="k">address</span> <span class="ss">today</span><span class="p">)))</span> <span class="err">→</span> <span class="s">&quot;Sat Dec 17 07:15:13 2011&quot;</span>

<span class="c1">; same as the built-in date function</span>
<span class="p">(</span><span class="k">date</span> <span class="ss">today</span><span class="p">)</span> <span class="err">→</span> <span class="s">&quot;Sat Dec 17 07:15:13 2011&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>Care must be taken to pass valid addresses to pointer parameters in
imported functions or when passing address pointers to
<a href="#unpack">unpack</a>. Invalid address pointers can crash newLISP or make
it unstable.</p></div>
<div class="paragraph"><p><span class="monospaced">struct</span> defininitions can be nested:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">; the pair aggregate type</span>
<span class="p">(</span><span class="nv">struct</span> <span class="o">&#39;</span><span class="ss">pair</span> <span class="s">&quot;char&quot;</span> <span class="s">&quot;char&quot;</span><span class="p">)</span> <span class="err">→</span> <span class="ss">pair</span>

<span class="c1">; nested struct type</span>
<span class="p">(</span><span class="nv">struct</span> <span class="o">&#39;</span><span class="ss">comp</span> <span class="s">&quot;pair&quot;</span> <span class="s">&quot;int&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">comp</span>

<span class="c1">; pack data using the extended pack syntax</span>
<span class="c1">; not the insertion of structure alignment bytes after the pair</span>
<span class="p">(</span><span class="k">pack</span> <span class="ss">comp</span> <span class="p">(</span><span class="k">pack</span> <span class="ss">pair</span> <span class="ss">1</span> <span class="ss">2</span><span class="p">)</span> <span class="ss">3</span><span class="p">)</span> <span class="err">→</span> <span class="s">&quot;\001\002\000\000\003\000\000\000&quot;</span>

<span class="c1">; unpack reverses the process</span>
<span class="p">(</span><span class="k">unpack</span> <span class="ss">comp</span> <span class="s">&quot;\001\002\000\000\003\000\000\000&quot;</span><span class="p">)</span> <span class="err">→</span> <span class="p">((</span><span class="nv">1</span> <span class="ss">2</span><span class="p">)</span> <span class="ss">3</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Nested structures are unpacked recursively.</p></div>
<div class="paragraph"><p><a id="sub"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_sub_span"><span class="big red">sub</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (sub <em>num-1</em> [<em>num-2</em> &#8230; ])</p></div>
<div class="paragraph"><p>Successively subtracts the expressions in <em>num-1</em>, _num-2_—. <span class="monospaced">sub</span>
performs mixed-type arithmetic and handles integers or floating points,
but it will always return a floating point number. If only one argument
is supplied, its sign is reversed. Any floating point calculation with
<span class="monospaced">NaN</span> also returns <span class="monospaced">NaN</span>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">sub</span> <span class="ss">10</span> <span class="ss">8</span> <span class="ss">0.25</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">1.75</span>
<span class="p">(</span><span class="k">sub</span> <span class="ss">123</span><span class="p">)</span>        <span class="err">→</span> <span class="k">-</span><span class="ss">123</span>
</pre></div></div></div>
<div class="paragraph"><p><a id="swap"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_swap_a_href_destructive_a_span"><span class="big red">swap <a href="#destructive">!</a></span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (swap <em>place-1</em> <em>place-2</em>)</p></div>
<div class="paragraph"><p>The contents of the two places <em>place-1 and place-2</em> are swapped. A
<em>place</em> can be the contents of an unquoted symbol or any list or array
references expressed with <a href="#nth">nth</a>, <a href="#first">first</a>,
<a href="#lst">last</a> or implicit <a href="#indexing">indexing</a> or places
referenced by <a href="#assoc">assoc</a> or <a href="#lookup">lookup</a>.</p></div>
<div class="paragraph"><p><span class="monospaced">swap</span> is a destructive operation that changes the contents of the
lists, arrays, or symbols involved.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">lst</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span> <span class="ss">d</span> <span class="ss">e</span> <span class="ss">f</span><span class="p">))</span>

<span class="p">(</span><span class="k">swap</span> <span class="p">(</span><span class="k">first</span> <span class="ss">lst</span><span class="p">)</span> <span class="p">(</span><span class="k">last</span> <span class="ss">lst</span><span class="p">))</span> <span class="err">→</span> <span class="ss">a</span>
<span class="ss">lst</span>                           <span class="err">→</span> <span class="p">(</span><span class="nv">f</span> <span class="ss">b</span> <span class="ss">c</span> <span class="ss">d</span> <span class="ss">e</span> <span class="ss">a</span><span class="p">)</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">lst-b</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">x</span> <span class="ss">y</span> <span class="ss">z</span><span class="p">))</span>

<span class="p">(</span><span class="k">swap</span> <span class="p">(</span><span class="nv">lst</span> <span class="ss">0</span><span class="p">)</span> <span class="p">(</span><span class="nv">lst-b</span> <span class="k">-</span><span class="ss">1</span><span class="p">))</span> <span class="err">→</span> <span class="ss">f</span>
<span class="ss">lst</span>                       <span class="err">→</span> <span class="p">(</span><span class="nv">z</span> <span class="ss">b</span> <span class="ss">c</span> <span class="ss">d</span> <span class="ss">e</span> <span class="ss">a</span><span class="p">)</span>
<span class="ss">lst-b</span>                     <span class="err">→</span> <span class="p">(</span><span class="nv">x</span> <span class="ss">y</span> <span class="ss">f</span><span class="p">)</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">A</span> <span class="p">(</span><span class="k">array</span> <span class="ss">2</span> <span class="ss">3</span> <span class="p">(</span><span class="k">sequence</span> <span class="ss">1</span> <span class="ss">6</span><span class="p">))</span> <span class="err">→</span> <span class="p">((</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">3</span><span class="p">)</span> <span class="p">(</span><span class="nv">4</span> <span class="ss">5</span> <span class="ss">6</span><span class="p">))</span>

<span class="p">(</span><span class="k">swap</span> <span class="p">(</span><span class="nv">A</span> <span class="ss">0</span><span class="p">)</span> <span class="p">(</span><span class="nv">A</span> <span class="ss">1</span><span class="p">))</span> <span class="err">→</span> <span class="p">(</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">3</span><span class="p">)</span>
<span class="ss">A</span>                  <span class="err">→</span> <span class="p">((</span><span class="nv">4</span> <span class="ss">5</span> <span class="ss">6</span><span class="p">)</span> <span class="p">(</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">3</span><span class="p">))</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">x</span> <span class="ss">1</span> <span class="o">&#39;</span><span class="ss">y</span> <span class="ss">2</span><span class="p">)</span>

<span class="p">(</span><span class="k">swap</span> <span class="ss">x</span> <span class="ss">y</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">1</span>
<span class="ss">x</span>  <span class="err">→</span> <span class="ss">2</span>
<span class="ss">y</span>  <span class="err">→</span> <span class="ss">1</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">lst</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">a</span> <span class="ss">1</span> <span class="ss">2</span> <span class="ss">3</span><span class="p">)</span> <span class="p">(</span><span class="nv">b</span> <span class="ss">10</span> <span class="ss">20</span> <span class="ss">30</span><span class="p">)))</span>
<span class="p">(</span><span class="k">swap</span> <span class="p">(</span><span class="k">lookup</span> <span class="o">&#39;</span><span class="ss">a</span> <span class="ss">lst</span> <span class="k">-</span><span class="ss">1</span><span class="p">)</span> <span class="p">(</span><span class="k">lookup</span> <span class="o">&#39;</span><span class="ss">b</span> <span class="ss">lst</span> <span class="ss">1</span><span class="p">))</span>
<span class="ss">lst</span> <span class="err">→</span> <span class="p">((</span><span class="nv">a</span> <span class="ss">1</span> <span class="ss">2</span> <span class="ss">10</span><span class="p">)</span> <span class="p">(</span><span class="nv">b</span> <span class="ss">3</span> <span class="ss">20</span> <span class="ss">30</span><span class="p">))</span>

<span class="p">(</span><span class="k">swap</span> <span class="p">(</span><span class="k">assoc</span> <span class="o">&#39;</span><span class="ss">a</span> <span class="ss">lst</span><span class="p">)</span> <span class="p">(</span><span class="k">assoc</span> <span class="o">&#39;</span><span class="ss">b</span> <span class="ss">lst</span><span class="p">))</span>
<span class="ss">lst</span> <span class="err">→</span>  <span class="p">((</span><span class="nv">b</span> <span class="ss">3</span> <span class="ss">20</span> <span class="ss">30</span><span class="p">)</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">1</span> <span class="ss">2</span> <span class="ss">10</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p>Any two places can be swept in the same or different objects.</p></div>
<div class="paragraph"><p><a id="sym"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_sym_span"><span class="big red">sym</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (sym <em>string</em> [<em>sym-context</em> <em>nil-flag</em>])<br>
<strong>syntax:</strong> (sym <em>number</em> [<em>sym-context</em> <em>nil-flag</em>])<br>
<strong>syntax:</strong> (sym <em>symbol</em> [<em>sym-context</em> <em>nil-flag</em>])</p></div>
<div class="paragraph"><p>Translates the first argument in <em>string</em>, <em>number</em>, or <em>symbol</em> into a
symbol and returns it. If the optional context is not specified in
<em>sym-context</em>, the current context is used when doing symbol lookup or
creation. Symbols will be created if they do not already exist. When the
context does not exist and the context is specified by a quoted symbol,
the symbol also gets created. If the context specification is unquoted,
the context is the specified name or the context specification is a
variable containing the context.</p></div>
<div class="paragraph"><p><span class="monospaced">sym</span> can create symbols within the symbol table that are not legal
symbols in newLISP source code (e.g., numbers or names containing
special characters such as parentheses, colons, etc.). This makes <span class="monospaced">sym</span>
usable as a function for associative memory access, much like <em>hash
table</em> access in other scripting languages.</p></div>
<div class="paragraph"><p>As a third optional argument, <span class="monospaced">nil</span> can be specified to suppress symbol
creation if the symbol is not found. In this case, <span class="monospaced">sym</span> returns <span class="monospaced">nil</span>
if the symbol looked up does not exist. Using this last form, <span class="monospaced">sym</span> can
be used to check for the existence of a symbol.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">sym</span> <span class="s">&quot;some&quot;</span><span class="p">)</span>           <span class="err">→</span> <span class="ss">some</span>
<span class="p">(</span><span class="k">set</span> <span class="p">(</span><span class="k">sym</span> <span class="s">&quot;var&quot;</span><span class="p">)</span> <span class="ss">345</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">345</span>
<span class="ss">var</span>                    <span class="err">→</span> <span class="ss">345</span>
<span class="p">(</span><span class="k">sym</span> <span class="s">&quot;aSym&quot;</span> <span class="o">&#39;</span><span class="ss">MyCTX</span><span class="p">)</span>    <span class="err">→</span> <span class="ss">MyCTX</span><span class="o">:</span><span class="ss">aSym</span>
<span class="p">(</span><span class="k">sym</span> <span class="s">&quot;aSym&quot;</span> <span class="ss">MyCTX</span><span class="p">)</span>     <span class="err">→</span> <span class="ss">MyCTX</span><span class="o">:</span><span class="ss">aSym</span>  <span class="c1">; unquoted context</span>

<span class="p">(</span><span class="k">sym</span> <span class="s">&quot;foo&quot;</span> <span class="ss">MyCTX</span> <span class="k">nil</span><span class="p">)</span>  <span class="err">→</span> <span class="k">nil</span>  <span class="c1">; &#39;foo does not exist</span>
<span class="p">(</span><span class="k">sym</span> <span class="s">&quot;foo&quot;</span> <span class="ss">MyCTX</span><span class="p">)</span>      <span class="err">→</span> <span class="ss">foo</span>  <span class="c1">; &#39;foo is created</span>
<span class="p">(</span><span class="k">sym</span> <span class="s">&quot;foo&quot;</span> <span class="ss">MyCTX</span> <span class="k">nil</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">foo</span>  <span class="c1">; foo now exists</span>
</pre></div></div></div>
<div class="paragraph"><p>Because the function <span class="monospaced">sym</span> returns the symbol looked up or created,
expressions with <span class="monospaced">sym</span> can be embedded directly in other expressions
that use symbols as arguments. The following example shows the use of
<span class="monospaced">sym</span> as a hash-like function for associative memory access, as well as
symbol configurations that are not legal newLISP symbols:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">;; using sym for simulating hash tables</span>

<span class="p">(</span><span class="k">set</span> <span class="p">(</span><span class="k">sym</span> <span class="s">&quot;John Doe&quot;</span> <span class="o">&#39;</span><span class="ss">MyDB</span><span class="p">)</span> <span class="ss">1.234</span><span class="p">)</span>
<span class="p">(</span><span class="k">set</span> <span class="p">(</span><span class="k">sym</span> <span class="s">&quot;(&quot;</span> <span class="o">&#39;</span><span class="ss">MyDB</span><span class="p">)</span> <span class="s">&quot;parenthesis open&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">set</span> <span class="p">(</span><span class="k">sym</span> <span class="ss">12</span> <span class="o">&#39;</span><span class="ss">MyDB</span><span class="p">)</span> <span class="s">&quot;twelve&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">eval</span> <span class="p">(</span><span class="k">sym</span> <span class="s">&quot;John Doe&quot;</span> <span class="o">&#39;</span><span class="ss">MyDB</span><span class="p">))</span>  <span class="err">→</span> <span class="ss">1.234</span>
<span class="p">(</span><span class="k">eval</span> <span class="p">(</span><span class="k">sym</span> <span class="s">&quot;(&quot;</span> <span class="o">&#39;</span><span class="ss">MyDB</span><span class="p">))</span>         <span class="err">→</span> <span class="s">&quot;parenthesis open&quot;</span>
<span class="p">(</span><span class="k">eval</span> <span class="p">(</span><span class="k">sym</span> <span class="ss">12</span> <span class="o">&#39;</span><span class="ss">MyDB</span><span class="p">))</span>          <span class="err">→</span> <span class="s">&quot;twelve&quot;</span>

<span class="c1">;; delete a symbol from a symbol table or hash</span>
<span class="p">(</span><span class="k">delete</span> <span class="p">(</span><span class="k">sym</span> <span class="s">&quot;John Doe&quot;</span> <span class="o">&#39;</span><span class="ss">MyDB</span><span class="p">))</span>  <span class="err">→</span> <span class="k">true</span>
</pre></div></div></div>
<div class="paragraph"><p>The last statement shows how a symbol can be eliminated using
<a href="#delete">delete</a>.</p></div>
<div class="paragraph"><p>The third syntax allows symbols to be used instead of strings for the
symbol name in the target context. In this case, <span class="monospaced">sym</span> will extract the
name from the symbol and use it as the name string for the symbol in the
target context:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">sym</span> <span class="o">&#39;</span><span class="ss">myVar</span> <span class="o">&#39;</span><span class="ss">FOO</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">FOO</span><span class="o">:</span><span class="ss">myVar</span>

<span class="p">(</span><span class="k">define-macro</span> <span class="p">(</span><span class="nv">def-context</span><span class="p">)</span>
  <span class="p">(</span><span class="k">dolist</span> <span class="p">(</span><span class="nv">s</span> <span class="p">(</span><span class="k">rest</span> <span class="p">(</span><span class="k">args</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">sym</span> <span class="ss">s</span> <span class="p">(</span><span class="k">first</span> <span class="p">(</span><span class="k">args</span><span class="p">)))))</span>

<span class="p">(</span><span class="nv">def-context</span> <span class="ss">foo</span> <span class="ss">x</span> <span class="ss">y</span> <span class="ss">z</span><span class="p">)</span>

<span class="p">(</span><span class="k">symbols</span> <span class="ss">foo</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">foo</span><span class="o">:</span><span class="ss">x</span> <span class="ss">foo</span><span class="o">:</span><span class="ss">y</span> <span class="ss">foo</span><span class="o">:</span><span class="ss">z</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The <span class="monospaced">def-context</span> macro shows how this could be used to create a macro
that creates contexts and their variables in a dynamic fashion.</p></div>
<div class="paragraph"><p>A syntax of the <a href="#context">context</a> function can also be used to
create, set and evaluate symbols.</p></div>
<div class="paragraph"><p><a id="symbol?"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_symbol_span"><span class="big red">symbol?</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (symbol? <em>exp</em>)</p></div>
<div class="paragraph"><p>Evaluates the <em>exp</em> expression and returns <span class="monospaced">true</span> if the value is a
symbol; otherwise, it returns <span class="monospaced">nil</span>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">x</span> <span class="o">&#39;</span><span class="ss">y</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">y</span>

<span class="p">(</span><span class="nv">symbol?</span> <span class="ss">x</span><span class="p">)</span>  <span class="err">→</span> <span class="k">true</span>

<span class="p">(</span><span class="nv">symbol?</span> <span class="ss">123</span><span class="p">)</span>  <span class="err">→</span> <span class="k">nil</span>

<span class="p">(</span><span class="nv">symbol?</span> <span class="p">(</span><span class="k">first</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">var</span> <span class="ss">x</span> <span class="ss">y</span> <span class="ss">z</span><span class="p">)))</span>  <span class="err">→</span> <span class="k">true</span>
</pre></div></div></div>
<div class="paragraph"><p>The first statement sets the contents of <span class="monospaced">x</span> to the symbol <span class="monospaced">y</span>. The
second statement then checks the contents of <span class="monospaced">x</span>. The last example
checks the first element of a list.</p></div>
<div class="paragraph"><p><a id="symbols"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_symbols_span"><span class="big red">symbols</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (symbols [<em>context</em>])</p></div>
<div class="paragraph"><p>Returns a sorted list of all symbols in the current context when called
without an argument. If a context symbol is specified, symbols defined
in that context are returned.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">symbols</span><span class="p">)</span>       <span class="c1">; list of all symbols in current context</span>
<span class="p">(</span><span class="k">symbols</span> <span class="o">&#39;</span><span class="ss">CTX</span><span class="p">)</span>  <span class="c1">; list of symbols in context CTX</span>
<span class="p">(</span><span class="k">symbols</span> <span class="ss">CTX</span><span class="p">)</span>   <span class="c1">; omitting the quote</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">ct</span> <span class="ss">CTX</span><span class="p">)</span>   <span class="c1">; assigning context to a variable</span>
<span class="p">(</span><span class="k">symbols</span> <span class="ss">ct</span><span class="p">)</span>    <span class="c1">; list of symbols in context CTX</span>
</pre></div></div></div>
<div class="paragraph"><p>The quote can be omitted because contexts evaluate to themselves.</p></div>
<div class="paragraph"><p><a id="sync"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_sync_span"><span class="big red">sync</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (sync <em>int-timeout</em> [<em>func-inlet</em>])<br>
<strong>syntax:</strong> (sync)</p></div>
<div class="paragraph"><p>When <em>int-timeout</em> in milliseconds is specified, <span class="monospaced">sync</span> waits for child
processes launched with <a href="#spawn">spawn</a> to finish. Whenever a child
process finishes, <span class="monospaced">sync</span> assigns the evaluation result of the spawned
subtask to the symbol specified in the spawn statement. The <span class="monospaced">sync</span>
returns <span class="monospaced">true</span> if all child processes have been processed or <span class="monospaced">nil</span> if
the timeout value has been reached and more child processes are pending.</p></div>
<div class="paragraph"><p>If <span class="monospaced">sync</span> additionally is given with an optional user-defined <em>inlet</em>
function in <em>func-inlet</em>, this function will be called with the child
process-id as argument whenever a spawned child process returns.
<em>func-inlet</em> can contain either a lambda expression or a symbol which
defines a function.</p></div>
<div class="paragraph"><p>Without any parameter, <span class="monospaced">sync</span> returns a list of pending child process
PIDs (process identifiers), for which results have not been processed
yet.</p></div>
<div class="paragraph"><p>The function <span class="monospaced">sync</span> is not available on Win32.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">; wait for 10 seconds and process finished child processes</span>
<span class="p">(</span><span class="k">sync</span> <span class="ss">10000</span><span class="p">)</span>

<span class="c1">; wait for the maximum time (~ 1193 hours)</span>
<span class="p">(</span><span class="k">sync</span> <span class="k">-</span><span class="ss">1</span><span class="p">)</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">report</span> <span class="ss">pid</span><span class="p">)</span>
    <span class="p">(</span><span class="k">println</span> <span class="s">&quot;process: &quot;</span> <span class="ss">pid</span> <span class="s">&quot; has returned&quot;</span><span class="p">))</span>

<span class="c1">; call the report function, when a child returns</span>
<span class="p">(</span><span class="k">sync</span> <span class="ss">10000</span> <span class="ss">report</span><span class="p">)</span> <span class="c1">; wait for 10 seconds max</span>

<span class="c1">; return a list of pending child processes</span>
<span class="p">(</span><span class="k">sync</span><span class="p">)</span>         <span class="err">→</span> <span class="p">(</span><span class="nv">245</span> <span class="ss">246</span> <span class="ss">247</span> <span class="ss">248</span><span class="p">)</span>

<span class="c1">; wait and do something else</span>
<span class="p">(</span><span class="k">until</span> <span class="p">(</span><span class="k">true</span><span class="ss">?</span> <span class="p">(</span><span class="k">sync</span> <span class="ss">10</span> <span class="ss">report</span><span class="p">)</span> <span class="p">)</span>
    <span class="p">(</span><span class="k">println</span> <span class="p">(</span><span class="k">time-of-day</span><span class="p">)))</span>
</pre></div></div></div>
<div class="paragraph"><p>When <span class="monospaced">sync</span> is given with a timeout parameter, it will block until
timeout or until all child processes have returned, whichever comes
earlier. When no parameter is specified or a function is specified,
<span class="monospaced">sync</span> returns immediately.</p></div>
<div class="paragraph"><p>The function <span class="monospaced">sync</span> is part of the Cilk API for synchronizing child
processes and process parallelization. See the reference for the
function <a href="#spawn">spawn</a> for a full discussion of the Cilk API.</p></div>
<div class="paragraph"><p><a id="sys-error"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_sys_error_span"><span class="big red">sys-error</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (sys-error)<br>
<strong>syntax:</strong> (sys-error <em>int-error</em>)<br>
<strong>syntax:</strong> (sys-error <span class="monospaced">0</span>)</p></div>
<div class="paragraph"><p>Reports the last error generated by the underlying OS which newLISP is
running on. The error reported may differ on the platforms newLISP has
been compiled for. Consult the platform&#8217;s C library information. The
error is reported as a list of error number and error text.</p></div>
<div class="paragraph"><p>If no error has occurred or the system error number has been reset,
<span class="monospaced">nil</span> is returned.</p></div>
<div class="paragraph"><p>When <em>int-error</em> is greater <span class="monospaced">0</span> (zero) a list of the number and the
error text is returned.</p></div>
<div class="paragraph"><p>To reset the error specify <span class="monospaced">0</span> as the error number.</p></div>
<div class="paragraph"><p>Whenever a function in newLISP within the system resources area returns
<span class="monospaced">nil</span>, <span class="monospaced">sys-error</span> can be checked for the underlying reason. For file
operations, <span class="monospaced">sys-error</span> may be set for nonexistent files or wrong
permissions when accessing the resource. Another cause of error could be
the exhaustion of certain system resources like file handles or
semaphores.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">;; trying to open a nonexistent file</span>
<span class="p">(</span><span class="k">open</span> <span class="s">&quot;xyz&quot;</span> <span class="s">&quot;r&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="k">nil</span>

<span class="p">(</span><span class="k">sys-error</span><span class="p">)</span>       <span class="err">→</span> <span class="p">(</span><span class="nv">2</span> <span class="s">&quot;No such file or directory&quot;</span><span class="p">)</span>

<span class="c1">;; reset errno</span>
<span class="p">(</span><span class="k">sys-error</span> <span class="ss">0</span><span class="p">)</span>     <span class="err">→</span> <span class="p">(</span><span class="nv">0</span> <span class="s">&quot;Unknown error: 0&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">sys-error</span><span class="p">)</span>       <span class="err">→</span> <span class="k">nil</span>
</pre></div></div></div>
<div class="paragraph"><p>See also <a href="#last-error">last-error</a> and <a href="#net-error">net-error</a>.</p></div>
<div class="paragraph"><p><a id="sys-info"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_sys_info_span"><span class="big red">sys-info</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (sys-info [<em>int-idx</em>])</p></div>
<div class="paragraph"><p>Calling <span class="monospaced">sys-info</span> without <em>int-idx</em> returns a list of internal resource
statistics. Ten integers report the following status:</p></div>
<table class="tableblock frame-all grid-all"
style="
width:50%;
">
<col style="width:10%;">
<col style="width:90%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" >offset </th>
<th class="tableblock halign-left valign-top" >description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Number of Lisp cells</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Maximum number of Lisp cells constant</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Number of symbols</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Evaluation/recursion level</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Environment stack level</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Maximum call stack constant</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Pid of the parent process or 0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Pid of running newLISP process</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Version number as an integer constant</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Operating system constant:<br>
 linux=1, bsd=2, osx=3, solaris=4, win32=6, os/2=7, cygwin=8,
tru64unix=9, aix=10 <br>
 bit 11 will be set for ffilib (extended import/callback API) versions
(add 1024)<br>
 bit 10 will be set for IPv6 versions (add 512)<br>
 bit 9 will be set for 64-bit (changeable at runtime) versions (add
256)<br>
 bit 8 will be set for UTF-8 versions (add 128)<br>
 bit 7 will be added for library versions (add 64)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>The numbers from <span class="monospaced">0</span> to <span class="monospaced">9</span> indicate the optional offset in the returned
list.</p></div>
<div class="paragraph"><p>It is recommended to use offsets 0 to 5 to address up and including
"Maximum call stack constant" and to use negative offsets -1 to -4 to
access the last four entries in the system info list. Future new entries
will be inserted after offset 5. This way older source code does not
need to change.</p></div>
<div class="paragraph"><p>When using <em>int-idx</em>, one element of the list will be returned.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">sys-info</span><span class="p">)</span>     <span class="err">→</span> <span class="p">(</span><span class="nv">401</span> <span class="ss">268435456</span> <span class="ss">376</span> <span class="ss">1</span> <span class="ss">0</span> <span class="ss">2048</span> <span class="ss">39220</span> <span class="ss">10002</span> <span class="ss">131</span><span class="p">)</span>
<span class="p">(</span><span class="k">sys-info</span> <span class="ss">3</span><span class="p">)</span>   <span class="err">→</span> <span class="ss">1</span>
<span class="p">(</span><span class="k">sys-info</span> <span class="k">-</span><span class="ss">2</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">10002</span>
</pre></div></div></div>
<div class="paragraph"><p>The number for the maximum of Lisp cells can be changed via the <span class="monospaced">-m</span>
command-line switch. For each megabyte of Lisp cell memory, 64k memory
cells can be allocated. The maximum call stack depth can be changed
using the <span class="monospaced">-s</span> command-line switch.</p></div>
<div class="paragraph"><p><a id="t-test"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_t_test_span"><span class="big red">t-test</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (t-test <em>list-vector-A</em> <em>list-vecor-B</em> [<span class="monospaced">true</span>])</p></div>
<div class="paragraph"><p>The functions performs a t-test using the <em>Student&#8217;s t</em> statistic for
comparing the means values in <em>list-vector-A</em> and <em>list-vecor-B</em>. If the
<span class="monospaced">true</span> flag is not used, both vectors in A and B can be of different
length and groups represented by A and B are not related.</p></div>
<div class="paragraph"><p>When the optional flag is set to <span class="monospaced">true</span>, measurements were taken from
the same group twice, e.g. before and after a procedure.</p></div>
<div class="paragraph"><p>The following results are returned in a list:</p></div>
<table class="tableblock frame-all grid-all"
style="
width:35%;
">
<col style="width:20%;">
<col style="width:80%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" >name     </th>
<th class="tableblock halign-left valign-top" >description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">mean-a</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Mean of group A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">mean-b</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Mean of group B</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">sdev-a</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Standard deviation in group A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">sdev-b</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Standard deviation in group B</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">t</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">t between mean values</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">df</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Degress of freedom</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">p</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Two tailed probablity of t under the null hypothesis</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>The first example studies the effect of different sleep length before a
test on the SCAT (Sam&#8217;s Cognitive Ability Test):</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">; SCAT (Sam&#39;s Cognitive Ability Test)</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">hours-sleep-8</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">5</span> <span class="ss">7</span> <span class="ss">5</span> <span class="ss">3</span> <span class="ss">5</span> <span class="ss">3</span> <span class="ss">3</span> <span class="ss">9</span><span class="p">))</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">hours-sleep-4</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">8</span> <span class="ss">1</span> <span class="ss">4</span> <span class="ss">6</span> <span class="ss">6</span> <span class="ss">4</span> <span class="ss">1</span> <span class="ss">2</span><span class="p">))</span>

<span class="p">(</span><span class="nv">t-test</span> <span class="ss">hours-sleep-8</span> <span class="ss">hours-sleep-4</span><span class="p">)</span>
 <span class="err">→</span> <span class="p">(</span><span class="nv">5</span> <span class="ss">4</span> <span class="ss">2.138</span> <span class="ss">2.563</span> <span class="ss">0.847</span> <span class="ss">14</span> <span class="ss">0.411</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The duration of sleeps before the SCAT does not have a significant
impact with a probability value of <span class="monospaced">0.411</span>.</p></div>
<div class="paragraph"><p>In the second example, the same group of people get tested twice, before
and after a treatment with Prosac depression medication:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">; Effect of Prozac on a group of depressed people</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">mood-pre</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">3</span> <span class="ss">0</span> <span class="ss">6</span> <span class="ss">7</span> <span class="ss">4</span> <span class="ss">3</span> <span class="ss">2</span> <span class="ss">1</span> <span class="ss">4</span><span class="p">))</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">mood-post</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">5</span> <span class="ss">1</span> <span class="ss">5</span> <span class="ss">7</span> <span class="ss">10</span> <span class="ss">9</span> <span class="ss">7</span> <span class="ss">11</span> <span class="ss">8</span><span class="p">))</span>

<span class="p">(</span><span class="nv">t-test</span> <span class="ss">mood-pre</span> <span class="ss">mood-post</span> <span class="k">true</span><span class="p">)</span>
 <span class="err">→</span> <span class="p">(</span><span class="nv">3.333</span> <span class="ss">7</span> <span class="ss">2.236</span> <span class="ss">3.041</span> <span class="k">-</span><span class="ss">3.143</span> <span class="ss">8</span> <span class="ss">0.0137</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The effect of the Prosac treatment is moderately significant with a <span class="monospaced">p</span>
of <span class="monospaced">0.0137</span>.</p></div>
<div class="paragraph"><p><a id="tan"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_tan_span"><span class="big red">tan</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (tan <em>num-radians</em>)</p></div>
<div class="paragraph"><p>Calculates the tangent function from <em>num-radians</em> and returns the
result.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">tan</span> <span class="ss">1</span><span class="p">)</span>                     <span class="err">→</span> <span class="ss">1.557407725</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">pi</span> <span class="p">(</span><span class="k">mul</span> <span class="ss">2</span> <span class="p">(</span><span class="k">asin</span> <span class="ss">1</span><span class="p">)))</span>  <span class="err">→</span> <span class="ss">3.141592654</span>
<span class="p">(</span><span class="k">tan</span> <span class="p">(</span><span class="k">div</span> <span class="ss">pi</span> <span class="ss">4</span><span class="p">))</span>            <span class="err">→</span> <span class="ss">1</span>
</pre></div></div></div>
<div class="paragraph"><p><a id="tanh"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_tanh_span"><span class="big red">tanh</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (tanh <em>num-radians</em>)</p></div>
<div class="paragraph"><p>Calculates the hyperbolic tangent of <em>num-radians</em>. The hyperbolic
tangent is defined mathematically as: <em>sinh (x) / cosh (x)</em>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">tanh</span> <span class="ss">1</span><span class="p">)</span>     <span class="err">→</span> <span class="ss">0.761594156</span>
<span class="p">(</span><span class="k">tanh</span> <span class="ss">10</span><span class="p">)</span>    <span class="err">→</span> <span class="ss">0.9999999959</span>
<span class="p">(</span><span class="k">tanh</span> <span class="ss">1000</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">1</span>
<span class="p">(</span><span class="nv">=</span> <span class="p">(</span><span class="k">tanh</span> <span class="ss">1</span><span class="p">)</span> <span class="p">(</span><span class="k">div</span> <span class="p">(</span><span class="k">sinh</span> <span class="ss">1</span><span class="p">)</span> <span class="p">(</span><span class="k">cosh</span> <span class="ss">1</span><span class="p">)))</span>  <span class="err">→</span> <span class="k">true</span>
</pre></div></div></div>
<div class="paragraph"><p><a id="term"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_term_span"><span class="big red">term</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (term <em>symbol</em>)</p></div>
<div class="paragraph"><p>Returns as a string, the term part of a <em>symbol</em> without the context
prefix.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">ACTX</span><span class="o">:</span><span class="ss">var</span> <span class="ss">123</span><span class="p">)</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">sm</span> <span class="o">&#39;</span><span class="ss">ACTX</span><span class="o">:</span><span class="ss">var</span><span class="p">)</span>
<span class="p">(</span><span class="k">string</span> <span class="ss">sm</span><span class="p">)</span>     <span class="err">→</span> <span class="s">&quot;ACTX:var&quot;</span>
<span class="p">(</span><span class="k">term</span> <span class="ss">sm</span><span class="p">)</span>      <span class="err">→</span> <span class="s">&quot;var&quot;</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">s</span> <span class="o">&#39;</span><span class="ss">foo</span><span class="o">:</span><span class="ss">bar</span><span class="p">)</span>
<span class="p">(</span><span class="nv">=</span> <span class="ss">s</span> <span class="p">(</span><span class="k">sym</span> <span class="p">(</span><span class="k">term</span> <span class="ss">s</span><span class="p">)</span> <span class="p">(</span><span class="k">prefix</span> <span class="ss">s</span><span class="p">)))</span>
</pre></div></div></div>
<div class="paragraph"><p>See also <a href="#prefix">prefix</a> to extract the namespace or context prefix
from a symbol.</p></div>
<div class="paragraph"><p><a id="throw"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_throw_span"><span class="big red">throw</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (throw <em>exp</em>)</p></div>
<div class="paragraph"><p>Works together with the <a href="#catch">catch</a> function. <span class="monospaced">throw</span> forces the
return of a previous <span class="monospaced">catch</span> statement and puts the <em>exp</em> into the
result symbol of <span class="monospaced">catch</span>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="k">throw-</span><span class="ss">test</span><span class="p">)</span>
    <span class="p">(</span><span class="k">dotimes</span> <span class="p">(</span><span class="nv">x</span> <span class="ss">1000</span><span class="p">)</span>
        <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">=</span> <span class="ss">x</span> <span class="ss">500</span><span class="p">)</span> <span class="p">(</span><span class="k">throw</span> <span class="s">&quot;interrupted&quot;</span><span class="p">))))</span>

<span class="p">(</span><span class="k">catch</span> <span class="p">(</span><span class="k">throw-</span><span class="ss">test</span><span class="p">)</span> <span class="o">&#39;</span><span class="ss">result</span><span class="p">)</span>  <span class="err">→</span> <span class="k">true</span>

<span class="ss">result</span>  <span class="err">→</span> <span class="s">&quot;interrupted&quot;</span>

<span class="p">(</span><span class="k">catch</span> <span class="p">(</span><span class="k">throw-</span><span class="ss">test</span><span class="p">))</span>  <span class="err">→</span> <span class="s">&quot;interrupted&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>The last example shows a shorter form of <a href="#catch">catch</a>, which
returns the <span class="monospaced">throw</span> result directly.</p></div>
<div class="paragraph"><p><span class="monospaced">throw</span> is useful for breaking out of a loop or for early return from
user-defined functions or expression blocks. In the following example,
the <span class="monospaced">begin</span> block will return <span class="monospaced">X</span> if <span class="monospaced">(foo X)</span> is <span class="monospaced">true</span>; else <span class="monospaced">Y</span> will
be returned:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">catch</span> <span class="p">(</span><span class="k">begin</span>
    <span class="err">…</span>
    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">foo</span> <span class="ss">X</span><span class="p">)</span> <span class="p">(</span><span class="k">throw</span> <span class="ss">X</span><span class="p">)</span> <span class="ss">Y</span><span class="p">)</span>
    <span class="err">…</span>
<span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p><span class="monospaced">throw</span> will <em>not</em> cause an error exception. Use
<a href="#throw-error">throw-error</a> to throw user error exceptions.</p></div>
<div class="paragraph"><p><a id="throw-error"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_throw_error_span"><span class="big red">throw-error</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (throw-error <em>exp</em>)</p></div>
<div class="paragraph"><p>Causes a user-defined error exception with text provided by evaluating
<em>exp</em>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">foo</span> <span class="ss">x</span> <span class="ss">y</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">=</span> <span class="ss">x</span> <span class="ss">0</span><span class="p">)</span> <span class="p">(</span><span class="k">throw-error</span> <span class="s">&quot;first argument cannot be 0&quot;</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">+</span> <span class="ss">x</span> <span class="ss">y</span><span class="p">))</span>

<span class="p">(</span><span class="nv">foo</span> <span class="ss">1</span> <span class="ss">2</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">3</span>

<span class="p">(</span><span class="nv">foo</span> <span class="ss">0</span> <span class="ss">2</span><span class="p">)</span>  <span class="c1">; causes a user error exception</span>
<span class="ss">ERR</span><span class="o">:</span> <span class="ss">user</span> <span class="ss">error</span> <span class="o">:</span> <span class="k">first</span> <span class="ss">argument</span> <span class="ss">cannot</span> <span class="ss">be</span> <span class="ss">0</span>
<span class="ss">called</span> <span class="ss">from</span> <span class="ss">user-defined</span> <span class="ss">function</span> <span class="ss">foo</span>
</pre></div></div></div>
<div class="paragraph"><p>The user error can be handled like any other error exception using
user-defined error handlers and the <a href="#error-event">error-event</a>
function, or the form of <a href="#catch">catch</a> that can capture error
exceptions.</p></div>
<div class="paragraph"><p><a id="time"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_time_span"><span class="big red">time</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (time <em>exp</em> [<em>int-count</em>)</p></div>
<div class="paragraph"><p>Evaluates the expression in <em>exp</em> and returns the time spent on
evaluation in floating point milliseconds. Depending on the platform
decimals of milliseconds are shown or not shown.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">time</span> <span class="p">(</span><span class="nv">myprog</span> <span class="ss">x</span> <span class="ss">y</span> <span class="ss">z</span><span class="p">))</span>  <span class="err">→</span> <span class="ss">450.340</span>

<span class="p">(</span><span class="k">time</span> <span class="p">(</span><span class="nv">myprog</span> <span class="ss">x</span> <span class="ss">y</span> <span class="ss">z</span><span class="p">)</span> <span class="ss">10</span><span class="p">)</span>  <span class="err">→</span> <span class="ss">4420.021</span>
</pre></div></div></div>
<div class="paragraph"><p>In first the example, 450 milliseconds elapsed while evaluating
<span class="monospaced">(myprog x y z)</span>. The second example returns the time for ten
evaluations of <span class="monospaced">(myprog x y z)</span>. See also <a href="#date">date</a>,
<a href="#date-value">date-value</a>, <a href="#time-of-day">time-of-day</a>, and
<a href="#now">now</a>.</p></div>
<div class="paragraph"><p><a id="time-of-day"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_time_of_day_span"><span class="big red">time-of-day</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (time-of-day)</p></div>
<div class="paragraph"><p>Returns the time in milliseconds since the start of the current day.</p></div>
<div class="paragraph"><p>See also the <a href="#date">date</a>, <a href="#date-value">date-value</a>,
<a href="#time">time</a>, and <a href="#now">now</a> functions.</p></div>
<div class="paragraph"><p><a id="timer"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_timer_span"><span class="big red">timer</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (timer <em>sym-event-handler | func-event-handler</em> <em>num-seconds</em> [<em>int-option</em>])<br>
<strong>syntax:</strong> (timer <em>sym-event-handler | func-event-handler</em>)<br>
<strong>syntax:</strong> (timer)</p></div>
<div class="paragraph"><p>Starts a one-shot timer firing off the Unix signal <span class="monospaced">SIGALRM</span>,
<span class="monospaced">SIGVTALRM</span>, or <span class="monospaced">SIGPROF</span> after the time in seconds (specified in
<em>num-seconds</em>) has elapsed. When the timer fires, it calls the
user-defined function in <em>sym-</em> or <em>func-event-handler</em>.</p></div>
<div class="paragraph"><p>On Linux/Unix, an optional <span class="monospaced">0</span>, <span class="monospaced">1</span>, or <span class="monospaced">2</span> can be specified to control
how the timer counts. With default option <span class="monospaced">0</span>, real time is measured.
Option <span class="monospaced">1</span> measures the time the CPU spends processing in the process
owning the timer. Option <span class="monospaced">2</span> is a combination of both called <em>profiling
time</em>. See the Unix man page <span class="monospaced">setitimer()</span> for details.</p></div>
<div class="paragraph"><p>The event handler can start the timer again to achieve a continuous flow
of events. Starting with version 8.5.9, seconds can be defined as
floating point numbers with a fractional part (e.g., <span class="monospaced">0.25</span> for 250
milliseconds).</p></div>
<div class="paragraph"><p>Defining <span class="monospaced">0</span> (zero) as time shuts the running timer down and prevents it
from firing.</p></div>
<div class="paragraph"><p>When called with <em>sym-</em> or <em>func-event-handler</em>, <span class="monospaced">timer</span> returns the
elapsed time of the timer in progress. This can be used to program time
lines or schedules.</p></div>
<div class="paragraph"><p><span class="monospaced">timer</span> called without arguments returns the symbol of the current event
handler.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">ticker</span><span class="p">)</span>
    <span class="p">(</span><span class="k">println</span> <span class="p">(</span><span class="k">date</span><span class="p">))</span> <span class="p">(</span><span class="k">timer</span> <span class="o">&#39;</span><span class="ss">ticker</span> <span class="ss">1.0</span><span class="p">))</span>

<span class="ss">&gt;</span> <span class="p">(</span><span class="nv">ticker</span><span class="p">)</span>
<span class="ss">Tue</span> <span class="ss">Apr</span> <span class="ss">12</span> <span class="ss">20</span><span class="o">:</span><span class="ss">44</span><span class="o">:</span><span class="ss">48</span> <span class="ss">2005</span> <span class="c1">; first execution of ticker</span>
<span class="err">→</span> <span class="ss">ticker</span>                <span class="c1">; return value from ticker</span>

<span class="ss">&gt;</span> <span class="ss">Tue</span> <span class="ss">Apr</span> <span class="ss">12</span> <span class="ss">20</span><span class="o">:</span><span class="ss">44</span><span class="o">:</span><span class="ss">49</span> <span class="ss">2005</span>    <span class="c1">; first timer event</span>
<span class="ss">Tue</span> <span class="ss">Apr</span> <span class="ss">12</span> <span class="ss">20</span><span class="o">:</span><span class="ss">44</span><span class="o">:</span><span class="ss">50</span> <span class="ss">2005</span> <span class="c1">; second timer event ...</span>
<span class="ss">Tue</span> <span class="ss">Apr</span> <span class="ss">12</span> <span class="ss">20</span><span class="o">:</span><span class="ss">44</span><span class="o">:</span><span class="ss">51</span> <span class="ss">2005</span>
<span class="ss">Tue</span> <span class="ss">Apr</span> <span class="ss">12</span> <span class="ss">20</span><span class="o">:</span><span class="ss">44</span><span class="o">:</span><span class="ss">52</span> <span class="ss">2005</span>
</pre></div></div></div>
<div class="paragraph"><p>The example shows an event handler, <span class="monospaced">ticker</span>, which starts the timer
again after each event.</p></div>
<div class="paragraph"><p>Note that a timer cannot interrupt an ongoing built-in function. The
timer interrupt gets registered by newLISP, but a timer handler cannot
run until one expression is evaluated and the next one starts. To
interrupt an ongoing I/O operation with <span class="monospaced">timer</span>, use the following
pattern, which calls <a href="#net-select">net-select</a> to test if a socket is
ready for reading:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="k">define</span> <span class="p">(</span><span class="nv">interrupt</span><span class="p">)</span>
    <span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">timeout</span> <span class="k">true</span><span class="p">))</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">listen</span> <span class="p">(</span><span class="k">net-listen</span> <span class="ss">30001</span><span class="p">))</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">socket</span> <span class="p">(</span><span class="k">net-accept</span> <span class="ss">listen</span><span class="p">))</span>

<span class="p">(</span><span class="k">timer</span> <span class="o">&#39;</span><span class="ss">interrupt</span> <span class="ss">10</span><span class="p">)</span>
<span class="c1">;; or specifying the function directly</span>
<span class="p">(</span><span class="k">timer</span> <span class="p">(</span><span class="k">fn</span> <span class="p">()</span> <span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">timeout</span> <span class="k">true</span><span class="p">))</span> <span class="ss">10</span><span class="p">)</span>

<span class="p">(</span><span class="k">until</span> <span class="p">(</span><span class="k">or</span> <span class="ss">timeout</span> <span class="ss">done</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="k">net-select</span> <span class="ss">socket</span> <span class="s">&quot;read&quot;</span> <span class="ss">100000</span><span class="p">)</span>
        <span class="p">(</span><span class="k">begin</span>
            <span class="p">(</span><span class="k">net-receive</span> <span class="ss">socket</span> <span class="ss">buffer</span> <span class="ss">1024</span><span class="p">)</span>
            <span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">done</span> <span class="k">true</span><span class="p">)))</span>
<span class="p">)</span>

<span class="p">(</span><span class="k">if</span> <span class="ss">timeout</span>
    <span class="p">(</span><span class="k">println</span> <span class="s">&quot;timeout&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="k">println</span> <span class="ss">buffer</span><span class="p">))</span>

<span class="p">(</span><span class="k">exit</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>In this example, the <span class="monospaced">until</span> loop will run until something can be read
from <span class="monospaced">socket</span>, or until ten seconds have passed and the <span class="monospaced">timeout</span>
variable is set.</p></div>
<div class="paragraph"><p><a id="title-case"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_title_case_a_href_utf8_capable_utf8_a_span"><span class="big red">title-case <a href="#utf8_capable">utf8</a></span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (title-case <em>str</em> <em>[bool]</em>)</p></div>
<div class="paragraph"><p>Returns a copy of the string in <em>str</em> with the first character converted
to uppercase. When the optional <em>bool</em> parameter evaluates to any value
other than <span class="monospaced">nil</span>, the rest of the string is converted to lowercase.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">title-case</span> <span class="s">&quot;hello&quot;</span><span class="p">)</span>       <span class="err">→</span> <span class="s">&quot;Hello&quot;</span>
<span class="p">(</span><span class="k">title-case</span> <span class="s">&quot;hELLO&quot;</span> <span class="k">true</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;Hello&quot;</span>
<span class="p">(</span><span class="k">title-case</span> <span class="s">&quot;hELLO&quot;</span><span class="p">)</span>       <span class="err">→</span> <span class="s">&quot;HELLO&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>See also the <a href="#lower-case">lower-case</a> and
<a href="#upper-case">upper-case</a> functions.</p></div>
<div class="paragraph"><p><a id="trace"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_trace_span"><span class="big red">trace</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (trace [<em>bool</em>])</p></div>
<div class="paragraph"><p>Tracing is switched on when <em>bool</em> evaluates to anything other than
<span class="monospaced">nil</span>. When no argument is supplied, <span class="monospaced">trace</span> evaluates to <span class="monospaced">true</span> or
<span class="monospaced">nil</span> depending on the current trace mode. If trace mode is switched on,
newLISP goes into debugging mode after entering the next user defined
function, displaying the function and highlighting the current
expression upon entry and exit.</p></div>
<div class="paragraph"><p>Highlighting is done by bracketing the expression between two # (number
sign) characters. This can be changed to a different character using
<a href="#trace-highlight">trace-highlight</a>. Upon exit from the expression,
the result of its evaluation is also reported.</p></div>
<div class="paragraph"><p>If an expression occurs more than once in a function, the first
occurrence of the executing function will always be highlighted
(bracketed).</p></div>
<div class="paragraph"><p>newLISP execution stops with a prompt line at each entry and exit of an
expression.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nv">[-&gt; 2]</span> <span class="ss">s|tep</span> <span class="ss">n|ext</span> <span class="ss">c|ont</span> <span class="ss">q|uit</span> <span class="ss">&gt;</span>
</pre></div></div></div>
<div class="paragraph"><p>At the prompt, an <span class="monospaced">s</span>, <span class="monospaced">n</span>, <span class="monospaced">c</span>, or <span class="monospaced">q</span> can be entered to step into or
merely execute the next expression. Any expression can be entered at the
prompt for evaluation. Entering the name of a variable, for example,
would evaluate to its contents. In this way, a variable&#8217;s contents can
be checked during debugging or set to different values.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">;; switches newLISP into debugging mode</span>
<span class="p">(</span><span class="k">trace</span> <span class="k">true</span><span class="p">)</span>  <span class="err">→</span> <span class="k">true</span>

<span class="c1">;; the debugger will show each step</span>
<span class="p">(</span><span class="nv">my-func</span> <span class="ss">a</span> <span class="ss">b</span> <span class="ss">c</span><span class="p">)</span>

<span class="c1">;; switched newLISP out of debugging mode</span>
<span class="p">(</span><span class="k">trace</span> <span class="k">nil</span><span class="p">)</span>  <span class="err">→</span> <span class="k">nil</span>
</pre></div></div></div>
<div class="paragraph"><p>To set break points where newLISP should interrupt normal execution and
go into debugging mode, put <span class="monospaced">(trace true)</span> statements into the newLISP
code where execution should switch on the debugger.</p></div>
<div class="paragraph"><p>Use the <a href="#debug">debug</a> function as a shortcut for the above example.</p></div>
<div class="paragraph"><p><a id="trace-highlight"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_trace_highlight_span"><span class="big red">trace-highlight</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (trace-highlight <em>str-pre</em> <em>str-post</em> [<em>str-header</em> <em>str-footer</em>])</p></div>
<div class="paragraph"><p>Sets the characters or string of characters used to enclose expressions
during <a href="#trace">trace</a>. By default, the # (number sign) is used to
enclose the expression highlighted in <a href="#trace">trace</a> mode. This can
be changed to different characters or strings of up to seven characters.
If the console window accepts terminal control characters, this can be
used to display the expression in a different color, bold, reverse, and
so forth.</p></div>
<div class="paragraph"><p>Two more strings can optionally be specified for <em>str-header and
str-footer</em>, which control the separator and prompt. A maximum of 15
characters is allowed for the header and 31 for the footer.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">;; active expressions are enclosed in &gt;&gt; and &lt;&lt;</span>

<span class="p">(</span><span class="k">trace-highlight</span> <span class="s">&quot;&gt;&gt;&quot;</span> <span class="s">&quot;&lt;&lt;&quot;</span><span class="p">)</span>

<span class="c1">;; &#39;bright&#39; color on a VT100 or similar terminal window</span>

<span class="p">(</span><span class="k">trace-highlight</span> <span class="s">&quot;\027[1m&quot;</span> <span class="s">&quot;\027[0m&quot;</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The first example replaces the default <span class="monospaced">#</span> (number sign) with a <span class="monospaced">&gt;&gt;</span> and
<span class="monospaced">&lt;&lt;</span>. The second example works on most Linux shells. It may not,
however, work in console windows under Win32 or CYGWIN, depending on the
configuration of the terminal.</p></div>
<div class="paragraph"><p><a id="transpose"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_transpose_span"><span class="big red">transpose</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (transpose <em>matrix</em>)</p></div>
<div class="paragraph"><p>Transposes a <em>matrix</em> by reversing the rows and columns. Any kind of
list-matrix can be transposed. Matrices are made rectangular by filling
in <span class="monospaced">nil</span> for missing elements, omitting elements where appropriate, or
expanding atoms in rows into lists. Matrix dimensions are calculated
using the number of rows in the original matrix for columns and the
number of elements in the first row as number of rows for the transposed
matrix.</p></div>
<div class="paragraph"><p>The matrix to transpose can contain any data-type.</p></div>
<div class="paragraph"><p>The dimensions of a matrix are defined by the number of rows and the
number of elements in the first row. A matrix can either be a nested
list or an <a href="#array">array</a>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">A</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">3</span><span class="p">)</span> <span class="p">(</span><span class="nv">4</span> <span class="ss">5</span> <span class="ss">6</span><span class="p">)))</span>
<span class="p">(</span><span class="k">transpose</span> <span class="ss">A</span><span class="p">)</span>                      <span class="err">→</span> <span class="p">((</span><span class="nv">1</span> <span class="ss">4</span><span class="p">)</span> <span class="p">(</span><span class="nv">2</span> <span class="ss">5</span><span class="p">)</span> <span class="p">(</span><span class="nv">3</span> <span class="ss">6</span><span class="p">))</span>
<span class="p">(</span><span class="k">transpose</span> <span class="p">(</span><span class="k">list</span> <span class="p">(</span><span class="k">sequence</span> <span class="ss">1</span> <span class="ss">5</span><span class="p">)))</span>  <span class="err">→</span> <span class="p">((</span><span class="nv">1</span><span class="p">)</span> <span class="p">(</span><span class="nv">2</span><span class="p">)</span> <span class="p">(</span><span class="nv">3</span><span class="p">)</span> <span class="p">(</span><span class="nv">4</span><span class="p">)</span> <span class="p">(</span><span class="nv">5</span><span class="p">))</span>

<span class="c1">; any data type is allowed in the matrix</span>
<span class="p">(</span><span class="k">transpose</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">a</span> <span class="ss">b</span><span class="p">)</span> <span class="p">(</span><span class="nv">c</span> <span class="ss">d</span><span class="p">)</span> <span class="p">(</span><span class="nv">e</span> <span class="ss">f</span><span class="p">)))</span>   <span class="err">→</span> <span class="p">((</span><span class="nv">a</span> <span class="ss">c</span> <span class="ss">e</span><span class="p">)</span> <span class="p">(</span><span class="nv">b</span> <span class="ss">d</span> <span class="ss">f</span><span class="p">))</span>

<span class="c1">; arrays can be transposed too</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">A</span> <span class="p">(</span><span class="k">array</span> <span class="ss">2</span> <span class="ss">3</span> <span class="p">(</span><span class="k">sequence</span> <span class="ss">1</span> <span class="ss">6</span><span class="p">)))</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">M</span> <span class="p">(</span><span class="k">transpose</span> <span class="ss">A</span><span class="p">))</span>
<span class="ss">M</span> <span class="err">→</span> <span class="p">((</span><span class="nv">1</span> <span class="ss">4</span><span class="p">)</span> <span class="p">(</span><span class="nv">2</span> <span class="ss">5</span><span class="p">)</span> <span class="p">(</span><span class="nv">3</span> <span class="ss">6</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p>The number of columns in a matrix is defined by the number of elements
in the first row of the matrix. If other rows have fewer elements,
<span class="monospaced">transpose</span> will assume <span class="monospaced">nil</span> for those missing elements. Superfluous
elements in a row will be ignored.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">A</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">3</span><span class="p">)</span> <span class="p">(</span><span class="nv">4</span> <span class="ss">5</span><span class="p">)</span> <span class="p">(</span><span class="nv">7</span> <span class="ss">8</span> <span class="ss">9</span><span class="p">)))</span>

<span class="p">(</span><span class="k">transpose</span> <span class="ss">A</span><span class="p">)</span>  <span class="err">→</span> <span class="p">((</span><span class="nv">1</span> <span class="ss">4</span> <span class="ss">7</span><span class="p">)</span> <span class="p">(</span><span class="nv">2</span> <span class="ss">5</span> <span class="ss">8</span><span class="p">)</span> <span class="p">(</span><span class="nv">3</span> <span class="k">nil</span> <span class="ss">9</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p>If a row is any other data type besides a list, the transposition treats
it like an entire row of elements of that data type:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">A</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">1</span> <span class="ss">2</span> <span class="ss">3</span><span class="p">)</span> <span class="ss">X</span> <span class="p">(</span><span class="nv">7</span> <span class="ss">8</span> <span class="ss">9</span><span class="p">)))</span>

<span class="p">(</span><span class="k">transpose</span> <span class="ss">A</span><span class="p">)</span>  <span class="err">→</span> <span class="p">((</span><span class="nv">1</span> <span class="ss">X</span> <span class="ss">7</span><span class="p">)</span> <span class="p">(</span><span class="nv">2</span> <span class="ss">X</span> <span class="ss">8</span><span class="p">)</span> <span class="p">(</span><span class="nv">3</span> <span class="ss">X</span> <span class="ss">9</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p>All operations shown here on lists can also be performed on arrays.</p></div>
<div class="paragraph"><p>See also the matrix operations <a href="#det">det</a>, <a href="#invert">invert</a>,
<a href="#mat">mat</a> and <a href="#multiply">multiply</a>.</p></div>
<div class="paragraph"><p><a id="trim"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_trim_a_href_utf8_capable_utf8_a_span"><span class="big red">trim <a href="#utf8_capable">utf8</a></span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (trim <em>str</em> [<em>str-char</em>])<br>
<strong>syntax:</strong> (trim <em>str</em> <em>str-left-char</em> <em>str-right-char</em>)</p></div>
<div class="paragraph"><p>The first syntax trims the string <em>str</em> from both sides, stripping the
leading and trailing characters as given in <em>str-char</em>. If <em>str-char</em>
contains no character, the space character is assumed. <span class="monospaced">trim</span> returns
the new string.</p></div>
<div class="paragraph"><p>The second syntax can either trim different characters from both sides
or trim only one side if an empty string is specified for the other.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">trim</span> <span class="s">&quot;   hello  &quot;</span><span class="p">)</span>              <span class="err">→</span> <span class="s">&quot;hello&quot;</span>
<span class="p">(</span><span class="k">trim</span> <span class="s">&quot;----hello-----&quot;</span> <span class="s">&quot;-&quot;</span><span class="p">)</span>      <span class="err">→</span> <span class="s">&quot;hello&quot;</span>
<span class="p">(</span><span class="k">trim</span> <span class="s">&quot;00012340&quot;</span> <span class="s">&quot;0&quot;</span> <span class="s">&quot;&quot;</span><span class="p">)</span>         <span class="err">→</span> <span class="s">&quot;12340&quot;</span>
<span class="p">(</span><span class="k">trim</span> <span class="s">&quot;1234000&quot;</span> <span class="s">&quot;&quot;</span> <span class="s">&quot;0&quot;</span><span class="p">)</span>          <span class="err">→</span> <span class="s">&quot;1234&quot;</span>
<span class="p">(</span><span class="k">trim</span> <span class="s">&quot;----hello=====&quot;</span> <span class="s">&quot;-&quot;</span> <span class="s">&quot;=&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;hello&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p><a id="true?"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_true_span"><span class="big red">true?</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (true? <em>exp</em>)</p></div>
<div class="paragraph"><p>If the expression in <em>exp</em> evaluates to anything other than <span class="monospaced">nil</span> or the
empty list <span class="monospaced">()</span>, <span class="monospaced">true?</span> returns <span class="monospaced">true</span>; otherwise, it returns <span class="monospaced">nil</span>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">map</span> <span class="k">true</span><span class="ss">?</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">x</span> <span class="ss">1</span> <span class="s">&quot;hi&quot;</span> <span class="p">(</span><span class="nv">a</span> <span class="ss">b</span> <span class="ss">c</span><span class="p">)</span> <span class="k">nil</span> <span class="p">()))</span>
<span class="err">→</span> <span class="p">(</span><span class="k">true</span> <span class="k">true</span> <span class="k">true</span> <span class="k">true</span> <span class="k">nil</span> <span class="k">nil</span><span class="p">)</span>
<span class="p">(</span><span class="k">true</span><span class="ss">?</span> <span class="k">nil</span><span class="p">)</span>  <span class="err">→</span> <span class="k">nil</span>
<span class="p">(</span><span class="k">true</span><span class="ss">?</span> <span class="o">&#39;</span><span class="p">())</span>  <span class="err">→</span> <span class="k">nil</span>
</pre></div></div></div>
<div class="paragraph"><p><span class="monospaced">true?</span> behaves like <a href="#if">if</a> and rejects the empty list <span class="monospaced">()</span>.</p></div>
<div class="paragraph"><p><a id="unicode"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_unicode_span"><span class="big red">unicode</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (unicode <em>str-utf8</em>)</p></div>
<div class="paragraph"><p>Converts ASCII/UTF-8 character strings in <em>str</em> to UCS-4–encoded Unicode
of 4-byte integers per character. The string is terminated with a 4-byte
integer <span class="monospaced">0</span>. This function is only available on UTF-8–enabled versions
of newLISP.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">unicode</span> <span class="s">&quot;new&quot;</span><span class="p">)</span>
<span class="err">→</span> <span class="s">&quot;n\000\000\000e\000\000\000w\000\000\000\000\000\000\000&quot;</span>

<span class="p">(</span><span class="k">utf8</span> <span class="p">(</span><span class="k">unicode</span> <span class="s">&quot;new&quot;</span><span class="p">))</span>  <span class="err">→</span> <span class="s">&quot;new&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>On <em>big endian</em> CPU architectures, the byte order will be reversed from
high to low. The <span class="monospaced">unicode</span> and <a href="#utf8">utf8</a> functions are the
inverse of each other. These functions are only necessary if UCS-4
Unicode is in use. Most systems use UTF-8 encoding only.</p></div>
<div class="paragraph"><p><a id="unify"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_unify_span"><span class="big red">unify</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (unify <em>exp-1</em> <em>exp-2</em> [<em>list-env</em>])</p></div>
<div class="paragraph"><p>Evaluates and matches <em>exp-1</em> and <em>exp-2</em>. Expressions match if they are
equal or if one of the expressions is an unbound variable (which would
then be bound to the other expression). If expressions are lists, they
are matched by comparing subexpressions. Unbound variables start with an
uppercase character to distinguish them from symbols. <span class="monospaced">unify</span> returns
<span class="monospaced">nil</span> when the unification process fails, or it returns a list of
variable associations on success. When no variables were bound, but the
match is still successful, <span class="monospaced">unify</span> returns an empty list. newLISP uses a
modified <em>J. Alan Robinson</em> unification algorithm with correctly applied
<em>occurs check</em>. See also <em>Peter Norvig</em>'s paper about a common
<a href="http://norvig.com/unify-bug.pdf">unifcation algorithm bug</a>, which is not
present in this implementation.</p></div>
<div class="paragraph"><p>Since version 10.4.0 the underscore symbol <span class="monospaced">_</span> (ASCII 95) matches any
atom, list or unbound variable and never binds.</p></div>
<div class="paragraph"><p>Like <a href="#match">match</a>, <span class="monospaced">unify</span> is frequently employed as a parameter
functor in <a href="#find">find</a>, <a href="#ref">ref</a>, <a href="#ref-all">ref-all</a> and
<a href="#replace">replace</a>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">unify</span> <span class="o">&#39;</span><span class="ss">A</span> <span class="o">&#39;</span><span class="ss">A</span><span class="p">)</span>  <span class="err">→</span> <span class="p">()</span>  <span class="c1">; tautology</span>

<span class="p">(</span><span class="k">unify</span> <span class="o">&#39;</span><span class="ss">A</span> <span class="ss">123</span><span class="p">)</span>  <span class="err">→</span> <span class="p">((</span><span class="nv">A</span> <span class="ss">123</span><span class="p">))</span>  <span class="c1">; A bound to 123</span>

<span class="p">(</span><span class="k">unify</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">A</span> <span class="ss">B</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">x</span> <span class="ss">y</span><span class="p">))</span>  <span class="err">→</span> <span class="p">((</span><span class="nv">A</span> <span class="ss">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">B</span> <span class="ss">y</span><span class="p">))</span>  <span class="c1">; A bound to x, B bound to y</span>

<span class="p">(</span><span class="k">unify</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">A</span> <span class="ss">B</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">B</span> <span class="ss">abc</span><span class="p">))</span>  <span class="err">→</span> <span class="p">((</span><span class="nv">A</span> <span class="ss">abc</span><span class="p">)</span> <span class="p">(</span><span class="nv">B</span> <span class="ss">abc</span><span class="p">))</span>  <span class="c1">; B is alias for A</span>

<span class="p">(</span><span class="k">unify</span> <span class="o">&#39;</span><span class="ss">abc</span> <span class="o">&#39;</span><span class="ss">xyz</span><span class="p">)</span>  <span class="err">→</span> <span class="k">nil</span>  <span class="c1">; fails because symbols are different</span>

<span class="p">(</span><span class="k">unify</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">A</span> <span class="ss">A</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">123</span> <span class="ss">456</span><span class="p">))</span>  <span class="err">→</span> <span class="k">nil</span>  <span class="c1">; fails because A cannot be bound to different values</span>

<span class="p">(</span><span class="k">unify</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">f</span> <span class="ss">A</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">f</span> <span class="ss">B</span><span class="p">))</span>  <span class="err">→</span> <span class="p">((</span><span class="nv">A</span> <span class="ss">B</span><span class="p">))</span>  <span class="c1">; A and B are aliases</span>

<span class="p">(</span><span class="k">unify</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">f</span> <span class="ss">A</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">g</span> <span class="ss">B</span><span class="p">))</span>  <span class="err">→</span> <span class="k">nil</span>  <span class="c1">; fails because heads of terms are different</span>

<span class="p">(</span><span class="k">unify</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">f</span> <span class="ss">A</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">f</span> <span class="ss">A</span> <span class="ss">B</span><span class="p">))</span>  <span class="err">→</span> <span class="k">nil</span>  <span class="c1">; fails because terms are of different arity</span>

<span class="p">(</span><span class="k">unify</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">f</span> <span class="p">(</span><span class="nv">g</span> <span class="ss">A</span><span class="p">))</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">f</span> <span class="ss">B</span><span class="p">))</span>  <span class="err">→</span> <span class="p">((</span><span class="nv">B</span> <span class="p">(</span><span class="nv">g</span> <span class="ss">A</span><span class="p">)))</span>  <span class="c1">; B bound to (g A)</span>

<span class="p">(</span><span class="k">unify</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">f</span> <span class="p">(</span><span class="nv">g</span> <span class="ss">A</span><span class="p">)</span> <span class="ss">A</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">f</span> <span class="ss">B</span> <span class="ss">xyz</span><span class="p">))</span>  <span class="err">→</span> <span class="p">((</span><span class="nv">B</span> <span class="p">(</span><span class="nv">g</span> <span class="ss">xyz</span><span class="p">))</span> <span class="p">(</span><span class="nv">A</span> <span class="ss">xyz</span><span class="p">))</span>  <span class="c1">; B bound to (g xyz) A to xyz</span>

<span class="p">(</span><span class="k">unify</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">f</span> <span class="ss">A</span><span class="p">)</span> <span class="o">&#39;</span><span class="ss">A</span><span class="p">)</span>  <span class="err">→</span> <span class="k">nil</span>  <span class="c1">; fails because of infinite unification (f(f(f …)))</span>

<span class="p">(</span><span class="k">unify</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">A</span> <span class="ss">xyz</span> <span class="ss">A</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">abc</span> <span class="ss">X</span> <span class="ss">X</span><span class="p">))</span>  <span class="err">→</span>  <span class="k">nil</span> <span class="c1">; indirect alias A to X doesn&#39;t match bound terms</span>

<span class="p">(</span><span class="k">unify</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">p</span> <span class="ss">X</span> <span class="ss">Y</span> <span class="ss">a</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">p</span> <span class="ss">Y</span> <span class="ss">X</span> <span class="ss">X</span><span class="p">))</span>  <span class="err">→</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">Y</span> <span class="ss">a</span><span class="p">)</span> <span class="p">(</span><span class="nv">X</span> <span class="ss">a</span><span class="p">)))</span>  <span class="c1">; X alias Y and binding to &#39;a</span>

<span class="p">(</span><span class="k">unify</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">q</span> <span class="p">(</span><span class="nv">p</span> <span class="ss">X</span> <span class="ss">Y</span><span class="p">)</span> <span class="p">(</span><span class="nv">p</span> <span class="ss">Y</span> <span class="ss">X</span><span class="p">))</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">q</span> <span class="ss">Z</span> <span class="ss">Z</span><span class="p">))</span>  <span class="err">→</span> <span class="p">((</span><span class="nv">Y</span> <span class="ss">X</span><span class="p">)</span> <span class="p">(</span><span class="nv">Z</span> <span class="p">(</span><span class="nv">p</span> <span class="ss">X</span> <span class="ss">X</span><span class="p">)))</span>  <span class="c1">; indirect alias</span>

<span class="p">(</span><span class="k">unify</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">A</span> <span class="ss">b</span> <span class="ss">_</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">x</span> <span class="ss">G</span> <span class="ss">z</span><span class="p">))</span> <span class="err">→</span> <span class="p">((</span><span class="nv">A</span> <span class="ss">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">G</span> <span class="ss">b</span><span class="p">))</span> <span class="c1">; _ matches atom z</span>

<span class="p">(</span><span class="k">unify</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">A</span> <span class="ss">b</span> <span class="ss">c</span> <span class="ss">_</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">x</span> <span class="ss">G</span> <span class="ss">_</span> <span class="ss">z</span><span class="p">))</span> <span class="err">→</span> <span class="p">((</span><span class="nv">A</span> <span class="ss">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">G</span> <span class="ss">b</span><span class="p">))</span> <span class="c1">; _ never binds, matches c and z</span>

<span class="p">(</span><span class="k">unify</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">A</span> <span class="ss">b</span> <span class="ss">_</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">x</span> <span class="ss">G</span> <span class="p">(</span><span class="nv">x</span> <span class="ss">y</span> <span class="ss">z</span><span class="p">)))</span> <span class="err">→</span> <span class="p">((</span><span class="nv">A</span> <span class="ss">x</span><span class="p">)</span> <span class="p">(</span><span class="nv">G</span> <span class="ss">b</span><span class="p">))</span> <span class="c1">; _ matches list (x y z)</span>

<span class="c1">;; some examples taken from http://en.wikipedia.org/wiki/Unification</span>
</pre></div></div></div>
<div class="paragraph"><p><span class="monospaced">unify</span> can take an optional binding or association list in <em>list-env</em>.
This is useful when chaining <span class="monospaced">unify</span> expressions and the results of
previous <span class="monospaced">unify</span> bindings must be included:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">unify</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">f</span> <span class="ss">X</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">f</span> <span class="ss">123</span><span class="p">))</span>  <span class="err">→</span> <span class="p">((</span><span class="nv">X</span> <span class="ss">123</span><span class="p">))</span>

<span class="p">(</span><span class="k">unify</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">A</span> <span class="ss">B</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">X</span> <span class="ss">A</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">X</span> <span class="ss">123</span><span class="p">)))</span>
<span class="err">→</span> <span class="p">((</span><span class="nv">X</span> <span class="ss">123</span><span class="p">)</span> <span class="p">(</span><span class="nv">A</span> <span class="ss">123</span><span class="p">)</span> <span class="p">(</span><span class="nv">B</span> <span class="ss">123</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p>In the previous example, <span class="monospaced">X</span> was bound to <span class="monospaced">123</span> earlier and is included
in the second statement to pre-bind <span class="monospaced">X</span>.</p></div>
</div>
<div class="sect3">
<h4 id="_use_span_class_monospaced_unify_span_with_span_class_monospaced_expand_span">Use <span class="monospaced">unify</span> with <span class="monospaced">expand</span></h4>
<div class="paragraph"><p>Note that variables are not actually bound as a newLISP assignment.
Rather, an association list is returned showing the logical binding. A
special syntax of <a href="#expand">expand</a> can be used to actually replace
bound variables with their terms:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">bindings</span> <span class="p">(</span><span class="k">unify</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">f</span> <span class="p">(</span><span class="nv">g</span> <span class="ss">A</span><span class="p">)</span> <span class="ss">A</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">f</span> <span class="ss">B</span> <span class="ss">xyz</span><span class="p">)))</span>
<span class="err">→</span> <span class="p">((</span><span class="nv">B</span> <span class="p">(</span><span class="nv">g</span> <span class="ss">xyz</span><span class="p">))</span> <span class="p">(</span><span class="nv">A</span> <span class="ss">xyz</span><span class="p">))</span>

<span class="p">(</span><span class="k">expand</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">f</span> <span class="p">(</span><span class="nv">g</span> <span class="ss">A</span><span class="p">)</span> <span class="ss">A</span><span class="p">)</span> <span class="ss">bindings</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">f</span> <span class="p">(</span><span class="nv">g</span> <span class="ss">xyz</span><span class="p">)</span> <span class="ss">xyz</span><span class="p">)</span>

<span class="c1">; or in one statement</span>
<span class="p">(</span><span class="k">expand</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">f</span> <span class="p">(</span><span class="nv">g</span> <span class="ss">A</span><span class="p">)</span> <span class="ss">A</span><span class="p">)</span> <span class="p">(</span><span class="k">unify</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">f</span> <span class="p">(</span><span class="nv">g</span> <span class="ss">A</span><span class="p">)</span> <span class="ss">A</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">f</span> <span class="ss">B</span> <span class="ss">xyz</span><span class="p">)))</span>
<span class="err">→</span> <span class="p">(</span><span class="nv">f</span> <span class="p">(</span><span class="nv">g</span> <span class="ss">xyz</span><span class="p">)</span> <span class="ss">xyz</span><span class="p">)</span>
</pre></div></div></div>
</div>
<div class="sect3">
<h4 id="_use_span_class_monospaced_unify_span_with_span_class_monospaced_bind_span_for_de_structuring">Use <span class="monospaced">unify</span> with <span class="monospaced">bind</span> for de-structuring</h4>
<div class="paragraph"><p>The function <a href="#bind">bind</a> can be used to set unified variables:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">bind</span> <span class="p">(</span><span class="k">unify</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">f</span> <span class="p">(</span><span class="nv">g</span> <span class="ss">A</span><span class="p">)</span> <span class="ss">A</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">f</span> <span class="ss">B</span> <span class="ss">xyz</span><span class="p">)))</span>

<span class="ss">A</span> <span class="err">→</span> <span class="ss">xyz</span>
<span class="ss">B</span> <span class="err">→</span> <span class="p">(</span><span class="nv">g</span> <span class="ss">xyz</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>This can be used for de-structuring:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">structure</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">one</span> <span class="s">&quot;two&quot;</span><span class="p">)</span> <span class="ss">3</span> <span class="p">(</span><span class="nv">four</span> <span class="p">(</span><span class="nv">x</span> <span class="ss">y</span> <span class="ss">z</span><span class="p">))))</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">pattern</span> <span class="o">&#39;</span><span class="p">((</span><span class="nv">A</span> <span class="ss">B</span><span class="p">)</span> <span class="ss">C</span> <span class="p">(</span><span class="nv">D</span> <span class="ss">E</span><span class="p">)))</span>
<span class="p">(</span><span class="k">bind</span> <span class="p">(</span><span class="k">unify</span> <span class="ss">pattern</span> <span class="ss">structure</span><span class="p">))</span>

<span class="ss">A</span> <span class="err">→</span> <span class="ss">one</span>
<span class="ss">B</span> <span class="err">→</span> <span class="s">&quot;two&quot;</span>
<span class="ss">C</span> <span class="err">→</span> <span class="ss">3</span>
<span class="ss">D</span> <span class="err">→</span> <span class="ss">four</span>
<span class="ss">E</span> <span class="err">→</span> <span class="p">(</span><span class="nv">x</span> <span class="ss">y</span> <span class="ss">z</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p><span class="monospaced">unify</span> returns an association list and <span class="monospaced">bind</span> binds the associations.</p></div>
</div>
<div class="sect3">
<h4 id="_model_propositional_logic_with_span_class_monospaced_unify_span">Model propositional logic with <span class="monospaced">unify</span></h4>
<div class="paragraph"><p>The following example shows how propositional logic can be modeled using
<span class="monospaced">unify</span> and <a href="#expand">expand</a>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">; if somebody is human, he is mortal -&gt; (X human) :- (X mortal)</span>
<span class="c1">; socrates is human -&gt; (socrates human)</span>
<span class="c1">; is socrates mortal? -&gt; ?  (socrates mortal)</span>

<span class="p">(</span><span class="k">expand</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">X</span> <span class="ss">mortal</span><span class="p">)</span>
         <span class="p">(</span><span class="k">unify</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">X</span> <span class="ss">human</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">socrates</span> <span class="ss">human</span><span class="p">)))</span>
<span class="err">→</span> <span class="p">(</span><span class="nv">socrates</span> <span class="ss">mortal</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The following is a more complex example showing a small, working PROLOG
(Programming in Logic) implementation.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">;; a small PROLOG implementation</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">facts</span> <span class="o">&#39;</span><span class="p">(</span>
    <span class="p">(</span><span class="nv">socrates</span> <span class="ss">philosopher</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">socrates</span> <span class="ss">greek</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">socrates</span> <span class="ss">human</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">einstein</span> <span class="ss">german</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">einstein</span> <span class="p">(</span><span class="nv">studied</span> <span class="ss">physics</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">einstein</span> <span class="ss">human</span><span class="p">)</span>
<span class="p">))</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">rules</span> <span class="o">&#39;</span><span class="p">(</span>
    <span class="p">((</span><span class="nv">X</span> <span class="ss">mortal</span><span class="p">)</span> <span class="ss">&lt;-</span> <span class="p">(</span><span class="nv">X</span> <span class="ss">human</span><span class="p">))</span>
    <span class="p">((</span><span class="nv">X</span> <span class="p">(</span><span class="nv">knows</span> <span class="ss">physics</span><span class="p">))</span> <span class="ss">&lt;-</span> <span class="p">(</span><span class="nv">X</span> <span class="ss">physicist</span><span class="p">))</span>
    <span class="p">((</span><span class="nv">X</span> <span class="ss">physicist</span><span class="p">)</span> <span class="ss">&lt;-</span> <span class="p">(</span><span class="nv">X</span> <span class="p">(</span><span class="nv">studied</span> <span class="ss">physics</span><span class="p">)))</span>
<span class="p">))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">query</span> <span class="ss">trm</span><span class="p">)</span>
    <span class="p">(</span><span class="k">or</span>  <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="k">find</span> <span class="ss">trm</span> <span class="ss">facts</span><span class="p">)</span> <span class="k">true</span><span class="p">)</span> <span class="p">(</span><span class="k">catch</span> <span class="p">(</span><span class="nv">prove-rule</span> <span class="ss">trm</span><span class="p">))))</span>

<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">prove-rule</span> <span class="ss">trm</span><span class="p">)</span>
    <span class="p">(</span><span class="k">dolist</span> <span class="p">(</span><span class="nv">r</span> <span class="ss">rules</span><span class="p">)</span>
        <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="k">list</span><span class="ss">?</span> <span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">e</span> <span class="p">(</span><span class="k">unify</span> <span class="ss">trm</span> <span class="p">(</span><span class="k">first</span> <span class="ss">r</span><span class="p">))))</span>
            <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="nv">query</span> <span class="p">(</span><span class="k">expand</span> <span class="p">(</span><span class="k">last</span> <span class="ss">r</span><span class="p">)</span> <span class="ss">e</span><span class="p">))</span>
                <span class="p">(</span><span class="k">throw</span> <span class="k">true</span><span class="p">))))</span>
    <span class="k">nil</span>
<span class="p">)</span>

<span class="c1">; try it</span>

<span class="ss">&gt;</span> <span class="p">(</span><span class="nv">query</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">socrates</span> <span class="ss">human</span><span class="p">))</span>
<span class="k">true</span>
<span class="ss">&gt;</span> <span class="p">(</span><span class="nv">query</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">socrates</span> <span class="p">(</span><span class="nv">knows</span> <span class="ss">physics</span><span class="p">)))</span>
<span class="k">nil</span>
<span class="ss">&gt;</span> <span class="p">(</span><span class="nv">query</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">einstein</span> <span class="p">(</span><span class="nv">knows</span> <span class="ss">physics</span><span class="p">)))</span>
<span class="k">true</span>
</pre></div></div></div>
<div class="paragraph"><p>The program handles a database of <span class="monospaced">facts</span> and a database of simple <em>A is
a fact if B is a fact</em> <span class="monospaced">rules</span>. A fact is proven true if it either can
be found in the <span class="monospaced">facts</span> database or if it can be proven using a rule.
Rules can be nested: for example, to prove that somebody
<span class="monospaced">(knows physics)</span>, it must be proved true that somebody is a
<span class="monospaced">physicist</span>. But somebody is only a physicist if that person
<span class="monospaced">studied physics</span>. The <span class="monospaced">&lt;-</span> symbol separating the left and right terms
of the rules is not required and is only added to make the rules
database more readable.</p></div>
<div class="paragraph"><p>This implementation does not handle multiple terms in the right premise
part of the rules, but it does handle backtracking of the <span class="monospaced">rules</span>
database to try out different matches. It does not handle backtracking
in multiple premises of the rule. For example, if in the following rule
<span class="monospaced">A if B and C and D</span>, the premises <span class="monospaced">B</span> and <span class="monospaced">C</span> succeed and <span class="monospaced">D</span> fails, a
backtracking mechanism might need to go back and reunify the <span class="monospaced">B</span> or <span class="monospaced">A</span>
terms with different facts or rules to make <span class="monospaced">D</span> succeed.</p></div>
<div class="paragraph"><p>The above algorithm could be written differently by omitting
<a href="#expand">expand</a> from the definition of <span class="monospaced">prove-rule</span> and by passing
the environment, <span class="monospaced">e</span>, as an argument to the <span class="monospaced">unify</span> and <span class="monospaced">query</span>
functions.</p></div>
<div class="paragraph"><p>A <em>learning</em> of proven facts can be implemented by appending them to the
<span class="monospaced">facts</span> database once they are proven. This would speed up subsequent
queries.</p></div>
<div class="paragraph"><p>Larger PROLOG implementations also allow the evaluation of terms in
rules. This makes it possible to implement functions for doing other
work while processing rule terms. <span class="monospaced">prove-rule</span> could accomplish this
testing for the symbol <span class="monospaced">eval</span> in each rule term.</p></div>
<div class="paragraph"><p><a id="union"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_union_span"><span class="big red">union</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (union <em>list-1</em> <em>list-2</em> [<em>list-3</em> &#8230; ])</p></div>
<div class="paragraph"><p><span class="monospaced">union</span> returns a unique collection list of distinct elements found in
two or more lists.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="nv">union</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">1</span> <span class="ss">3</span> <span class="ss">1</span> <span class="ss">4</span> <span class="ss">4</span> <span class="ss">3</span><span class="p">)</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">2</span> <span class="ss">1</span> <span class="ss">5</span> <span class="ss">6</span> <span class="ss">4</span><span class="p">))</span>  <span class="err">→</span>  <span class="p">(</span><span class="nv">1</span> <span class="ss">3</span> <span class="ss">4</span> <span class="ss">2</span> <span class="ss">5</span> <span class="ss">6</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Like the other set functions <a href="#difference">difference</a>,
<a href="#interset">intersect</a> and <a href="#unique">unique</a>, <span class="monospaced">union</span> maintains
the order of elements as found in the original lists.</p></div>
<div class="paragraph"><p><a id="unique"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_unique_span"><span class="big red">unique</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (unique <em>list</em>)</p></div>
<div class="paragraph"><p>Returns a unique version of <em>list</em> with all duplicates removed.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">unique</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">2</span> <span class="ss">3</span> <span class="ss">4</span> <span class="ss">4</span> <span class="ss">6</span> <span class="ss">7</span> <span class="ss">8</span> <span class="ss">7</span><span class="p">))</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">2</span> <span class="ss">3</span> <span class="ss">4</span> <span class="ss">6</span> <span class="ss">7</span> <span class="ss">8</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Note that the list does not need to be sorted, but a sorted list makes
<span class="monospaced">unique</span> perform faster.</p></div>
<div class="paragraph"><p>Other <em>set</em> functions are <a href="#difference">difference</a>,
<a href="#intersect">intersect</a> and <a href="#union">union</a>.</p></div>
<div class="paragraph"><p><a id="unless"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_unless_span"><span class="big red">unless</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (unless <em>exp-condition</em> <em>body</em>)</p></div>
<div class="paragraph"><p>The statements in <em>body</em> are only evaluated if <em>exp-condition</em> evaluates
to <span class="monospaced">nil</span> or the empty list <span class="monospaced">()</span>. The result of the last expression in
<em>body</em> is returned or <span class="monospaced">nil</span> or the empty list <span class="monospaced">()</span> if <em>body</em> was not
executed.</p></div>
<div class="paragraph"><p>Because <span class="monospaced">unless</span> does not have an <em>else</em> condition as in <a href="#if">if</a>,
the statements in <em>body</em> need not to be grouped with <a href="#begin">begin</a>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">unless</span> <span class="p">(</span><span class="k">starts-with</span> <span class="p">(</span><span class="k">read-</span><span class="ss">line</span><span class="p">)</span> <span class="s">&quot;quit&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="k">process</span> <span class="p">(</span><span class="k">current-line</span><span class="p">))</span>
    <span class="ss">...</span>
    <span class="p">(</span><span class="nv">finish</span><span class="p">)</span>
<span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>See also the function <a href="#when">when</a>.</p></div>
<div class="paragraph"><p><a id="unpack"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_unpack_span"><span class="big red">unpack</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (unpack <em>str-format</em> <em>str-addr-packed</em>)<br>
<strong>syntax:</strong> (unpack <em>str-format</em> <em>num-addr-packed</em>)<br>
<strong>syntax:</strong> (unpack <em>struct</em> <em>num-addr-packed</em>)<br>
<strong>syntax:</strong> (unpack <em>struct</em> <em>str-addr-packed</em>)</p></div>
<div class="paragraph"><p>When the first parameter is a string, <span class="monospaced">unpack</span> unpacks a binary
structure in <em>str-addr-packed</em> or pointed to by <em>num-addr-packed</em> into
newLISP variables using the format in <em>str-format</em>. <span class="monospaced">unpack</span> is the
reverse operation of <span class="monospaced">pack</span>. Using <em>num-addr-packed</em> facilitates the
unpacking of structures returned from imported, shared library
functions.</p></div>
<div class="paragraph"><p>If the number specified in <em>num-addr-packed</em> is not a valid memory
address, a system bus error or segfault can occur and crash newLISP or
leave it in an unstable state.</p></div>
<div class="paragraph"><p>When the first parameter is the symbol of a <a href="#struct">struct</a>
definition, <span class="monospaced">unpack</span> uses the format as specified in <em>struct</em>. While
<span class="monospaced">unpack</span> with <em>str-format</em> literally unpacks as specified, <span class="monospaced">unpack</span> with
<em>struct</em> will skip structure aligning pad-bytes depending on data type,
order of elements and CPU architecture. Refer to the description of the
<a href="#struct">struct</a> function for more detail.</p></div>
<div class="paragraph"><p>The following characters may define a format:</p></div>
<table class="tableblock frame-all grid-all"
style="
width:25%;
">
<col style="width:20%;">
<col style="width:80%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" >format </th>
<th class="tableblock halign-left valign-top" >description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">`c `</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">a signed 8-bit number</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">`b `</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">an unsigned 8-bit number</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">`d `</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">a signed 16-bit short number</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">`u `</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">an unsigned 16-bit short number</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">ld</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">a signed 32-bit long number</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">lu</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">an unsigned 32-bit long number</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">Ld</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">a signed 64-bit long number</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">Lu</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">an unsigned 64-bit long number</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">`f `</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">a float in 32-bit representation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">lf</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">a double float in 64-bit representation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">sn</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">a string of <em>n</em> null padded ASCII characters</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">nn</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><em>n</em> null characters</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">&gt;</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">switches to big endian byte order</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">&lt;</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">switches to little endian byte order</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">pack</span> <span class="s">&quot;c c c&quot;</span> <span class="ss">65</span> <span class="ss">66</span> <span class="ss">67</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;ABC&quot;</span>
<span class="p">(</span><span class="k">unpack</span> <span class="s">&quot;c c c&quot;</span> <span class="s">&quot;ABC&quot;</span><span class="p">)</span>   <span class="err">→</span> <span class="p">(</span><span class="nv">65</span> <span class="ss">66</span> <span class="ss">67</span><span class="p">)</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">s</span> <span class="p">(</span><span class="k">pack</span> <span class="s">&quot;c d u&quot;</span> <span class="ss">10</span> <span class="ss">12345</span> <span class="ss">56789</span><span class="p">))</span>
<span class="p">(</span><span class="k">unpack</span> <span class="s">&quot;c d u&quot;</span> <span class="ss">s</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">10</span> <span class="ss">12345</span> <span class="ss">56789</span><span class="p">)</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">s</span> <span class="p">(</span><span class="k">pack</span> <span class="s">&quot;s10 f&quot;</span> <span class="s">&quot;result&quot;</span> <span class="ss">1.23</span><span class="p">))</span>
<span class="p">(</span><span class="k">unpack</span> <span class="s">&quot;s10 f&quot;</span> <span class="ss">s</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="s">&quot;result\000\000\000\000&quot;</span> <span class="ss">1.230000019</span><span class="p">)</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">s</span> <span class="p">(</span><span class="k">pack</span> <span class="s">&quot;s3 lf&quot;</span> <span class="s">&quot;result&quot;</span> <span class="ss">1.23</span><span class="p">))</span>
<span class="p">(</span><span class="k">unpack</span> <span class="s">&quot;s3 f&quot;</span> <span class="ss">s</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="s">&quot;res&quot;</span> <span class="ss">1.23</span><span class="p">)</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">s</span> <span class="p">(</span><span class="k">pack</span> <span class="s">&quot;c n7 c&quot;</span> <span class="ss">11</span> <span class="ss">22</span><span class="p">))</span>
<span class="p">(</span><span class="k">unpack</span> <span class="s">&quot;c n7 c&quot;</span> <span class="ss">s</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">11</span> <span class="ss">22</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p>The <span class="monospaced">&gt;</span> and <span class="monospaced">&lt;</span> specifiers can be used to switch between <em>little endian</em>
and <em>big endian</em> byte order when packing or unpacking:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">;; on a little endian system (e.g., Intel CPUs)</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">buff</span> <span class="p">(</span><span class="k">pack</span> <span class="s">&quot;d&quot;</span> <span class="ss">1</span><span class="p">))</span>  <span class="err">→</span> <span class="s">&quot;\001\000&quot;</span>

<span class="p">(</span><span class="k">unpack</span> <span class="s">&quot;d&quot;</span> <span class="ss">buff</span><span class="p">)</span>   <span class="err">→</span> <span class="p">(</span><span class="nv">1</span><span class="p">)</span>
<span class="p">(</span><span class="k">unpack</span> <span class="s">&quot;&gt;d&quot;</span> <span class="ss">buff</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">256</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Switching the byte order will affect all number formats with 16-, 32-,
or 64-bit sizes.</p></div>
<div class="paragraph"><p>The <span class="monospaced">pack</span> and <span class="monospaced">unpack</span> format need not be the same, as in the following
example:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">s</span> <span class="p">(</span><span class="k">pack</span> <span class="s">&quot;s3&quot;</span> <span class="s">&quot;ABC&quot;</span><span class="p">))</span>
<span class="p">(</span><span class="k">unpack</span> <span class="s">&quot;c c c&quot;</span> <span class="ss">s</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">65</span> <span class="ss">66</span> <span class="ss">67</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The examples show spaces between the format specifiers. Although not
required, they can improve readability.</p></div>
<div class="paragraph"><p>If the buffer&#8217;s size at a memory address is smaller than the formatting
string specifies, some formatting characters may be left unused.</p></div>
<div class="paragraph"><p>See also the <a href="#address">address</a>, <a href="#get-int">get-int</a>,
<a href="#get-long">get-long</a>, <a href="#get-char">get-char</a>,
<a href="#get-string">get-string</a>, and <a href="#pack">pack</a> functions.</p></div>
<div class="paragraph"><p><a id="until"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_until_span"><span class="big red">until</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (until <em>exp-condition</em> [<em>body</em>])</p></div>
<div class="paragraph"><p>Evaluates the condition in <em>exp-condition</em>. If the result is <span class="monospaced">nil</span> or
the empty list <span class="monospaced">()</span>, the expressions in <em>body</em> are evaluated. Evaluation
is repeated until the exp-condition results in a value other than <span class="monospaced">nil</span>
or the empty list. The result of the last expression evaluated in <em>body</em>
is the return value of the <span class="monospaced">until</span> expression. If <em>body</em> is empty, the
result of last <em>exp-condition</em> is returned. <span class="monospaced">until</span> works like
(<a href="#while">while</a> (<a href="#not">not</a> …)).</p></div>
<div class="paragraph"><p><span class="monospaced">until</span> also updates the system iterator symbol <span class="monospaced">$idx</span>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">device</span> <span class="p">(</span><span class="k">open</span> <span class="s">&quot;somefile.txt&quot;</span> <span class="s">&quot;read&quot;</span><span class="p">))</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">line-count</span> <span class="ss">0</span><span class="p">)</span>
<span class="p">(</span><span class="k">until</span> <span class="p">(</span><span class="k">not</span> <span class="p">(</span><span class="k">read-</span><span class="ss">line</span><span class="p">))</span> <span class="p">(</span><span class="k">inc</span> <span class="ss">line-count</span><span class="p">))</span>
<span class="p">(</span><span class="k">close</span> <span class="p">(</span><span class="k">device</span><span class="p">))</span>
<span class="p">(</span><span class="k">print</span> <span class="s">&quot;the file has &quot;</span> <span class="ss">line-count</span> <span class="s">&quot; lines\n&quot;</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Use the <a href="#do-until">do-until</a> function to test the condition <em>after</em>
evaluation of the body expressions.</p></div>
<div class="paragraph"><p><a id="upper-case"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_upper_case_a_href_utf8_capable_utf8_a_span"><span class="big red">upper-case <a href="#utf8_capable">utf8</a></span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (upper-case <em>str</em>)</p></div>
<div class="paragraph"><p>Returns a copy of the string in <em>str</em> converted to uppercase.
International characters are converted correctly.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">upper-case</span> <span class="s">&quot;hello world&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;HELLO WORLD&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>See also the <a href="#lower-case">lower-case</a> and
<a href="#title-case">title-case</a> functions.</p></div>
<div class="paragraph"><p><a id="utf8"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_utf8_span"><span class="big red">utf8</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (utf8 <em>str-unicode</em>)</p></div>
<div class="paragraph"><p>Converts a UCS-4, 4-byte, Unicode-encoded string (<em>str</em>) into UTF-8.
This function is only available on UTF-8–enabled versions of newLISP.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">unicode</span> <span class="s">&quot;new&quot;</span><span class="p">)</span>
<span class="err">→</span> <span class="s">&quot;n\000\000\000e\000\000\000w\000\000\000\000\000\000\000&quot;</span>

<span class="p">(</span><span class="k">utf8</span> <span class="p">(</span><span class="k">unicode</span> <span class="s">&quot;new&quot;</span><span class="p">))</span>  <span class="err">→</span> <span class="s">&quot;new&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>The <span class="monospaced">utf8</span> function can also be used to test for the presence of
UTF-8–enabled newLISP:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">if</span> <span class="k">utf8</span> <span class="p">(</span><span class="nv">do-utf8-version-of-code</span><span class="p">)</span> <span class="p">(</span><span class="nv">do-ascii-version-of-code</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p>On <em>big endian</em> CPU architectures, the byte order will be reversed from
highest to lowest. The <span class="monospaced">utf8</span> and <a href="#unicode">unicode</a> functions are
the inverse of each other. These functions are only necessary if UCS-4
Unicode is in use. Most systems use UTF-8 Unicode encoding only.</p></div>
<div class="paragraph"><p><a id="utf8len"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_utf8len_span"><span class="big red">utf8len</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (utf8len <em>str</em>)</p></div>
<div class="paragraph"><p>Returns the number of characters in a UTF-8–encoded string. UTF-8
characters can be encoded in more than one 8-bit byte. <span class="monospaced">utf8len</span> returns
the number of UTF-8 characters in a string. This function is only
available on UTF-8–enabled versions of newLISP.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">utf8len</span> <span class="s">&quot;我能吞下玻璃而不伤身体。&quot;</span><span class="p">)</span>    <span class="err">→</span> <span class="ss">12</span>
<span class="p">(</span><span class="k">length</span> <span class="s">&quot;我能吞下玻璃而不伤身体。&quot;</span><span class="p">)</span>      <span class="err">→</span> <span class="ss">36</span>
</pre></div></div></div>
<div class="paragraph"><p>See also the <a href="#unicode">unicode</a> and <a href="#utf8">utf8</a> functions.
Above Chinese text from <a href="http://www.columbia.edu/kermit/utf8.html">UTF-8
Sampler</a>.</p></div>
<div class="paragraph"><p><a id="uuid"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_uuid_span"><span class="big red">uuid</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (uuid [<em>str-node</em>])</p></div>
<div class="paragraph"><p>Constructs and returns a UUID (Universally Unique IDentifier). Without a
node spec in <em>str-node</em>, a type 4 UUID random generated byte number is
returned. When the optional <em>str-node</em> parameter is used, a type 1 UUID
is returned. The string in <em>str-node</em> specifies a valid MAC (Media
Access Code) from a network adapter installed on the node or a random
node ID. When a random node ID is specified, the least significant bit
of the first node byte should be set to 1 to avoid clashes with real MAC
identifiers. UUIDs of type 1 with node ID are generated from a timestamp
and other data. See <a href="http://www.ietf.org/rfc/rfc4122.txt">RFC 4122</a> for
details on UUID generation.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">;; type 4 UUID for any system</span>

<span class="p">(</span><span class="k">uuid</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;493AAD61-266F-48A9-B99A-33941BEE3607&quot;</span>

<span class="c1">;; type 1 UUID preferred for distributed systems</span>

<span class="c1">;; configure node ID for ether 00:14:51:0a:e0:bc</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">id</span> <span class="p">(</span><span class="k">pack</span> <span class="s">&quot;cccccc&quot;</span> <span class="ss">0x00</span> <span class="ss">0x14</span> <span class="ss">0x51</span> <span class="ss">0x0a</span> <span class="ss">0xe0</span> <span class="ss">0xbc</span><span class="p">))</span>

<span class="p">(</span><span class="k">uuid</span>  <span class="ss">id</span><span class="p">)</span>  <span class="err">→</span> <span class="s">&quot;0749161C-2EC2-11DB-BBB2-0014510AE0BC&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>Each invocation of the <span class="monospaced">uuid</span> function will yield a new unique UUID. The
UUIDs are generated without system-wide shared stable store (see RFC
4122). If the system generating the UUIDs is distributed over several
nodes, then type 1 generation should be used with a different node ID on
each node. For several processes on the same node, valid UUIDs are
guaranteed even if requested at the same time. This is because the
process ID of the generating newLISP process is part of the seed for the
random number generator. When type 4 IDs are used on a distributed
system, two identical UUID&#8217;s are still highly unlikely and impossible
for type 1 IDs if real MAC addresses are used.</p></div>
<div class="paragraph"><p><a id="wait-pid"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_wait_pid_span"><span class="big red">wait-pid</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (wait-pid <em>int-pid</em> [<em>int-options</em> | <span class="monospaced">nil</span>])</p></div>
<div class="paragraph"><p>Waits for a child process specified in <em>int-pid</em> to end. The child
process was previously started with <a href="#process">process</a> or
<a href="#fork">fork</a>. When the child process specified in <em>int-pid</em> ends, a
list of pid and status value is returned. The status value describes the
reason for termination of the child process. The interpretation of the
returned status value differs between Linux and other flavors of Unix.
Consult the Linux/Unix man pages for the <span class="monospaced">waitpid</span> command (without the
hyphen used in newLISP) for further information.</p></div>
<div class="paragraph"><p>When <span class="monospaced">-1</span> is specified for <em>int-pid</em>, pid and status information of any
child process started by the parent are returned. When <span class="monospaced">0</span> is specified,
<span class="monospaced">wait-pid</span> only watches child processes in the same process group as the
calling process. Any other negative value for <em>int-pid</em> reports child
processes in the same process group as specified with a negative sign in
<em>int-pid</em>.</p></div>
<div class="paragraph"><p>An option can be specified in <em>int-option</em>. See Linux/Unix documentation
for details on integer values for <em>int-options</em>. As an alternative,
<span class="monospaced">nil</span> can be specified. This option causes <span class="monospaced">wait-pid</span> to be
non-blocking, returning right away with a <span class="monospaced">0</span> in the pid of the list
returned. This option used together with an <em>int-pid</em> parameter of <span class="monospaced">-1</span>
can be used to continuously loop and act on returned child processes.</p></div>
<div class="paragraph"><p>This function is only available on Mac OS X, Linux and other Unix-like
operating systems.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">pid</span> <span class="p">(</span><span class="k">fork</span> <span class="p">(</span><span class="nv">my-process</span><span class="p">)))</span> <span class="err">→</span> <span class="ss">8596</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">ret</span> <span class="p">(</span><span class="k">wait-pid</span> <span class="ss">pid</span><span class="p">))</span>  <span class="err">→</span> <span class="p">(</span><span class="nv">8596</span> <span class="ss">0</span><span class="p">)</span> <span class="c1">; child has exited</span>

<span class="p">(</span><span class="k">println</span> <span class="s">&quot;process: &quot;</span> <span class="ss">pid</span> <span class="s">&quot; has finished with status: &quot;</span> <span class="p">(</span><span class="k">last</span> <span class="ss">ret</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p>The process <span class="monospaced">my-process</span> is started, then the main program blocks in the
<span class="monospaced">wait-pid</span> call until <span class="monospaced">my-process</span> has finished.</p></div>
<div class="paragraph"><p><a id="when"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_when_span"><span class="big red">when</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (when <em>exp-condition</em> <em>body</em>)</p></div>
<div class="paragraph"><p>The statements in <em>body</em> are only evaluated if <em>exp-condition</em> evaluates
to anything not <span class="monospaced">nil</span> and not the empty list <span class="monospaced">()</span>. The result of the
last expression in <em>body</em> is returned or <span class="monospaced">nil</span> or the empty list <span class="monospaced">()</span> if
<em>body</em> was not executed.</p></div>
<div class="paragraph"><p>Because <span class="monospaced">when</span> does not have an <em>else</em> condition as in <a href="#if">if</a>, the
statements in <em>body</em> need not to be grouped with <a href="#begin">begin</a>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">when</span> <span class="p">(</span><span class="k">read-</span><span class="ss">line</span><span class="p">)</span>
    <span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">result</span> <span class="p">(</span><span class="nv">analyze</span> <span class="p">(</span><span class="k">current-line</span><span class="p">)))</span>
    <span class="p">(</span><span class="nv">report</span> <span class="ss">result</span><span class="p">)</span>
    <span class="p">(</span><span class="nv">finish</span><span class="p">)</span>
<span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>See also the function <a href="#unless">unless</a> working like
<span class="monospaced">(when (not ...) ...)</span>.</p></div>
<div class="paragraph"><p><a id="while"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_while_span"><span class="big red">while</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (while <em>exp-condition</em> <em>body</em>)</p></div>
<div class="paragraph"><p>Evaluates the condition in <em>exp-condition</em>. If the result is not <span class="monospaced">nil</span>
or the empty list <span class="monospaced">()</span>, the expressions in <em>body</em> are evaluated.
Evaluation is repeated until an <em>exp-condition</em> results in <span class="monospaced">nil</span> or the
empty list <span class="monospaced">()</span>. The result of the body&#8217;s last evaluated expression is
the return value of the <span class="monospaced">while</span> expression.</p></div>
<div class="paragraph"><p><span class="monospaced">while</span> also updates the system iterator symbol <span class="monospaced">$idx</span>.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">device</span> <span class="p">(</span><span class="k">open</span> <span class="s">&quot;somefile.txt&quot;</span> <span class="s">&quot;read&quot;</span><span class="p">))</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">line-count</span> <span class="ss">0</span><span class="p">)</span>
<span class="p">(</span><span class="k">while</span> <span class="p">(</span><span class="k">read-</span><span class="ss">line</span><span class="p">)</span> <span class="p">(</span><span class="k">inc</span> <span class="ss">line-count</span><span class="p">))</span>
<span class="p">(</span><span class="k">close</span> <span class="p">(</span><span class="k">device</span><span class="p">))</span>
<span class="p">(</span><span class="k">print</span> <span class="s">&quot;the file has &quot;</span> <span class="ss">line-count</span> <span class="s">&quot; lines\n&quot;</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Use the <a href="#do-while">do-while</a> function to evaluate the condition
<em>after</em> evaluating the body of expressions.</p></div>
<div class="paragraph"><p><a id="write"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_write_a_href_destructive_a_span"><span class="big red">write <a href="#destructive">!</a></span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (write <em>int-file</em> <em>str-buffer</em> [<em>int-size</em>])<br>
<strong>syntax:</strong> (write <em>str</em> <em>str-buffer</em> [<em>int-size</em>])</p></div>
<div class="paragraph"><p>The function <span class="monospaced">write</span> writes <em>int-size</em> bytes from a buffer in
<em>str-buffer</em> to a file specified in <em>int-file</em>, previously obtained from
a file <span class="monospaced">open</span> operation. If <em>int-size</em> is not specified, all data in
<em>sym-buffer</em> or <em>str-buffer</em> is written. <span class="monospaced">write</span> returns the number of
bytes written or <span class="monospaced">nil</span> on failure.</p></div>
<div class="paragraph"><p><span class="monospaced">write</span> is a shorter writing of <span class="monospaced">write-buffer</span>. The longer form still
works but is deprecated and should be avoided in new code.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">handle</span> <span class="p">(</span><span class="k">open</span> <span class="s">&quot;myfile.ext&quot;</span> <span class="s">&quot;write&quot;</span><span class="p">))</span>
<span class="p">(</span><span class="k">write</span> <span class="ss">handle</span> <span class="ss">data</span> <span class="ss">100</span><span class="p">)</span>
<span class="p">(</span><span class="k">write</span> <span class="ss">handle</span> <span class="s">&quot;a quick message\n&quot;</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The code in the example writes 100 bytes to the file <span class="monospaced">myfile.ext</span> from
the contents in <span class="monospaced">data</span>.</p></div>
<div class="paragraph"><p>In the second syntax, <span class="monospaced">write</span> can be used for destructive string
appending:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">str</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">write</span> <span class="ss">str</span> <span class="s">&quot;hello world&quot;</span><span class="p">)</span>

<span class="ss">str</span>   <span class="err">→</span> <span class="s">&quot;hello world&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>See also the <a href="#read">read</a> function.</p></div>
<div class="paragraph"><p><a id="write-char"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_write_char_span"><span class="big red">write-char</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (write-char <em>int-file</em> <em>int-byte1</em> [<em>int-byte2</em> &#8230; ])</p></div>
<div class="paragraph"><p>Writes a byte specified in <em>int-byte</em> to a file specified by the file
handle in <em>int-file</em>. The file handle is obtained from a previous <span class="monospaced">open</span>
operation. Each <span class="monospaced">write-char</span> advances the file pointer by one 8-bit
byte.</p></div>
<div class="paragraph"><p><span class="monospaced">write-char</span> returns the number of bytes written.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">slow-file-copy</span> <span class="ss">from-file</span> <span class="ss">to-file</span><span class="p">)</span>
    <span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">in-file</span> <span class="p">(</span><span class="k">open</span> <span class="ss">from-file</span> <span class="s">&quot;read&quot;</span><span class="p">))</span>
    <span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">out-file</span> <span class="p">(</span><span class="k">open</span> <span class="ss">to-file</span> <span class="s">&quot;write&quot;</span><span class="p">))</span>
    <span class="p">(</span><span class="k">while</span> <span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">chr</span> <span class="p">(</span><span class="k">read-char</span> <span class="ss">in-file</span><span class="p">))</span>
        <span class="p">(</span><span class="k">write-char</span> <span class="ss">out-file</span> <span class="ss">chr</span><span class="p">))</span>
     <span class="p">(</span><span class="k">close</span> <span class="ss">in-file</span><span class="p">)</span>
    <span class="p">(</span><span class="k">close</span> <span class="ss">out-file</span><span class="p">)</span>
    <span class="s">&quot;finished&quot;</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>Use the <a href="#print">print</a> and <a href="#device">device</a> functions to write
larger portions of data at a time. Note that newLISP already supplies a
faster built-in function called <a href="#copy-file">copy-file</a>.</p></div>
<div class="paragraph"><p>See also the <a href="#read-char">read-char</a> function.</p></div>
<div class="paragraph"><p><a id="write-file"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_write_file_span"><span class="big red">write-file</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (write-file <em>str-file-name</em> <em>str-buffer</em>)</p></div>
<div class="paragraph"><p>Writes a file in <em>str-file-name</em> with contents in <em>str-buffer</em> in one
swoop and returns the number of bytes written.</p></div>
<div class="paragraph"><p>On failure the function returns <span class="monospaced">nil</span>. For error information, use
<a href="#sys-error">sys-error</a> when used on files. When used on URLs
<a href="#net-error">net-error</a> gives more error information.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">write-</span><span class="ss">file</span> <span class="s">&quot;myfile.enc&quot;</span>
    <span class="p">(</span><span class="k">encrypt</span> <span class="p">(</span><span class="k">read-</span><span class="ss">file</span> <span class="s">&quot;/home/lisp/myFile&quot;</span><span class="p">)</span> <span class="s">&quot;secret&quot;</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p>The file <span class="monospaced">myfile</span> is read, <a href="#encrypt">encrypted</a> using the password
<span class="monospaced">secret</span>, and written back into the new file <span class="monospaced">myfile.enc</span> in the current
directory.</p></div>
<div class="paragraph"><p><span class="monospaced">write-file</span> can take an <span class="monospaced">http://</span> or <span class="monospaced">file://</span> URL in <em>str-file-name</em>.
When the prefix <span class="monospaced">http://</span> is used, <span class="monospaced">write-file</span> works exactly like
<a href="#put-url">put-url</a> and can take the same additional parameters:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">write-</span><span class="ss">file</span> <span class="s">&quot;http://asite.com/message.txt&quot;</span> <span class="s">&quot;This is a message&quot;</span> <span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The file <span class="monospaced">message.txt</span> is created and written at a remote location,
<span class="monospaced">http://asite.com</span>, with the contents of <em>str-buffer</em>. In this mode,
<span class="monospaced">write-file</span> can also be used to transfer files to remote newLISP server
nodes.</p></div>
<div class="paragraph"><p>See also the <a href="#append-file">append-file</a> and
<a href="#read-file">read-file</a> functions.</p></div>
<div class="paragraph"><p><a id="write-line"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_write_line_a_href_destructive_a_span"><span class="big red">write-line <a href="#destructive">!</a></span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (write-line [<em>int-file</em> [<em>str</em>]])<br>
<strong>syntax:</strong> (write-line <em>str-out</em> [<em>str</em>]])</p></div>
<div class="paragraph"><p>The string in <em>str</em> and the line termination character(s) are written to
the device specified in <em>int-file</em>. When the string argument is omitted
<span class="monospaced">write-line</span> writes the contents of the last <a href="#read-line">read-line</a>
to <em>int-file</em> If the first argument is omitted too then it writes to to
standard out (STDOUT) or to whatever device is set by
<a href="#device">device</a>.</p></div>
<div class="paragraph"><p>In the second syntax lines are appended to a string in <em>str-out</em>.</p></div>
<div class="paragraph"><p><span class="monospaced">write-line</span> returns the number of bytes written.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">out-file</span> <span class="p">(</span><span class="k">open</span> <span class="s">&quot;myfile&quot;</span> <span class="s">&quot;write&quot;</span><span class="p">))</span>
<span class="p">(</span><span class="k">write-</span><span class="ss">line</span> <span class="ss">out-file</span> <span class="s">&quot;hello there&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">close</span> <span class="ss">out-file</span><span class="p">)</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">myFile</span> <span class="p">(</span><span class="k">open</span> <span class="s">&quot;init.lsp&quot;</span> <span class="s">&quot;read&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">while</span> <span class="p">(</span><span class="k">read-</span><span class="ss">line</span> <span class="ss">myFile</span><span class="p">)</span> <span class="p">(</span><span class="k">write-</span><span class="ss">line</span><span class="p">))</span>

<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">str</span> <span class="s">&quot;&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">write-</span><span class="ss">line</span> <span class="ss">str</span> <span class="s">&quot;hello&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="k">write-</span><span class="ss">line</span> <span class="ss">str</span> <span class="s">&quot;world&quot;</span><span class="p">)</span>

<span class="ss">str</span>  <span class="err">→</span>  <span class="s">&quot;hello\nworld\n&quot;</span>
</pre></div></div></div>
<div class="paragraph"><p>The first example opens/creates a file, writes a line to it, and closes
the file. The second example shows the usage of <span class="monospaced">write-line</span> without
arguments. The contents of <span class="monospaced">init.lsp</span> are written to the console screen.</p></div>
<div class="paragraph"><p>See also the function <a href="#write">write</a> for writing to a device without
the line-terminating character.</p></div>
<div class="paragraph"><p><a id="xfer-event"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_xfer_event_span"><span class="big red">xfer-event</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (xfer-event <em>sym-event-handler</em> | <em>func-event-handler</em>)</p></div>
<div class="paragraph"><p>Registers a function in symbol <em>sym-event-handler</em> or in lambda function
<em>func-event-handler</em> to monitor HTTP byte transfers initiated by
<a href="#get-url">get-url</a>, <a href="#post-url">post-url</a> or
<a href="#put-url">put-url</a> or initiated by file functions which can take
URLs like <a href="#load">load</a>, <a href="#save">save</a>,
<a href="#read-file">read-file</a>, <a href="#write-file">write-file</a> and
<a href="#append-file">append-file</a>.</p></div>
<div class="paragraph"><p>E.g. whenever a block of data requested with <a href="#get-url">get-url</a>
arrives the function in <em>sym</em> or <em>func</em> will be called with the number
of bytes transferred. Likewise when sending data with
<a href="#post-url">post-url</a> or any of the other data sending functions,
<em>sym</em> or <em>func</em> will be called with the number of bytes transferred for
each block of data transferred.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">xfer-event</span> <span class="p">(</span><span class="k">fn</span> <span class="p">(</span><span class="nv">n</span><span class="p">)</span> <span class="p">(</span><span class="k">println</span> <span class="s">&quot;-&gt;&quot;</span> <span class="ss">n</span><span class="p">)))</span>
<span class="p">(</span><span class="k">length</span> <span class="p">(</span><span class="k">get-url</span> <span class="s">&quot;http://newlisp.org&quot;</span><span class="p">))</span>

<span class="ss">-&gt;73</span>
<span class="ss">-&gt;799</span>
<span class="ss">-&gt;1452</span>
<span class="ss">-&gt;351</span>
<span class="ss">-&gt;1093</span>
<span class="ss">-&gt;352</span>
<span class="ss">-&gt;211</span>
<span class="ss">-&gt;885</span>
<span class="ss">-&gt;564</span>
<span class="ss">-&gt;884</span>
<span class="ss">-&gt;561</span>
<span class="ss">-&gt;75</span>
<span class="ss">-&gt;812</span>
<span class="ss">-&gt;638</span>
<span class="ss">-&gt;1452</span>
<span class="ss">-&gt;801</span>
<span class="ss">-&gt;5</span>
<span class="ss">-&gt;927</span>
<span class="ss">11935</span>
</pre></div></div></div>
<div class="paragraph"><p>The computer output is shown in bold. Whenever a block of data is
received its byte size is printed. Instead of defining the handler
function directory with a lambda function in <em>func</em>, a symbol containing
a function definition could have been used:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">report</span> <span class="ss">n</span><span class="p">)</span> <span class="p">(</span><span class="k">println</span> <span class="s">&quot;-&gt;&quot;</span> <span class="ss">n</span><span class="p">))</span>
<span class="p">(</span><span class="k">xfer-event</span> <span class="o">&#39;</span><span class="ss">report</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>This can be used to monitor the progress of longer lasting byte
transfers in HTTP uploads or downloads.</p></div>
<div class="paragraph"><p><a id="xml-error"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_xml_error_span"><span class="big red">xml-error</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (xml-error)</p></div>
<div class="paragraph"><p>Returns a list of error information from the last
<a href="#xml-parse">xml-parse</a> operation; otherwise, returns <span class="monospaced">nil</span> if no
error occurred. The first element contains text describing the error,
and the second element is a number indicating the last scan position in
the source XML text, starting at <span class="monospaced">0</span> (zero).</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">xml-parse</span> <span class="s">&quot;&lt;atag&gt;hello&lt;/atag&gt;&lt;fin&quot;</span><span class="p">)</span>  <span class="err">→</span> <span class="k">nil</span>

<span class="p">(</span><span class="k">xml-error</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="s">&quot;expected closing tag: &gt;&quot;</span> <span class="ss">18</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p><a id="xml-parse"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_xml_parse_span"><span class="big red">xml-parse</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (xml-parse <em>string-xml</em> [<em>int-options</em> [<em>sym-context</em> [<em>func-callback</em>]]])</p></div>
<div class="paragraph"><p>Parses a string containing XML 1.0 compliant, <em>well-formed</em> XML.
<span class="monospaced">xml-parse</span> does not perform DTD validation. It skips DTDs (Document
Type Declarations) and processing instructions. Nodes of type ELEMENT,
TEXT, CDATA, and COMMENT are parsed, and a newLISP list structure is
returned. When an element node does not have attributes or child nodes,
it instead contains an empty list. Attributes are returned as
association lists, which can be accessed using <a href="#assoc">assoc</a>. When
<span class="monospaced">xml-parse</span> fails due to malformed XML, <span class="monospaced">nil</span> is returned and
<a href="#xml-error">xml-error</a> can be used to access error information.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">xml</span>
  <span class="s">&quot;&lt;person name=&#39;John Doe&#39; tel=&#39;555-1212&#39;&gt;nice guy&lt;/person&gt;&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">xml-parse</span> <span class="ss">xml</span><span class="p">)</span>
<span class="err">→</span> <span class="p">((</span><span class="s">&quot;ELEMENT&quot;</span> <span class="s">&quot;person&quot;</span>
    <span class="p">((</span><span class="s">&quot;name&quot;</span> <span class="s">&quot;John Doe&quot;</span><span class="p">)</span>
     <span class="p">(</span><span class="s">&quot;tel&quot;</span> <span class="s">&quot;555-1212&quot;</span><span class="p">))</span>
    <span class="p">((</span><span class="s">&quot;TEXT&quot;</span> <span class="s">&quot;nice guy&quot;</span><span class="p">))))</span>
</pre></div></div></div>
</div>
<div class="sect3">
<h4 id="_modifying_the_translation_process">Modifying the translation process</h4>
<div class="paragraph"><p>Optionally, the <em>int-options</em> parameter can be specified to suppress
whitespace, empty attribute lists, and comments. It can also be used to
transform tags from strings into symbols. Another function,
<a href="#xml-type-tags">xml-type-tags</a>, serves for translating the XML tags.
The following option numbers can be used:</p></div>
<table class="tableblock frame-all grid-all"
style="
width:30%;
">
<col style="width:20%;">
<col style="width:80%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" >option </th>
<th class="tableblock halign-left valign-top" >description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">suppress whitespace text tags</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">suppress empty attribute lists</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">suppress comment tags</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">translate string tags into symbols</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">16</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">add SXML (S-expression XML) attribute tags</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>Options can be combined by adding the numbers (e.g., <span class="monospaced">3</span> would combine
the options for suppressing whitespace text tags/info and empty
attribute lists).</p></div>
<div class="paragraph"><p>The following examples show how the different options can be used:</p></div>
<div class="listingblock">
<div class="title">XML source:</div>
<div class="content"><div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; ?&gt;</span>
<span class="nt">&lt;DATABASE</span> <span class="na">name=</span><span class="s">&quot;example.xml&quot;</span><span class="nt">&gt;</span>
<span class="c">&lt;!--This is a database of fruits--&gt;</span>
    <span class="nt">&lt;FRUIT&gt;</span>
        <span class="nt">&lt;NAME&gt;</span>apple<span class="nt">&lt;/NAME&gt;</span>
        <span class="nt">&lt;COLOR&gt;</span>red<span class="nt">&lt;/COLOR&gt;</span>
        <span class="nt">&lt;PRICE&gt;</span>0.80<span class="nt">&lt;/PRICE&gt;</span>
    <span class="nt">&lt;/FRUIT&gt;</span>

    <span class="nt">&lt;FRUIT&gt;</span>
        <span class="nt">&lt;NAME&gt;</span>orange<span class="nt">&lt;/NAME&gt;</span>
        <span class="nt">&lt;COLOR&gt;</span>orange<span class="nt">&lt;/COLOR&gt;</span>
        <span class="nt">&lt;PRICE&gt;</span>1.00<span class="nt">&lt;/PRICE&gt;</span>
    <span class="nt">&lt;/FRUIT&gt;</span>

    <span class="nt">&lt;FRUIT&gt;</span>
       <span class="nt">&lt;NAME&gt;</span>banana<span class="nt">&lt;/NAME&gt;</span>
       <span class="nt">&lt;COLOR&gt;</span>yellow<span class="nt">&lt;/COLOR&gt;</span>
       <span class="nt">&lt;PRICE&gt;</span>0.60<span class="nt">&lt;/PRICE&gt;</span>
    <span class="nt">&lt;/FRUIT&gt;</span>
<span class="nt">&lt;/DATABASE&gt;</span>
</pre></div></div></div>
<div class="listingblock">
<div class="title">Parsing without any options:</div>
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">xml-parse</span> <span class="p">(</span><span class="k">read-</span><span class="ss">file</span> <span class="s">&quot;example.xml&quot;</span><span class="p">))</span>
<span class="err">→</span> <span class="p">((</span><span class="s">&quot;ELEMENT&quot;</span> <span class="s">&quot;DATABASE&quot;</span> <span class="p">((</span><span class="s">&quot;name&quot;</span> <span class="s">&quot;example.xml&quot;</span><span class="p">))</span> <span class="p">((</span><span class="s">&quot;TEXT&quot;</span> <span class="s">&quot;\r\n\t&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&quot;COMMENT&quot;</span> <span class="s">&quot;This is a database of fruits&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&quot;TEXT&quot;</span> <span class="s">&quot;\r\n\t&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&quot;ELEMENT&quot;</span> <span class="s">&quot;FRUIT&quot;</span> <span class="p">()</span> <span class="p">((</span><span class="s">&quot;TEXT&quot;</span> <span class="s">&quot;\r\n\t\t&quot;</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;ELEMENT&quot;</span> <span class="s">&quot;NAME&quot;</span> <span class="p">()</span>
       <span class="p">((</span><span class="s">&quot;TEXT&quot;</span> <span class="s">&quot;apple&quot;</span><span class="p">)))</span>
      <span class="p">(</span><span class="s">&quot;TEXT&quot;</span> <span class="s">&quot;\r\n\t\t&quot;</span><span class="p">)</span>
      <span class="p">(</span><span class="s">&quot;ELEMENT&quot;</span> <span class="s">&quot;COLOR&quot;</span> <span class="p">()</span> <span class="p">((</span><span class="s">&quot;TEXT&quot;</span> <span class="s">&quot;red&quot;</span><span class="p">)))</span>
      <span class="p">(</span><span class="s">&quot;TEXT&quot;</span> <span class="s">&quot;\r\n\t\t&quot;</span><span class="p">)</span>
      <span class="p">(</span><span class="s">&quot;ELEMENT&quot;</span> <span class="s">&quot;PRICE&quot;</span> <span class="p">()</span> <span class="p">((</span><span class="s">&quot;TEXT&quot;</span> <span class="s">&quot;0.80&quot;</span><span class="p">)))</span>
      <span class="p">(</span><span class="s">&quot;TEXT&quot;</span> <span class="s">&quot;\r\n\t&quot;</span><span class="p">)))</span>
    <span class="p">(</span><span class="s">&quot;TEXT&quot;</span> <span class="s">&quot;\r\n\r\n\t&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&quot;ELEMENT&quot;</span> <span class="s">&quot;FRUIT&quot;</span> <span class="p">()</span> <span class="p">((</span><span class="s">&quot;TEXT&quot;</span> <span class="s">&quot;\r\n\t\t&quot;</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;ELEMENT&quot;</span> <span class="s">&quot;NAME&quot;</span> <span class="p">()</span>
       <span class="p">((</span><span class="s">&quot;TEXT&quot;</span> <span class="s">&quot;orange&quot;</span><span class="p">)))</span>
      <span class="p">(</span><span class="s">&quot;TEXT&quot;</span> <span class="s">&quot;\r\n\t\t&quot;</span><span class="p">)</span>
      <span class="p">(</span><span class="s">&quot;ELEMENT&quot;</span> <span class="s">&quot;COLOR&quot;</span> <span class="p">()</span> <span class="p">((</span><span class="s">&quot;TEXT&quot;</span> <span class="s">&quot;orange&quot;</span><span class="p">)))</span>
      <span class="p">(</span><span class="s">&quot;TEXT&quot;</span> <span class="s">&quot;\r\n\t\t&quot;</span><span class="p">)</span>
      <span class="p">(</span><span class="s">&quot;ELEMENT&quot;</span> <span class="s">&quot;PRICE&quot;</span> <span class="p">()</span> <span class="p">((</span><span class="s">&quot;TEXT&quot;</span> <span class="s">&quot;1.00&quot;</span><span class="p">)))</span>
      <span class="p">(</span><span class="s">&quot;TEXT&quot;</span> <span class="s">&quot;\r\n\t&quot;</span><span class="p">)))</span>
    <span class="p">(</span><span class="s">&quot;TEXT&quot;</span> <span class="s">&quot;\r\n\r\n\t&quot;</span><span class="p">)</span>
    <span class="p">(</span><span class="s">&quot;ELEMENT&quot;</span> <span class="s">&quot;FRUIT&quot;</span> <span class="p">()</span> <span class="p">((</span><span class="s">&quot;TEXT&quot;</span> <span class="s">&quot;\r\n\t\t&quot;</span><span class="p">)</span> <span class="p">(</span><span class="s">&quot;ELEMENT&quot;</span> <span class="s">&quot;NAME&quot;</span> <span class="p">()</span>
       <span class="p">((</span><span class="s">&quot;TEXT&quot;</span> <span class="s">&quot;banana&quot;</span><span class="p">)))</span>
      <span class="p">(</span><span class="s">&quot;TEXT&quot;</span> <span class="s">&quot;\r\n\t\t&quot;</span><span class="p">)</span>
      <span class="p">(</span><span class="s">&quot;ELEMENT&quot;</span> <span class="s">&quot;COLOR&quot;</span> <span class="p">()</span> <span class="p">((</span><span class="s">&quot;TEXT&quot;</span> <span class="s">&quot;yellow&quot;</span><span class="p">)))</span>
      <span class="p">(</span><span class="s">&quot;TEXT&quot;</span> <span class="s">&quot;\r\n\t\t&quot;</span><span class="p">)</span>
      <span class="p">(</span><span class="s">&quot;ELEMENT&quot;</span> <span class="s">&quot;PRICE&quot;</span> <span class="p">()</span> <span class="p">((</span><span class="s">&quot;TEXT&quot;</span> <span class="s">&quot;0.60&quot;</span><span class="p">)))</span>
      <span class="p">(</span><span class="s">&quot;TEXT&quot;</span> <span class="s">&quot;\r\n\t&quot;</span><span class="p">)))</span>
    <span class="p">(</span><span class="s">&quot;TEXT&quot;</span> <span class="s">&quot;\r\n&quot;</span><span class="p">))))</span>
</pre></div></div></div>
<div class="paragraph"><p>The <span class="monospaced">TEXT</span> elements containing only whitespace make the output very
confusing. As the database in <span class="monospaced">example.xml</span> only contains data, we can
suppress whitespace, empty attribute lists and comments with option
<span class="monospaced">(+ 1 2 4)</span>:</p></div>
<div class="listingblock">
<div class="title">Filtering whitespace TEXT, COMMENT tags, and empty attribute lists:</div>
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">xml-parse</span> <span class="p">(</span><span class="k">read-</span><span class="ss">file</span> <span class="s">&quot;example.xml&quot;</span><span class="p">)</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">1</span> <span class="ss">2</span> <span class="ss">4</span><span class="p">))</span>
<span class="err">→</span> <span class="p">((</span><span class="s">&quot;ELEMENT&quot;</span> <span class="s">&quot;DATABASE&quot;</span> <span class="p">((</span><span class="s">&quot;name&quot;</span> <span class="s">&quot;example.xml&quot;</span><span class="p">))</span> <span class="p">(</span>
     <span class="p">(</span><span class="s">&quot;ELEMENT&quot;</span> <span class="s">&quot;FRUIT&quot;</span> <span class="p">(</span>
       <span class="p">(</span><span class="s">&quot;ELEMENT&quot;</span> <span class="s">&quot;NAME&quot;</span> <span class="p">((</span><span class="s">&quot;TEXT&quot;</span> <span class="s">&quot;apple&quot;</span><span class="p">)))</span>
       <span class="p">(</span><span class="s">&quot;ELEMENT&quot;</span> <span class="s">&quot;COLOR&quot;</span> <span class="p">((</span><span class="s">&quot;TEXT&quot;</span> <span class="s">&quot;red&quot;</span><span class="p">)))</span>
       <span class="p">(</span><span class="s">&quot;ELEMENT&quot;</span> <span class="s">&quot;PRICE&quot;</span> <span class="p">((</span><span class="s">&quot;TEXT&quot;</span> <span class="s">&quot;0.80&quot;</span><span class="p">)))))</span>
     <span class="p">(</span><span class="s">&quot;ELEMENT&quot;</span> <span class="s">&quot;FRUIT&quot;</span> <span class="p">(</span>
       <span class="p">(</span><span class="s">&quot;ELEMENT&quot;</span> <span class="s">&quot;NAME&quot;</span> <span class="p">((</span><span class="s">&quot;TEXT&quot;</span> <span class="s">&quot;orange&quot;</span><span class="p">)))</span>
       <span class="p">(</span><span class="s">&quot;ELEMENT&quot;</span> <span class="s">&quot;COLOR&quot;</span> <span class="p">((</span><span class="s">&quot;TEXT&quot;</span> <span class="s">&quot;orange&quot;</span><span class="p">)))</span>
       <span class="p">(</span><span class="s">&quot;ELEMENT&quot;</span> <span class="s">&quot;PRICE&quot;</span> <span class="p">((</span><span class="s">&quot;TEXT&quot;</span> <span class="s">&quot;1.00&quot;</span><span class="p">)))))</span>
     <span class="p">(</span><span class="s">&quot;ELEMENT&quot;</span> <span class="s">&quot;FRUIT&quot;</span> <span class="p">(</span>
       <span class="p">(</span><span class="s">&quot;ELEMENT&quot;</span> <span class="s">&quot;NAME&quot;</span> <span class="p">((</span><span class="s">&quot;TEXT&quot;</span> <span class="s">&quot;banana&quot;</span><span class="p">)))</span>
       <span class="p">(</span><span class="s">&quot;ELEMENT&quot;</span> <span class="s">&quot;COLOR&quot;</span> <span class="p">((</span><span class="s">&quot;TEXT&quot;</span> <span class="s">&quot;yellow&quot;</span><span class="p">)))</span>
       <span class="p">(</span><span class="s">&quot;ELEMENT&quot;</span> <span class="s">&quot;PRICE&quot;</span> <span class="p">((</span><span class="s">&quot;TEXT&quot;</span> <span class="s">&quot;0.60&quot;</span><span class="p">))))))))</span>
</pre></div></div></div>
<div class="paragraph"><p>The resulting output looks much more readable, but it can still be
improved by using symbols instead of strings for the tags "FRUIT",
"NAME", "COLOR", and "PRICE", as well as by suppressing the XML type
tags "ELEMENT" and "TEXT" completely using the
<a href="#xml-type-tags">xml-type-tags</a> directive.</p></div>
<div class="listingblock">
<div class="title">Suppressing XML type tags with <a href="#xml-type-tags">xml-type-tags</a> and translating string tags into symbol tags:</div>
<div class="content"><div class="highlight"><pre><span class="c1">;; suppress all XML type tags for TEXT and ELEMENT</span>
<span class="c1">;; instead of &quot;CDATA&quot;, use cdata and instead of &quot;COMMENT&quot;, use !--</span>

<span class="p">(</span><span class="k">xml-type-tags</span> <span class="k">nil</span> <span class="o">&#39;</span><span class="ss">cdata</span> <span class="o">&#39;</span><span class="ss">!--</span> <span class="k">nil</span><span class="p">)</span>

<span class="c1">;; turn on all options for suppressing whitespace and empty</span>
<span class="c1">;; attributes, translate tags to symbols</span>

<span class="p">(</span><span class="k">xml-parse</span> <span class="p">(</span><span class="k">read-</span><span class="ss">file</span> <span class="s">&quot;example.xml&quot;</span><span class="p">)</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">1</span> <span class="ss">2</span> <span class="ss">8</span><span class="p">))</span>
<span class="err">→</span> <span class="p">((</span><span class="nv">DATABASE</span> <span class="p">((</span><span class="s">&quot;name&quot;</span> <span class="s">&quot;example.xml&quot;</span><span class="p">))</span>
     <span class="p">(</span><span class="nv">!--</span> <span class="s">&quot;This is a database of fruits&quot;</span><span class="p">)</span>
     <span class="p">(</span><span class="nv">FRUIT</span> <span class="p">(</span><span class="nv">NAME</span> <span class="s">&quot;apple&quot;</span><span class="p">)</span> <span class="p">(</span><span class="nv">COLOR</span> <span class="s">&quot;red&quot;</span><span class="p">)</span> <span class="p">(</span><span class="nv">PRICE</span> <span class="s">&quot;0.80&quot;</span><span class="p">))</span>
     <span class="p">(</span><span class="nv">FRUIT</span> <span class="p">(</span><span class="nv">NAME</span> <span class="s">&quot;orange&quot;</span><span class="p">)</span> <span class="p">(</span><span class="nv">COLOR</span> <span class="s">&quot;orange&quot;</span><span class="p">)</span> <span class="p">(</span><span class="nv">PRICE</span> <span class="s">&quot;1.00&quot;</span><span class="p">))</span>
     <span class="p">(</span><span class="nv">FRUIT</span> <span class="p">(</span><span class="nv">NAME</span> <span class="s">&quot;banana&quot;</span><span class="p">)</span> <span class="p">(</span><span class="nv">COLOR</span> <span class="s">&quot;yellow&quot;</span><span class="p">)</span> <span class="p">(</span><span class="nv">PRICE</span> <span class="s">&quot;0.60&quot;</span><span class="p">))))</span>
</pre></div></div></div>
<div class="paragraph"><p>When tags are translated into symbols by using option <span class="monospaced">8</span>, a context can
be specified in <em>sym-context</em>. If no context is specified, all symbols
will be created inside the current context.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">xml-type-tags</span> <span class="k">nil</span> <span class="k">nil</span> <span class="k">nil</span> <span class="k">nil</span><span class="p">)</span>
<span class="p">(</span><span class="k">xml-parse</span> <span class="s">&quot;&lt;msg&gt;Hello World&lt;/msg&gt;&quot;</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">1</span> <span class="ss">2</span> <span class="ss">4</span> <span class="ss">8</span> <span class="ss">16</span><span class="p">)</span> <span class="o">&#39;</span><span class="ss">CTX</span><span class="p">)</span>
<span class="err">→</span> <span class="p">((</span><span class="nv">CTX</span><span class="o">:</span><span class="ss">msg</span> <span class="s">&quot;Hello World&quot;</span><span class="p">))</span>
</pre></div></div></div>
<div class="paragraph"><p>Specifying <span class="monospaced">nil</span> for the XML type tags TEXT and ELEMENT makes them
disappear. At the same time, parentheses of the child node list are
removed so that child nodes now appear as members of the list, starting
with the tag symbol translated from the string tags "FRUIT", "NAME",
etcetera.</p></div>
<div class="paragraph"><div class="title">Parsing into SXML (S-expressions XML) format:</div><p>Using <a href="#xml-type-tags">xml-type-tags</a> to suppress all XML-type
tags—along with the option numbers <span class="monospaced">1</span>, <span class="monospaced">2</span>, <span class="monospaced">4</span>, <span class="monospaced">8</span>, and `16`—SXML
formatted output can be generated:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">xml-type-tags</span> <span class="k">nil</span> <span class="k">nil</span> <span class="k">nil</span> <span class="k">nil</span><span class="p">)</span>
<span class="p">(</span><span class="k">xml-parse</span> <span class="p">(</span><span class="k">read-</span><span class="ss">file</span> <span class="s">&quot;example.xml&quot;</span><span class="p">)</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">1</span> <span class="ss">2</span> <span class="ss">4</span> <span class="ss">8</span> <span class="ss">16</span><span class="p">))</span>
<span class="err">→</span> <span class="p">((</span><span class="nv">DATABASE</span> <span class="p">(</span><span class="nv">@</span> <span class="p">(</span><span class="nv">name</span> <span class="s">&quot;example.xml&quot;</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">FRUIT</span> <span class="p">(</span><span class="nv">NAME</span> <span class="s">&quot;apple&quot;</span><span class="p">)</span> <span class="p">(</span><span class="nv">COLOR</span> <span class="s">&quot;red&quot;</span><span class="p">)</span> <span class="p">(</span><span class="nv">PRICE</span> <span class="s">&quot;0.80&quot;</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">FRUIT</span> <span class="p">(</span><span class="nv">NAME</span> <span class="s">&quot;orange&quot;</span><span class="p">)</span> <span class="p">(</span><span class="nv">COLOR</span> <span class="s">&quot;orange&quot;</span><span class="p">)</span> <span class="p">(</span><span class="nv">PRICE</span> <span class="s">&quot;1.00&quot;</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">FRUIT</span> <span class="p">(</span><span class="nv">NAME</span> <span class="s">&quot;banana&quot;</span><span class="p">)</span> <span class="p">(</span><span class="nv">COLOR</span> <span class="s">&quot;yellow&quot;</span><span class="p">)</span> <span class="p">(</span><span class="nv">PRICE</span> <span class="s">&quot;0.60&quot;</span><span class="p">))))</span>
</pre></div></div></div>
<div class="paragraph"><p>Note that using option number <span class="monospaced">16</span> causes an <span class="monospaced">@</span> (at symbol) to be added
to attribute lists.</p></div>
<div class="paragraph"><p>See also the <a href="#xml-type-tags">xml-type-tags</a> function for further
information on XML parsing.</p></div>
<div class="paragraph"><div class="title">Parsing into a specified context:</div><p>When parsing XML expressions, XML tags are translated into newLISP
symbols. The <em>sym-context</em> option specifies the target context for the
symbol creation:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">xml-type-tags</span> <span class="k">nil</span> <span class="k">nil</span> <span class="k">nil</span> <span class="k">nil</span><span class="p">)</span>
<span class="p">(</span><span class="k">xml-parse</span> <span class="p">(</span><span class="k">read-</span><span class="ss">file</span> <span class="s">&quot;example.xml&quot;</span><span class="p">)</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">1</span> <span class="ss">2</span> <span class="ss">4</span> <span class="ss">8</span> <span class="ss">16</span><span class="p">)</span> <span class="o">&#39;</span><span class="ss">CTX</span><span class="p">)</span>
<span class="err">→</span><span class="p">((</span><span class="nv">CTX</span><span class="o">:</span><span class="ss">DATABASE</span> <span class="p">(</span><span class="nv">@</span> <span class="p">(</span><span class="nv">CTX</span><span class="o">:</span><span class="ss">name</span> <span class="s">&quot;example.xml&quot;</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">CTX</span><span class="o">:</span><span class="ss">FRUIT</span> <span class="p">(</span><span class="nv">CTX</span><span class="o">:</span><span class="ss">NAME</span> <span class="s">&quot;apple&quot;</span><span class="p">)</span> <span class="p">(</span><span class="nv">CTX</span><span class="o">:</span><span class="ss">COLOR</span> <span class="s">&quot;red&quot;</span><span class="p">)</span> <span class="p">(</span><span class="nv">CTX</span><span class="o">:</span><span class="ss">PRICE</span> <span class="s">&quot;0.80&quot;</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">CTX</span><span class="o">:</span><span class="ss">FRUIT</span> <span class="p">(</span><span class="nv">CTX</span><span class="o">:</span><span class="ss">NAME</span> <span class="s">&quot;orange&quot;</span><span class="p">)</span> <span class="p">(</span><span class="nv">CTX</span><span class="o">:</span><span class="ss">COLOR</span> <span class="s">&quot;orange&quot;</span><span class="p">)</span> <span class="p">(</span><span class="nv">CTX</span><span class="o">:</span><span class="ss">PRICE</span> <span class="s">&quot;1.00&quot;</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">CTX</span><span class="o">:</span><span class="ss">FRUIT</span> <span class="p">(</span><span class="nv">CTX</span><span class="o">:</span><span class="ss">NAME</span> <span class="s">&quot;banana&quot;</span><span class="p">)</span> <span class="p">(</span><span class="nv">CTX</span><span class="o">:</span><span class="ss">COLOR</span> <span class="s">&quot;yellow&quot;</span><span class="p">)</span> <span class="p">(</span><span class="nv">CTX</span><span class="o">:</span><span class="ss">PRICE</span> <span class="s">&quot;0.60&quot;</span><span class="p">))))</span>
</pre></div></div></div>
<div class="paragraph"><p>If the context does not exist, it will be created. If it exists, the
quote can be omitted or the context can be referred to by a variable.</p></div>
<div class="paragraph"><div class="title">Using a call back function:</div><p>Normally, <span class="monospaced">xml-parse</span> will not return until all parsing has finished.
Using the <em>func-callback</em> option, <span class="monospaced">xml-parse</span> will call back after each
tag closing with the generated S-expression and a start position and
length in the source XML:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">;; demo callback feature</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="nv">xml-callback</span> <span class="ss">s-expr</span> <span class="ss">start</span> <span class="ss">size</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if</span> <span class="p">(</span><span class="k">or</span> <span class="p">(</span><span class="nv">=</span> <span class="p">(</span><span class="nv">s-expr</span> <span class="ss">0</span><span class="p">)</span> <span class="o">&#39;</span><span class="ss">NAME</span><span class="p">)</span> <span class="p">(</span><span class="nv">=</span> <span class="p">(</span><span class="nv">s-expr</span> <span class="ss">0</span><span class="p">)</span> <span class="o">&#39;</span><span class="ss">COLOR</span><span class="p">)</span> <span class="p">(</span><span class="nv">=</span> <span class="p">(</span><span class="nv">s-expr</span> <span class="ss">0</span><span class="p">)</span> <span class="o">&#39;</span><span class="ss">PRICE</span><span class="p">))</span>
        <span class="p">(</span><span class="k">begin</span>
            <span class="p">(</span><span class="k">print</span> <span class="s">&quot;parsed expression:&quot;</span> <span class="ss">s-expr</span><span class="p">)</span>
            <span class="p">(</span><span class="k">println</span> <span class="s">&quot;, source:&quot;</span> <span class="p">(</span><span class="nv">start</span> <span class="ss">size</span> <span class="ss">example-xml</span><span class="p">))</span>
        <span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="p">(</span><span class="k">xml-type-tags</span> <span class="k">nil</span> <span class="o">&#39;</span><span class="ss">cdata</span> <span class="o">&#39;</span><span class="ss">!--</span> <span class="k">nil</span><span class="p">)</span>
<span class="p">(</span><span class="k">xml-parse</span>  <span class="p">(</span><span class="k">read-</span><span class="ss">file</span> <span class="s">&quot;example.xml&quot;</span><span class="p">)</span> <span class="p">(</span><span class="nv">+</span> <span class="ss">1</span> <span class="ss">2</span> <span class="ss">8</span><span class="p">)</span> <span class="k">MAIN</span> <span class="ss">xml-callback</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The following output will be generated by the callback function
<span class="monospaced">xml-callback</span>:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="ss">parsed</span> <span class="ss">expression</span><span class="o">:</span><span class="p">(</span><span class="nv">NAME</span> <span class="s">&quot;apple&quot;</span><span class="p">)</span><span class="ss">,</span> <span class="k">source</span><span class="o">:</span><span class="k">&lt;</span><span class="ss">NAME&gt;apple&lt;/NAME&gt;</span>
<span class="ss">parsed</span> <span class="ss">expression</span><span class="o">:</span><span class="p">(</span><span class="nv">COLOR</span> <span class="s">&quot;red&quot;</span><span class="p">)</span><span class="ss">,</span> <span class="k">source</span><span class="o">:</span><span class="k">&lt;</span><span class="ss">COLOR&gt;red&lt;/COLOR&gt;</span>
<span class="ss">parsed</span> <span class="ss">expression</span><span class="o">:</span><span class="p">(</span><span class="nv">PRICE</span> <span class="s">&quot;0.80&quot;</span><span class="p">)</span><span class="ss">,</span> <span class="k">source</span><span class="o">:</span><span class="k">&lt;</span><span class="ss">PRICE&gt;0.80&lt;/PRICE&gt;</span>
<span class="ss">parsed</span> <span class="ss">expression</span><span class="o">:</span><span class="p">(</span><span class="nv">NAME</span> <span class="s">&quot;orange&quot;</span><span class="p">)</span><span class="ss">,</span> <span class="k">source</span><span class="o">:</span><span class="k">&lt;</span><span class="ss">NAME&gt;orange&lt;/NAME&gt;</span>
<span class="ss">parsed</span> <span class="ss">expression</span><span class="o">:</span><span class="p">(</span><span class="nv">COLOR</span> <span class="s">&quot;orange&quot;</span><span class="p">)</span><span class="ss">,</span> <span class="k">source</span><span class="o">:</span><span class="k">&lt;</span><span class="ss">COLOR&gt;orange&lt;/COLOR&gt;</span>
<span class="ss">parsed</span> <span class="ss">expression</span><span class="o">:</span><span class="p">(</span><span class="nv">PRICE</span> <span class="s">&quot;1.00&quot;</span><span class="p">)</span><span class="ss">,</span> <span class="k">source</span><span class="o">:</span><span class="k">&lt;</span><span class="ss">PRICE&gt;1.00&lt;/PRICE&gt;</span>
<span class="ss">parsed</span> <span class="ss">expression</span><span class="o">:</span><span class="p">(</span><span class="nv">NAME</span> <span class="s">&quot;banana&quot;</span><span class="p">)</span><span class="ss">,</span> <span class="k">source</span><span class="o">:</span><span class="k">&lt;</span><span class="ss">NAME&gt;banana&lt;/NAME&gt;</span>
<span class="ss">parsed</span> <span class="ss">expression</span><span class="o">:</span><span class="p">(</span><span class="nv">COLOR</span> <span class="s">&quot;yellow&quot;</span><span class="p">)</span><span class="ss">,</span> <span class="k">source</span><span class="o">:</span><span class="k">&lt;</span><span class="ss">COLOR&gt;yellow&lt;/COLOR&gt;</span>
<span class="ss">parsed</span> <span class="ss">expression</span><span class="o">:</span><span class="p">(</span><span class="nv">PRICE</span> <span class="s">&quot;0.60&quot;</span><span class="p">)</span><span class="ss">,</span> <span class="k">source</span><span class="o">:</span><span class="k">&lt;</span><span class="ss">PRICE&gt;0.60&lt;/PRICE&gt;</span>
</pre></div></div></div>
<div class="paragraph"><p>The example callback handler function filters the tags of interest and
processes them as they occur.</p></div>
<div class="paragraph"><p><a id="xml-type-tags"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_xml_type_tags_span"><span class="big red">xml-type-tags</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (xml-type-tags [<em>exp-text-tag</em> <em>exp-cdata-tag</em> <em>exp-comment-tag</em> <em>exp-element-tags</em>])</p></div>
<div class="paragraph"><p>Can suppress completely or replace the XML type tags "TEXT", "CDATA",
"COMMENT", and "ELEMENT" with something else specified in the
parameters.</p></div>
<div class="paragraph"><p>Note that <span class="monospaced">xml-type-tags</span> only suppresses or translates the tags
themselves but does not suppress or modify the tagged information. The
latter would be done using option numbers in <a href="#xml-parse">xml-parse</a>.</p></div>
<div class="paragraph"><p>Using <span class="monospaced">xml-type-tags</span> without arguments returns the current type tags:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">xml-type-tags</span><span class="p">)</span>  <span class="err">→</span> <span class="p">(</span><span class="s">&quot;TEXT&quot;</span> <span class="s">&quot;CDATA&quot;</span> <span class="s">&quot;COMMENT&quot;</span> <span class="s">&quot;ELEMENT&quot;</span><span class="p">)</span>

<span class="p">(</span><span class="k">xml-type-tags</span> <span class="k">nil</span> <span class="o">&#39;</span><span class="ss">cdata</span> <span class="o">&#39;</span><span class="ss">!--</span> <span class="k">nil</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>The first example just shows the currently used type tags. The second
example specifies suppression of the "TEXT" and "ELEMENT" tags and shows
<span class="monospaced">cdata</span> and <span class="monospaced">!--</span> instead of "CDATA" and "COMMENT".</p></div>
<div class="paragraph"><p><a id="zero?"></a></p></div>
</div>
<div class="sect3">
<h4 id="_span_class_big_red_zero_span"><span class="big red">zero?</span></h4>
<div class="paragraph"><p><strong>syntax:</strong> (zero? <em>exp</em>)</p></div>
<div class="paragraph"><p>Checks the evaluation of <em>exp</em> to see if it equals <span class="monospaced">0</span> (zero).</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">value</span> <span class="ss">1.2</span><span class="p">)</span>
<span class="p">(</span><span class="k">set</span> <span class="o">&#39;</span><span class="ss">var</span> <span class="ss">0</span><span class="p">)</span>
<span class="p">(</span><span class="nv">zero?</span> <span class="ss">value</span><span class="p">)</span>  <span class="err">→</span> <span class="k">nil</span>
<span class="p">(</span><span class="nv">zero?</span> <span class="ss">var</span><span class="p">)</span>    <span class="err">→</span> <span class="k">true</span>

<span class="p">(</span><span class="k">map</span> <span class="ss">zero?</span> <span class="o">&#39;</span><span class="p">(</span><span class="nv">0</span> <span class="ss">0.0</span> <span class="ss">3.4</span> <span class="ss">4</span><span class="p">))</span>  <span class="err">→</span> <span class="p">(</span><span class="k">true</span> <span class="k">true</span> <span class="k">nil</span> <span class="k">nil</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p><span class="monospaced">zero?</span> will return <span class="monospaced">nil</span> on data types other than numbers.</p></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_appendix">Appendix</h2>
<div class="sectionbody">
<div class="sect3">
<h4 id="_error_codes">Error codes</h4>
<table class="tableblock frame-all grid-all"
style="
width:25%;
">
<col style="width:9%;">
<col style="width:90%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" >no </th>
<th class="tableblock halign-left valign-top" >description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">not enough memory</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">environment stack overflow</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">call stack overflow</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">problem accessing file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">not an expression</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">missing parenthesis</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">string token too long</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">missing argument</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">number or string expected</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">value expected</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">string expected</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">symbol expected</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">13</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">context expected</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">14</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">symbol or context expected</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">15</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">list expected</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">16</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">list or array expected</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">17</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">list or symbol expected</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">18</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">list or string expected</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">19</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">list or number expected</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">20</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">array expected</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">21</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">array, list or string expected</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">22</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">lambda expected</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">23</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">lambda-macro expected</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">24</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">invalid function</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">25</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">invalid lambda expression</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">26</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">invalid macro expression</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">27</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">invalid let parameter list</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">28</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">problem saving file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">29</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">division by zero</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">30</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">matrix expected</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">31</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">wrong dimensions</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">32</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">matrix is singular</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">33</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">syntax in regular expression</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">34</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">throw without catch</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">35</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">problem loading library</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">36</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">import function not found</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">37</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">symbol is protected</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">38</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">error number too high</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">39</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">regular expression</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">40</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">missing end of text [/text]</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">41</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">mismatch in number of arguments</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">42</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">problem in format string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">43</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">data type and format don&#8217;t match</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">44</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">invalid parameter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">45</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">invalid parameter: 0.0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">46</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">invalid parameter: NaN</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">47</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">invalid UTF8 string</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">48</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">illegal parameter type</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">49</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">symbol not in MAIN context</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">50</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">symbol not in current context</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">51</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">target cannot be MAIN</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">52</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">list index out of bounds</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">53</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">array index out of bounds</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">54</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">string index out of bounds</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">55</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">nesting level too deep</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">56</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">list reference changed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">57</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">invalid syntax</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">58</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">user error</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">59</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">user reset -</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">60</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">received SIGINT -</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">61</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">function is not reentrant</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">62</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">local symbol is protected</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">63</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no reference found</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">64</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">list is empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">65</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">I/O error</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">66</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">working directory not found</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">67</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">invalid PID</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">68</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">cannot open socket pair</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">69</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">cannot fork process</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">70</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no comm channel found</p></td>
</tr>
</tbody>
</table>
<div class="sect4">
<h5 id="_error_codes_extended_ffi">Error codes extended FFI</h5>
<table class="tableblock frame-all grid-all"
style="
width:25%;
">
<col style="width:9%;">
<col style="width:90%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" >no </th>
<th class="tableblock halign-left valign-top" >description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">71</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">FFI preparation failed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">72</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">invalid FFI type</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">73</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">FFI struct expected</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_tcp_ip_and_udp_error_codes">TCP/IP and UDP Error Codes</h5>
<table class="tableblock frame-all grid-all"
style="
width:25%;
">
<col style="width:9%;">
<col style="width:90%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" >no  </th>
<th class="tableblock halign-left valign-top" >description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Cannot open socket</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">DNS resolution failed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Not a valid service</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Connection failed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Accept failed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Connection closed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Connection broken</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Socket send() failed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Socket recv() failed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Cannot bind socket</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Too many sockets in net-select</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Listen failed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">13</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Badly formed IP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">14</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Select failed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">15</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Peek failed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">16</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Not a valid socket</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">17</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Cannot unblock socket</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">18</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Operation timed out</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">19</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">HTTP bad formed URL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">20</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">HTTP file operation failed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">21</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">HTTP transfer failed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">22</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">HTTP invalid response from server</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">23</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">HTTP no response from server</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">24</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">HTTP document empty</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">25</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">HTTP error in header</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock">26</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">HTTP error in chunked format</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_system_symbols_and_constants">System Symbols and Constants</h4>
<div class="sect4">
<h5 id="_variables_changed_by_the_system">Variables changed by the system</h5>
<div class="paragraph"><p>newLISP maintains several internal symbol variables. All of them are
global and can be used by the programmer. Some have write protection,
others are user settable. Some will change when used in a sub-expression
of the enclosing expression using it. Others are safe when using
reentrant in nested functions or expressions.</p></div>
<div class="paragraph"><p>All symbols starting with the <span class="monospaced">$</span> character will not be serialized when
using the <a href="#save">save</a> or <a href="#source">source</a> functions.</p></div>
<table class="tableblock frame-all grid-all"
style="
width:100%;
">
<col style="width:10%;">
<col style="width:70%;">
<col style="width:10%;">
<col style="width:10%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" >name </th>
<th class="tableblock halign-left valign-top" >purpose </th>
<th class="tableblock halign-left valign-top" >protected </th>
<th class="tableblock halign-left valign-top" >reentrant</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced"> $0 - $15</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Used primarily in regular expressions. <span class="monospaced">$0</span> is also used
to record the last state or count of execution of some functions.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced"> $args</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Contains the list parameters not bound to local variables.
Normally the function <a href="#args">args</a> is used to retrieve the contents
of this variable.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced"> $idx</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The function <a href="#dolist">dolist</a> maintains this as a list
index or offset. The functions <a href="#map">map</a>, <a href="#series">series</a>,
<a href="#while">while</a>, <a href="#until">until</a>, <a href="#do-while">do-while</a> and
<a href="#do-until">do-until</a> maintain this variable as an iteration counter
starting with 0 (zero) for the first iteration.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced"> $it</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">The <em>anaphoric</em> <span class="monospaced">$it</span> refers to the result inside an executing
expression, i.e. in self referential assignments. <span class="monospaced">$it</span> is only
available inside the function expression setting it, and is set to <span class="monospaced">nil</span>
on exit of that expression. The following functions use it:
<a href="#hash">hashes</a>, <a href="#find-all">find-all</a>, <a href="#replace">replace</a>,
<a href="#set-ref">set-ref</a>, <a href="#set-ref-all">set-ref-all</a> and
<a href="#setf">setf setq</a>.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced"> $main-args</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Contains the list of command line arguments passed by
the OS to newLISP when it was started. Normally the function
<a href="#main-args">main-args</a> is used to retrieve the contents.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">n/a</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect4">
<h5 id="_predefined_variables_and_functions">Predefined variables and functions.</h5>
<div class="paragraph"><p>These are preset symbol constants. Two of them are used as namespace
templates, one two write platform independent code.</p></div>
<table class="tableblock frame-all grid-all"
style="
width:100%;
">
<col style="width:10%;">
<col style="width:70%;">
<col style="width:10%;">
<col style="width:10%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" >name </th>
<th class="tableblock halign-left valign-top" >purpose </th>
<th class="tableblock halign-left valign-top" >protected </th>
<th class="tableblock halign-left valign-top" >reentrant</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced"> Class</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Is the predefined general FOOP class constructor which can be
used together with <span class="monospaced">new</span> to create new FOOP classes, e.g:
<span class="monospaced">(new Class 'Rectangle)</span> would create a class and object constructor for
a user class <span class="monospaced">Rectangle</span>. See the <a href="#newlisp_classes">FOOP classes and
constructors</a> chapter in the users manual for details.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">n/a</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced"> ostype</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Contains a string identifying the OS-Platform for which the
running newLISP version has been compiled. See the reference section for
<a href="#ostype">details</a></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">yes</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">n/a</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced"> Tree</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Is a predefined namespace to serve as a hash like dictionary.
Instead of writing <span class="monospaced">(define Foo:Foo)</span> to create a <span class="monospaced">Foo</span> dictionary, the
expression <span class="monospaced">(new Tree 'Foo)</span> can be used as well. See the chapter
<a href="#hash">Hash functions and dictionaries</a> foe details.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">n/a</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced"> module</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">Is a predefined function to load modules. Instead of using
<span class="monospaced">load</span> together with the <span class="monospaced">NEWLISPDIR</span> environment variable, the <span class="monospaced">module</span>
function loads automatically from <span class="monospaced">$NEWLISPDIR/modules/</span>.</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">no</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">n/a</p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>The symbols <span class="monospaced">Class</span>, <span class="monospaced">Tree</span> and <span class="monospaced">module</span> are predefined as follows:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="c1">; built-in template for FOOP constructors</span>
<span class="c1">; usage: (new Class &#39;MyClass)</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="k">Class</span><span class="o">:</span><span class="k">Class</span><span class="p">)</span>
    <span class="p">(</span><span class="k">cons</span> <span class="p">(</span><span class="k">context</span><span class="p">)</span> <span class="p">(</span><span class="k">args</span><span class="p">)))</span>

<span class="c1">; built-in template for hashes</span>
<span class="c1">; usage: (new Tree &#39;MyHash)</span>
<span class="p">(</span><span class="k">define</span> <span class="k">Tree</span><span class="o">:</span><span class="k">Tree</span><span class="p">)</span>

<span class="c1">; load modules from standard path</span>
<span class="c1">; usage (module &quot;mymodule.lsp&quot;)</span>
<span class="p">(</span><span class="k">define</span> <span class="p">(</span><span class="k">module</span> <span class="k">$</span><span class="ss">x</span><span class="p">)</span>
  <span class="p">(</span><span class="k">load</span> <span class="p">(</span><span class="k">append</span> <span class="p">(</span><span class="k">env</span> <span class="s">&quot;NEWLISPDIR&quot;</span><span class="p">)</span> <span class="s">&quot;/modules/&quot;</span> <span class="k">$</span><span class="ss">x</span><span class="p">)))</span>

<span class="p">(</span><span class="k">global</span> <span class="o">&#39;</span><span class="k">module</span><span class="p">)</span>
</pre></div></div></div>
<div class="paragraph"><p>These symbols are not protected and can be redefined by the user. The
<span class="monospaced">$x</span> variable is built-in and proteced against deletion. This <span class="monospaced">$x</span>
variable is also used in <a href="#curry">curry</a> expressions.</p></div>
</div>
</div>
<div class="sect3">
<h4 id="_gnu_free_documentation_license">GNU Free Documentation License</h4>
<div class="paragraph"><p>Version 1.2, November 2002</p></div>
<div class="paragraph"><p>Copyright &#169; 2000,2001,2002 Free Software Foundation, Inc. 59 Temple
Place, Suite 330, Boston, MA 02111-1307 USA Everyone is permitted to
copy and distribute verbatim copies of this license document, but
changing it is not allowed.</p></div>
<div class="sect4">
<h5 id="_0_preamble">0. PREAMBLE</h5>
<div class="paragraph"><p>The purpose of this License is to make a manual, textbook, or other
functional and useful document "free" in the sense of freedom: to assure
everyone the effective freedom to copy and redistribute it, with or
without modifying it, either commercially or noncommercially.
Secondarily, this License preserves for the author and publisher a way
to get credit for their work, while not being considered responsible for
modifications made by others.</p></div>
<div class="paragraph"><p>This License is a kind of "copyleft", which means that derivative works
of the document must themselves be free in the same sense. It
complements the GNU General Public License, which is a copyleft license
designed for free software.</p></div>
<div class="paragraph"><p>We have designed this License in order to use it for manuals for free
software, because free software needs free documentation: a free program
should come with manuals providing the same freedoms that the software
does. But this License is not limited to software manuals; it can be
used for any textual work, regardless of subject matter or whether it is
published as a printed book. We recommend this License principally for
works whose purpose is instruction or reference.</p></div>
</div>
<div class="sect4">
<h5 id="_1_applicability_and_definitions">1. APPLICABILITY AND DEFINITIONS</h5>
<div class="paragraph"><p>This License applies to any manual or other work, in any medium, that
contains a notice placed by the copyright holder saying it can be
distributed under the terms of this License. Such a notice grants a
world-wide, royalty-free license, unlimited in duration, to use that
work under the conditions stated herein. The "Document", below, refers
to any such manual or work. Any member of the public is a licensee, and
is addressed as "you". You accept the license if you copy, modify or
distribute the work in a way requiring permission under copyright law.</p></div>
<div class="paragraph"><p>A "Modified Version" of the Document means any work containing the
Document or a portion of it, either copied verbatim, or with
modifications and/or translated into another language.</p></div>
<div class="paragraph"><p>A "Secondary Section" is a named appendix or a front-matter section of
the Document that deals exclusively with the relationship of the
publishers or authors of the Document to the Document&#8217;s overall subject
(or to related matters) and contains nothing that could fall directly
within that overall subject. (Thus, if the Document is in part a
textbook of mathematics, a Secondary Section may not explain any
mathematics.) The relationship could be a matter of historical
connection with the subject or with related matters, or of legal,
commercial, philosophical, ethical or political position regarding them.</p></div>
<div class="paragraph"><p>The "Invariant Sections" are certain Secondary Sections whose titles are
designated, as being those of Invariant Sections, in the notice that
says that the Document is released under this License. If a section does
not fit the above definition of Secondary then it is not allowed to be
designated as Invariant. The Document may contain zero Invariant
Sections. If the Document does not identify any Invariant Sections then
there are none.</p></div>
<div class="paragraph"><p>The "Cover Texts" are certain short passages of text that are listed, as
Front-Cover Texts or Back-Cover Texts, in the notice that says that the
Document is released under this License. A Front-Cover Text may be at
most 5 words, and a Back-Cover Text may be at most 25 words.</p></div>
<div class="paragraph"><p>A "Transparent" copy of the Document means a machine-readable copy,
represented in a format whose specification is available to the general
public, that is suitable for revising the document straightforwardly
with generic text editors or (for images composed of pixels) generic
paint programs or (for drawings) some widely available drawing editor,
and that is suitable for input to text formatters or for automatic
translation to a variety of formats suitable for input to text
formatters. A copy made in an otherwise Transparent file format whose
markup, or absence of markup, has been arranged to thwart or discourage
subsequent modification by readers is not Transparent. An image format
is not Transparent if used for any substantial amount of text. A copy
that is not "Transparent" is called "Opaque".</p></div>
<div class="paragraph"><p>Examples of suitable formats for Transparent copies include plain ASCII
without markup, Texinfo input format, LaTeX input format, SGML or XML
using a publicly available DTD, and standard-conforming simple HTML,
PostScript or PDF designed for human modification. Examples of
transparent image formats include PNG, XCF and JPG. Opaque formats
include proprietary formats that can be read and edited only by
proprietary word processors, SGML or XML for which the DTD and/or
processing tools are not generally available, and the machine-generated
HTML, PostScript or PDF produced by some word processors for output
purposes only.</p></div>
<div class="paragraph"><p>The "Title Page" means, for a printed book, the title page itself, plus
such following pages as are needed to hold, legibly, the material this
License requires to appear in the title page. For works in formats which
do not have any title page as such, "Title Page" means the text near the
most prominent appearance of the work&#8217;s title, preceding the beginning
of the body of the text.</p></div>
<div class="paragraph"><p>A section "Entitled XYZ" means a named subunit of the Document whose
title either is precisely XYZ or contains XYZ in parentheses following
text that translates XYZ in another language. (Here XYZ stands for a
specific section name mentioned below, such as "Acknowledgements",
"Dedications", "Endorsements", or "History".) To "Preserve the Title" of
such a section when you modify the Document means that it remains a
section "Entitled XYZ" according to this definition.</p></div>
<div class="paragraph"><p>The Document may include Warranty Disclaimers next to the notice which
states that this License applies to the Document. These Warranty
Disclaimers are considered to be included by reference in this License,
but only as regards disclaiming warranties: any other implication that
these Warranty Disclaimers may have is void and has no effect on the
meaning of this License.</p></div>
</div>
<div class="sect4">
<h5 id="_2_verbatim_copying">2. VERBATIM COPYING</h5>
<div class="paragraph"><p>You may copy and distribute the Document in any medium, either
commercially or noncommercially, provided that this License, the
copyright notices, and the license notice saying this License applies to
the Document are reproduced in all copies, and that you add no other
conditions whatsoever to those of this License. You may not use
technical measures to obstruct or control the reading or further copying
of the copies you make or distribute. However, you may accept
compensation in exchange for copies. If you distribute a large enough
number of copies you must also follow the conditions in section 3.</p></div>
<div class="paragraph"><p>You may also lend copies, under the same conditions stated above, and
you may publicly display copies.</p></div>
</div>
<div class="sect4">
<h5 id="_3_copying_in_quantity">3. COPYING IN QUANTITY</h5>
<div class="paragraph"><p>If you publish printed copies (or copies in media that commonly have
printed covers) of the Document, numbering more than 100, and the
Document&#8217;s license notice requires Cover Texts, you must enclose the
copies in covers that carry, clearly and legibly, all these Cover Texts:
Front-Cover Texts on the front cover, and Back-Cover Texts on the back
cover. Both covers must also clearly and legibly identify you as the
publisher of these copies. The front cover must present the full title
with all words of the title equally prominent and visible. You may add
other material on the covers in addition. Copying with changes limited
to the covers, as long as they preserve the title of the Document and
satisfy these conditions, can be treated as verbatim copying in other
respects.</p></div>
<div class="paragraph"><p>If the required texts for either cover are too voluminous to fit
legibly, you should put the first ones listed (as many as fit
reasonably) on the actual cover, and continue the rest onto adjacent
pages.</p></div>
<div class="paragraph"><p>If you publish or distribute Opaque copies of the Document numbering
more than 100, you must either include a machine-readable Transparent
copy along with each Opaque copy, or state in or with each Opaque copy a
computer-network location from which the general network-using public
has access to download using public-standard network protocols a
complete Transparent copy of the Document, free of added material. If
you use the latter option, you must take reasonably prudent steps, when
you begin distribution of Opaque copies in quantity, to ensure that this
Transparent copy will remain thus accessible at the stated location
until at least one year after the last time you distribute an Opaque
copy (directly or through your agents or retailers) of that edition to
the public.</p></div>
<div class="paragraph"><p>It is requested, but not required, that you contact the authors of the
Document well before redistributing any large number of copies, to give
them a chance to provide you with an updated version of the Document.</p></div>
</div>
<div class="sect4">
<h5 id="_4_modifications">4. MODIFICATIONS</h5>
<div class="paragraph"><p>You may copy and distribute a Modified Version of the Document under the
conditions of sections 2 and 3 above, provided that you release the
Modified Version under precisely this License, with the Modified Version
filling the role of the Document, thus licensing distribution and
modification of the Modified Version to whoever possesses a copy of it.
In addition, you must do these things in the Modified Version:</p></div>
<div class="olist upperalpha"><ol class="upperalpha">
<li>
<p>
Use in the Title Page (and on the covers, if any) a title distinct
   from that of the Document, and from those of previous versions
   (which should, if there were any, be listed in the History section
   of the Document). You may use the same title as a previous version
   if the original publisher of that version gives permission.
</p>
</li>
<li>
<p>
List on the Title Page, as authors, one or more persons or entities
   responsible for authorship of the modifications in the Modified
   Version, together with at least five of the principal authors of
   the Document (all of its principal authors, if it has fewer than
   five), unless they release you from this requirement.
</p>
</li>
<li>
<p>
State on the Title page the name of the publisher of the Modified
   Version, as the publisher.
</p>
</li>
<li>
<p>
Preserve all the copyright notices of the Document.
</p>
</li>
<li>
<p>
Add an appropriate copyright notice for your modifications adjacent
   to the other copyright notices.
</p>
</li>
<li>
<p>
Include, immediately after the copyright notices, a license notice
   giving the public permission to use the Modified Version under the
   terms of this License, in the form shown in the Addendum below.
</p>
</li>
<li>
<p>
Preserve in that license notice the full lists of Invariant
   Sections and required Cover Texts given in the Document&#8217;s license
   notice.
</p>
</li>
<li>
<p>
Include an unaltered copy of this License.
</p>
</li>
<li>
<p>
Preserve the section Entitled "History", Preserve its Title, and
   add to it an item stating at least the title, year, new authors,
   and publisher of the Modified Version as given on the Title Page.
   If there is no section Entitled "History" in the Document, create
   one stating the title, year, authors, and publisher of the Document
   as given on its Title Page, then add an item describing the
   Modified Version as stated in the previous sentence.
</p>
</li>
<li>
<p>
Preserve the network location, if any, given in the Document for
   public access to a Transparent copy of the Document, and likewise
   the network locations given in the Document for previous versions
   it was based on. These may be placed in the "History" section. You
   may omit a network location for a work that was published at least
   four years before the Document itself, or if the original publisher
   of the version it refers to gives permission.
</p>
</li>
<li>
<p>
For any section Entitled "Acknowledgements" or "Dedications",
   Preserve the Title of the section, and preserve in the section all
   the substance and tone of each of the contributor acknowledgements
   and/or dedications given therein.
</p>
</li>
<li>
<p>
Preserve all the Invariant Sections of the Document, unaltered in
   their text and in their titles. Section numbers or the equivalent
   are not considered part of the section titles.
</p>
</li>
<li>
<p>
Delete any section Entitled "Endorsements". Such a section may not
   be included in the Modified Version.
</p>
</li>
<li>
<p>
Do not retitle any existing section to be Entitled "Endorsements"
   or to conflict in title with any Invariant Section.
</p>
</li>
<li>
<p>
Preserve any Warranty Disclaimers.
</p>
</li>
</ol></div>
<div class="paragraph"><p>If the Modified Version includes new front-matter sections or appendices
that qualify as Secondary Sections and contain no material copied from
the Document, you may at your option designate some or all of these
sections as invariant. To do this, add their titles to the list of
Invariant Sections in the Modified Version&#8217;s license notice. These
titles must be distinct from any other section titles.</p></div>
<div class="paragraph"><p>You may add a section Entitled "Endorsements", provided it contains
nothing but endorsements of your Modified Version by various
parties&#8212;for example, statements of peer review or that the text has
been approved by an organization as the authoritative definition of a
standard.</p></div>
<div class="paragraph"><p>You may add a passage of up to five words as a Front-Cover Text, and a
passage of up to 25 words as a Back-Cover Text, to the end of the list
of Cover Texts in the Modified Version. Only one passage of Front-Cover
Text and one of Back-Cover Text may be added by (or through arrangements
made by) any one entity. If the Document already includes a cover text
for the same cover, previously added by you or by arrangement made by
the same entity you are acting on behalf of, you may not add another;
but you may replace the old one, on explicit permission from the
previous publisher that added the old one.</p></div>
<div class="paragraph"><p>The author(s) and publisher(s) of the Document do not by this License
give permission to use their names for publicity for or to assert or
imply endorsement of any Modified Version.</p></div>
</div>
<div class="sect4">
<h5 id="_5_combining_documents">5. COMBINING DOCUMENTS</h5>
<div class="paragraph"><p>You may combine the Document with other documents released under this
License, under the terms defined in section 4 above for modified
versions, provided that you include in the combination all of the
Invariant Sections of all of the original documents, unmodified, and
list them all as Invariant Sections of your combined work in its license
notice, and that you preserve all their Warranty Disclaimers.</p></div>
<div class="paragraph"><p>The combined work need only contain one copy of this License, and
multiple identical Invariant Sections may be replaced with a single
copy. If there are multiple Invariant Sections with the same name but
different contents, make the title of each such section unique by adding
at the end of it, in parentheses, the name of the original author or
publisher of that section if known, or else a unique number. Make the
same adjustment to the section titles in the list of Invariant Sections
in the license notice of the combined work.</p></div>
<div class="paragraph"><p>In the combination, you must combine any sections Entitled "History" in
the various original documents, forming one section Entitled "History";
likewise combine any sections Entitled "Acknowledgements", and any
sections Entitled "Dedications". You must delete all sections Entitled
"Endorsements."</p></div>
</div>
<div class="sect4">
<h5 id="_6_collections_of_documents">6. COLLECTIONS OF DOCUMENTS</h5>
<div class="paragraph"><p>You may make a collection consisting of the Document and other documents
released under this License, and replace the individual copies of this
License in the various documents with a single copy that is included in
the collection, provided that you follow the rules of this License for
verbatim copying of each of the documents in all other respects.</p></div>
<div class="paragraph"><p>You may extract a single document from such a collection, and distribute
it individually under this License, provided you insert a copy of this
License into the extracted document, and follow this License in all
other respects regarding verbatim copying of that document.</p></div>
</div>
<div class="sect4">
<h5 id="_7_aggregation_with_independent_works">7. AGGREGATION WITH INDEPENDENT WORKS</h5>
<div class="paragraph"><p>A compilation of the Document or its derivatives with other separate and
independent documents or works, in or on a volume of a storage or
distribution medium, is called an "aggregate" if the copyright resulting
from the compilation is not used to limit the legal rights of the
compilation&#8217;s users beyond what the individual works permit. When the
Document is included in an aggregate, this License does not apply to the
other works in the aggregate which are not themselves derivative works
of the Document.</p></div>
<div class="paragraph"><p>If the Cover Text requirement of section 3 is applicable to these copies
of the Document, then if the Document is less than one half of the
entire aggregate, the Document&#8217;s Cover Texts may be placed on covers
that bracket the Document within the aggregate, or the electronic
equivalent of covers if the Document is in electronic form. Otherwise
they must appear on printed covers that bracket the whole aggregate.</p></div>
</div>
<div class="sect4">
<h5 id="_8_translation">8. TRANSLATION</h5>
<div class="paragraph"><p>Translation is considered a kind of modification, so you may distribute
translations of the Document under the terms of section 4. Replacing
Invariant Sections with translations requires special permission from
their copyright holders, but you may include translations of some or all
Invariant Sections in addition to the original versions of these
Invariant Sections. You may include a translation of this License, and
all the license notices in the Document, and any Warranty Disclaimers,
provided that you also include the original English version of this
License and the original versions of those notices and disclaimers. In
case of a disagreement between the translation and the original version
of this License or a notice or disclaimer, the original version will
prevail.</p></div>
<div class="paragraph"><p>If a section in the Document is Entitled "Acknowledgements",
"Dedications", or "History", the requirement (section 4) to Preserve its
Title (section 1) will typically require changing the actual title.</p></div>
</div>
<div class="sect4">
<h5 id="_9_termination">9. TERMINATION</h5>
<div class="paragraph"><p>You may not copy, modify, sublicense, or distribute the Document except
as expressly provided for under this License. Any other attempt to copy,
modify, sublicense or distribute the Document is void, and will
automatically terminate your rights under this License. However, parties
who have received copies, or rights, from you under this License will
not have their licenses terminated so long as such parties remain in
full compliance.</p></div>
</div>
<div class="sect4">
<h5 id="_10_future_revisions_of_this_license">10. FUTURE REVISIONS OF THIS LICENSE</h5>
<div class="paragraph"><p>The Free Software Foundation may publish new, revised versions of the
GNU Free Documentation License from time to time. Such new versions will
be similar in spirit to the present version, but may differ in detail to
address new problems or concerns. See <a href="http://www.gnu.org/copyleft/">http://www.gnu.org/copyleft/</a>.</p></div>
<div class="paragraph"><p>Each version of the License is given a distinguishing version number. If
the Document specifies that a particular numbered version of this
License "or any later version" applies to it, you have the option of
following the terms and conditions either of that specified version or
of any later version that has been published (not as a draft) by the
Free Software Foundation. If the Document does not specify a version
number of this License, you may choose any version ever published (not
as a draft) by the Free Software Foundation.</p></div>
</div>
</div>
<div class="sect3">
<h4 id="_gnu_general_public_license">GNU GENERAL PUBLIC LICENSE</h4>
<div class="paragraph"><p>Version 3, 29 June 2007</p></div>
<div class="paragraph"><p>Copyright &#169; 2007 Free Software Foundation, Inc. <a href="http://fsf.org/">http://fsf.org/</a>
Everyone is permitted to copy and distribute verbatim copies of this
license document, but changing it is not allowed.</p></div>
<div class="sect4">
<h5 id="_preamble">Preamble</h5>
<div class="paragraph"><p>The GNU General Public License is a free, copyleft license for
software and other kinds of works.</p></div>
<div class="paragraph"><p>The licenses for most software and other practical works are designed
to take away your freedom to share and change the works. By contrast,
the GNU General Public License is intended to guarantee your freedom
to share and change all versions of a program&#8212;to make sure it remains
free software for all its users. We, the Free Software Foundation, use
the GNU General Public License for most of our software; it applies
also to any other work released this way by its authors. You can apply
it to your programs, too.</p></div>
<div class="paragraph"><p>When we speak of free software, we are referring to freedom, not
price.  Our General Public Licenses are designed to make sure that you
have the freedom to distribute copies of free software (and charge for
them if you wish), that you receive source code or can get it if you
want it, that you can change the software or use pieces of it in new
free programs, and that you know you can do these things.</p></div>
<div class="paragraph"><p>To protect your rights, we need to prevent others from denying you
these rights or asking you to surrender the rights. Therefore, you
have certain responsibilities if you distribute copies of the
software, or if you modify it: responsibilities to respect the freedom
of others.</p></div>
<div class="paragraph"><p>For example, if you distribute copies of such a program, whether
gratis or for a fee, you must pass on to the recipients the same
freedoms that you received. You must make sure that they, too, receive
or can get the source code. And you must show them these terms so they
know their rights.</p></div>
<div class="paragraph"><p>Developers that use the GNU GPL protect your rights with two steps:</p></div>
<div class="paragraph"><p>(1) assert copyright on the software, and (2) offer you this License
giving you legal permission to copy, distribute and/or modify it.</p></div>
<div class="paragraph"><p>For the developers' and authors' protection, the GPL clearly explains
that there is no warranty for this free software. For both users' and
authors' sake, the GPL requires that modified versions be marked as
changed, so that their problems will not be attributed erroneously to
authors of previous versions.</p></div>
<div class="paragraph"><p>Some devices are designed to deny users access to install or run
modified versions of the software inside them, although the
manufacturer can do so. This is fundamentally incompatible with the
aim of protecting users' freedom to change the software. The
systematic pattern of such abuse occurs in the area of products for
individuals to use, which is precisely where it is most unacceptable.
Therefore, we have designed this version of the GPL to prohibit the
practice for those products. If such problems arise substantially in
other domains, we stand ready to extend this provision to those
domains in future versions of the GPL, as needed to protect the
freedom of users.</p></div>
<div class="paragraph"><p>Finally, every program is threatened constantly by software patents.
States should not allow patents to restrict development and use of
software on general-purpose computers, but in those that do, we wish
to avoid the special danger that patents applied to a free program
could make it effectively proprietary. To prevent this, the GPL
assures that patents cannot be used to render the program non-free.</p></div>
<div class="paragraph"><p>The precise terms and conditions for copying, distribution and
modification follow.</p></div>
</div>
<div class="sect4">
<h5 id="_terms_and_conditions">TERMS AND CONDITIONS</h5>
<div class="sect4">
<h5 id="_0_definitions">0. Definitions.</h5>
<div class="paragraph"><p>"This License" refers to version 3 of the GNU General Public License.</p></div>
<div class="paragraph"><p>"Copyright" also means copyright-like laws that apply to other kinds
of works, such as semiconductor masks.</p></div>
<div class="paragraph"><p>"The Program" refers to any copyrightable work licensed under this
License. Each licensee is addressed as "you". "Licensees" and
"recipients" may be individuals or organizations.</p></div>
<div class="paragraph"><p>To "modify" a work means to copy from or adapt all or part of the work
in a fashion requiring copyright permission, other than the making of
an exact copy. The resulting work is called a "modified version" of
the earlier work or a work "based on" the earlier work.</p></div>
<div class="paragraph"><p>A "covered work" means either the unmodified Program or a work based
on the Program.</p></div>
<div class="paragraph"><p>To "propagate" a work means to do anything with it that, without
permission, would make you directly or secondarily liable for
infringement under applicable copyright law, except executing it on a
computer or modifying a private copy. Propagation includes copying,
distribution (with or without modification), making available to the
public, and in some countries other activities as well.</p></div>
<div class="paragraph"><p>To "convey" a work means any kind of propagation that enables other
parties to make or receive copies. Mere interaction with a user
through a computer network, with no transfer of a copy, is not
conveying.</p></div>
<div class="paragraph"><p>An interactive user interface displays "Appropriate Legal Notices" to
the extent that it includes a convenient and prominently visible
feature that (1) displays an appropriate copyright notice, and (2)
tells the user that there is no warranty for the work (except to the
extent that warranties are provided), that licensees may convey the
work under this License, and how to view a copy of this License. If
the interface presents a list of user commands or options, such as a
menu, a prominent item in the list meets this criterion.</p></div>
</div>
<div class="sect4">
<h5 id="_1_source_code">1. Source Code.</h5>
<div class="paragraph"><p>The "source code" for a work means the preferred form of the work for
making modifications to it. "Object code" means any non-source form of
a work.</p></div>
<div class="paragraph"><p>A "Standard Interface" means an interface that either is an official
standard defined by a recognized standards body, or, in the case of
interfaces specified for a particular programming language, one that
is widely used among developers working in that language.</p></div>
<div class="paragraph"><p>The "System Libraries" of an executable work include anything, other
than the work as a whole, that (a) is included in the normal form of
packaging a Major Component, but which is not part of that Major
Component, and (b) serves only to enable use of the work with that
Major Component, or to implement a Standard Interface for which an
implementation is available to the public in source code form. A
"Major Component", in this context, means a major essential component
(kernel, window system, and so on) of the specific operating system
(if any) on which the executable work runs, or a compiler used to
produce the work, or an object code interpreter used to run it.</p></div>
<div class="paragraph"><p>The "Corresponding Source" for a work in object code form means all
the source code needed to generate, install, and (for an executable
work) run the object code and to modify the work, including scripts to
control those activities. However, it does not include the work&#8217;s
System Libraries, or general-purpose tools or generally available free
programs which are used unmodified in performing those activities but
which are not part of the work. For example, Corresponding Source
includes interface definition files associated with source files for
the work, and the source code for shared libraries and dynamically
linked subprograms that the work is specifically designed to require,
such as by intimate data communication or control flow between those
subprograms and other parts of the work.</p></div>
<div class="paragraph"><p>The Corresponding Source need not include anything that users can
regenerate automatically from other parts of the Corresponding Source.</p></div>
<div class="paragraph"><p>The Corresponding Source for a work in source code form is that same
work.</p></div>
</div>
<div class="sect4">
<h5 id="_2_basic_permissions">2. Basic Permissions.</h5>
<div class="paragraph"><p>All rights granted under this License are granted for the term of
copyright on the Program, and are irrevocable provided the stated
conditions are met. This License explicitly affirms your unlimited
permission to run the unmodified Program. The output from running a
covered work is covered by this License only if the output, given its
content, constitutes a covered work. This License acknowledges your
rights of fair use or other equivalent, as provided by copyright law.</p></div>
<div class="paragraph"><p>You may make, run and propagate covered works that you do not convey,
without conditions so long as your license otherwise remains in force.
You may convey covered works to others for the sole purpose of having
them make modifications exclusively for you, or provide you with
facilities for running those works, provided that you comply with the
terms of this License in conveying all material for which you do not
control copyright. Those thus making or running the covered works for
you must do so exclusively on your behalf, under your direction and
control, on terms that prohibit them from making any copies of your
copyrighted material outside their relationship with you.</p></div>
<div class="paragraph"><p>Conveying under any other circumstances is permitted solely under the
conditions stated below. Sublicensing is not allowed; section 10 makes
it unnecessary.</p></div>
</div>
<div class="sect4">
<h5 id="_3_protecting_users_legal_rights_from_anti_circumvention_law">3. Protecting Users' Legal Rights From Anti-Circumvention Law.</h5>
<div class="paragraph"><p>No covered work shall be deemed part of an effective technological
measure under any applicable law fulfilling obligations under article
11 of the WIPO copyright treaty adopted on 20 December 1996, or
similar laws prohibiting or restricting circumvention of such
measures.</p></div>
<div class="paragraph"><p>When you convey a covered work, you waive any legal power to forbid
circumvention of technological measures to the extent such
circumvention is effected by exercising rights under this License with
respect to the covered work, and you disclaim any intention to limit
operation or modification of the work as a means of enforcing, against
the work&#8217;s users, your or third parties' legal rights to forbid
circumvention of technological measures.</p></div>
</div>
<div class="sect4">
<h5 id="_4_conveying_verbatim_copies">4. Conveying Verbatim Copies.</h5>
<div class="paragraph"><p>You may convey verbatim copies of the Program&#8217;s source code as you
receive it, in any medium, provided that you conspicuously and
appropriately publish on each copy an appropriate copyright notice;
keep intact all notices stating that this License and any
non-permissive terms added in accord with section 7 apply to the code;
keep intact all notices of the absence of any warranty; and give all
recipients a copy of this License along with the Program.</p></div>
<div class="paragraph"><p>You may charge any price or no price for each copy that you convey,
and you may offer support or warranty protection for a fee.</p></div>
</div>
<div class="sect4">
<h5 id="_5_conveying_modified_source_versions">5. Conveying Modified Source Versions.</h5>
<div class="paragraph"><p>You may convey a work based on the Program, or the modifications to
produce it from the Program, in the form of source code under the
terms of section 4, provided that you also meet all of these
conditions:</p></div>
<div class="olist loweralpha"><ol class="loweralpha">
<li>
<p>
The work must carry prominent notices stating that you modified it,
   and giving a relevant date.
</p>
</li>
<li>
<p>
The work must carry prominent notices stating that it is released
   under this License and any conditions added under section 7. This
   requirement modifies the requirement in section 4 to "keep intact
   all notices".
</p>
</li>
<li>
<p>
You must license the entire work, as a whole, under this License to
   anyone who comes into possession of a copy. This License will
   therefore apply, along with any applicable section 7 additional
   terms, to the whole of the work, and all its parts, regardless of
   how they are packaged. This License gives no permission to license
   the work in any other way, but it does not invalidate such
   permission if you have separately received it.
</p>
</li>
<li>
<p>
If the work has interactive user interfaces, each must display
   Appropriate Legal Notices; however, if the Program has interactive
   interfaces that do not display Appropriate Legal Notices, your work
   need not make them do so.
</p>
</li>
</ol></div>
<div class="paragraph"><p>A compilation of a covered work with other separate and independent
works, which are not by their nature extensions of the covered work,
and which are not combined with it such as to form a larger program,
in or on a volume of a storage or distribution medium, is called an
"aggregate" if the compilation and its resulting copyright are not
used to limit the access or legal rights of the compilation&#8217;s users
beyond what the individual works permit. Inclusion of a covered work
in an aggregate does not cause this License to apply to the other
parts of the aggregate.</p></div>
</div>
<div class="sect4">
<h5 id="_6_conveying_non_source_forms">6. Conveying Non-Source Forms.</h5>
<div class="paragraph"><p>You may convey a covered work in object code form under the terms of
sections 4 and 5, provided that you also convey the machine-readable
Corresponding Source under the terms of this License, in one of these
ways:</p></div>
<div class="olist loweralpha"><ol class="loweralpha">
<li>
<p>
Convey the object code in, or embodied in, a physical product
   (including a physical distribution medium), accompanied by the
   Corresponding Source fixed on a durable physical medium customarily
   used for software interchange.
</p>
</li>
<li>
<p>
Convey the object code in, or embodied in, a physical product
   (including a physical distribution medium), accompanied by a
   written offer, valid for at least three years and valid for as long
   as you offer spare parts or customer support for that product
   model, to give anyone who possesses the object code either (1) a
   copy of the Corresponding Source for all the software in the
   product that is covered by this License, on a durable physical
   medium customarily used for software interchange, for a price no
   more than your reasonable cost of physically performing this
   conveying of source, or (2) access to copy the Corresponding Source
   from a network server at no charge.
</p>
</li>
<li>
<p>
Convey individual copies of the object code with a copy of the
   written offer to provide the Corresponding Source. This alternative
   is allowed only occasionally and noncommercially, and only if you
   received the object code with such an offer, in accord with
   subsection 6b.
</p>
</li>
<li>
<p>
Convey the object code by offering access from a designated place
   (gratis or for a charge), and offer equivalent access to the
   Corresponding Source in the same way through the same place at no
   further charge. You need not require recipients to copy the
   Corresponding Source along with the object code. If the place to
   copy the object code is a network server, the Corresponding Source
   may be on a different server (operated by you or a third party)
   that supports equivalent copying facilities, provided you maintain
   clear directions next to the object code saying where to find the
   Corresponding Source.  Regardless of what server hosts the
   Corresponding Source, you remain obligated to ensure that it is
   available for as long as needed to satisfy these requirements.
</p>
</li>
<li>
<p>
Convey the object code using peer-to-peer transmission, provided
   you inform other peers where the object code and Corresponding
   Source of the work are being offered to the general public at no
   charge under subsection 6d.
</p>
</li>
</ol></div>
<div class="paragraph"><p>A separable portion of the object code, whose source code is excluded
from the Corresponding Source as a System Library, need not be
included in conveying the object code work.</p></div>
<div class="paragraph"><p>A "User Product" is either (1) a "consumer product", which means any
tangible personal property which is normally used for personal,
family, or household purposes, or (2) anything designed or sold for
incorporation into a dwelling. In determining whether a product is a
consumer product, doubtful cases shall be resolved in favor of
coverage.  For a particular product received by a particular user,
"normally used" refers to a typical or common use of that class of
product, regardless of the status of the particular user or of the way
in which the particular user actually uses, or expects or is expected
to use, the product. A product is a consumer product regardless of
whether the product has substantial commercial, industrial or
non-consumer uses, unless such uses represent the only significant
mode of use of the product.</p></div>
<div class="paragraph"><p>"Installation Information" for a User Product means any methods,
procedures, authorization keys, or other information required to
install and execute modified versions of a covered work in that User
Product from a modified version of its Corresponding Source. The
information must suffice to ensure that the continued functioning of
the modified object code is in no case prevented or interfered with
solely because modification has been made.</p></div>
<div class="paragraph"><p>If you convey an object code work under this section in, or with, or
specifically for use in, a User Product, and the conveying occurs as
part of a transaction in which the right of possession and use of the
User Product is transferred to the recipient in perpetuity or for a
fixed term (regardless of how the transaction is characterized), the
Corresponding Source conveyed under this section must be accompanied
by the Installation Information. But this requirement does not apply
if neither you nor any third party retains the ability to install
modified object code on the User Product (for example, the work has
been installed in ROM).</p></div>
<div class="paragraph"><p>The requirement to provide Installation Information does not include a
requirement to continue to provide support service, warranty, or
updates for a work that has been modified or installed by the
recipient, or for the User Product in which it has been modified or
installed. Access to a network may be denied when the modification
itself materially and adversely affects the operation of the network
or violates the rules and protocols for communication across the
network.</p></div>
<div class="paragraph"><p>Corresponding Source conveyed, and Installation Information provided,
in accord with this section must be in a format that is publicly
documented (and with an implementation available to the public in
source code form), and must require no special password or key for
unpacking, reading or copying.</p></div>
</div>
<div class="sect4">
<h5 id="_7_additional_terms">7. Additional Terms.</h5>
<div class="paragraph"><p>"Additional permissions" are terms that supplement the terms of this
License by making exceptions from one or more of its conditions.
Additional permissions that are applicable to the entire Program shall
be treated as though they were included in this License, to the extent
that they are valid under applicable law. If additional permissions
apply only to part of the Program, that part may be used separately
under those permissions, but the entire Program remains governed by
this License without regard to the additional permissions.</p></div>
<div class="paragraph"><p>When you convey a copy of a covered work, you may at your option
remove any additional permissions from that copy, or from any part of
it.  (Additional permissions may be written to require their own
removal in certain cases when you modify the work.) You may place
additional permissions on material, added by you to a covered work,
for which you have or can give appropriate copyright permission.</p></div>
<div class="paragraph"><p>Notwithstanding any other provision of this License, for material you
add to a covered work, you may (if authorized by the copyright holders
of that material) supplement the terms of this License with terms:</p></div>
<div class="olist loweralpha"><ol class="loweralpha">
<li>
<p>
Disclaiming warranty or limiting liability differently from the
   terms of sections 15 and 16 of this License; or
</p>
</li>
<li>
<p>
Requiring preservation of specified reasonable legal notices or
   author attributions in that material or in the Appropriate Legal
   Notices displayed by works containing it; or
</p>
</li>
<li>
<p>
Prohibiting misrepresentation of the origin of that material, or
   requiring that modified versions of such material be marked in
   reasonable ways as different from the original version; or
</p>
</li>
<li>
<p>
Limiting the use for publicity purposes of names of licensors or
   authors of the material; or
</p>
</li>
<li>
<p>
Declining to grant rights under trademark law for use of some trade
   names, trademarks, or service marks; or
</p>
</li>
<li>
<p>
Requiring indemnification of licensors and authors of that material
   by anyone who conveys the material (or modified versions of it)
   with contractual assumptions of liability to the recipient, for any
   liability that these contractual assumptions directly impose on
   those licensors and authors.
</p>
</li>
</ol></div>
<div class="paragraph"><p>All other non-permissive additional terms are considered "further
restrictions" within the meaning of section 10. If the Program as you
received it, or any part of it, contains a notice stating that it is
governed by this License along with a term that is a further
restriction, you may remove that term. If a license document contains
a further restriction but permits relicensing or conveying under this
License, you may add to a covered work material governed by the terms
of that license document, provided that the further restriction does
not survive such relicensing or conveying.</p></div>
<div class="paragraph"><p>If you add terms to a covered work in accord with this section, you
must place, in the relevant source files, a statement of the
additional terms that apply to those files, or a notice indicating
where to find the applicable terms.</p></div>
<div class="paragraph"><p>Additional terms, permissive or non-permissive, may be stated in the
form of a separately written license, or stated as exceptions; the
above requirements apply either way.</p></div>
</div>
<div class="sect4">
<h5 id="_8_termination">8. Termination.</h5>
<div class="paragraph"><p>You may not propagate or modify a covered work except as expressly
provided under this License. Any attempt otherwise to propagate or
modify it is void, and will automatically terminate your rights under
this License (including any patent licenses granted under the third
paragraph of section 11).</p></div>
<div class="paragraph"><p>However, if you cease all violation of this License, then your license
from a particular copyright holder is reinstated (a) provisionally,
unless and until the copyright holder explicitly and finally
terminates your license, and (b) permanently, if the copyright holder
fails to notify you of the violation by some reasonable means prior to
60 days after the cessation.</p></div>
<div class="paragraph"><p>Moreover, your license from a particular copyright holder is
reinstated permanently if the copyright holder notifies you of the
violation by some reasonable means, this is the first time you have
received notice of violation of this License (for any work) from that
copyright holder, and you cure the violation prior to 30 days after
your receipt of the notice.</p></div>
<div class="paragraph"><p>Termination of your rights under this section does not terminate the
licenses of parties who have received copies or rights from you under
this License. If your rights have been terminated and not permanently
reinstated, you do not qualify to receive new licenses for the same
material under section 10.</p></div>
</div>
<div class="sect4">
<h5 id="_9_acceptance_not_required_for_having_copies">9. Acceptance Not Required for Having Copies.</h5>
<div class="paragraph"><p>You are not required to accept this License in order to receive or run
a copy of the Program. Ancillary propagation of a covered work
occurring solely as a consequence of using peer-to-peer transmission
to receive a copy likewise does not require acceptance. However,
nothing other than this License grants you permission to propagate or
modify any covered work. These actions infringe copyright if you do
not accept this License. Therefore, by modifying or propagating a
covered work, you indicate your acceptance of this License to do so.</p></div>
</div>
<div class="sect4">
<h5 id="_10_automatic_licensing_of_downstream_recipients">10. Automatic Licensing of Downstream Recipients.</h5>
<div class="paragraph"><p>Each time you convey a covered work, the recipient automatically
receives a license from the original licensors, to run, modify and
propagate that work, subject to this License. You are not responsible
for enforcing compliance by third parties with this License.</p></div>
<div class="paragraph"><p>An "entity transaction" is a transaction transferring control of an
organization, or substantially all assets of one, or subdividing an
organization, or merging organizations. If propagation of a covered
work results from an entity transaction, each party to that
transaction who receives a copy of the work also receives whatever
licenses to the work the party&#8217;s predecessor in interest had or could
give under the previous paragraph, plus a right to possession of the
Corresponding Source of the work from the predecessor in interest, if
the predecessor has it or can get it with reasonable efforts.</p></div>
<div class="paragraph"><p>You may not impose any further restrictions on the exercise of the
rights granted or affirmed under this License. For example, you may
not impose a license fee, royalty, or other charge for exercise of
rights granted under this License, and you may not initiate litigation
(including a cross-claim or counterclaim in a lawsuit) alleging that
any patent claim is infringed by making, using, selling, offering for
sale, or importing the Program or any portion of it.</p></div>
</div>
<div class="sect4">
<h5 id="_11_patents">11. Patents.</h5>
<div class="paragraph"><p>A "contributor" is a copyright holder who authorizes use under this
License of the Program or a work on which the Program is based. The
work thus licensed is called the contributor&#8217;s "contributor version".</p></div>
<div class="paragraph"><p>A contributor&#8217;s "essential patent claims" are all patent claims owned
or controlled by the contributor, whether already acquired or
hereafter acquired, that would be infringed by some manner, permitted
by this License, of making, using, or selling its contributor version,
but do not include claims that would be infringed only as a
consequence of further modification of the contributor version. For
purposes of this definition, "control" includes the right to grant
patent sublicenses in a manner consistent with the requirements of
this License.</p></div>
<div class="paragraph"><p>Each contributor grants you a non-exclusive, worldwide, royalty-free
patent license under the contributor&#8217;s essential patent claims, to
make, use, sell, offer for sale, import and otherwise run, modify and
propagate the contents of its contributor version.</p></div>
<div class="paragraph"><p>In the following three paragraphs, a "patent license" is any express
agreement or commitment, however denominated, not to enforce a patent
(such as an express permission to practice a patent or covenant not to
sue for patent infringement). To "grant" such a patent license to a
party means to make such an agreement or commitment not to enforce a
patent against the party.</p></div>
<div class="paragraph"><p>If you convey a covered work, knowingly relying on a patent license,
and the Corresponding Source of the work is not available for anyone
to copy, free of charge and under the terms of this License, through a
publicly available network server or other readily accessible means,
then you must either (1) cause the Corresponding Source to be so
available, or (2) arrange to deprive yourself of the benefit of the
patent license for this particular work, or (3) arrange, in a manner
consistent with the requirements of this License, to extend the patent
license to downstream recipients. "Knowingly relying" means you have
actual knowledge that, but for the patent license, your conveying the
covered work in a country, or your recipient&#8217;s use of the covered work
in a country, would infringe one or more identifiable patents in that
country that you have reason to believe are valid.</p></div>
<div class="paragraph"><p>If, pursuant to or in connection with a single transaction or
arrangement, you convey, or propagate by procuring conveyance of, a
covered work, and grant a patent license to some of the parties
receiving the covered work authorizing them to use, propagate, modify
or convey a specific copy of the covered work, then the patent license
you grant is automatically extended to all recipients of the covered
work and works based on it.</p></div>
<div class="paragraph"><p>A patent license is "discriminatory" if it does not include within the
scope of its coverage, prohibits the exercise of, or is conditioned on
the non-exercise of one or more of the rights that are specifically
granted under this License. You may not convey a covered work if you
are a party to an arrangement with a third party that is in the
business of distributing software, under which you make payment to the
third party based on the extent of your activity of conveying the
work, and under which the third party grants, to any of the parties
who would receive the covered work from you, a discriminatory patent
license (a) in connection with copies of the covered work conveyed by
you (or copies made from those copies), or (b) primarily for and in
connection with specific products or compilations that contain the
covered work, unless you entered into that arrangement, or that patent
license was granted, prior to 28 March 2007.</p></div>
<div class="paragraph"><p>Nothing in this License shall be construed as excluding or limiting
any implied license or other defenses to infringement that may
otherwise be available to you under applicable patent law.</p></div>
</div>
<div class="sect4">
<h5 id="_12_no_surrender_of_others_freedom">12. No Surrender of Others' Freedom.</h5>
<div class="paragraph"><p>If conditions are imposed on you (whether by court order, agreement or
otherwise) that contradict the conditions of this License, they do not
excuse you from the conditions of this License. If you cannot convey a
covered work so as to satisfy simultaneously your obligations under
this License and any other pertinent obligations, then as a
consequence you may not convey it at all. For example, if you agree to
terms that obligate you to collect a royalty for further conveying
from those to whom you convey the Program, the only way you could
satisfy both those terms and this License would be to refrain entirely
from conveying the Program.</p></div>
</div>
<div class="sect4">
<h5 id="_13_use_with_the_gnu_affero_general_public_license">13. Use with the GNU Affero General Public License.</h5>
<div class="paragraph"><p>Notwithstanding any other provision of this License, you have
permission to link or combine any covered work with a work licensed
under version 3 of the GNU Affero General Public License into a single
combined work, and to convey the resulting work. The terms of this
License will continue to apply to the part which is the covered work,
but the special requirements of the GNU Affero General Public License,
section 13, concerning interaction through a network will apply to the
combination as such.</p></div>
</div>
<div class="sect4">
<h5 id="_14_revised_versions_of_this_license">14. Revised Versions of this License.</h5>
<div class="paragraph"><p>The Free Software Foundation may publish revised and/or new versions
of the GNU General Public License from time to time. Such new versions
will be similar in spirit to the present version, but may differ in
detail to address new problems or concerns.</p></div>
<div class="paragraph"><p>Each version is given a distinguishing version number. If the Program
specifies that a certain numbered version of the GNU General Public
License "or any later version" applies to it, you have the option of
following the terms and conditions either of that numbered version or
of any later version published by the Free Software Foundation. If the
Program does not specify a version number of the GNU General Public
License, you may choose any version ever published by the Free
Software Foundation.</p></div>
<div class="paragraph"><p>If the Program specifies that a proxy can decide which future versions
of the GNU General Public License can be used, that proxy&#8217;s public
statement of acceptance of a version permanently authorizes you to
choose that version for the Program.</p></div>
<div class="paragraph"><p>Later license versions may give you additional or different
permissions.  However, no additional obligations are imposed on any
author or copyright holder as a result of your choosing to follow a
later version.</p></div>
</div>
<div class="sect4">
<h5 id="_15_disclaimer_of_warranty">15. Disclaimer of Warranty.</h5>
<div class="paragraph"><p>THERE IS NO WARRANTY FOR THE PROGRAM, TO THE EXTENT PERMITTED BY
APPLICABLE LAW. EXCEPT WHEN OTHERWISE STATED IN WRITING THE COPYRIGHT
HOLDERS AND/OR OTHER PARTIES PROVIDE THE PROGRAM "AS IS" WITHOUT
WARRANTY OF ANY KIND, EITHER EXPRESSED OR IMPLIED, INCLUDING, BUT NOT
LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
A PARTICULAR PURPOSE. THE ENTIRE RISK AS TO THE QUALITY AND
PERFORMANCE OF THE PROGRAM IS WITH YOU. SHOULD THE PROGRAM PROVE
DEFECTIVE, YOU ASSUME THE COST OF ALL NECESSARY SERVICING, REPAIR OR
CORRECTION.</p></div>
</div>
<div class="sect4">
<h5 id="_16_limitation_of_liability">16. Limitation of Liability.</h5>
<div class="paragraph"><p>IN NO EVENT UNLESS REQUIRED BY APPLICABLE LAW OR AGREED TO IN WRITING
WILL ANY COPYRIGHT HOLDER, OR ANY OTHER PARTY WHO MODIFIES AND/OR
CONVEYS THE PROGRAM AS PERMITTED ABOVE, BE LIABLE TO YOU FOR DAMAGES,
INCLUDING ANY GENERAL, SPECIAL, INCIDENTAL OR CONSEQUENTIAL DAMAGES
ARISING OUT OF THE USE OR INABILITY TO USE THE PROGRAM (INCLUDING BUT
NOT LIMITED TO LOSS OF DATA OR DATA BEING RENDERED INACCURATE OR
LOSSES SUSTAINED BY YOU OR THIRD PARTIES OR A FAILURE OF THE PROGRAM
TO OPERATE WITH ANY OTHER PROGRAMS), EVEN IF SUCH HOLDER OR OTHER
PARTY HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.</p></div>
</div>
<div class="sect4">
<h5 id="_17_interpretation_of_sections_15_and_16">17. Interpretation of Sections 15 and 16.</h5>
<div class="paragraph"><p>If the disclaimer of warranty and limitation of liability provided
above cannot be given local legal effect according to their terms,
reviewing courts shall apply local law that most closely approximates
an absolute waiver of all civil liability in connection with the
Program, unless a warranty or assumption of liability accompanies a
copy of the Program in return for a fee.</p></div>
</div>
</div>
<div class="sect4">
<h5 id="_end_of_terms_and_conditions">END OF TERMS AND CONDITIONS</h5>
</div>
</div>
</div>
</div>
</div>
<div id="footnotes"><hr></div>
<div id="footer">
<div id="footer-text">
Version 10.4.5<br>
Last updated 2013-01-27 12:21:50 CST
</div>
</div>
</body>
</html>
